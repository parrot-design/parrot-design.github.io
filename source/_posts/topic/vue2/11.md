---
title: ğŸ”¥Vue2ç»„ä»¶ç³»ç»Ÿ
permalink: posts/vue2-component.html
date: 2024-12-05 10:16
topic: vue2
banner: /assets/topic/vue2/banner/diff.jpg
---  

&nbsp;

{% button è¿”å› javascript:window.history.back() icon:solar:back-white color:orange size:xs %}

{% quot ä¸“æ ç¬¬åç¯‡-ç»„ä»¶ç³»ç»Ÿ %}

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨è¯´æ™®é€šçš„èŠ‚ç‚¹æ¸²æŸ“ï¼Œä½†æ˜¯å¾ˆå°‘æåŠç»„ä»¶ç›¸å…³çš„å†…å®¹ï¼Œè¿™èŠ‚ä¸­æˆ‘ä»¬å°±æŠŠâ€œç»„ä»¶â€å¥½å¥½çš„è¯´é“è¯´é“ã€‚

# ä¸€ã€å·¥ä½œä¸­é‡åˆ°çš„å›°æƒ‘

ç»„ä»¶æ˜¯Vueæ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ã€‚ç»„ä»¶ç³»ç»Ÿæä¾›äº†æ„å»ºå¯å¤ç”¨ã€å¯ç»´æŠ¤ä¸”æ€§èƒ½ä¼˜åŒ–çš„ç»„ä»¶çš„èƒ½åŠ›ã€‚

ä½¿ç”¨ç»„ä»¶åŠŸèƒ½ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦æ³¨å†Œç»„ä»¶ï¼Œç„¶åå°±å¯ä»¥åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨äº†ã€‚

{% box child:codeblock color:purple %}
```js 
// 1. ç¬¬ä¸€æ­¥å…ˆæ³¨å†Œç»„ä»¶
Vue.component('hello',{
    template:`<div>Hello World</div>`
})
// 2. ç¬¬äºŒæ­¥åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶
<template>
    <hello />
</template>
```
{% endbox %}

ä½†æ˜¯æˆ‘ä»¬å·¥ä½œä¸­æ€»ä¼šè«åå…¶å¦™çš„é‡åˆ°ç»„ä»¶æ³¨å†Œæ²¡æœ‰ç”Ÿæ•ˆçš„é—®é¢˜ã€‚

è¿™é‡Œåˆ—ä¸¾å‡ ä¸ªå¸¸è§çš„é”™è¯¯ã€‚

## 1.1 ç»„ä»¶æœªåœ¨Vueå®ä¾‹åŒ–ä¹‹å‰æ³¨å†Œ

æœ‰æ—¶å€™æˆ‘ä»¬ä¸æ¸…æ¥šç»„ä»¶æ³¨å†Œçš„åŸç†ï¼Œä¼šä¸‹æ„è¯†çš„è®¤ä¸ºæ— è®ºåœ¨å“ªé‡Œæ³¨å†Œç»„ä»¶ï¼Œéƒ½ä¼šæˆåŠŸæ³¨å†Œç»„ä»¶å¹¶åœ¨æ¨¡ç‰ˆä¸­å¯ä»¥æ­£ç¡®ä½¿ç”¨ã€‚

æ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬æ³¨å†Œçš„æ—¶æœºå°±ä¼šå­˜åœ¨é—®é¢˜ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š

{% box child:codeblock color:purple %}
```js 
// å…ˆæ¸²æŸ“æ¸²æŸ“Testç»„ä»¶
new Vue(Test)
// ç„¶åå†æ³¨å†Œç»„ä»¶
Vue.component('hello',{
    template:`<div>Hello World</div>`
})
// åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶
// Test.vue
<template>
    <hello />
</template>
```
{% endbox %}

ä¸Šé¢å…ˆå®ä¾‹åŒ–Vueæ¸²æŸ“Testç»„ä»¶ç„¶åå†æ³¨å†Œç»„ä»¶ï¼Œæ­¤æ—¶æµè§ˆå™¨æ— æ³•æ¸²æŸ“å‡ºTestç»„ä»¶å†…å®¹ã€‚

{% image /assets/topic/vue2/component/1.png %}

## 1.2 æ³¨å†Œç»„ä»¶æœªéµå¾ªå‘½åè§„èŒƒ

åœ¨Vueä¸­ï¼Œæ¨èä½¿ç”¨é©¼å³°å‘½åæ³•ä½œä¸ºç»„ä»¶åã€‚å¦‚æœæˆ‘ä»¬åœ¨æ³¨å†Œç»„ä»¶æ—¶ä½¿ç”¨äº†å¸¦æœ‰ä¸‹åˆ’çº¿å’ŒçŸ­æ¨ªçº¿çš„å‘½åæ–¹å¼ï¼ŒVueå°†æ— æ³•æ­£ç¡®è¯†åˆ«è¯¥ç»„ä»¶ã€‚

{% box child:codeblock color:purple %}
```js 
// å…ˆæ³¨å†Œç»„ä»¶ï¼ˆä½¿ç”¨çŸ­æ¨ªçº¿å‘½åç»„ä»¶åï¼‰
Vue.component('hello-c',{
    template:`<div>Hello World</div>`
})
// å†æ¸²æŸ“Testç»„ä»¶
new Vue(Test)

// åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶ï¼ˆä½¿ç”¨é©¼å³°æ³•ä½¿ç”¨ç»„ä»¶ï¼‰
// Test.vue
<template>
    <helloC />
</template>
```
{% endbox %}

å¦‚ä¸Šï¼Œåœ¨æ¨¡ç‰ˆå®šä¹‰æ—¶ä½¿ç”¨çŸ­æ¨ªçº¿å‘½åç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨æ¨¡ç‰ˆä¸­å°±æ— æ³•ä½¿ç”¨é©¼å³°å†™æ³•ï¼Œåä¹‹æ˜¯å¯ä»¥çš„ã€‚

{% image /assets/topic/vue2/component/2.png %}

## 1.3 ç»„ä»¶åç§°å†²çª

æœ‰æ—¶å½“ç³»ç»Ÿè¶³å¤Ÿå¤æ‚ã€ç»„ä»¶å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œç¼–å†™çš„ç»„ä»¶åé‡å¤æ˜¯å¾ˆå¸¸è§çš„ã€‚

å½“ä¸åŒçš„ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„åç§°æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¨å±€ç»„ä»¶æ³¨å†Œå¤±è´¥ã€‚Vueä¼šä¼˜å…ˆä½¿ç”¨æœ€åæ³¨å†Œçš„ç»„ä»¶ï¼Œè¦†ç›–ä¹‹å‰çš„åŒåç»„ä»¶ã€‚

{% box child:codeblock color:purple %}
```js 
// å…ˆæ³¨å†Œç»„ä»¶
Vue.component('HelloC',{
    template:`<div>Hello World1</div>`
})
// æ³¨å†ŒåŒåç»„ä»¶
Vue.component('HelloC',{
    template:`<div>Hello World2</div>`
})
// å†æ¸²æŸ“Testç»„ä»¶
new Vue(Test)

// åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶
// Test.vue
<template>
    <hello-c />
</template>
```
{% endbox %}

æ­¤æ—¶æµè§ˆå™¨ä¸­ä¼šæ¸²æŸ“ç¬¬äºŒæ¬¡ç»„ä»¶å®šä¹‰çš„æ¨¡ç‰ˆå†…å®¹ã€‚

ä¸Šé¢çš„è¿™å‡ ç§æƒ…å†µéƒ½æ˜¯æ¡†æ¶ç»™æˆ‘ä»¬è§„å®šçš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬å¸¦ç€è¿™å‡ ä¸ªç–‘é—®å†å»çœ‹Vueç»„ä»¶çš„æºç ã€‚

# äºŒã€ç»„ä»¶æ³¨å†Œçš„æ–¹å¼

ç»„ä»¶æ³¨å†Œçš„æ–¹å¼ä¸€èˆ¬æœ‰2ç§ï¼š{% u å…¨å±€æ³¨å†Œã€å±€éƒ¨æ³¨å†Œ %}ã€‚

## 2.1 å…¨å±€æ³¨å†ŒAPIï¼šVue.component

åœ¨[ä¸“æ ç¬¬ä¸‰ç¯‡](/posts/vue2-constructor.html)ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨Vueè¢«å¼•å…¥æ—¶è°ƒç”¨äº†initGlobalAPIå°†componentå±æ€§æŒ‚åœ¨åˆ°Vueæ„é€ å‡½æ•°ä¸Šã€‚

é‚£ä¹ˆVue.componentå†…éƒ¨ç©¶ç«Ÿåšäº†ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ

{% box child:codeblock color:purple %}
```js 
const ASSET_TYPES = ['component', 'directive', 'filter'];
export function initAssetRegisters(Vue){
    ASSET_TYPES.forEach(type => {
        Vue[type] = function(
            id,
            definition
        ){
            if (!definition) {
                return this.options[type + 's'][id]
            }else{
                /* istanbul ignore if */
                if (__DEV__ && type === 'component') {
                    validateComponentName(id)
                }
                if (type === 'component' && isPlainObject(definition)) {
                    // ä¼˜å…ˆå–name å¦‚æœæ²¡æœ‰å°±ä½¿ç”¨id
                    definition.name = definition.name || id
                    definition = this.options._base.extend(definition)
                }
                this.options[type + 's'][id] = definition
                return definition
            }
        }
    })
}
```
{% endbox %}

å¦‚æœä½ ä¹‹å‰çœ‹è¿‡[ä¸“æ ç¬¬äº”ç¯‡](/posts/vue2-merge-options.html)ï¼Œå¯¹äºä¸Šé¢è¿™æ®µä»£ç è‚¯å®šä¸€çœ¼å°±çœ‹å‡ºæ¥äº†ã€‚

åœ¨Vueè¢«å¼•å…¥æ—¶ï¼Œä¼šåœ¨æ„é€ å‡½æ•°çš„options.componentsæŒ‚è½½ä¸€äº›å†…éƒ¨ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š

{% image /assets/topic/vue2/component/4.jpg %}

è€Œä½¿ç”¨Vue.componentæ–¹æ³•å®é™…ä¸Šå°±æ˜¯åœ¨é€‰é¡¹çš„componentsä¸­æŒ‚è½½ä¸€äº›å…¶ä»–çš„ç»„ä»¶ã€‚

{% image /assets/topic/vue2/component/5.jpg %}
 

## 2.2 å±€éƒ¨æ³¨å†Œ

å¦‚æœä½ æƒ³æ³¨å†Œä¸€ä¸ªå†…éƒ¨ç»„ä»¶ï¼Œåªæƒ³åœ¨æŸä¸ªæ¨¡å—ä¸‹ä½¿ç”¨è¿™ä¸ªç»„ä»¶ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½ å¯ä»¥åœ¨ä½¿ç”¨çš„æ¨¡å—å†…éƒ¨å¼•å…¥è¿™ä¸ªç»„ä»¶ï¼Œå¹¶åœ¨é€‰é¡¹ä¸Šæ·»åŠ componentsé€‰é¡¹æ³¨å†Œåªåœ¨å½“å‰æ¨¡å—ä¸‹ä½¿ç”¨çš„ç»„ä»¶ã€‚

{% box child:codeblock color:purple %}
```vue
<!-- Test.vue -->
<template>  
    <!-- ä½¿ç”¨è¿™ä¸ªç»„ä»¶ -->
    <hello />
</template>

<script>
import Hello from "./Hello.vue"
export default {
    // åœ¨å½“å‰æ¨¡å—ä¸‹æ³¨å†Œå±€éƒ¨ç»„ä»¶
    components:{
        Hello
    }
}
</script>
```
{% endbox %}

{% image /assets/topic/vue2/component/6.jpg %}

# ä¸‰ã€ç»„ä»¶æ¸²æŸ“çš„æ ¸å¿ƒæµç¨‹

ç»è¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†Vueæ˜¯ä¸€ä¸ªåŸºäºè™šæ‹ŸDOMçš„å‰ç«¯æ¡†æ¶ã€‚

æ‰€ä»¥æ¸²æŸ“åˆ†ä¸º2æ­¥ï¼š{% u 1. è·å–éœ€è¦æ¸²æŸ“çš„è™šæ‹ŸDOM(vm._render())  2. å°†è™šæ‹ŸDOMå¯¹åº”çš„å†…å®¹æ¸²æŸ“åˆ°é¡µé¢ä¸Š(vm._update()) %}ã€‚

{% image /assets/topic/vue2/component/7.jpg %}

## 3.1 è·å–ç»„ä»¶çš„è™šæ‹ŸDOM

### 3.1.1 æ¨¡ç‰ˆç¼–è¯‘

æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨.vueæ–‡ä»¶å†…ç¼–å†™çš„å†…å®¹æœ€ç»ˆä¼šé€šè¿‡webpack+vue-loaderç¼–è¯‘æˆä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­templateçš„å†…å®¹ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªrenderå‡½æ•°ã€‚å¦‚ä¸‹ï¼Œåœ¨æ¨¡ç‰ˆä¸­ç¼–å†™äº†ä¸€ä¸ªç»„ä»¶æ ‡ç­¾ï¼š

{% box child:codeblock color:purple %}
```vue
<!-- Test.vue -->
<template>  
    <!-- ä½¿ç”¨è¿™ä¸ªç»„ä»¶ -->
    <hello />
</template>
```
{% endbox %}

ä¼šç¼–è¯‘æˆä¸‹é¢è¿™ç§renderå‡½æ•°ã€‚

{% image /assets/topic/vue2/component/8.png %}

_cå‡½æ•°æ˜¯createElementçš„ç¼©å†™å½¢å¼ï¼š

1. å¦‚æœæ˜¯æ™®é€šhtmlæ ‡ç­¾ï¼ŒcreateElementçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹åº”çš„æ ‡ç­¾å­—ç¬¦ä¸²å¦‚ï¼š{% u 'div' %}
2. å¦‚æœæ˜¯ç»„ä»¶æ ‡ç­¾ï¼ŒcreateElementçš„ç¬¬ä¸€ä¸ªå‚æ•°åŒæ ·æ˜¯å­—ç¬¦ä¸²ï¼Œä¸è¿‡å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯åœ¨æ¨¡ç‰ˆä¸­å†™çš„æ ‡ç­¾åç§°å¦‚ï¼š{% u 'hello' %}

### 3.1.2 createElementåˆ›å»ºvnode

å½“tagä¼ å…¥ä¸ºå­—ç¬¦ä¸²å¹¶ä¸”èƒ½å¤Ÿæ ¹æ®tagåœ¨ç»„ä»¶å®ä¾‹çš„$options.componentsä¸Šè·å–åˆ°å†…å®¹æ—¶ï¼Œåˆ™è°ƒç”¨createComponentç”Ÿæˆç»„ä»¶è™šæ‹ŸDOMã€‚

{% box child:codeblock color:purple %}
```js
export function _createElement(
    tag
){
    let vnode,Ctor
    if(typeof tag === 'string'){
        // å¦‚æœæ˜¯æ™®é€šæ ‡ç­¾ï¼Œå¦‚ï¼š'div'
        if (config.isReservedTag(tag)) {
        }else if(
            isDef((Ctor = resolveAsset(context.$options, 'components', tag)))
        ){
            vnode = createComponent(Ctor, data, context, children, tag)
        }
    }
}
```
{% endbox %}

#### 3.1.2.1 çŸ¥è¯†å›é¡¾-ç»„ä»¶å®ä¾‹é€‰é¡¹

å‰é¢æˆ‘ä»¬é€šè¿‡åœ¨å®ä¾‹çš„ç»„ä»¶é€‰é¡¹ä¸Šè·å–ï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œè¯´æ˜ç»„ä»¶æ³¨å†ŒæˆåŠŸï¼Œé‚£ä¹ˆæ³¨å†Œçš„ç»„ä»¶ä¸ºä»€ä¹ˆå¯ä»¥åœ¨vm.$options.componentsä¸Šè·å–åˆ°å‘¢ï¼Ÿ

åœ¨[ä¸“æ ç¬¬äº”ç¯‡](/posts/vue2-merge-options.html)ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“é™¤äº†{% u æ ¹Vueé¡µé¢å¤–ï¼Œæ¯ä¸€ä¸ªVueé¡µé¢éƒ½å­˜åœ¨ä¸€ä¸ªç»„ä»¶æ„é€ å‡½æ•°å’Œä¸€ä¸ªç»„ä»¶æ„é€ å‡½æ•°å®ä¾‹ %}ã€‚

è¿™ä¸ªç»„ä»¶æ„é€ å‡½æ•°æ˜¯åŸºäºVueæ„é€ å‡½æ•°åˆ›å»ºçš„ï¼Œä¸Šé¢çš„é€‰é¡¹åŒæ ·åˆå¹¶äº†Vueæ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚

åœ¨è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œå¦‚æœé‡åˆ°ç»„ä»¶ç±»å‹çš„è™šæ‹ŸDOMï¼Œä¼šä½¿ç”¨ç»„ä»¶æ„é€ å‡½æ•°å®ä¾‹åŒ–ï¼Œå¹¶åœ¨å®ä¾‹åŒ–æ—¶åˆå¹¶ä¼ å…¥çš„é€‰é¡¹ä»¥åŠå¯¹åº”æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚

æ‰€ä»¥ {% u å®ä¾‹ä¸Šçš„ç»„ä»¶é€‰é¡¹ = æ„é€ å‡½æ•°ä¼ å…¥çš„ç»„ä»¶é€‰é¡¹ + æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹ + Vueæ„é€ å‡½æ•°çš„é€‰é¡¹ %}

{% image /assets/topic/vue2/component/9.jpg %}

æ‰€ä»¥é€šè¿‡ä¸‹é¢2ç§æ–¹å¼æ³¨å†Œçš„ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡vm.$options.componentsè·å–åˆ°ï¼š

1. å…¨å±€æ³¨å†Œçš„ç»„ä»¶ï¼Œä¼šæŒ‚è½½åˆ°Vueæ„é€ å‡½æ•°çš„é€‰é¡¹ä¸Šã€‚
2. å±€éƒ¨æ³¨å†Œçš„ç»„ä»¶ï¼Œä¼šæŒ‚è½½åˆ°ç»„ä»¶æ„é€ å‡½æ•°çš„é€‰é¡¹ä¸Šã€‚

#### 3.1.2.2 resolveAssetè·å–å…·ä½“çš„ç»„ä»¶

{% box child:codeblock color:purple %}
```js
export function resolveAsset(
  options: Record<string, any>,
  type: string,
  id: string,
  warnMissing?: boolean
): any {
  /* istanbul ignore if */
  if (typeof id !== 'string') {
    return
  }
  const assets = options[type]
  // check local registration variations first
  if (hasOwn(assets, id)) return assets[id]
  const camelizedId = camelize(id)
  if (hasOwn(assets, camelizedId)) return assets[camelizedId]
  const PascalCaseId = capitalize(camelizedId)
  if (hasOwn(assets, PascalCaseId)) return assets[PascalCaseId]
  // fallback to prototype chain
  const res = assets[id] || assets[camelizedId] || assets[PascalCaseId]
  if (__DEV__ && warnMissing && !res) {
    warn('Failed to resolve ' + type.slice(0, -1) + ': ' + id)
  }
  return res
}
```
{% endbox %}

resolveAsset å‡½æ•°æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥è§£æç»„ä»¶ä¸­çš„èµ„æºï¼Œæ”¯æŒå¤šç§å‘½åçº¦å®šï¼Œå¹¶ä¸”åœ¨èµ„æºæœªæ‰¾åˆ°æ—¶æä¾›è­¦å‘Šã€‚

å¯ä»¥çœ‹å‡ºæ¥å¹¶ä¸ä¸€å®šè¦å±æ€§åå®Œå…¨ä¸€è‡´æ‰å¯ä»¥åŒ¹é…æˆåŠŸã€‚

1. ç¬¬ä¸€æ­¥å…ˆæ ¹æ®ä¼ å…¥çš„å±æ€§ååœ¨èµ„æºå¯¹è±¡æœ¬èº«çš„å±æ€§ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰å®Œå…¨ä¸€è‡´çš„ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„èµ„æºï¼›å¦‚æœæ²¡æœ‰ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚
2. ç¬¬äºŒæ­¥å°†ä¼ å…¥çš„å±æ€§åç”±ä¸­æ¨ªçº¿è½¬åŒ–ä¸ºå°é©¼å³°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å†åœ¨èµ„æºå¯¹è±¡æœ¬èº«çš„å±æ€§ä¸­è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„èµ„æºï¼›å¦‚æœæ²¡æœ‰ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚
3. ç¬¬ä¸‰æ­¥å°†ä¼ å…¥çš„å±æ€§åé¦–å­—æ¯å¤§å†™å†åœ¨èµ„æºå¯¹è±¡æœ¬èº«çš„å±æ€§ä¸­è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„èµ„æºï¼›å¦‚æœæ²¡æœ‰ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚
4. ç¬¬å››æ­¥åœ¨å¯¹è±¡çš„åŸå‹ä¸ŠæŸ¥æ‰¾å¯¹åº”çš„å±æ€§ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„èµ„æºã€‚å¦åˆ™ï¼ŒæŠ¥é”™æŸ¥æ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºã€‚

#### 3.1.2.3 createComponentåˆ›å»ºç»„ä»¶çš„è™šæ‹ŸDOM 

{% box child:codeblock color:purple %}
```js
export function createComponent(
  Ctor: typeof Component | Function | ComponentOptions | void,
  data: VNodeData | undefined,
  context: Component,
  children?: Array<VNode>,
  tag?: string
): VNode | Array<VNode> | void {
  // åˆ›å»ºç»„ä»¶è™šæ‹ŸèŠ‚ç‚¹ä¸€å®šè¦æœ‰ç»„ä»¶çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ç»„ä»¶çš„å†…å®¹ï¼Œç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œåˆ›å»ºã€‚
  if (isUndef(Ctor)) {
    return
  }
  // è·å–åˆ›å»ºç»„ä»¶æ„é€ å‡½æ•°çš„åŸºç±»æ„é€ å‡½æ•°ï¼šVue
  const baseCtor = context.$options._base

  // åˆ¤æ–­ç»„ä»¶å†…å®¹æ˜¯å¯¹è±¡ï¼Œè°ƒç”¨extendæ–¹æ³•ç”Ÿæˆç»„ä»¶æ„é€ å‡½æ•°
  if (isObject(Ctor)) {
    Ctor = baseCtor.extend(Ctor as typeof Component)
  }

  // ç»„ä»¶æ„é€ å‡½æ•°ä¸€å®šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¦‚æœç»„ä»¶æ„é€ å‡½æ•°ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç›´æ¥æŠ¥é”™éæ³•çš„ç»„ä»¶å®šä¹‰
  if (typeof Ctor !== 'function') {
    if (__DEV__) {
      warn(`Invalid Component definition: ${String(Ctor)}`, context)
    }
    return
  }

  // å¼‚æ­¥ç»„ä»¶
  let asyncFactory
  // @ts-expect-error
  if (isUndef(Ctor.cid)) {
    asyncFactory = Ctor
    Ctor = resolveAsyncComponent(asyncFactory, baseCtor)
    if (Ctor === undefined) {
      // return a placeholder node for async component, which is rendered
      // as a comment node but preserves all the raw information for the node.
      // the information will be used for async server-rendering and hydration.
      return createAsyncPlaceholder(asyncFactory, data, context, children, tag)
    }
  }

  // è®¾ç½®data
  data = data || {}

  // é˜²æ­¢åœ¨æ„é€ å‡½æ•°å®åŠ›åŒ–ååº”ç”¨å…¨å±€æ··åˆ
  resolveConstructorOptions(Ctor as typeof Component)

  // è½¬åŒ–ç»„ä»¶çš„model
  if (isDef(data.model)) {
    // @ts-expect-error
    transformModel(Ctor.options, data)
  }

  // props
  const propsData = extractPropsFromVNodeData(data, Ctor, tag)

  // å‡½æ•°ç»„ä»¶
  if (isTrue(Ctor.options.functional)) {
    return createFunctionalComponent(
      Ctor as typeof Component,
      propsData,
      data,
      context,
      children
    )
  }

  // ç›‘å¬å™¨
  const listeners = data.on
  // replace with listeners with .native modifier
  // so it gets processed during parent component patch.
  data.on = data.nativeOn

  // @ts-expect-error
  if (isTrue(Ctor.options.abstract)) {
    // abstract components do not keep anything
    // other than props & listeners & slot

    // work around flow
    const slot = data.slot
    data = {}
    if (slot) {
      data.slot = slot
    }
  }

  // install component management hooks onto the placeholder node
  installComponentHooks(data)

  // return a placeholder vnode
  // @ts-expect-error
  const name = getComponentName(Ctor.options) || tag
  const vnode = new VNode(
    // @ts-expect-error
    `vue-component-${Ctor.cid}${name ? `-${name}` : ''}`,
    data,
    undefined,
    undefined,
    undefined,
    context,
    // @ts-expect-error
    { Ctor, propsData, listeners, tag, children },
    asyncFactory
  )

  return vnode
}
```
{% endbox %}
 
è¿™ä¸ªå‡½æ•°ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªæ ¸å¿ƒåŠŸèƒ½ç‚¹ï¼š

1. åˆ›å»ºç»„ä»¶æ„é€ å‡½æ•°

ä½¿ç”¨Vue.extendåˆ›å»ºç»„ä»¶æ„é€ å‡½æ•°Ctorã€‚

2. å¤„ç†propã€modelã€å¼‚æ­¥ç»„ä»¶ã€å‡½æ•°ç»„ä»¶ç­‰ã€‚

3. è°ƒç”¨componentVNodeHooksæ–¹æ³•åœ¨dataä¸Šå®šä¹‰ä¸€äº›hookï¼Œåœ¨åç»­æ¸²æŸ“æ—¶è°ƒç”¨ã€‚

4. å°†Ctorç­‰å±æ€§æ”¾åœ¨VNodeçš„componentOptionså±æ€§ä¸Šã€‚

ä¸‹å›¾æ˜¯æ™®é€šè™šæ‹ŸèŠ‚ç‚¹å’Œç»„ä»¶è™šæ‹ŸèŠ‚ç‚¹å¸¸ç”¨å±æ€§çš„å·®å¼‚å¯¹æ¯”ã€‚

{% image /assets/topic/vue2/component/10.jpg %}

## 3.2 æ¸²æŸ“ç»„ä»¶VNode

### 3.2.1 å›é¡¾ä¸‹æ™®é€šè™šæ‹ŸèŠ‚ç‚¹åˆ›å»ºçœŸå®DOMçš„æµç¨‹