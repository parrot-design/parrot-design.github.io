---
title: ğŸ”¥Vue2ç»„ä»¶ç³»ç»Ÿ
permalink: posts/vue2-component.html
date: 2024-12-05 10:16
topic: vue2
banner: /assets/topic/vue2/banner/diff.jpg
---  

&nbsp;

{% button è¿”å› javascript:window.history.back() icon:solar:back-white color:orange size:xs %}

{% quot ä¸“æ ç¬¬åç¯‡-ç»„ä»¶ç³»ç»Ÿ %}

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨è¯´æ™®é€šçš„èŠ‚ç‚¹æ¸²æŸ“ï¼Œä½†æ˜¯å¾ˆå°‘æåŠç»„ä»¶ç›¸å…³çš„å†…å®¹ï¼Œè¿™èŠ‚ä¸­æˆ‘ä»¬å°±æŠŠâ€œç»„ä»¶â€å¥½å¥½çš„è¯´é“è¯´é“ã€‚

# ä¸€ã€å·¥ä½œä¸­é‡åˆ°çš„å›°æƒ‘

ç»„ä»¶æ˜¯Vueæ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ã€‚ç»„ä»¶ç³»ç»Ÿæä¾›äº†æ„å»ºå¯å¤ç”¨ã€å¯ç»´æŠ¤ä¸”æ€§èƒ½ä¼˜åŒ–çš„ç»„ä»¶çš„èƒ½åŠ›ã€‚

ä½¿ç”¨ç»„ä»¶åŠŸèƒ½ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦æ³¨å†Œç»„ä»¶ï¼Œç„¶åå°±å¯ä»¥åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨äº†ã€‚

{% box child:codeblock color:purple %}
```js 
// 1. ç¬¬ä¸€æ­¥å…ˆæ³¨å†Œç»„ä»¶
Vue.component('hello',{
    template:`<div>Hello World</div>`
})
// 2. ç¬¬äºŒæ­¥åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶
<template>
    <hello />
</template>
```
{% endbox %}

ä½†æ˜¯æˆ‘ä»¬å·¥ä½œä¸­æ€»ä¼šè«åå…¶å¦™çš„é‡åˆ°ç»„ä»¶æ³¨å†Œæ²¡æœ‰ç”Ÿæ•ˆçš„é—®é¢˜ã€‚

è¿™é‡Œåˆ—ä¸¾å‡ ä¸ªå¸¸è§çš„é”™è¯¯ã€‚

## 1.1 ç»„ä»¶æœªåœ¨Vueå®ä¾‹åŒ–ä¹‹å‰æ³¨å†Œ

æœ‰æ—¶å€™æˆ‘ä»¬ä¸æ¸…æ¥šç»„ä»¶æ³¨å†Œçš„åŸç†ï¼Œä¼šä¸‹æ„è¯†çš„è®¤ä¸ºæ— è®ºåœ¨å“ªé‡Œæ³¨å†Œç»„ä»¶ï¼Œéƒ½ä¼šæˆåŠŸæ³¨å†Œç»„ä»¶å¹¶åœ¨æ¨¡ç‰ˆä¸­å¯ä»¥æ­£ç¡®ä½¿ç”¨ã€‚

æ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬æ³¨å†Œçš„æ—¶æœºå°±ä¼šå­˜åœ¨é—®é¢˜ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š

{% box child:codeblock color:purple %}
```js 
// å…ˆæ¸²æŸ“æ¸²æŸ“Testç»„ä»¶
new Vue(Test)
// ç„¶åå†æ³¨å†Œç»„ä»¶
Vue.component('hello',{
    template:`<div>Hello World</div>`
})
// åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶
// Test.vue
<template>
    <hello />
</template>
```
{% endbox %}

ä¸Šé¢å…ˆå®ä¾‹åŒ–Vueæ¸²æŸ“Testç»„ä»¶ç„¶åå†æ³¨å†Œç»„ä»¶ï¼Œæ­¤æ—¶æµè§ˆå™¨æ— æ³•æ¸²æŸ“å‡ºTestç»„ä»¶å†…å®¹ã€‚

{% image /assets/topic/vue2/component/1.png %}

## 1.2 æ³¨å†Œç»„ä»¶æœªéµå¾ªå‘½åè§„èŒƒ

åœ¨Vueä¸­ï¼Œæ¨èä½¿ç”¨é©¼å³°å‘½åæ³•ä½œä¸ºç»„ä»¶åã€‚å¦‚æœæˆ‘ä»¬åœ¨æ³¨å†Œç»„ä»¶æ—¶ä½¿ç”¨äº†å¸¦æœ‰ä¸‹åˆ’çº¿å’ŒçŸ­æ¨ªçº¿çš„å‘½åæ–¹å¼ï¼ŒVueå°†æ— æ³•æ­£ç¡®è¯†åˆ«è¯¥ç»„ä»¶ã€‚

{% box child:codeblock color:purple %}
```js 
// å…ˆæ³¨å†Œç»„ä»¶ï¼ˆä½¿ç”¨çŸ­æ¨ªçº¿å‘½åç»„ä»¶åï¼‰
Vue.component('hello-c',{
    template:`<div>Hello World</div>`
})
// å†æ¸²æŸ“Testç»„ä»¶
new Vue(Test)

// åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶ï¼ˆä½¿ç”¨é©¼å³°æ³•ä½¿ç”¨ç»„ä»¶ï¼‰
// Test.vue
<template>
    <helloC />
</template>
```
{% endbox %}

å¦‚ä¸Šï¼Œåœ¨æ¨¡ç‰ˆå®šä¹‰æ—¶ä½¿ç”¨çŸ­æ¨ªçº¿å‘½åç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨æ¨¡ç‰ˆä¸­å°±æ— æ³•ä½¿ç”¨é©¼å³°å†™æ³•ï¼Œåä¹‹æ˜¯å¯ä»¥çš„ã€‚

{% image /assets/topic/vue2/component/2.png %}

## 1.3 ç»„ä»¶åç§°å†²çª

æœ‰æ—¶å½“ç³»ç»Ÿè¶³å¤Ÿå¤æ‚ã€ç»„ä»¶å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œç¼–å†™çš„ç»„ä»¶åé‡å¤æ˜¯å¾ˆå¸¸è§çš„ã€‚

å½“ä¸åŒçš„ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„åç§°æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¨å±€ç»„ä»¶æ³¨å†Œå¤±è´¥ã€‚Vueä¼šä¼˜å…ˆä½¿ç”¨æœ€åæ³¨å†Œçš„ç»„ä»¶ï¼Œè¦†ç›–ä¹‹å‰çš„åŒåç»„ä»¶ã€‚

{% box child:codeblock color:purple %}
```js 
// å…ˆæ³¨å†Œç»„ä»¶
Vue.component('HelloC',{
    template:`<div>Hello World1</div>`
})
// æ³¨å†ŒåŒåç»„ä»¶
Vue.component('HelloC',{
    template:`<div>Hello World2</div>`
})
// å†æ¸²æŸ“Testç»„ä»¶
new Vue(Test)

// åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ç»„ä»¶
// Test.vue
<template>
    <hello-c />
</template>
```
{% endbox %}

æ­¤æ—¶æµè§ˆå™¨ä¸­ä¼šæ¸²æŸ“ç¬¬äºŒæ¬¡ç»„ä»¶å®šä¹‰çš„æ¨¡ç‰ˆå†…å®¹ã€‚

ä¸Šé¢çš„è¿™å‡ ç§æƒ…å†µéƒ½æ˜¯æ¡†æ¶ç»™æˆ‘ä»¬è§„å®šçš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬å¸¦ç€è¿™å‡ ä¸ªç–‘é—®å†å»çœ‹Vueç»„ä»¶çš„æºç ã€‚

# äºŒã€ç»„ä»¶æ³¨å†Œçš„æ–¹å¼

ç»„ä»¶æ³¨å†Œçš„æ–¹å¼ä¸€èˆ¬æœ‰2ç§ï¼š{% u å…¨å±€æ³¨å†Œã€å±€éƒ¨æ³¨å†Œ %}ã€‚

## 2.1 å…¨å±€æ³¨å†ŒAPIï¼šVue.component

åœ¨[ä¸“æ ç¬¬ä¸‰ç¯‡](/posts/vue2-constructor.html)ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨Vueè¢«å¼•å…¥æ—¶è°ƒç”¨äº†initGlobalAPIå°†componentå±æ€§æŒ‚åœ¨åˆ°Vueæ„é€ å‡½æ•°ä¸Šã€‚

é‚£ä¹ˆVue.componentå†…éƒ¨ç©¶ç«Ÿåšäº†ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ

{% box child:codeblock color:purple %}
```js 
const ASSET_TYPES = ['component', 'directive', 'filter'];
export function initAssetRegisters(Vue){
    ASSET_TYPES.forEach(type => {
        Vue[type] = function(
            id,
            definition
        ){
            if (!definition) {
                return this.options[type + 's'][id]
            }else{
                /* istanbul ignore if */
                if (__DEV__ && type === 'component') {
                    validateComponentName(id)
                }
                if (type === 'component' && isPlainObject(definition)) {
                    // ä¼˜å…ˆå–name å¦‚æœæ²¡æœ‰å°±ä½¿ç”¨id
                    definition.name = definition.name || id
                    definition = this.options._base.extend(definition)
                }
                this.options[type + 's'][id] = definition
                return definition
            }
        }
    })
}
```
{% endbox %}

å¦‚æœä½ ä¹‹å‰çœ‹è¿‡[ä¸“æ ç¬¬äº”ç¯‡](/posts/vue2-merge-options.html)ï¼Œå¯¹äºä¸Šé¢è¿™æ®µä»£ç è‚¯å®šä¸€çœ¼å°±çœ‹å‡ºæ¥äº†ã€‚

åœ¨Vueè¢«å¼•å…¥æ—¶ï¼Œä¼šåœ¨æ„é€ å‡½æ•°çš„options.componentsæŒ‚è½½ä¸€äº›å†…éƒ¨ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š

{% image /assets/topic/vue2/component/4.jpg %}

è€Œä½¿ç”¨Vue.componentæ–¹æ³•å®é™…ä¸Šå°±æ˜¯åœ¨é€‰é¡¹çš„componentsä¸­æŒ‚è½½ä¸€äº›å…¶ä»–çš„ç»„ä»¶ã€‚

{% image /assets/topic/vue2/component/5.jpg %}
 

## 2.2 å±€éƒ¨æ³¨å†Œ

å¦‚æœä½ æƒ³æ³¨å†Œä¸€ä¸ªå†…éƒ¨ç»„ä»¶ï¼Œåªæƒ³åœ¨æŸä¸ªæ¨¡å—ä¸‹ä½¿ç”¨è¿™ä¸ªç»„ä»¶ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½ å¯ä»¥åœ¨ä½¿ç”¨çš„æ¨¡å—å†…éƒ¨å¼•å…¥è¿™ä¸ªç»„ä»¶ï¼Œå¹¶åœ¨é€‰é¡¹ä¸Šæ·»åŠ componentsé€‰é¡¹æ³¨å†Œåªåœ¨å½“å‰æ¨¡å—ä¸‹ä½¿ç”¨çš„ç»„ä»¶ã€‚

{% box child:codeblock color:purple %}
```vue
<!-- Test.vue -->
<template>  
    <!-- ä½¿ç”¨è¿™ä¸ªç»„ä»¶ -->
    <hello />
</template>

<script>
import Hello from "./Hello.vue"
export default {
    // åœ¨å½“å‰æ¨¡å—ä¸‹æ³¨å†Œå±€éƒ¨ç»„ä»¶
    components:{
        Hello
    }
}
</script>
```
{% endbox %}

{% image /assets/topic/vue2/component/6.jpg %}

# ä¸‰ã€ç»„ä»¶æ³¨å†Œçš„åŸç†

ç»„ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š
 
{% box child:codeblock color:purple %}
```js
// ç»„ä»¶å®šä¹‰å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡
const MyComponent = {
    name: 'MyComponent',
    data(){
        return { foo:1 }
    }
}
```
{% endbox %}

## 3.1 ç»„ä»¶çš„è™šæ‹ŸDOM

Vueæ˜¯åŸºäºè™šæ‹ŸDOMæ¸²æŸ“é¡µé¢çš„æ¡†æ¶ï¼Œç»„ä»¶åˆ™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„è™šæ‹ŸDOMèŠ‚ç‚¹ã€‚

ä¾‹å¦‚ï¼Œä¸ºäº†æè¿°æ™®é€šæ ‡ç­¾ï¼Œæˆ‘ä»¬ç”¨è™šæ‹ŸèŠ‚ç‚¹çš„vnode.tagå±æ€§æ¥å­˜å‚¨æ ‡ç­¾åç§°ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š

{% box child:codeblock color:purple %}
```js
// è¯¥vnodeç”¨æ¥æè¿°æ™®é€šæ ‡ç­¾
const MyComponent = {
    tag: 'div'
    // ...
}
```
{% endbox %}

åœ¨Vueçš„æ¸²æŸ“èŠ‚ç‚¹ä¼šæ ¹æ®è™šæ‹ŸèŠ‚ç‚¹çš„ç±»å‹æ¥èµ°ä¸åŒçš„é€»è¾‘æ¥åˆ›å»ºçœŸå®DOMã€‚

<!-- å’Œåˆ›å»ºæ™®é€šèŠ‚ç‚¹è™šæ‹ŸDOMçš„æ–¹å¼ä¸€æ ·ï¼Œç»„ä»¶èŠ‚ç‚¹åŒæ ·ä½¿ç”¨createElementæ–¹æ³•æ¥åˆ›å»ºè™šæ‹ŸDOMã€‚ 

{% box child:codeblock color:purple %}
```js
// çœç•¥éƒ¨åˆ†ä»£ç 
export function _createElement(tag){
    if(typeof tag === 'string'){
        let Ctor ; 
        if(isDef(Ctor = resolveAsset(context.$options, 'components', tag))){
            vnode = createComponent(Ctor, data, context, children, tag)
        }
    }else{
        vnode = createComponent(tag as any, data, context, children)
    }
}
```
{% endbox %}

åœ¨åˆ›å»ºç»„ä»¶VNodeæ—¶ï¼Œä¼šä½¿ç”¨resolveAssetæ¥è·å–ç»„ä»¶çš„å†…å®¹ã€‚  -->

 

 