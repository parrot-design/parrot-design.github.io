---
title: ğŸ”¥Vue2æ¸²æŸ“åŸºç¡€
permalink: posts/vue2-vnode.html
date: 2024-11-13 15:55
topic: vue2
banner: /assets/topic/vue2/banner/vnode.png
--- 

{% quot ä¸“æ ç¬¬å…­ç¯‡-è™šæ‹ŸèŠ‚ç‚¹ä»¥åŠcreateElementå‡½æ•° %}

åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Vueåˆå§‹åŒ–çš„ä¸€ç³»åˆ—æ“ä½œã€‚

Vueæ¡†æ¶ä¸å°±æ˜¯ç”¨æ¥ç”»é¡µé¢çš„å—ã€‚

æˆ‘æƒ³è¯´æ˜¯çš„ï¼Œåé¢çš„ç« èŠ‚å°±å¸¦ç€å¤§å®¶æ¥è§£ææ¸²æŸ“ç›¸å…³çš„é€»è¾‘ã€‚

ä½†æ˜¯åœ¨è§£ææ¸²æŸ“ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ vueæ¡†æ¶æ¸²æŸ“çš„åŸºç¡€ï¼Œè™šæ‹Ÿ DOMã€‚

# ä¸€ã€æ¸²æŸ“å™¨çš„æ¸²æŸ“æµç¨‹  

åœ¨è®¨è®ºè™šæ‹ŸèŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æµè§ˆå™¨æ¸²æŸ“çš„æµç¨‹ã€‚

å½“æµè§ˆå™¨æ¥æ”¶åˆ°ä¸€ä¸ª HTML æ–‡ä»¶åï¼ŒJavaScript å¼•æ“ä¸æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“éšå³å¼€å§‹è¿è¡Œã€‚

ä»æ¸²æŸ“å¼•æ“çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒé¦–å…ˆä¼šæŠŠ HTML æ–‡ä»¶è§£æä¸ºä¸€ä¸ª DOM æ ‘ã€‚

ä¸æ­¤åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šè¯†åˆ«å¹¶åŠ è½½ CSS æ ·å¼ï¼Œç„¶åå°†å…¶ä¸ DOM æ ‘åˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚

åœ¨æœ‰äº†æ¸²æŸ“æ ‘ä¹‹åï¼Œæ¸²æŸ“å¼•æ“ä¼šè®¡ç®—æ‰€æœ‰å…ƒç´ çš„ä½ç½®ä¿¡æ¯ï¼Œæœ€åé€šè¿‡ç»˜åˆ¶æ“ä½œï¼Œåœ¨å±å¹•ä¸Šå‘ˆç°å‡ºæœ€ç»ˆçš„å†…å®¹ã€‚

JavaScript å¼•æ“å’Œæ¸²æŸ“å¼•æ“è™½ç„¶å¤„äºä¸¤ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¹‹ä¸­ï¼Œç„¶è€Œ JavaScript å¼•æ“å´èƒ½å¤Ÿè§¦å‘æ¸²æŸ“å¼•æ“å¼€å§‹å·¥ä½œã€‚

å½“æˆ‘ä»¬å€ŸåŠ©è„šæœ¬å»æ›´æ”¹å…ƒç´ çš„ä½ç½®æˆ–è€…å¤–è§‚æ—¶ï¼ŒJavaScript å¼•æ“ä¼šè¿ç”¨ä¸ DOM ç›¸å…³çš„ API æ–¹æ³•æ¥æ“ä½œ DOM å¯¹è±¡ã€‚

æ­¤æ—¶æ¸²æŸ“å¼•æ“ä¾¿å¼€å§‹è¿ä½œï¼Œæ¸²æŸ“å¼•æ“ä¼šè§¦å‘å›æµæˆ–è€…é‡ç»˜æ“ä½œã€‚

æˆ‘ä»¬æ¥äº†è§£ä¸‹å›æµä»¥åŠé‡ç»˜çš„æ¦‚å¿µï¼š

*   å›æµï¼šå½“æˆ‘ä»¬å¯¹DOMçš„ä¿®æ”¹å¼•å‘äº†{% mark å…ƒç´ å°ºå¯¸çš„å˜åŒ– color:orange %}æ—¶ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼Œæœ€åå°†é‡æ–°è®¡ç®—çš„ç»“æœç»˜åˆ¶å‡ºæ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›æµã€‚

*   é‡ç»˜ï¼šå½“æˆ‘ä»¬å¯¹DOMçš„ä¿®æ”¹åªå•çº¯{% mark æ”¹å˜å…ƒç´ çš„é¢œè‰² color:orange %}æ—¶ï¼Œæµè§ˆå™¨æ­¤æ—¶å¹¶ä¸éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼Œè€Œåªè¦é‡æ–°ç»˜åˆ¶æ–°æ ·å¼ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé‡ç»˜ã€‚

{% mark å¾ˆæ˜¾ç„¶ï¼Œå›æµæ¯”èµ·é‡ç»˜æ›´åŠ æ¶ˆè€—æ€§èƒ½ã€‚ color:orange %}

é€šè¿‡äº†è§£æµè§ˆå™¨åŸºæœ¬çš„æ¸²æŸ“æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸éš¾è”æƒ³åˆ°ï¼Œå½“ä¸æ–­åœ°é€šè¿‡ JavaScript ä¿®æ”¹ DOM æ—¶ï¼Œå¾ˆå®¹æ˜“åœ¨ä¸ç»æ„é—´è§¦å‘æ¸²æŸ“å¼•æ“çš„å›æµæˆ–è€…é‡ç»˜ï¼Œè€Œè¿™ç§æ“ä½œæ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€æ˜¯éå¸¸å·¨å¤§çš„ã€‚

å› æ­¤ï¼Œä¸ºäº†é™ä½æ€§èƒ½å¼€é”€ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°½å¯èƒ½åœ°å‡å°‘å¯¹ DOM çš„æ“ä½œã€‚

è™šæ‹ŸèŠ‚ç‚¹å°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹å­•è‚²è€Œç”Ÿã€‚
 

# äºŒ. ç¼“å†²å±‚-è™šæ‹ŸDOM

è™šæ‹Ÿ DOM ï¼ˆVirtual DOM ä»¥ä¸‹ç®€ç§° VDOMï¼‰æ˜¯ä¸ºäº†è§£å†³é¢‘ç¹æ“ä½œ DOM æ‰€å¼•å‘çš„æ€§èƒ½é—®é¢˜è€Œäº§ç”Ÿçš„äº§ç‰©ã€‚

VDOMæ˜¯æŠŠé¡µé¢çš„çŠ¶æ€æŠ½è±¡æˆ JS å¯¹è±¡çš„å½¢å¼å‘ˆç°ã€‚

ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒå¤„äº JS ä¸çœŸå® DOM ä¹‹é—´ï¼Œèµ·ç€ä¸­é—´å±‚çš„ä½œç”¨ã€‚

å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ JS è„šæœ¬è¿›è¡Œå¤§æ‰¹é‡çš„ DOM æ“ä½œæ—¶ï¼Œä¼šä¼˜å…ˆåœ¨è™šæ‹Ÿ VDOM è¿™ä¸ª JS å¯¹è±¡ä¸Šè¿›è¡Œæ“ä½œã€‚

æœ€åï¼Œé€šè¿‡å¯¹æ¯”æ‰¾å‡ºå°†è¦æ”¹åŠ¨çš„éƒ¨åˆ†ï¼Œå¹¶å°†è¿™äº›æ”¹åŠ¨é€šçŸ¥å¹¶æ›´æ–°åˆ°çœŸå®çš„ DOM ä¸Šã€‚

å°½ç®¡æœ€ç»ˆä»ç„¶æ˜¯å¯¹çœŸå®çš„ DOM è¿›è¡Œæ“ä½œï¼Œç„¶è€Œè™šæ‹Ÿ DOM èƒ½å¤Ÿå°†å¤šä¸ªæ”¹åŠ¨åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹é‡æ“ä½œã€‚

è¿™æ ·åšå¯ä»¥å‡å°‘ DOM é‡æ’çš„æ¬¡æ•°ï¼Œè¿›è€Œç¼©çŸ­ç”Ÿæˆæ¸²æŸ“æ ‘ä»¥åŠè¿›è¡Œç»˜åˆ¶æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªçœŸå®çš„ DOM å…·ä½“åŒ…å«äº†å“ªäº›å†…å®¹ã€‚

{% image /assets/topic/vue2/vnode/1.png %}

æµè§ˆå™¨å°†çœŸå®çš„ DOM è®¾è®¡å¾—æä¸ºå¤æ‚ã€‚

å®ƒä¸ä½†åŒ…å«äº†è‡ªèº«çš„å±æ€§æè¿°ï¼Œå¦‚å¤§å°ã€ä½ç½®ç­‰å®šä¹‰ï¼Œè¿˜å›Šæ‹¬äº† DOM æ‰€æ‹¥æœ‰çš„æµè§ˆå™¨äº‹ä»¶ç­‰å†…å®¹ã€‚

æ­£æ˜¯ç”±äºå…¶å¦‚æ­¤å¤æ‚çš„ç»“æ„ï¼Œæˆ‘ä»¬é¢‘ç¹åœ°å»æ“ä½œ DOM æˆ–å¤šæˆ–å°‘ä¼šç»™æµè§ˆå™¨å¸¦æ¥æ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚

è€Œä½œä¸ºæ•°æ®ä¸çœŸå® DOM ä¹‹é—´çš„ä¸€å±‚ç¼“å†²ï¼Œè™šæ‹Ÿ DOM åªæ˜¯ç”¨äºæ˜ å°„åˆ°çœŸå® DOM è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åŒ…å«æ“ä½œ DOM çš„æ–¹æ³•ã€‚

å®ƒåªéœ€åœ¨å¯¹è±¡ä¸­é‡ç‚¹å…³æ³¨å‡ ä¸ªå±æ€§å°±å¯ä»¥äº†ã€‚

# ä¸‰ã€ VNode

{% box child:codeblock color:purple %}
```js
// çœŸå®DOM
<div id="app"><span>Hello World</span></div>

// çœŸå®DOMå¯¹åº”çš„JSå¯¹è±¡(VNode)
{
  tag:'div',
  data:{
    id:'app'
  },
  children:[{
    tag:'span',
    children:[
      {
        tag:undefined,
        text:'Hello World'
      }
    ]
  }]
} 
```
{% endbox %}

é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥{% mark æ¯ä¸€ä¸ª DOMèŠ‚ç‚¹ éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ª VNode æ¥è¡¨ç¤º color:orange %}ã€‚

åœ¨ Vueå†…éƒ¨ï¼Œä½¿ç”¨ VNode è¿™ä¸ªæ„é€ å‡½æ•°å»æè¿°ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 

{% box child:codeblock color:purple %}
```js
export default class VNode {
  tag?: string
  data: VNodeData | undefined
  children?: Array<VNode> | null
  text?: string
  elm: Node | undefined
  ns?: string
  context?: Component // rendered in this component's scope
  key: string | number | undefined
  componentOptions?: VNodeComponentOptions
  componentInstance?: Component // component instance
  parent: VNode | undefined | null // component placeholder node

  // strictly internal
  raw: boolean // contains raw HTML? (server only)
  isStatic: boolean // hoisted static node
  isRootInsert: boolean // necessary for enter transition check
  isComment: boolean // empty comment placeholder?
  isCloned: boolean // is a cloned node?
  isOnce: boolean // is a v-once node?
  asyncFactory?: Function // async component factory function
  asyncMeta: Object | void
  isAsyncPlaceholder: boolean
  ssrContext?: Object | void
  fnContext: Component | void // real context vm for functional nodes
  fnOptions?: ComponentOptions | null // for SSR caching
  devtoolsMeta?: Object | null // used to store functional render context for devtools
  fnScopeId?: string | null // functional scope id support
  isComponentRootElement?: boolean | null // for SSR directives

  constructor(
    tag?: string,
    data?: VNodeData,
    children?: Array<VNode> | null,
    text?: string,
    elm?: Node,
    context?: Component,
    componentOptions?: VNodeComponentOptions,
    asyncFactory?: Function
  ) {
    this.tag = tag
    this.data = data
    this.children = children
    this.text = text
    this.elm = elm
    this.ns = undefined
    this.context = context
    this.fnContext = undefined
    this.fnOptions = undefined
    this.fnScopeId = undefined
    this.key = data && data.key
    this.componentOptions = componentOptions
    this.componentInstance = undefined
    this.parent = undefined
    this.raw = false
    this.isStatic = false
    this.isRootInsert = true
    this.isComment = false
    this.isCloned = false
    this.isOnce = false
    this.asyncFactory = asyncFactory
    this.asyncMeta = undefined
    this.isAsyncPlaceholder = false
  }

  // DEPRECATED: alias for componentInstance for backwards compat.
  /* istanbul ignore next */
  get child(): Component | void {
    return this.componentInstance
  }
} 
```
{% endbox %}

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ new å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ª VNodeã€‚ 
 
{% box child:codeblock color:purple %}
```js
// åˆ›å»ºä¸€ä¸ªdivçš„ vnode
new VNode('div',{},'Hello World')
// åˆ›å»ºä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„ vnode
new VNode('div',{},[
    new VNode('span',{},'1'),
    new VNode('span',{},'2'),
    new VNode('span',{},'3')
])
```
{% endbox %}

è¿™é‡Œæˆ‘ä»¬å…ˆåˆ—ä¸¾å››ä¸ªå¸¸ç”¨çš„å±æ€§ï¼š`tagã€dataã€childrenã€text`ã€‚

å…¶ä½™å±æ€§åœ¨æˆ‘ä»¬åé¢çš„è§£æä¸­ä¼šä¸€ä¸€è¿›è¡Œè§£æã€‚

## 3.1 tagå±æ€§

tagè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ ‡ç­¾åç§°ã€‚

å†³å®šäº†æœ€ç»ˆä¼šæ¸²æŸ“æˆä»€ä¹ˆæ ·çš„ DOMå…ƒç´ ã€‚

tagå¯ä»¥æ˜¯ HTML å…ƒç´ ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²{% mark 'span'ã€'div' color:orange %}ã€‚

ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶å¼•ç”¨ï¼ŒåŒæ ·å¯ä»¥æ˜¯ä¸€ä¸ªåŠ¨æ€æ ‡ç­¾ã€‚

 
{% box child:codeblock color:purple %}
```js
// ç¼–è¯‘å‰ï¼ˆæ™®é€šèŠ‚ç‚¹ï¼‰
<div></div> 
// ç¼–è¯‘å
VNode {
  tag:"div"
}
// ç¼–è¯‘å‰ï¼ˆç»„ä»¶èŠ‚ç‚¹ï¼‰
<CustomComponent></CustomComponent> 
// ç¼–è¯‘å
VNode {
  tag:"CustomComponent"
} 
```
{% endbox %}

## 3.2 dataå±æ€§

data å‚æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ç”¨äºæè¿° VNode çš„å„ç§å±æ€§å’Œé…ç½®ä¿¡æ¯ã€‚

data å‚æ•°å¯ä»¥ç”±ä»¥ä¸‹å‡ ç§æ„æˆï¼š

*   `attrs`:è¡¨ç¤ºå…ƒç´ çš„ä¸Šé™æ€å±æ€§ï¼Œå¦‚srcã€altç­‰ã€‚
*   `staicClass`:è¡¨ç¤ºå…ƒç´ ä¸Šçš„é™æ€cssç±»ã€‚
*   `style`:è¡¨ç¤ºå…ƒç´ ä¸Šçš„å†…è”æ ·å¼ã€‚
*   `on`:è¡¨ç¤ºå…ƒç´ ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨ã€‚
*   `slot`:è¡¨ç¤ºä½œç”¨åŸŸæ’æ§½æˆ–æ™®é€šæ’æ§½çš„ä½ç½®ã€‚
*   `props`:è¡¨ç¤ºä¼ é€’ç»„ä»¶çš„ props æ•°æ®ã€‚
*   `directives`:è¡¨ç¤ºæ·»åŠ çš„è‡ªå®šä¹‰çš„è¡Œä¸ºï¼Œå¦‚ v-modelã€v-showç­‰ã€‚
*   `key`:è¡¨ç¤ºç»„ä»¶å”¯ä¸€æ ‡è¯†ã€‚

## 3.3 children

children å‚æ•°æ˜¯æŒ‡å®šä¸€ä¸ª VNodeï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰çš„å­èŠ‚ç‚¹å†…å®¹ã€‚

è¿™ä¸ªå‚æ•°å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼Œç”¨äºæè¿°å­èŠ‚ç‚¹çš„ç»“æ„å’Œå†…å®¹ã€‚

## 3.4 text

æˆ‘ä»¬çŸ¥é“å¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰tagçš„ï¼Œæ¯”å¦‚æ–‡å­—èŠ‚ç‚¹å°±æ²¡æœ‰tagã€‚

åœ¨vueä¸­ï¼Œæ–‡å­—ä¹Ÿä»£è¡¨ä¸€ä¸ªvnodeã€‚

{% box child:codeblock color:purple %}
```js
// ç¼–è¯‘å‰
"æˆ‘æ˜¯" 
// ç¼–è¯‘å
VNode {
  text:"æˆ‘æ˜¯"
}
``` 
{% endbox %}

## 3.1.5 elm

æˆ‘ä»¬çŸ¥é“æ¯ä¸ª vnodeèŠ‚ç‚¹ éƒ½æœ‰å¯¹åº”çš„çœŸå® DOMå…ƒç´ ã€‚

è€Œè¿™ä¸ª elm å°±æŒ‡å‘è¿™ä¸ªçœŸå® DOMå…ƒç´ ã€‚

# å››. createElementå‡½æ•°

ç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“è™šæ‹ŸDOMå°±æ˜¯ä¸€ä¸ªJSå¯¹è±¡ï¼Œåªä¸è¿‡ä»–æœ‰å¾ˆå¤šå±æ€§ã€‚

è™½ç„¶åˆ›å»ºä¸€ä¸ªè™šæ‹ŸDOMä¹Ÿç»ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œä½†æ˜¯ Vue æ¡†æ¶ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå‡½æ•°createElementã€‚

å®ƒå®šä¹‰åœ¨ `core/vdom/create-element.js` ä¸­ï¼š

## 4.1 createElementå‡½æ•°çš„ä¼˜åŠ¿

createElementå‡½æ•°çš„æ„ä¹‰åœ¨äºå®ƒæä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿ã€æ›´ç®€æ´ä¸”æ›´å…·å¯è¯»æ€§çš„æ–¹å¼æ¥åˆ›å»ºvnodeï¼Œç›¸æ¯”ç›´æ¥ç¼–å†™ VNode å…·æœ‰ä»¥ä¸‹å¥½å¤„ï¼š

### 4.1.1 ç›´è§‚çš„å‚æ•°å½¢å¼

ä½¿ç”¨createElementå‡½æ•°å¯ä»¥é€šè¿‡ç›´è§‚çš„å‚æ•°æ¥æè¿°è™šæ‹ŸèŠ‚ç‚¹çš„å±æ€§ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼Œç›´æ¥ç¼–å†™ VNode å¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ„å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªå±æ€§çš„ JavaScript å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç è¾ƒä¸ºå†—é•¿å’Œå¤æ‚ï¼Œé™ä½äº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### 4.1.2 ç»Ÿä¸€çš„åˆ›å»ºæ–¹å¼

åœ¨é¡¹ç›®ä¸­ä½¿ç”¨createElementå‡½æ•°å¯ä»¥ç¡®ä¿è™šæ‹ŸèŠ‚ç‚¹çš„åˆ›å»ºæ–¹å¼ä¸€è‡´ã€‚

ç›´æ¥ç¼–å†™ VNode å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„å¼€å‘è€…é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥æ„å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»è€Œé™ä½äº†ä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### 4.1.3 åŠ¨æ€å±æ€§å’Œæ¡ä»¶åˆ¤æ–­

createElementå‡½æ•°å¯ä»¥æ¥æ”¶åŠ¨æ€çš„å‚æ•°ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶æ¥å†³å®šè™šæ‹ŸèŠ‚ç‚¹çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å˜åŒ–åŠ¨æ€åœ°æ·»åŠ æˆ–ä¿®æ”¹å±æ€§ï¼Œæˆ–è€…æ ¹æ®æ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ªå­èŠ‚ç‚¹ã€‚

ç›´æ¥ç¼–å†™ VNode å¯¹è±¡æ—¶ï¼Œè¦å®ç°ç±»ä¼¼çš„åŠ¨æ€è¡Œä¸ºå¯èƒ½éœ€è¦æ›´å¤šçš„ä»£ç å’Œé€»è¾‘å¤„ç†ï¼Œå¢åŠ äº†ä»£ç çš„å¤æ‚æ€§ã€‚

## 4.2 createElementå‡½æ•°

{% box child:codeblock color:purple %}
```js
export function createElement(
  context: Component,
  tag: any,
  data: any,
  children: any,
  normalizationType: any,
  alwaysNormalize: boolean
): VNode | Array<VNode> {
  if (isArray(data) || isPrimitive(data)) {
    normalizationType = children
    children = data
    data = undefined
  }
  if (isTrue(alwaysNormalize)) {
    normalizationType = ALWAYS_NORMALIZE
  }
  return _createElement(context, tag, data, children, normalizationType)
}
``` 
{% endbox %}

createElement æ–¹æ³•å®é™…ä¸Šæ˜¯å¯¹ _createElement æ–¹æ³•çš„å°è£…ï¼Œå®ƒå…è®¸ä¼ å…¥çš„å‚æ•°æ›´åŠ çµæ´»ï¼Œåœ¨å¤„ç†è¿™äº›å‚æ•°åï¼Œè°ƒç”¨çœŸæ­£åˆ›å»º VNode çš„å‡½æ•° _createElementã€‚

### 4.2.1 å¯¹ç¬¬äºŒä¸ªå‚æ•°åšå…¼å®¹ 

å¹³æ—¶æˆ‘ä»¬å¼€å‘ä¼šè¿™ä¹ˆè°ƒç”¨ï¼š

```js
// å­˜åœ¨ dataçš„æƒ…å†µ
createElement('div',{style:{color:"red"}},'hello world')
// å¦‚æœæ²¡æœ‰ dataï¼Œä¸ºäº†é¿å…éº»çƒ¦ ä¸€èˆ¬æˆ‘ä»¬ä¹Ÿä¸ä¼šä¼ ç¬¬äºŒä¸ªå‚æ•°
createElement('div','hello world')
``` 
è¿™ä¸ªæ—¶å€™è¿™é‡Œå°±èƒ½å¾ˆå¥½çš„å…¼å®¹æˆ‘ä»¬çš„è¿™ 2 ç§æƒ…å†µï¼Œåœ¨ç”Ÿæˆ VNodeçš„æ—¶å€™åŒºåˆ†ç¬¬äºŒä¸ªå‚æ•°ç©¶ç«Ÿæ˜¯ dataè¿˜æ˜¯ childrenã€‚

### 4.2.2 å¯¹childrençš„è§„èŒƒåŒ–

ç”±äº Virtual DOM å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸€ä¸ª VNode å¯èƒ½ä¼šæœ‰è‹¥å¹²ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™äº›å­èŠ‚ç‚¹åº”è¯¥ä¹Ÿæ˜¯ VNode çš„ç±»å‹ã€‚

_createElement æ¥æ”¶çš„ç¬¬ 4 ä¸ªå‚æ•° children æ˜¯ä»»æ„ç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬è§„èŒƒæˆ VNode ç±»å‹ã€‚

è¿™é‡Œæ ¹æ® normalizationType çš„ä¸åŒï¼Œè°ƒç”¨äº† normalizeChildren(children) å’Œ simpleNormalizeChildren(children) æ–¹æ³•ã€‚

å®ƒä»¬çš„å®šä¹‰éƒ½åœ¨ src/core/vdom/helpers/normalzie-children.js ä¸­ï¼š

# äº”ã€æ€»ç»“

ä¸ºäº†é¿å…é‡å¤æ“ä½œçœŸå® DOM æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œvueæ¡†æ¶å¼•å…¥äº†è™šæ‹Ÿ DOMã€‚

è™šæ‹Ÿ DOMæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå…·æœ‰ç‰¹æœ‰å±æ€§çš„ä¸€ä¸ª JSå¯¹è±¡ã€‚

ä¸ºäº†å®ç°åˆ›å»ºè™šæ‹Ÿ DOM çš„ä¸€è‡´æ€§ï¼Œvueæä¾›äº†ä¸€ä¸ªæ–¹æ³• createElement ç”¨æ¥æ–¹ä¾¿å¿«æ·çš„ç”Ÿæˆè™šæ‹Ÿ DOMã€‚