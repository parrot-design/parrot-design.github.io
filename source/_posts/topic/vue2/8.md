---
title: ğŸ”¥Vue2æ•°æ®å“åº”å¼åŸç†
permalink: posts/vue2-observe.html
date: 2024-11-18 14:39
topic: vue2
banner: /assets/topic/vue2/banner/init-render.jpg
--- 

{% quot ä¸“æ ç¬¬å…«ç¯‡-æ•°æ®å“åº”å¼åŸç† %}

ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬å°†åˆæ¬¡æ¸²æŸ“é¡µé¢çš„æµç¨‹å¤§è‡´çš„è¿‡äº†ä¸€éã€‚

å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰æè¿°ã€‚

Vueä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†çš„å°±æ˜¯æ•°æ®é©±åŠ¨è§†å›¾ï¼Œæ‰€è°“å“åº”å¼å°±æ˜¯å½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç•Œé¢ä¼šåŒæ­¥æ›´æ–°ã€‚

# ä¸€ã€æ•°æ®ä»£ç†çš„åŸºç¡€

æ•°æ®ä»£ç†ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä½œæ•°æ®åŠ«æŒï¼Œæ˜¯ä¸€ç§æŠ€æœ¯æ‰‹æ®µï¼Œå®ƒèƒ½å¤Ÿæˆªè·å¯¹å¯¹è±¡å±æ€§çš„è®¿é—®å’Œä¿®æ”¹æ“ä½œï¼Œå¹¶åœ¨è¿™äº›æ“ä½œå‘ç”Ÿæ—¶æ‰§è¡Œé¢å¤–çš„é€»è¾‘æˆ–ä¿®æ”¹è¿”å›çš„ç»“æœã€‚

åœ¨ Vue.js ä¸­ï¼Œå“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶æ­£æ˜¯åŸºäºæ•°æ®ä»£ç†ã€‚

é€šè¿‡ä»£ç†ï¼ŒVue èƒ½å¤Ÿ{% mark åœ¨æ•°æ®è¢«è®¿é—®æ—¶æ”¶é›†ä¾èµ–ï¼Œåœ¨æ•°æ®è¢«ä¿®æ”¹æ—¶æ›´æ–°è¿™äº›ä¾èµ– color:red %}ï¼Œè¿™æ˜¯å“åº”å¼ç³»ç»Ÿè¿ä½œçš„åŸºæœ¬ç†å¿µã€‚

è€Œè¿™ä¸€åˆ‡éƒ½ä¾èµ–äº Vue å¯¹æ•°æ®è¿›è¡Œçš„æ‹¦æˆªå’Œä»£ç†æ“ä½œã€‚

å°½ç®¡å“åº”å¼ç‰¹æ€§æœ¬èº«å¹¶éæœ¬èŠ‚çš„è®¨è®ºé‡ç‚¹ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ•°æ®ä»£ç†åœ¨å…¶ä»–åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚

åœ¨æ·±å…¥åˆ†æä¹‹å‰ï¼Œé‡è¦çš„æ˜¯è¦ç†è§£å®ç°æ•°æ®ä»£ç†çš„ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼š{% mark Object.defineProperty color:orange %}å’Œ {% mark Proxy color:orange %}ã€‚

è¿™ä¸¤ç§æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼Œä»¥å®ç°å¯¹æ•°æ®è®¿é—®å’Œä¿®æ”¹è¡Œä¸ºçš„ç²¾ç»†æ§åˆ¶ã€‚ 

## 1.1 Object.defineProperty

Vueæ˜¯é€šè¿‡è¿™ä¸ªAPIå¯¹æ•°æ®è¿›è¡Œç›‘å¬çš„ã€‚

> Object.defineProperty() æ–¹æ³•ç”¨äºåœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šç›´æ¥å®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚

åŸºæœ¬ä½¿ç”¨å¦‚ä¸‹ï¼š

{% box child:codeblock color:purple %}
```js
Object.defineProperty(obj, prop, descriptor)
```
{% endbox %}

å‚æ•°è¯´æ˜ï¼š

> objï¼šå¿…éœ€ã€‚ç›®æ ‡å¯¹è±¡
> propsï¼šå¿…éœ€ã€‚éœ€å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åå­—
> descriptorï¼šå¿…éœ€ã€‚ç›®æ ‡å±æ€§æ‰€æ‹¥æœ‰çš„ç‰¹æ€§

Object.defineProperty() å…è®¸æˆ‘ä»¬ç²¾ç¡®åœ°æ·»åŠ æˆ–ä¿®æ”¹å¯¹è±¡çš„å±æ€§ã€‚ 

ç»™å¯¹è±¡çš„å±æ€§æ·»åŠ ç‰¹æ€§æè¿°æœ‰ä¸¤ç§å½¢å¼ï¼š{% mark 1.æ•°æ®æè¿°å’Œ2.å­˜å–æè¿° color:orange %}ã€‚

æ•°æ®æè¿°å’Œå­˜å–æè¿°æ‰€å¯¹åº”çš„å±æ€§æ˜¯ä¸åŒçš„ã€‚

### 1.1.1 æ•°æ®æè¿°

å½“ä¿®æ”¹æˆ–å®šä¹‰å¯¹è±¡çš„æŸä¸ªå±æ€§çš„æ—¶å€™ï¼Œç»™è¿™ä¸ªå±æ€§æ·»åŠ ä¸€äº›ç‰¹æ€§ã€‚

{% box child:codeblock color:purple %}
```js
let obj = {
    test:'hello world'
}
//å¯¹å·²æœ‰çš„å±æ€§æ·»åŠ ç‰¹æ€§æè¿°
Object.defineProperty(obj,"test",{
    configurable:true | false,
    enumerable:true | false,
    value:ä»»æ„ç±»å‹çš„å€¼,
    writable:true | false
});
//å¯¹æ–°æ·»åŠ çš„å±æ€§çš„ç‰¹æ€§æè¿°
Object.defineProperty(obj,"newKey",{
    configurable:true | false,
    enumerable:true | false,
    value:ä»»æ„ç±»å‹çš„å€¼,
    writable:true | false
});
```
{% endbox %}

æ•°æ®æè¿°ä¸­çš„å±æ€§éƒ½æ˜¯å¯é€‰çš„ï¼Œæ¥çœ‹ä¸€ä¸‹è®¾ç½®æ¯ä¸€ä¸ªå±æ€§çš„ä½œç”¨ã€‚

#### 1.1.1.1 value 

å±æ€§å¯¹åº”çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„ç±»å‹çš„å€¼ï¼Œé»˜è®¤ä¸º undefinedã€‚

{% box child:codeblock color:purple %}
```js
let obj = {}
//ç¬¬ä¸€ç§æƒ…å†µï¼šä¸è®¾ç½®valueå±æ€§
Object.defineProperty(obj,"newKey",{

});
console.log( obj.newKey );  //undefined
----------------------------------------
//ç¬¬äºŒç§æƒ…å†µï¼šè®¾ç½®valueå±æ€§
Object.defineProperty(obj,"newKey",{
    value:"hello"
});
console.log( obj.newKey );  //hello
```
{% endbox %}


#### 1.1.1.2 writable 

å±æ€§çš„å€¼æ˜¯å¦å¯ä»¥è¢«é‡å†™ã€‚è®¾ç½®ä¸ºtrueå¯ä»¥è¢«é‡å†™ï¼›è®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«é‡å†™ã€‚é»˜è®¤ä¸ºfalseã€‚

{% box child:codeblock color:purple %}
```js
let obj = {}
//ç¬¬ä¸€ç§æƒ…å†µï¼šwritableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½é‡å†™ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false
});
//æ›´æ”¹newKeyçš„å€¼
obj.newKey = "change value";
console.log( obj.newKey );  //hello
------------------------------
//ç¬¬äºŒç§æƒ…å†µï¼šè®¾ç½®valueå±æ€§
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:true
});
//æ›´æ”¹newKeyçš„å€¼
obj.newKey = "change value";
console.log( obj.newKey );  //change value
```
{% endbox %}
 
#### 1.1.1.3 configurable 

æ˜¯å¦å¯ä»¥åˆ é™¤ç›®æ ‡å±æ€§æˆ–æ˜¯å¦å¯ä»¥å†æ¬¡ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼ˆwritable, configurable, enumerableï¼‰ã€‚è®¾ç½®ä¸ºtrueå¯ä»¥è¢«åˆ é™¤æˆ–å¯ä»¥é‡æ–°è®¾ç½®ç‰¹æ€§ï¼›è®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«å¯ä»¥è¢«åˆ é™¤æˆ–ä¸å¯ä»¥é‡æ–°è®¾ç½®ç‰¹æ€§ã€‚é»˜è®¤ä¸ºfalseã€‚

è¿™ä¸ªå±æ€§èµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼š

1. ç›®æ ‡å±æ€§æ˜¯å¦å¯ä»¥ä½¿ç”¨deleteåˆ é™¤
2. ç›®æ ‡å±æ€§æ˜¯å¦å¯ä»¥å†æ¬¡è®¾ç½®ç‰¹æ€§


{% box child:codeblock color:purple %}
```js
//-----------------æµ‹è¯•ç›®æ ‡å±æ€§æ˜¯å¦èƒ½è¢«åˆ é™¤------------------------
let obj = {}
//ç¬¬ä¸€ç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«åˆ é™¤ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false,
    enumerable:false,
    configurable:false
});
//åˆ é™¤å±æ€§
delete obj.newKey;
console.log( obj.newKey ); //hello
//ç¬¬äºŒç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥è¢«åˆ é™¤ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false,
    enumerable:false,
    configurable:true
});
//åˆ é™¤å±æ€§
delete obj.newKey;
console.log( obj.newKey ); //undefined

//-----------------æµ‹è¯•æ˜¯å¦å¯ä»¥å†æ¬¡ä¿®æ”¹ç‰¹æ€§------------------------
let obj = {}
//ç¬¬ä¸€ç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½å†æ¬¡ä¿®æ”¹ç‰¹æ€§ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false,
    enumerable:false,
    configurable:false
});
//é‡æ–°ä¿®æ”¹ç‰¹æ€§
//æŠ¥é”™ï¼šUncaught TypeError: Cannot redefine property: newKey
// å› ä¸º writableå’Œ configurableéƒ½ä¸º false å³æ— æ³•é‡æ–°é…ç½®
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:true,
    enumerable:true,
    configurable:true
});


//ç¬¬äºŒç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥å†æ¬¡ä¿®æ”¹ç‰¹æ€§ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false,
    enumerable:false,
    configurable:true
});
//é‡æ–°ä¿®æ”¹ç‰¹æ€§
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:true,
    enumerable:true,
    configurable:true
});
console.log( obj.newKey ); //hello
```
{% endbox %}

#### 1.1.1.4 enumerable
 
æ­¤å±æ€§æ˜¯å¦å¯ä»¥è¢«æšä¸¾ï¼ˆä½¿ç”¨for...inæˆ–Object.keys()ï¼‰ã€‚è®¾ç½®ä¸ºtrueå¯ä»¥è¢«æšä¸¾ï¼›è®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«æšä¸¾ã€‚é»˜è®¤ä¸ºfalseã€‚

{% box child:codeblock color:purple %}
```js
let obj = {}
//ç¬¬ä¸€ç§æƒ…å†µï¼šenumerableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«æšä¸¾ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false,
    enumerable:false
});

//æšä¸¾å¯¹è±¡çš„å±æ€§
for( var attr in obj ){
    console.log( attr );  // æ‰“å°ä¸ºç©º
}
//ç¬¬äºŒç§æƒ…å†µï¼šenumerableè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥è¢«æšä¸¾ã€‚
Object.defineProperty(obj,"newKey",{
    value:"hello",
    writable:false,
    enumerable:true
});

//æšä¸¾å¯¹è±¡çš„å±æ€§
for( var attr in obj ){
    console.log( attr );  //newKey
}
```
{% endbox %}

> {% mark ä¸€æ—¦ä½¿ç”¨Object.definePropertyç»™å¯¹è±¡æ·»åŠ å±æ€§ï¼Œé‚£ä¹ˆå¦‚æœä¸è®¾ç½®å±æ€§çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆconfigurableã€enumerableã€writableè¿™äº›å€¼éƒ½ä¸ºé»˜è®¤çš„false color:orange %}

### 1.1.2 å­˜å–å™¨æè¿°

å½“ä½¿ç”¨å­˜å–å™¨æè¿°å±æ€§çš„ç‰¹æ€§çš„æ—¶å€™ï¼Œå…è®¸è®¾ç½®ä»¥ä¸‹ç‰¹æ€§å±æ€§ï¼š

{% box child:codeblock color:purple %}
```js
let obj = {};
Object.defineProperty(obj,"newKey",{
    get:function (){} | undefined,
    set:function (value){} | undefined
    configurable: true | false
    enumerable: true | false
});
```
{% endbox %}

> å½“ä½¿ç”¨äº†getteræˆ–setteræ–¹æ³•ï¼Œä¸å…è®¸ä½¿ç”¨writableå’Œvalueè¿™ä¸¤ä¸ªå±æ€§


#### 1.1.2.1 getter/setter

å½“è®¾ç½®æˆ–è·å–å¯¹è±¡çš„æŸä¸ªå±æ€§çš„å€¼çš„æ—¶å€™ï¼Œå¯ä»¥æä¾›getter/setteræ–¹æ³•ã€‚

* getter æ˜¯ä¸€ç§è·å¾—å±æ€§å€¼çš„æ–¹æ³•
* setteræ˜¯ä¸€ç§è®¾ç½®å±æ€§å€¼çš„æ–¹æ³•ã€‚

åœ¨ç‰¹æ€§ä¸­ä½¿ç”¨get/setå±æ€§æ¥å®šä¹‰å¯¹åº”çš„æ–¹æ³•ã€‚

{% box child:codeblock color:purple %}
```js
let obj = {};
let initValue = 'hello';
Object.defineProperty(obj,"newKey",{
    get:function (){
        //å½“è·å–å€¼çš„æ—¶å€™è§¦å‘çš„å‡½æ•°
        return initValue;    
    },
    set:function (value){
        //å½“è®¾ç½®å€¼çš„æ—¶å€™è§¦å‘çš„å‡½æ•°,è®¾ç½®çš„æ–°å€¼é€šè¿‡å‚æ•°valueæ‹¿åˆ°
        initValue = value;
    }
});
//è·å–å€¼
console.log( obj.newKey );  //hello

//è®¾ç½®å€¼
obj.newKey = 'change value';

console.log( obj.newKey ); //change value
```
{% endbox %}

> æ³¨æ„ï¼šgetæˆ–setä¸æ˜¯å¿…é¡»æˆå¯¹å‡ºç°ï¼Œä»»å†™å…¶ä¸€å°±å¯ä»¥ã€‚å¦‚æœä¸è®¾ç½®æ–¹æ³•ï¼Œåˆ™getå’Œsetçš„é»˜è®¤å€¼ä¸ºundefined

> configurableå’ŒenumerableåŒä¸Šé¢çš„ç”¨æ³•ã€‚

> å±æ€§æè¿°ç¬¦å’Œæ•°æ®æè¿°ç¬¦éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¦‚æœä½ åœ¨ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­æ—¢å†™äº† value/writableï¼Œåˆå†™äº† get/set åˆ™ä¼šæŠ¥é”™ã€‚

{% image /assets/topic/vue2/observe/2.png %}

### 1.1.3 å…¼å®¹æ€§

{% image /assets/topic/vue2/observe/1.png %}

å…¼å®¹æ€§å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ie8ä¸‹åªèƒ½åœ¨DOMå¯¹è±¡ä¸Šä½¿ç”¨ï¼Œå°è¯•åœ¨åŸç”Ÿçš„å¯¹è±¡ä½¿ç”¨ Object.defineProperty()ä¼šæŠ¥é”™ã€‚

### 1.1.4 å›°æƒ‘çš„é—®é¢˜

{% image /assets/topic/vue2/observe/3.png %}

å¦‚ä¸Šï¼Œåœ¨ä½¿ç”¨ get æ–¹æ³•åï¼Œæ— æ³•ç›´æ¥çœ‹åˆ°å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œéœ€è¦ç‚¹å‡»æ‰å¯ä»¥ã€‚

## 1.2 Proxy 

### 1.2.1 definePropertyçš„ç¼ºç‚¹

æˆ‘ä»¬çŸ¥é“Vue2ä¸­çš„æ•°æ®å“åº”å¼å¤„ç†ä½¿ç”¨çš„æ˜¯ Object.definePropertyï¼Œè€Œ Vue3ä¸­å®ç°æ•°æ®å“åº”ä½¿ç”¨çš„æ˜¯ Proxyã€‚

Object.definePropertyè™½ç„¶å¯ä»¥å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯æ— æ³•å¯¹æ•°ç»„æˆ–è€…æ·±å±‚æ¬¡å¯¹è±¡è¿›è¡Œç›‘å¬å¤„ç†ã€‚

#### 1.2.1.1 æ•°ç»„

{% box child:codeblock color:purple %}
```js
let arr = [1,2,3,4,5];
arr.forEach((item,index)=>{
    Object.defineProperty(arr,index,{
        get() {
            console.log('æ•°ç»„è¢«getteræ‹¦æˆª')
            return item
        },
        set(value) {
            console.log('æ•°ç»„è¢«setteræ‹¦æˆª')
            return item = value
        }
    })
})
arr[1] = 11;
console.log(arr[1]);
// ç»“æœ
æ•°ç»„è¢«setteræ‹¦æˆª
æ•°ç»„è¢«getteræ‹¦æˆª
11
```
{% endbox %}

å¾ˆæ˜¾ç„¶ï¼Œ{% mark å·²çŸ¥é•¿åº¦çš„æ•°ç»„å¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡Œå±æ€§çš„è®¾ç½®ä¸è®¿é—® color:orange %}ã€‚

ç„¶è€Œï¼Œæ•°ç»„çš„æ·»åŠ æ“ä½œå´æ— æ³•è¢«ç›´æ¥æ‹¦æˆªã€‚

è¿™å¾ˆå®¹æ˜“ç†è§£ï¼šæ— è®ºæ˜¯é€šè¿‡ arr.push() æ–¹æ³•è¿˜æ˜¯ç›´æ¥èµ‹å€¼å¦‚ arr[10] = 10 æ¥æ·»åŠ å…ƒç´ ï¼Œæ–°æ·»åŠ çš„ç´¢å¼•å¹¶æœªè¢«åŒ…å«åœ¨é¢„è®¾çš„æ•°æ®æ‹¦æˆªæœºåˆ¶ä¸­ï¼Œå› æ­¤æ— æ³•å®ç°æ‹¦æˆªå¤„ç†ã€‚

è¿™æ˜¯ä½¿ç”¨ Object.defineProperty è¿›è¡Œæ•°æ®ä»£ç†çš„ä¸€ä¸ªå±€é™æ€§ã€‚

Vue åœ¨å…¶å“åº”å¼ç³»ç»Ÿä¸­å¯¹æ•°ç»„æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œä»è€Œé—´æ¥åœ°è§£å†³äº†æ­¤é—®é¢˜ã€‚

#### 1.2.1.2 æ·±å±‚æ¬¡å¯¹è±¡ 

{% box child:codeblock color:purple %}
```js
let obj={
    level1:{
        level2:"ç¬¬äºŒå±‚"
    }
}
// ä¿å­˜ level1 çš„åŸå§‹å€¼ é¿å…å¾ªç¯å¼•ç”¨çš„é”™è¯¯
let originalLevel1 = obj.level1;
Object.defineProperty(obj,'level1',{
    get(){
        console.log("å¯¹è±¡è¢«getteræ‹¦æˆª")
        return originalLevel1
    },
    set(value){
        console.log("å¯¹è±¡è¢«setteræ‹¦æˆª")
        originalLevel1 = value;
    }
})
// ç»“æœ
å¯¹è±¡è¢«setteræ‹¦æˆª
å¯¹è±¡è¢«getteræ‹¦æˆª
obj.level1 = {level3:"ç¬¬ä¸‰å±‚"}
console.log(obj.level1)// {level3:"ç¬¬ä¸‰å±‚"}
```
{% endbox %}

å¯ä»¥çœ‹åˆ°æ›´æ–°è®¾ç½®çš„é‚£ä¸€å±‚æ˜¯æ²¡é—®é¢˜çš„ã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ›´æ–°æ›´æ·±å±‚æ¬¡çš„å¯¹è±¡ï¼Œå°±æ— æ³•ç›‘å¬åˆ°ã€‚

{% box child:codeblock color:purple %}
```js
let obj={
    level1:{
        level2:"ç¬¬äºŒå±‚"
    }
}
// ä¿å­˜ level1 çš„åŸå§‹å€¼ é¿å…å¾ªç¯å¼•ç”¨çš„é”™è¯¯
let originalLevel1 = obj.level1;
Object.defineProperty(obj,'level1',{
    get(){
        console.log("å¯¹è±¡è¢«getteræ‹¦æˆª")
        return originalLevel1
    },
    set(value){
        console.log("å¯¹è±¡è¢«setteræ‹¦æˆª")
        originalLevel1 = value;
    }
}) 
//ç»“æœ
å¯¹è±¡è¢«getteræ‹¦æˆª
obj.level1.level2 = 'ç¬¬äºŒå±‚-å¤åˆ¶'
```
{% endbox %}

å¯ä»¥çœ‹å‡ºæ¥å¹¶æ²¡æœ‰æ‰§è¡Œ set æ–¹æ³•ï¼Œå¦‚æœæƒ³è¦æ·±å±‚æ¬¡çš„å±æ€§ä¹Ÿè¢«ç›‘å¬åˆ°çš„è¯ï¼Œéœ€è¦é€’å½’åœ°ç»™å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§æ·»åŠ å±æ€§æè¿°ã€‚


{% box child:codeblock color:purple %}
```js
function walk(obj){
    // å¦‚æœä¸æ˜¯å¯¹è±¡ æ— éœ€å¤„ç†
    if(!(obj instanceof Object))  return obj
    for(let k in obj){
        let val = obj[k];
        walk(val);
        Object.defineProperty(obj,k,{
            enumerable:true,
            configurable:true,
            get(){
                console.log(`è®¿é—®obj.${k}å±æ€§è§¦å‘`)
                return val
            },
            set(newValue) {
                console.log(`ä¿®æ”¹obj.${k}å±æ€§è§¦å‘` , newValue)
                if (val === newValue) return;
                val = newValue
                walk(newValue)
            } 
        })
    }
    return obj;
}
// é€’å½’ç›‘å¬æ‰€æœ‰å±‚çº§å¯¹è±¡
let obj = {a:{b:{c:'d'}}}
walk(obj)
obj.a
obj.a.b
obj.a.b.c
```
{% endbox %}

### 1.2.2 

