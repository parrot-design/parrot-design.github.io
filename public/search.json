[{"title":"ç¬¬ä¸€èŠ‚ï¼šå®‰è£…JavaSDK","path":"//posts/java-class1.html","content":"ä¸€ã€JDK8ã€JDK11ã€JDK17åº”è¯¥æ€ä¹ˆé€‰æ‹©è¦ä½¿ç”¨Javaè¯­è¨€ï¼Œé‚£ä¹ˆJDKå°±å¿…ä¸å¯å°‘ã€‚ å®‰è£…JDKåï¼Œä¼šåœ¨ç”µè„‘ä¸­åŒæ—¶å®‰è£…ï¼šjavaçš„è¿è¡Œç¯å¢ƒjre å’Œ å¼€å‘ç¯å¢ƒjdkã€‚ æˆªæ­¢åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„JDKå­˜åœ¨äº†ä¸‰ä¸ªç‰ˆæœ¬çš„é•¿æœŸæ”¯æŒç‰ˆï¼šJDK8ã€JDK11å’ŒJDK17ã€‚ åŸºæœ¬ä¸ŠJavaå¤§éƒ¨åˆ†çš„é¡¹ç›®éƒ½æ˜¯åŸºäºJDK8ç¯å¢ƒã€‚ é¦–å…ˆï¼Œå›é¡¾æ‰€æœ‰ç‰ˆæœ¬ï¼ŒJDK8åˆšå‡ºç”Ÿæ—¶ï¼Œä»–å°±å† åäº†ä¸€ä¸ªç›¸å¯¹å®Œç¾çš„å¼€å‘ç¯å¢ƒä¹‹ç§°ã€‚å› ä¸ºç›¸æ¯”ä»¥å¾€çš„JDK7ã€JDK5è¿™äº›ï¼ŒJDK8çš„ç”Ÿæ€å¾ˆå¥½ï¼Œå¼€å‘è€…ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”ä¹‹å‰çš„ç‰ˆæœ¬èˆ’é€‚ï¼ŒåŒæ—¶JDK8æ”¯æŒäº†å‡ ä¹æ‰€æœ‰çš„å¼€å‘åŠŸèƒ½éœ€æ±‚ï¼Œè®¾è®¡æ¯”è¾ƒå®Œå–„ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸‹è½½ JDK8 äºŒã€Macä¸‹è½½jdk82.1 å®˜ç½‘ä¸‹è½½æ‰“å¼€oracle å®˜ç½‘ä¸‹è½½é¡µé¢ã€‚ é¡µé¢ä¸€ç›´ä¸‹æ‹‰ï¼Œå¯ä»¥æ‰¾åˆ°å†å²ç‰ˆæœ¬çš„ä¸‹è½½è·¯å¾„ã€‚å¯ä»¥é€šè¿‡åˆ‡æ¢tabï¼Œé€‰æ‹©é€‚åˆè‡ªå·±ç”µè„‘ç³»ç»Ÿçš„å®‰è£…åŒ…ã€‚ macbookä¸‹è½½jdk8æ—¶ï¼Œæ¨èä¸‹è½½.dmgæ–‡ä»¶ã€‚ 2.2 å›½å†…å¹³å°å›½å†…æœ‰å¾ˆå¤šæä¾›é•œåƒä¸‹è½½çš„å¹³å°ã€‚å¯ä»¥æ‰¾åˆ°å†å²ç‰ˆæœ¬çš„jdkï¼Œä¸‹è½½é€Ÿåº¦å¿«ï¼Œå…ç™»å½•ã€‚ æˆ‘å®é™…ä½¿ç”¨è¿‡çš„æ˜¯ï¼šhttp://www.codebaoku.com/jdk/jdk-oracle-jdk1-8.html ä¸‰ã€å®‰è£… jdkä¸‹è½½å®Œ dmgæ–‡ä»¶ä»¥åï¼ŒåŒå‡»æ–‡ä»¶ï¼Œç„¶åä¼šè·³å‡ºæ¥ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸ª pkgåŒ…å®‰è£…æ–‡ä»¶ï¼ŒåŒå‡»è¿›å…¥å®‰è£…å¼•å¯¼ç•Œé¢ã€‚ä¸€ç›´ç‚¹â€œç»§ç»­â€æŒ‰é’®å°±å¯ä»¥å‚»ç“œå¼å®‰è£… javaäº†ã€‚ æ‰“å¼€ç»ˆç«¯è¾“å…¥ java -versionå°±å¯ä»¥æŸ¥çœ‹ javaæ˜¯å¦å®‰è£…æˆåŠŸã€‚","tags":["blog"],"categories":["Javaå®æˆ˜"]},{"title":"ğŸ”¥Vue2å¼‚æ­¥æ¸²æŸ“æœºåˆ¶","path":"//posts/vue2-async.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬ä¹ç¯‡-å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ ä¸€ã€å¼‚æ­¥æ¸²æŸ“æœºåˆ¶åœ¨ä¸Šä¸€èŠ‚çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¼šé‡æ–°æ›´æ–°ä¾èµ–ï¼Œæœ€ç»ˆä¼šæ‰§è¡ŒWatcherå®ä¾‹çš„updateæ–¹æ³•ã€‚ ä½†æ˜¯å…¶å®Vueä¸­å¹¶ä¸æ˜¯åœ¨æ¯æ¬¡æ‰§è¡Œupdateæ–¹æ³•æ—¶éƒ½ä¼šæ‰§è¡Œæ¸²æŸ“ï¼Œä»–ä¼šå°†å¤šæ¬¡å˜åŒ–åšä¸€æ¬¡åˆå¹¶æ¸²æŸ“ã€‚ 1234567891011121314import Vue from &quot;vue&quot;;new Vue(&#123; template:`&lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;`, data()&#123; return &#123; msg:&quot;inited&quot; &#125; &#125;, mounted()&#123; this.msg = &#x27;ç¬¬ä¸€æ¬¡æ¸²æŸ“&#x27;; this.msg = &#x27;ç¬¬äºŒæ¬¡æ¸²æŸ“&#x27;; &#125;&#125;).$mount(&quot;#app&quot;) æŒ‰ç…§æˆ‘ä»¬ä¸ŠèŠ‚æ‰€å­¦çš„çŸ¥è¯†ï¼šæ¯ä¸€ä¸ªdataéƒ½è¢«ä»£ç†åŠ«æŒï¼Œæ¯æ¬¡dataä¿®æ”¹åéƒ½ä¼šé‡æ–°æ‰§è¡Œæ›´æ–°æ–¹æ³•ã€‚ é‚£ä¹ˆåœ¨ mountedæ–¹æ³•ä¸­ dataä¿®æ”¹äº† 2 æ¬¡ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥æ¸²æŸ“ 2 æ¬¡å‘¢ï¼Ÿ ä½†æ˜¯ä»å®é™…è§’åº¦æ˜æ˜¾æˆ‘ä»¬è¿™é‡Œåªéœ€è¦æ¸²æŸ“ç¬¬äºŒæ¬¡çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åªæ¸²æŸ“ä¸€æ¬¡ï¼Œè€Œ Vueå†…éƒ¨ä¹Ÿæ˜¯è¿™ä¹ˆæ“ä½œçš„ã€‚ ç”±äºVueå†…éƒ¨çš„å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ï¼Œå®é™…ä¸Šé¡µé¢åªä¼šæ¸²æŸ“ä¸€æ¬¡ï¼ŒæŠŠç¬¬ä¸€æ¬¡çš„èµ‹å€¼æ‰€å¸¦æ¥çš„çš„å“åº”ä¸ç¬¬äºŒæ¬¡çš„èµ‹å€¼æ‰€å¸¦æ¥çš„çš„å“åº”è¿›è¡Œä¸€æ¬¡åˆå¹¶ï¼Œå°†æœ€ç»ˆçš„valåªåšä¸€æ¬¡é¡µé¢æ¸²æŸ“ï¼Œè€Œä¸”é¡µé¢æ˜¯åœ¨æ‰§è¡Œæ‰€æœ‰çš„åŒæ­¥ä»£ç ä¹‹åæ‰èƒ½å¾—åˆ°æ¸²æŸ“ã€‚ äºŒã€ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ¸²æŸ“1234567891011121314151617181920let data = &#123;msg:&#x27;inited&#x27;&#125;let _msg = data.msgObject.defineProperty(data,&quot;msg&quot;,&#123; set(val)&#123; console.log(&quot;æˆ‘è¢«è®¾ç½®äº†&quot;) _msg = val &#125;, get()&#123; console.log(&quot;æˆ‘è¢«è®¿é—®äº†&quot;) return _msg &#125;&#125;) data.msg = &#x27;ç¬¬ä¸€æ¬¡æ¸²æŸ“&#x27;console.log(&quot;è·å–æ­¤æ—¶data.msg&quot;,data.msg)data.msg = &#x27;ç¬¬äºŒæ¬¡æ¸²æŸ“&#x27; // æ‰§è¡Œç»“æœ// æˆ‘è¢«è®¾ç½®äº†// æˆ‘è¢«è®¿é—®äº†// è·å–æ­¤æ—¶data.msg ç¬¬ä¸€æ¬¡æ¸²æŸ“// æˆ‘è¢«è®¾ç½®äº† é€šè¿‡æ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä»£ç†æ˜¯åŒæ­¥æ“ä½œã€‚ ä¹Ÿå°±æ˜¯è¯´å¦‚æœåœ¨ Vueä¸­ä¸è¿›è¡Œå¼‚æ­¥å¤„ç†çš„è¯ï¼Œå¯èƒ½æœ€ç»ˆæ‰§è¡Œé€»è¾‘å°±æ˜¯ä¸‹å›¾è¿™æ ·ã€‚ è¿™æ ·çš„è¯æ¯æ¬¡ dataå˜åŒ–å°±ä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨çš„é—ªçƒå¡é¡¿ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ 2 ä¸ªè§’åº¦è¿›è¡Œåˆ†æï¼š ç”¨æˆ·ä½“éªŒï¼šä»ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå®é™…ä¸Šé¡µé¢åªéœ€è¦å±•ç¤ºæœ€ç»ˆçš„å€¼å˜åŒ–ã€‚ç¬¬ä¸€æ¬¡çš„å€¼å˜åŒ–åªæ˜¯ä¸€ä¸ªè¿‡æ¸¡çŠ¶æ€ï¼Œå¦‚æœå°†å…¶æ¸²æŸ“å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¡µé¢å‡ºç°é—ªçƒç°è±¡ï¼Œä»è€Œå½±å“ç”¨æˆ·ä½“éªŒã€‚é€šè¿‡ Vue çš„å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ç¨³å®šä¸”æœ€æ–°çš„é¡µé¢çŠ¶æ€ã€‚ æ€§èƒ½ï¼šåœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæœ€ç»ˆéœ€è¦å±•ç¤ºçš„æ•°æ®å®é™…ä¸Šæ˜¯ç¬¬äºŒæ¬¡å¯¹ val èµ‹çš„å€¼ã€‚å¦‚æœç¬¬ä¸€æ¬¡èµ‹å€¼ä¹Ÿè§¦å‘é¡µé¢æ¸²æŸ“ï¼Œé‚£ä¹ˆåœ¨æœ€ç»ˆç»“æœæ¸²æŸ“ä¹‹å‰ï¼Œé¡µé¢ä¼šè¿›è¡Œä¸€æ¬¡ä¸å¿…è¦çš„æ¸²æŸ“ã€‚è¿™æ— ç–‘å¢åŠ äº†æ€§èƒ½çš„æ¶ˆè€—ã€‚ ä¸‰ã€Vueå¼‚æ­¥æ¸²æŸ“åŸç†æ•°æ®æ¯æ¬¡å˜åŒ–æ—¶ï¼Œå°†å…¶å¼•èµ·é¡µé¢å˜åŒ–çš„æ“ä½œéƒ½ä¼šæ”¾åˆ°ä¸€ä¸ªå¼‚æ­¥APIçš„å›è°ƒå‡½æ•°ä¸­ã€‚å½“åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œå¼‚æ­¥å›è°ƒå¼€å§‹æ‰§è¡Œã€‚æ­¤æ—¶ Vue ä¼šå°†æ‰€æœ‰éœ€è¦æ¸²æŸ“çš„å˜åŒ–åˆå¹¶åœ¨ä¸€èµ·ï¼Œæœ€ç»ˆæ‰§è¡Œä¸€æ¬¡æ¸²æŸ“æ“ä½œã€‚ å››ã€queueWatcheræ¯ä¸€æ¬¡dataå˜åŒ–éƒ½ä¼šæ‰§è¡ŒWatcherå®ä¾‹ä¸Šçš„ updateæ–¹æ³•ã€‚ 12345678910update() &#123; /* istanbul ignore else */ if (this.lazy) &#123; this.dirty = true &#125; else if (this.sync) &#123; this.run() &#125; else &#123; queueWatcher(this) &#125;&#125; é»˜è®¤ lazyã€syncéƒ½æ˜¯ falseã€‚ æ‰€ä»¥é»˜è®¤æ¯ä¸€æ¬¡éƒ½ä¼šè°ƒç”¨queueWatcheræ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ª queueWatcherå‡½æ•°éƒ½åšäº†ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ 4.1 haså¯¹è±¡123456789let has = &#123;&#125;;export function queueWatcher(watcher: Watcher) &#123; const id = watcher.id if (has[id] != null) &#123; return &#125; has[id] = true // çœç•¥éƒ¨åˆ†ä»£ç &#125; has å¯¹è±¡ç”¨äºå­˜å‚¨å·²ç»åŠ å…¥é˜Ÿåˆ—çš„ watcher çš„ IDï¼Œä»¥ç¡®ä¿æ¯ä¸ª watcher åªè¢«åŠ å…¥é˜Ÿåˆ—ä¸€æ¬¡ã€‚è¿™æ˜¯ä¸€ç§é¿å…é‡å¤å¤„ç†ç›¸åŒ watcher çš„æœºåˆ¶ã€‚ 4.2 noRecurseé€‰é¡¹123if (watcher === Dep.target &amp;&amp; watcher.noRecurse) &#123; return&#125; å¦‚æœå½“å‰çš„ watcher å°±æ˜¯å…¨å±€çš„ Dep.targetï¼ˆå³å½“å‰æ­£åœ¨æ‰§è¡Œçš„ watcherï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ª watcher è®¾ç½®äº† noRecurse æ ‡å¿—ï¼ˆè¡¨ç¤ºä¸å¸Œæœ›é€’å½’è§¦å‘ï¼‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ 4.3 queue123456789const queue: Array&lt;Watcher&gt; = []export function queueWatcher(watcher: Watcher) &#123; // çœç•¥éƒ¨åˆ†ä»£ç  if (!flushing) &#123; queue.push(watcher) &#125; else &#123; queue.splice(i + 1, 0, watcher) &#125;&#125; queueæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜å‚¨éœ€è¦æ‰§è¡Œæ›´æ–°æ¸²æŸ“çš„ watcherå®ä¾‹ã€‚ å½“æ•°æ®å˜åŒ–æ—¶ï¼Œç›¸å…³çš„ watcherå®ä¾‹ä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ªæ•°ç»„ä¸­ï¼Œç­‰å¾…æ‰§è¡Œã€‚ 4.4 flushingçŠ¶æ€12345678910111213141516171819202122232425let flushing = false;let index = 0;export function queueWatcher(watcher: Watcher) &#123; // çœç•¥éƒ¨åˆ†ä»£ç  if (!flushing) &#123; queue.push(watcher) &#125; else &#123; let i = queue.length - 1 while (i &gt; index &amp;&amp; queue[i].id &gt; watcher.id) &#123; i-- &#125; queue.splice(i + 1, 0, watcher) &#125; nextTick(flushSchedulerQueue);&#125;function flushSchedulerQueue()&#123; flushing = true; // çœç•¥ä»£ç  // æ‰§è¡Œå®Œæ›´æ–°æ“ä½œåé‡ç½®å†…éƒ¨çŠ¶æ€ resetSchedulerState();&#125;function resetSchedulerState()&#123; flushing = false;&#125; å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼šflushingæ˜¯ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œ watcher çš„é˜Ÿåˆ—ã€‚é»˜è®¤ä¸º falseã€‚ å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œ queueWatchæ—¶ï¼Œflushingä¸º falseï¼Œè¡¨ç¤ºå½“å‰æ²¡æœ‰æ‰§è¡Œ watcheré˜Ÿåˆ—ï¼Œè¿™ä¸ªæ—¶å€™å¤„ç†æ¯”è¾ƒç®€å•ï¼Œå°† watcher æ·»åŠ åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œç­‰å¾…åç»­çš„æ‰§è¡Œã€‚ æ­¤æ—¶è°ƒç”¨nextTick(flushSchedulerQueue)æ–¹æ³•ã€‚ åœ¨åŒæ­¥ä»»åŠ¡æ‰§è¡Œä»¥åï¼Œæ‰§è¡Œå¼‚æ­¥æ—¶åœ¨flushSchedulerQueueæ–¹æ³•ä¸­å°† flushingç½®ä¸º trueï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œ watcheré˜Ÿåˆ—ã€‚ å¦‚æœåœ¨æ‰§è¡ŒflushSchedulerQueueæ–¹æ³•æ—¶å†æ¬¡è°ƒç”¨äº† queueWatcheræ–¹æ³•ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª idå°äºæˆ–ç­‰äº watch.idï¼Œç„¶åæ’å…¥ä»–çš„åé¢ï¼Œä¿è¯äº† watcheræŒ‰ç…§å®ƒä»¬è¢«åˆ›å»ºçš„é¡ºåºæ‰§è¡Œï¼Œå³ä½¿åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰ watcheråŠ å…¥ã€‚ 4.5 waitingçŠ¶æ€1234567891011121314let waiting = false;if (!waiting) &#123; waiting = true; nextTick(flushSchedulerQueue)&#125; function resetSchedulerState()&#123; // å°† waitingé‡ç½®ä¸º false waiting = false; &#125;function flushSchedulerQueue()&#123; resetSchedulerState()&#125; queueWatcheræ–¹æ³•æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯æ‰§è¡Œ nextTick(flushSchedulerQueue)æ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°å¼‚æ­¥æ‰¹é‡æ›´æ–°çš„ç›®çš„ã€‚ è€Œ waitingå†³å®šäº†æ˜¯å¦åº”è¯¥æ‰§è¡ŒflushSchedulerQueueæ–¹æ³•ã€‚ åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ queueWatcher(this)æ—¶ï¼Œä¼šè°ƒç”¨nextTick(flushSchedulerQueue)æ–¹æ³•ã€‚ å¹¶ä¸”å°† waitingè®¾ç½®ä¸º trueã€‚ ç„¶åç«‹å³æ‰§è¡Œå¼‚æ­¥æ›´æ–°æ“ä½œï¼Œæ‰€ä»¥ waitingè¡¨ç¤ºç›®å‰å­˜åœ¨å¼‚æ­¥æ›´æ–°æ“ä½œæ­£åœ¨ç­‰å¾…æ‰§è¡Œã€‚ ç„¶ååœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯å†…å†æ¬¡è°ƒç”¨ queueWatcheræ–¹æ³•ï¼Œæ­¤æ—¶å·²ç»æœ‰å¼‚æ­¥æ›´æ–°æ“ä½œç­‰å¾…æ‰§è¡Œã€‚ æ‰€ä»¥ä¸å†è°ƒç”¨å¼‚æ­¥æ›´æ–°æ“ä½œï¼Œè¿™æ„å‘³ç€åœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯å†…ï¼Œè¯¥æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚ è¯¥å˜é‡åœ¨å¼‚æ­¥æ›´æ–°åä¼šè¢«é‡ç½®ä¸º falseã€‚ 4.6 flushSchedulerQueueä¸“é—¨ç”¨äºæ‰§è¡Œå¤„ç†queueé˜Ÿåˆ—ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758function flushSchedulerQueue() &#123; currentFlushTimestamp = getNow() flushing = true let watcher, id // Sort queue before flush. // This ensures that: // 1. Components are updated from parent to child. (because parent is always // created before the child) // 2. A component&#x27;s user watchers are run before its render watcher (because // user watchers are created before the render watcher) // 3. If a component is destroyed during a parent component&#x27;s watcher run, // its watchers can be skipped. queue.sort(sortCompareFn) // do not cache length because more watchers might be pushed // as we run existing watchers for (index = 0; index &lt; queue.length; index++) &#123; watcher = queue[index] if (watcher.before) &#123; watcher.before() &#125; id = watcher.id has[id] = null watcher.run() // in dev build, check and stop circular updates. if (__DEV__ &amp;&amp; has[id] != null) &#123; circular[id] = (circular[id] || 0) + 1 if (circular[id] &gt; MAX_UPDATE_COUNT) &#123; warn( &#x27;You may have an infinite update loop &#x27; + (watcher.user ? `in watcher with expression &quot;$&#123;watcher.expression&#125;&quot;` : `in a component render function.`), watcher.vm ) break &#125; &#125; &#125; // keep copies of post queues before resetting state const activatedQueue = activatedChildren.slice() const updatedQueue = queue.slice() resetSchedulerState() // call component updated and activated hooks callActivatedHooks(activatedQueue) callUpdatedHooks(updatedQueue) cleanupDeps() // devtool hook /* istanbul ignore if */ if (devtools &amp;&amp; config.devtools) &#123; devtools.emit(&#x27;flush&#x27;) &#125;&#125; 4.6.1 ä½¿ç”¨sortCompareFnè¿›è¡Œæ’åº123456789101112131415161718192021const sortCompareFn = (a: Watcher, b: Watcher): number =&gt; &#123; if (a.post) &#123; if (!b.post) return 1 &#125; else if (b.post) &#123; return -1 &#125; return a.id - b.id&#125;let queue = []function flushSchedulerQueue() &#123; // çœç•¥éƒ¨åˆ†ä»£ç  // Sort queue before flush. // This ensures that: // 1. Components are updated from parent to child. (because parent is always // created before the child) // 2. A component&#x27;s user watchers are run before its render watcher (because // user watchers are created before the render watcher) // 3. If a component is destroyed during a parent component&#x27;s watcher run, // its watchers can be skipped. queue.sort(sortCompareFn) &#125; å› ä¸ºåœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯å†…å¤šæ¬¡è§¦å‘ queueWatcher å‡½æ•°ä¼šç»™é˜Ÿåˆ—æ·»åŠ  watcherã€‚ æ­¤æ—¶ watcherçš„æ‰§è¡Œé¡ºåºéœ€è¦é‡æ–°æ•´ç†ï¼ŒsortCompareFnç”¨äºç»™ watcheræ’åºã€‚ postè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåœ¨ DOMæ›´æ–°åæ‰§è¡Œçš„ watcher æ’åºç›®çš„ä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿ä¸‹é¢ä¸‰ç§æƒ…å†µçš„é¡ºåºï¼š çˆ¶å­ç»„ä»¶æ›´æ–°é¡ºåºï¼šç»„ä»¶çš„çˆ¶ watcher åº”è¯¥åœ¨å­ watcher ä¹‹å‰æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºçˆ¶ç»„ä»¶é€šå¸¸åœ¨å­ç»„ä»¶ä¹‹å‰åˆ›å»ºï¼Œå› æ­¤å…¶ watcher ä¹Ÿåº”è¯¥å…ˆæ‰§è¡Œã€‚ ç”¨æˆ· watcher ä¸æ¸²æŸ“ watcher çš„é¡ºåºï¼šç”¨æˆ·å®šä¹‰çš„ watcherï¼ˆé€šå¸¸åœ¨ç»„ä»¶çš„ watch é€‰é¡¹ä¸­å®šä¹‰ï¼‰åº”è¯¥åœ¨ç»„ä»¶çš„æ¸²æŸ“ watcher ä¹‹å‰æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºç”¨æˆ· watcher é€šå¸¸åœ¨æ¸²æŸ“ watcher ä¹‹å‰åˆ›å»ºã€‚ å¤„ç†ç»„ä»¶é”€æ¯ï¼šå¦‚æœä¸€ä¸ªç»„ä»¶åœ¨çˆ¶ç»„ä»¶çš„ watcher æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«é”€æ¯ï¼Œå…¶ watcher å¯ä»¥è¢«è·³è¿‡ï¼Œä»¥é¿å…å¯¹å·²é”€æ¯ç»„ä»¶çš„æ— æ•ˆæ“ä½œã€‚ 4.6.2 æ‰§è¡Œwatcherå®ä¾‹çš„æ›´æ–°1234567891011121314151617181920212223for (index = 0; index &lt; queue.length; index++) &#123; watcher = queue[index] if (watcher.before) &#123; watcher.before() &#125; id = watcher.id has[id] = null watcher.run() // in dev build, check and stop circular updates. if (__DEV__ &amp;&amp; has[id] != null) &#123; circular[id] = (circular[id] || 0) + 1 if (circular[id] &gt; MAX_UPDATE_COUNT) &#123; warn( &#x27;You may have an infinite update loop &#x27; + (watcher.user ? `in watcher with expression &quot;$&#123;watcher.expression&#125;&quot;` : `in a component render function.`), watcher.vm ) break &#125; &#125; &#125; åœ¨å°† watcheré¡ºåºæ’åˆ—å¥½åï¼Œç«‹å³æ‰§è¡Œéå†é˜Ÿåˆ—ä¸­çš„æ¯ä¸ª watcherå¹¶æ‰§è¡Œä»–ä»¬ã€‚ åŒæ—¶åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ— é™å¾ªç¯æ›´æ–°çš„æƒ…å†µã€‚ å¦‚æœ has[id] ä»ç„¶ä¸ä¸º nullï¼ˆè¿™æ„å‘³ç€åœ¨å½“å‰ watcher æ‰§è¡Œåï¼Œåˆæœ‰æ–°çš„æ›´æ–°è¯·æ±‚ï¼‰ï¼Œåˆ™å¢åŠ  circular[id] çš„è®¡æ•°ï¼Œç”¨äºè·Ÿè¸ªåŒä¸€ä¸ª watcher è¢«é‡æ–°è§¦å‘çš„æ¬¡æ•°ã€‚ å¦‚æœ circular[id] çš„æ¬¡æ•°è¶…è¿‡äº† MAX_UPDATE_COUNTï¼ˆä¸€ä¸ªè®¾å®šçš„æœ€å¤§æ›´æ–°æ¬¡æ•°ï¼‰ï¼Œåˆ™å‘å‡ºè­¦å‘Šï¼Œæç¤ºå¯èƒ½å­˜åœ¨æ— é™æ›´æ–°å¾ªç¯ï¼Œå¹¶ä¸­æ–­å½“å‰çš„æ‰§è¡Œå¾ªç¯ã€‚ 4.6.3 è°ƒç”¨keep-aliveç»„ä»¶çš„activatedé’©å­1234567891011121314151617181920const activatedChildren: Array&lt;Component&gt; = [] function resetSchedulerState() &#123; index = queue.length = activatedChildren.length = 0 has = &#123;&#125; if (__DEV__) &#123; circular = &#123;&#125; &#125; waiting = flushing = false&#125;const activatedQueue = activatedChildren.slice()callActivatedHooks(activatedQueue)function callActivatedHooks(queue) &#123; for (let i = 0; i &lt; queue.length; i++) &#123; queue[i]._inactive = true activateChildComponent(queue[i], true /* true */) &#125;&#125; å½“ä¸€ä¸ªç»„ä»¶è¢«æ’å…¥åˆ° DOM ä¸­æ—¶ï¼Œå®ƒçš„ activated é’©å­ä¼šè¢«è°ƒç”¨ã€‚ è¿™ä¸ªå‡½æ•°å¤„ç†çš„æ˜¯ activated é’©å­çš„è°ƒç”¨é€»è¾‘ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†åŠ¨æ€ç»„ä»¶ï¼ˆ æ ‡ç­¾ï¼‰æˆ– keep-alive ç¼“å­˜çš„ç»„ä»¶æ—¶ã€‚ 4.6.4 è°ƒç”¨æ™®é€šç»„ä»¶çš„ updatedé’©å­1234567891011121314const updatedQueue = queue.slice()callUpdatedHooks(updatedQueue)function callUpdatedHooks(queue: Watcher[]) &#123; let i = queue.length while (i--) &#123; const watcher = queue[i] const vm = watcher.vm if (vm &amp;&amp; vm._watcher === watcher &amp;&amp; vm._isMounted &amp;&amp; !vm._isDestroyed) &#123; callHook(vm, &#x27;updated&#x27;) &#125; &#125;&#125; 4.6.5 è°ƒç”¨resetSchedulerStateé‡ç½®çŠ¶æ€12345678function resetSchedulerState() &#123; index = queue.length = activatedChildren.length = 0 has = &#123;&#125; if (__DEV__) &#123; circular = &#123;&#125; &#125; waiting = flushing = false&#125; åœ¨æ‰§è¡Œå®Œ watcherå®ä¾‹çš„æ¸²æŸ“æ–¹æ³•åï¼Œéœ€è¦å°†çŠ¶æ€é‡ç½®ã€‚ 4.6.6 æ¸…é™¤æ— æ•ˆçš„è®¢é˜…12345678910cleanupDeps()export const cleanupDeps = () =&gt; &#123; for (let i = 0; i &lt; pendingCleanupDeps.length; i++) &#123; const dep = pendingCleanupDeps[i] dep.subs = dep.subs.filter(s =&gt; s) dep._pending = false &#125; pendingCleanupDeps.length = 0&#125; è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯ç§»é™¤é‚£äº›å·²ç»æ— æ•ˆçš„è®¢é˜…ï¼ˆsubsï¼‰ï¼Œè¿™äº›è®¢é˜…å¯èƒ½æ¥è‡ªäºå·²ç»è¢«é”€æ¯çš„ Watcher å®ä¾‹ã€‚ä»¥ä¸‹æ˜¯å¯¹ cleanupDeps å‡½æ•°çš„è¯¦ç»†è§£é‡Šï¼š äº”ã€å¼‚æ­¥å‡½æ•° nextTickæˆ‘ä»¬çŸ¥é“Vueä½¿ç”¨å¼‚æ­¥æ¸²æŸ“çš„æ–¹å¼æ¥æé«˜æ•ˆç‡ã€‚ è€Œ Vueä¸­å°±æ˜¯ä½¿ç”¨ nextTickæ¥å®Œæˆå¼‚æ­¥è¿™ä¸ªæ“ä½œã€‚ 123456789101112131415161718192021222324252627const callbacks = []let pending = falseexport function nextTick(cb, ctx) &#123; let _resolve callbacks.push(() =&gt; &#123; if (cb) &#123; try &#123; cb.call(ctx) &#125; catch (e: any) &#123; handleError(e, ctx, &#x27;nextTick&#x27;) &#125; &#125; else if (_resolve) &#123; _resolve(ctx) &#125; &#125;) if (!pending) &#123; pending = true timerFunc() &#125; // $flow-disable-line if (!cb &amp;&amp; typeof Promise !== &#x27;undefined&#x27;) &#123; return new Promise(resolve =&gt; &#123; _resolve = resolve &#125;) &#125;&#125; å¯ä»¥çœ‹å‡ºæ¥ nextTick å°±æ˜¯å°†ä¼ å…¥çš„å›è°ƒå‡½æ•°æ”¾å…¥ callbacksè¿™ä¸ªæ•°ç»„ä¸­ï¼Œç„¶åå†ä½¿ç”¨å¼‚æ­¥çš„ APIè¿›è¡Œè°ƒç”¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455let timerFunc// The nextTick behavior leverages the microtask queue, which can be accessed// via either native Promise.then or MutationObserver.// MutationObserver has wider support, however it is seriously bugged in// UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It// completely stops working after triggering a few times... so, if native// Promise is available, we will use it:/* istanbul ignore next, $flow-disable-line */if (typeof Promise !== &#x27;undefined&#x27; &amp;&amp; isNative(Promise)) &#123; const p = Promise.resolve() timerFunc = () =&gt; &#123; p.then(flushCallbacks) // In problematic UIWebViews, Promise.then doesn&#x27;t completely break, but // it can get stuck in a weird state where callbacks are pushed into the // microtask queue but the queue isn&#x27;t being flushed, until the browser // needs to do some other work, e.g. handle a timer. Therefore we can // &quot;force&quot; the microtask queue to be flushed by adding an empty timer. if (isIOS) setTimeout(noop) &#125; isUsingMicroTask = true&#125; else if ( !isIE &amp;&amp; typeof MutationObserver !== &#x27;undefined&#x27; &amp;&amp; (isNative(MutationObserver) || // PhantomJS and iOS 7.x MutationObserver.toString() === &#x27;[object MutationObserverConstructor]&#x27;)) &#123; // Use MutationObserver where native Promise is not available, // e.g. PhantomJS, iOS7, Android 4.4 // (#6466 MutationObserver is unreliable in IE11) let counter = 1 const observer = new MutationObserver(flushCallbacks) const textNode = document.createTextNode(String(counter)) observer.observe(textNode, &#123; characterData: true &#125;) timerFunc = () =&gt; &#123; counter = (counter + 1) % 2 textNode.data = String(counter) &#125; isUsingMicroTask = true&#125; else if (typeof setImmediate !== &#x27;undefined&#x27; &amp;&amp; isNative(setImmediate)) &#123; // Fallback to setImmediate. // Technically it leverages the (macro) task queue, // but it is still a better choice than setTimeout. timerFunc = () =&gt; &#123; setImmediate(flushCallbacks) &#125;&#125; else &#123; // Fallback to setTimeout. timerFunc = () =&gt; &#123; setTimeout(flushCallbacks, 0) &#125;&#125; timerFunc ç”¨äºå°†å›è°ƒå‡½æ•°æ’é˜Ÿåˆ°æµè§ˆå™¨çš„å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰é˜Ÿåˆ—ä¸­ï¼Œä»¥ç¡®ä¿åœ¨å½“å‰è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼Œä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯å¼€å§‹å‰æ‰§è¡Œè¿™äº›å›è°ƒã€‚ ä¼˜å…ˆä½¿ç”¨ Promise.then å¦‚æœç¯å¢ƒä¸æ”¯æŒ Promise,åˆ™å°è¯•ä½¿ç”¨ MutationObserver å¦‚æœä¸Šé¢ 2 ç§éƒ½ä¸æ”¯æŒï¼Œåˆ™å°è¯•ä½¿ç”¨ setImmediate å¦‚æœä¸Šé¢ 3 ç§éƒ½ä¸æ”¯æŒï¼Œåˆ™æœ€ç»ˆä½¿ç”¨ setTimeout å…­ã€æ€»ç»“æœ¬æ–‡ä»‹ç»äº†Vueçš„å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ä»¥åŠå¼‚æ­¥æ¸²æŸ“æœºåˆ¶å¸¦æ¥çš„å¥½å¤„ã€‚"},{"title":"ğŸ”¥Vue2åŒç«¯å¯¹æ¯”","path":"//posts/vue2-diff.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬åç¯‡-åŒç«¯å¯¹æ¯”ç®—æ³• ä¸ŠèŠ‚æˆ‘ä»¬è¯´åˆ°Vueæ˜¯å¼‚æ­¥æ‰¹é‡æ›´æ–°çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ watcherçš„runæ–¹æ³•ï¼Œç„¶åè°ƒç”¨å®ä¾‹ä¸Šçš„_updateæ–¹æ³•è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚ ä¸€ã€diffç®—æ³•1.1 å‰ä¸–ä»Šç”Ÿå‰ä¸–ï¼šdiff ç®—æ³•æœ€åˆæ˜¯ç”±è®¡ç®—æœºç§‘å­¦å®¶è¿ˆå…‹å°”Â·è²èˆå°”å’Œä¸¹å°¼å°”Â·å¸Œå°”ä¼¯ç‰¹æ‰€å‘æ˜çš„ä¸€ç§ æ–‡æœ¬æ¯”è¾ƒç®—æ³•ã€‚ ä»Šç”Ÿï¼šä¼´éšç€å‰ç«¯å¼€å‘çš„è“¬å‹ƒå…´èµ·ï¼Œdiff ç®—æ³•è¢«å¼•å…¥åˆ°è™šæ‹Ÿ DOM å½“ä¸­ï¼Œæˆä¸ºäº†ä¸€é¡¹ç”¨äºé«˜æ•ˆæ›´æ–°ç”¨æˆ·ç•Œé¢çš„æ ¸å¿ƒæŠ€æœ¯ã€‚å…¶æ—¨åœ¨é«˜æ•ˆåœ°è¾¨åˆ«å‡ºä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§çŠ¶æ€æ‰€éœ€è¦çš„æœ€å°å˜æ›´é›†åˆã€‚ç”±äºåœ¨æµè§ˆå™¨ä¸­å¯¹ DOM è¿›è¡Œæ“ä½œçš„æ€§èƒ½æ¶ˆè€—é¢‡ä¸ºæ˜‚è´µï¼Œä¾‹å¦‚èŠ‚ç‚¹çš„æ·»åŠ ã€åˆ é™¤ç­‰ç­‰ï¼Œæ‰€ä»¥ diff ç®—æ³•èƒ½å¤ŸÂ å°½å¯èƒ½åœ°é™ä½ DOM çš„æ“ä½œæ•°é‡ï¼Œé¿å…é¢‘ç¹çš„ DOM æ“ä½œæ‰€å¸¦æ¥çš„æ€§èƒ½è€—è´¹ï¼Œè¿›è€Œå‡è½»æµè§ˆå™¨çš„æ€§èƒ½è´Ÿæ‹…ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å¦‚æœéœ€è¦å°†ä¸Šå›¾ä¸­å·¦è¾¹çš„DOMæ ‘æ›´æ–°ä¸ºå³è¾¹çš„DOMæ ‘ï¼Œåœ¨ä¸é‡‡ç”¨è™šæ‹ŸDOMçš„æƒ…å†µä¸‹ï¼ˆå³æ— æ³•å¤ç”¨DOMèŠ‚ç‚¹ï¼‰ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œ6æ¬¡DOMæ“ä½œï¼š å¸è½½æ‰€æœ‰æ—§å­èŠ‚ç‚¹ï¼Œéœ€è¦ 3 æ¬¡ DOM åˆ é™¤æ“ä½œã€‚ æŒ‚è½½æ‰€æœ‰æ–°å­èŠ‚ç‚¹ï¼Œéœ€è¦ 3 æ¬¡ DOM æ·»åŠ æ“ä½œã€‚ ä½†æ˜¯å¦‚æœé‡‡ç”¨diffç®—æ³•å¤ç”¨DOMèŠ‚ç‚¹çš„ç­–ç•¥è¿›è¡Œçš„è¯ï¼Œå®é™…ä¸Šåªéœ€è¦è¿›è¡Œ1æ¬¡DOMæ“ä½œï¼š ç§»åŠ¨æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹çš„BèŠ‚ç‚¹åˆ°CèŠ‚ç‚¹çš„åé¢ã€‚ å¯ä»¥çœ‹å‡ºæ¥é€šè¿‡å¤ç”¨ç­–ç•¥å¯ä»¥æœ‰æ•ˆçš„é¿å…é¢‘ç¹æ“ä½œDOMå¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚ 1.2 diffç®—æ³•çš„å¤æ‚åº¦å¯¹ä¸¤æ£µæ ‘è¿›è¡Œ diff æ“ä½œï¼Œå…¶å¤æ‚åº¦ä¸º O(n^3) ã€‚ è¿™æ˜¯å› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å’Œå¦ä¸€æ£µæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹é€ä¸€è¿›è¡Œå¯¹æ¯”ï¼Œè¿™ä¾¿å½¢æˆäº† n çš„å¤æ‚åº¦ã€‚ å€˜è‹¥æ‰¾åˆ°æœ‰å˜åŒ–çš„èŠ‚ç‚¹ï¼Œæ‰§è¡Œæ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹æ“ä½œåŒæ ·å…·æœ‰ n çš„å¤æ‚åº¦ã€‚ æ‰€æœ‰çš„èŠ‚ç‚¹å‡æ˜¯å¦‚æ­¤ï¼Œå†ä¹˜ä»¥ n ï¼Œå› æ­¤å¾—å‡ºçš„å¤æ‚åº¦æ˜¯ O(n * n * n) ã€‚ å¦‚æ­¤çš„å¤æ‚åº¦å¯¹äºå‰ç«¯æ¡†æ¶è€Œè¨€æ˜¯æ— æ³•æ¥å—çš„ï¼Œè¿™æ„å‘³ç€è‹¥å­˜åœ¨ 1000 ä¸ªèŠ‚ç‚¹ï¼Œæ¸²æŸ“ä¸€æ¬¡å°±éœ€è¦å¤„ç† 1000 * 1000 * 1000ï¼Œæ€»è®¡ 10 äº¿æ¬¡ã€‚ æ‰€ä»¥å‰ç«¯æ¡†æ¶çš„ diff çº¦å®šäº†ä¸¤ç§å¤„ç†åŸåˆ™ï¼š1.åªåšåŒå±‚çš„å¯¹æ¯” 2.type å˜äº†å°±ä¸å†å¯¹æ¯”å­èŠ‚ç‚¹ã€‚ å› ä¸º DOM èŠ‚ç‚¹è¿›è¡Œè·¨å±‚çº§ç§»åŠ¨çš„æƒ…å½¢ç›¸å¯¹è¾ƒå°‘ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯åŒä¸€å±‚çº§çš„ DOM çš„å¢åˆ æ”¹æ“ä½œã€‚ åƒè¿™æ ·çš„è¯ï¼Œåªéœ€éå†ä¸€æ¬¡ï¼Œå¯¹æ¯”ä¸€ä¸‹ type å°±å¯ä»¥äº†ï¼Œå…¶å¤æ‚åº¦æ˜¯ O(n) ã€‚è€Œä¸”ä¸€æ—¦ type å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å†å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œèƒ½å¤ŸèŠ‚çœä¸‹å¤§é‡èŠ‚ç‚¹çš„éå†å·¥ä½œã€‚å¦å¤–ï¼Œç”±äºåœ¨è™šæ‹Ÿ DOM ä¸­è®°å½•äº†å…³è”çš„ DOM èŠ‚ç‚¹ï¼Œæ‰§è¡Œ DOM çš„å¢åˆ æ”¹æ“ä½œæ—¶ä¹Ÿæ— éœ€éå†ï¼Œå…¶å¤æ‚åº¦æ˜¯ O(1) ã€‚æ•´ä½“çš„ diff ç®—æ³•å¤æ‚åº¦å³ä¸º O(n) ã€‚ 1.3 diffç®—æ³•çš„æ ¸å¿ƒè¦ç´ 1.3.1 åŒå±‚æ¯”è¾ƒ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç®—æ³•ä¼šäºä¸¤ä¸ªè™šæ‹Ÿ DOM æ ‘çš„åŒä¸€å±‚çº§å±•å¼€å¯¹æ¯”ï¼Œè€Œä¸ä¼šè¿›è¡Œè·¨å±‚çº§çš„å¯¹æ¯”ã€‚è¿™ä»£è¡¨ç€å®ƒé¦–å…ˆä¼šæ ¸æŸ¥æ¯ä¸ªçˆ¶èŠ‚ç‚¹æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œæ¥ä¸‹æ¥æ‰ä¼šé€’å½’è¿›å…¥å­æ ‘è¿›è¡Œæ¯”è¾ƒã€‚å€˜è‹¥ä¸åŒï¼Œåˆ™ç›´æ¥ä¾æ®å…·ä½“æƒ…å†µè¿›è¡Œæ›´æ–°ã€‚ ç”±ä¹‹å‰çš„ç« èŠ‚èƒ½å¤Ÿäº†è§£åˆ°ï¼šåŒç«¯ diff ç®—æ³•è¢«è®¾è®¡ä¸ºåªæœ‰åŒå±‚èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œå…¶åŸå› ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š é™ä½ diff ç®—æ³•çš„å¤æ‚ç¨‹åº¦ã€‚ DOM èŠ‚ç‚¹è¿›è¡Œè·¨å±‚çº§ç§»åŠ¨çš„æƒ…å†µç›¸å¯¹è¾ƒå°‘ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯åŒä¸€å±‚çº§çš„ DOM çš„å¢åˆ æ”¹æ“ä½œã€‚ 1.3.2 ç›¸åŒèŠ‚ç‚¹åˆ¤æ–­ç­–ç•¥ å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚åœ¨ Vue ä¸­ï¼Œåˆ¤æ–­æ–°æ—§èŠ‚ç‚¹æ˜¯å¦ä¸ºç›¸åŒèŠ‚ç‚¹çš„é€»è¾‘ä¸ºï¼šå½“Â èŠ‚ç‚¹çš„æ ‡ç­¾ï¼ˆæ¯”å¦‚ p èŠ‚ç‚¹ï¼‰Â ä»¥åŠÂ èŠ‚ç‚¹çš„ï¼ˆkey&#x3D;1ï¼‰Â ç›¸åŒæ—¶ï¼Œå³è¢«è§†ä¸ºåŒä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæ˜¯å› ä¸ºä¸€æ—¦ type æˆ–è€… key å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å†å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œèƒ½å¤ŸèŠ‚çœä¸‹å¤§é‡èŠ‚ç‚¹çš„éå†å·¥ä½œï¼Œä»è€Œæå‡æ€§èƒ½ã€‚ 1.3.3 å¾ªç¯ä»ä¸¤è¾¹å‘ä¸­é—´æ¯”è¾ƒ è¿™æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œç®—æ³•ä¸æ˜¯çº¿æ€§éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œæ˜¯ä»ä¸¤ç«¯å¼€å§‹ï¼Œå‘ä¸­é—´é€æ­¥é æ‹¢ï¼Œè¿™æ ·å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹æ›´æ—©åœ°å‘ç°å·®å¼‚å¹¶ç»ˆæ­¢ä¸å¿…è¦çš„æ¯”è¾ƒã€‚ ç¬¬ä¸€æ­¥ï¼šæ¯”è¾ƒæ—§çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹Aä¸æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹Cã€‚ ç¬¬äºŒæ­¥ï¼šæ¯”è¾ƒæ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹Cä¸æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹Bã€‚ ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒæ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹Aä¸æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ Bã€‚ ç¬¬å››æ­¥ï¼šæ¯”è¾ƒæ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ Cä¸æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹Cã€‚ 1.3.4 èŠ‚ç‚¹å¤ç”¨åœ¨diffç®—æ³•ä¸­ï¼ŒèŠ‚ç‚¹å¤ç”¨æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ä¼˜åŒ–æ‰‹æ®µã€‚é€šè¿‡å¤ç”¨æ—§èŠ‚ç‚¹ï¼Œå¯ä»¥å¤§å¤§å‡å°‘DOMæ“ä½œï¼Œä»è€Œæå‡æ¸²æŸ“æ•ˆç‡ã€‚ Vue.jså›¢é˜Ÿé€šè¿‡å¼•å…¥keyçš„æ¦‚å¿µï¼Œå®ç°äº†èŠ‚ç‚¹å¤ç”¨çš„åŠŸèƒ½ã€‚keyæ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå®ƒå¯ä»¥å¸®åŠ©Vue.jsåŒºåˆ†ä¸åŒçš„èŠ‚ç‚¹ã€‚å½“æ–°æ—§èŠ‚ç‚¹çš„keyç›¸åŒæ—¶ï¼ŒVue.jså°±ä¼šå¤ç”¨æ—§èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°èŠ‚ç‚¹ã€‚ åœ¨æ²¡æœ‰keyçš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­ä¸‹é¢å±äºåŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥è¿›è¡Œå­èŠ‚ç‚¹çš„å¯¹æ¯”ï¼Œå­èŠ‚ç‚¹æ˜¯æ–‡å­—ï¼Œåˆ™ç›´æ¥æ›´æ–°æ–‡å­—ã€‚ï¼ˆè¿™é‡Œå› ä¸ºæ²¡æœ‰keyå€¼æ— æ³•è¿›è¡Œå¤ç”¨ï¼Œå¤ç”¨çš„è¯åªéœ€è¦ç§»åŠ¨AèŠ‚ç‚¹çš„ä½ç½®å³å¯ï¼‰ã€‚ åœ¨å­˜åœ¨keyçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨åŒç«¯ diffçš„å››æ­¥å¯¹æ¯”è¿›è¡Œã€‚ ç¬¬ä¸€æ­¥ï¼Œåœ¨æœ‰keyçš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­ä¸å±äºåŒä¸ªèŠ‚ç‚¹ï¼Œè·³è¿‡ ç¬¬äºŒæ­¥ï¼Œåœ¨æœ‰keyçš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­ä¸å±äºåŒä¸ªèŠ‚ç‚¹ï¼Œè·³è¿‡ ç¬¬ä¸‰æ­¥ï¼Œåœ¨æœ‰keyçš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­å±äºåŒä¸ªèŠ‚ç‚¹ï¼Œè¿›è¡ŒèŠ‚ç‚¹å¤ç”¨æ“ä½œï¼ˆå…·ä½“æ“ä½œåç»­ä¼šè¯´ï¼‰ äºŒã€è™šæ‹Ÿ DOMå’Œ diffçš„å…³è”åœ¨ä¸“æ ç¬¬å…­ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†è™šæ‹ŸDOMã€‚ æˆ‘ä»¬çŸ¥é“è™šæ‹ŸDOMæ˜¯ä¸€ç§å¯ä»¥è¡¨ç¤ºDOMçš„æŠ½è±¡å±‚é¢çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå¯ä»¥é«˜æ•ˆåœ°æ›´æ–°åˆ°å®é™…çš„DOMä¸Šã€‚ åœ¨Vueä¸­ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ¸²æŸ“å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæè¿°è¯¥ç»„ä»¶è§†å›¾çš„è™šæ‹ŸèŠ‚ç‚¹æ ‘ã€‚ åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œä¼šè°ƒç”¨æ¸²æŸ“å‡½æ•°ç”Ÿæˆä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ ‘ã€‚ å½“ç»„ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ¸²æŸ“å‡½æ•°ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„è™šæ‹ŸèŠ‚ç‚¹æ ‘ã€‚ Vueçš„diffç®—æ³•å°±æ˜¯ç”¨æ¥æ¯”è¾ƒæ–°æ—§è™šæ‹ŸèŠ‚ç‚¹æ ‘çš„å·®å¼‚ï¼Œæ‰¾å‡ºæœ€å°çš„DOMæ“ä½œæ¥æ›´æ–°å®é™…çš„DOMã€‚ æ‰€ä»¥ Vueçš„ diffåªä¼šå‘ç”Ÿåœ¨æ›´æ–°é˜¶æ®µã€‚åˆæ¬¡æŒ‚è½½ç›´æ¥åˆ›å»ºå¹¶æŒ‚è½½èŠ‚ç‚¹ã€‚ 1234567891011121314151617// å‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„ç»„ä»¶let component = &#123; data: &#x27;Hello, Vue!&#x27;, template: `&lt;div&gt;&#123;&#123; data &#125;&#125;&lt;/div&gt;`&#125;; // é¦–æ¬¡æ¸²æŸ“ï¼Œç”Ÿæˆè™šæ‹ŸDOMlet oldVnode = Vue.render(component); // å‡è®¾æ•°æ®ï¼ˆdataï¼‰æ›´æ–°ï¼Œäº§ç”Ÿæ–°çš„è™šæ‹ŸDOMlet newVnode = Vue.render(component); // Vueçš„diffç®—æ³•æ¯”è¾ƒæ–°æ—§è™šæ‹ŸDOMlet patches = Vue.diff(oldVnode, newVnode); // æ ¹æ®diffç»“æœåº”ç”¨åˆ°å®é™…DOMVue.patch(document.body, patches); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒVueé¦–æ¬¡æ¸²æŸ“ç»„ä»¶æ—¶ç”Ÿæˆäº†ä¸€ä¸ªè™šæ‹ŸDOMèŠ‚ç‚¹ï¼ˆoldVnodeï¼‰ã€‚å½“ç»„ä»¶çš„æ•°æ®æ›´æ–°æ—¶ï¼ŒVueå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„è™šæ‹ŸDOMèŠ‚ç‚¹ï¼ˆnewVnodeï¼‰ã€‚Vueçš„diffç®—æ³•ä¼šæ¯”è¾ƒè¿™ä¸¤ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œæ‰¾å‡ºéœ€è¦æ‰§è¡Œçš„æœ€å°DOMæ“ä½œï¼ˆpatchesï¼‰ï¼Œæœ€åè¿™äº›DOMæ“ä½œä¼šè¢«åº”ç”¨åˆ°å®é™…çš„DOMä¸Šï¼Œä»¥æ­¤æ¥æ›´æ–°è§†å›¾ã€‚ ä¸‰ã€ snabbdomç®€ä»‹Snabbdomæ˜¯ç‘å…¸è¯­å•è¯ï¼ŒåŸæ„ä¸ºâ€é€Ÿåº¦â€œã€‚æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è™šæ‹ŸDOMå’ŒDOM diffç®—æ³•åº“ï¼Œå®ƒè¢«è®¾è®¡ç”¨äºä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼æ›´æ–°çœŸå®DOMã€‚Vue.jsåœ¨2.xç‰ˆæœ¬ä¸­é‡‡ç”¨äº†è™šæ‹ŸDOMçš„æ¦‚å¿µæ¥æé«˜å…¶æ€§èƒ½å’Œæ•ˆç‡ï¼Œè€ŒVue 2.xå†…éƒ¨ä½¿ç”¨çš„è™šæ‹ŸDOMå®ç°å®é™…ä¸Šæ˜¯åœ¨Snabbdomçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›å®šåˆ¶å’Œæ”¹é€ çš„ã€‚ Vueå›¢é˜Ÿé€‰æ‹©Snabbdomä½œä¸ºå…¶è™šæ‹ŸDOMå®ç°çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºSnabbdomçš„é«˜æ€§èƒ½ç‰¹æ€§å’Œå°å·§çš„ä½“ç§¯ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€æ´çš„APIæ¥åˆ›å»ºå’Œç®¡ç†è™šæ‹ŸèŠ‚ç‚¹ï¼ˆvnodesï¼‰ï¼Œå¹¶é€šè¿‡é«˜æ•ˆçš„diffç®—æ³•æ¥è®¡ç®—å‡ºè™šæ‹ŸDOMæ ‘çš„æœ€å°å˜æ›´é›†ï¼Œè¿›è€Œåªå¯¹å®é™…DOMè¿›è¡Œå¿…è¦çš„æ›´æ–°ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„DOMæ“ä½œï¼Œæé«˜äº†é¡µé¢çš„æ¸²æŸ“æ•ˆç‡ã€‚ vue2æºç ä¸­æ›´æ–°åŸºæœ¬å’Œsnabbdomä¸­ä¸€è‡´ï¼Œéƒ¨åˆ†è¾¹è§’ç»†èŠ‚ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€ä¸‹snabbdomæºç å¤§è‡´å°±å¯ä»¥äº†è§£Vueæ›´æ–°çš„ç»†èŠ‚ã€‚ githubåœ°å€ï¼šhttps://github.com/snabbdom/snabbdom 123456789101112131415161718192021222324252627282930313233import &#123; init, h&#125; from &quot;snabbdom&quot;;// è°ƒç”¨ initç”Ÿæˆ patchæ¸²æŸ“å‡½æ•°const patch = init([]);const container = document.getElementById(&quot;container&quot;);const myVnode = h(&#x27;div&#x27;,[ h(&#x27;p&#x27;,&#x27;è‹¹æœ&#x27;), h(&#x27;p&#x27;,&#x27;é¦™è•‰&#x27;), h(&#x27;p&#x27;,&#x27;ç«é¾™æœ&#x27;),]);const myVnode2 = h(&#x27;div&#x27;,[ h(&#x27;p&#x27;,&#x27;è‹¹æœ&#x27;), h(&#x27;p&#x27;,&#x27;é¦™è•‰&#x27;), h(&#x27;p&#x27;,&#x27;æ¡ƒå­&#x27;),])// ç¬¬ä¸€ä¸ªå‚æ•°ä¸º DOMèŠ‚ç‚¹// ç¬¬äºŒä¸ªå‚æ•°ä¸º VNODEèŠ‚ç‚¹// è¡¨ç¤ºç¬¬ä¸€æ¬¡æ‰§è¡ŒæŒ‚è½½æ“ä½œpatch(container, myVnode);document.getElementById(&#x27;btn&#x27;).addEventListener(&#x27;click&#x27;,()=&gt;&#123; // ç¬¬ä¸€ä¸ªå‚æ•°ä¸º DOMèŠ‚ç‚¹ // ç¬¬äºŒä¸ªå‚æ•°ä¸º VNODEèŠ‚ç‚¹ // è¡¨ç¤ºæ‰§è¡Œæ›´æ–°æ“ä½œ patch(myVnode, myVnode2);&#125;) ç•Œé¢ä¸Šæ¸²æŸ“æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š ç‚¹å‡»æŒ‰é’®åï¼š ç”±ä¹‹å‰çš„diffç®—æ³•å¯çŸ¥ï¼Œå½“ç‚¹å‡»æ›´æ–°ä»¥åï¼Œç•Œé¢ä¸Šä¼šå¤ç”¨å‰ä¸¤ä¸ªå…ƒç´ è‹¹æœå’Œé¦™è•‰(å³æ²¡æœ‰é”€æ¯ä»¥åŠé‡æ–°åˆ›å»º)ï¼Œé‚£ä¹ˆå¦‚ä½•è¯æ˜å®ƒå¤ç”¨äº†å‘¢ï¼Œå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æ›´æ”¹å‰2ä¸ªå…ƒç´ ï¼Œå¦‚æœç‚¹å‡»æ›´æ–°ä»¥åï¼Œæ›´æ”¹çš„å‰2ä¸ªå…ƒç´ æ²¡æœ‰å˜åŒ–ï¼Œå³å¯è¯æ˜å®ƒå¹¶å¯¹domèŠ‚ç‚¹è¿›è¡Œäº†å¤ç”¨ã€‚ å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œpatchå³ä¸ºvueä¸­çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œç‚¹å‡»æŒ‰é’®æ›´æ–°æ–°çš„vnodeç›¸å½“äºvueä¸­çš„æ›´æ–°æ¸²æŸ“ï¼Œåªä¸è¿‡vueä¸­å°†è¡Œä¸ºè¿›è¡Œäº†ä¸€äº›å°è£…ã€‚æ‰€ä»¥æŒæ¡snabbdomå³å¯æŒæ¡vue2çš„æ ¸å¿ƒåŒç«¯diffç®—æ³•ã€‚"},{"title":"ğŸ”¥Vue2æ•°æ®å“åº”å¼åŸç†","path":"//posts/vue2-observe.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬å…«ç¯‡-æ•°æ®å“åº”å¼åŸç† ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬å°†åˆæ¬¡æ¸²æŸ“é¡µé¢çš„æµç¨‹å¤§è‡´çš„è¿‡äº†ä¸€éã€‚ å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰æè¿°ã€‚ Vueä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†çš„å°±æ˜¯æ•°æ®é©±åŠ¨è§†å›¾ï¼Œæ‰€è°“å“åº”å¼å°±æ˜¯å½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç•Œé¢ä¼šåŒæ­¥æ›´æ–°ã€‚ ä¸€ã€æ•°æ®ä»£ç†çš„åŸºç¡€æ•°æ®ä»£ç†ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä½œæ•°æ®åŠ«æŒï¼Œæ˜¯ä¸€ç§æŠ€æœ¯æ‰‹æ®µï¼Œå®ƒèƒ½å¤Ÿæˆªè·å¯¹å¯¹è±¡å±æ€§çš„è®¿é—®å’Œä¿®æ”¹æ“ä½œï¼Œå¹¶åœ¨è¿™äº›æ“ä½œå‘ç”Ÿæ—¶æ‰§è¡Œé¢å¤–çš„é€»è¾‘æˆ–ä¿®æ”¹è¿”å›çš„ç»“æœã€‚ åœ¨ Vue.js ä¸­ï¼Œå“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶æ­£æ˜¯åŸºäºæ•°æ®ä»£ç†ã€‚ é€šè¿‡ä»£ç†ï¼ŒVue èƒ½å¤Ÿåœ¨æ•°æ®è¢«è®¿é—®æ—¶æ”¶é›†ä¾èµ–ï¼Œåœ¨æ•°æ®è¢«ä¿®æ”¹æ—¶æ›´æ–°è¿™äº›ä¾èµ–ï¼Œè¿™æ˜¯å“åº”å¼ç³»ç»Ÿè¿ä½œçš„åŸºæœ¬ç†å¿µã€‚ è€Œè¿™ä¸€åˆ‡éƒ½ä¾èµ–äº Vue å¯¹æ•°æ®è¿›è¡Œçš„æ‹¦æˆªå’Œä»£ç†æ“ä½œã€‚ å°½ç®¡å“åº”å¼ç‰¹æ€§æœ¬èº«å¹¶éæœ¬èŠ‚çš„è®¨è®ºé‡ç‚¹ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ•°æ®ä»£ç†åœ¨å…¶ä»–åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚ åœ¨æ·±å…¥åˆ†æä¹‹å‰ï¼Œé‡è¦çš„æ˜¯è¦ç†è§£å®ç°æ•°æ®ä»£ç†çš„ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼šObject.definePropertyå’Œ Proxyã€‚ è¿™ä¸¤ç§æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼Œä»¥å®ç°å¯¹æ•°æ®è®¿é—®å’Œä¿®æ”¹è¡Œä¸ºçš„ç²¾ç»†æ§åˆ¶ã€‚ 1.1 Object.definePropertyVueæ˜¯é€šè¿‡è¿™ä¸ªAPIå¯¹æ•°æ®è¿›è¡Œç›‘å¬çš„ã€‚ Object.defineProperty() æ–¹æ³•ç”¨äºåœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šç›´æ¥å®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚ åŸºæœ¬ä½¿ç”¨å¦‚ä¸‹ï¼š 1Object.defineProperty(obj, prop, descriptor) å‚æ•°è¯´æ˜ï¼š objï¼šå¿…éœ€ã€‚ç›®æ ‡å¯¹è±¡propsï¼šå¿…éœ€ã€‚éœ€å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åå­—descriptorï¼šå¿…éœ€ã€‚ç›®æ ‡å±æ€§æ‰€æ‹¥æœ‰çš„ç‰¹æ€§ Object.defineProperty() å…è®¸æˆ‘ä»¬ç²¾ç¡®åœ°æ·»åŠ æˆ–ä¿®æ”¹å¯¹è±¡çš„å±æ€§ã€‚ ç»™å¯¹è±¡çš„å±æ€§æ·»åŠ ç‰¹æ€§æè¿°æœ‰ä¸¤ç§å½¢å¼ï¼š1.æ•°æ®æè¿°å’Œ2.å­˜å–æè¿° color:orangeã€‚ æ•°æ®æè¿°å’Œå­˜å–æè¿°æ‰€å¯¹åº”çš„å±æ€§æ˜¯ä¸åŒçš„ã€‚ 1.1.1 æ•°æ®æè¿°å½“ä¿®æ”¹æˆ–å®šä¹‰å¯¹è±¡çš„æŸä¸ªå±æ€§çš„æ—¶å€™ï¼Œç»™è¿™ä¸ªå±æ€§æ·»åŠ ä¸€äº›ç‰¹æ€§ã€‚ 1234567891011121314151617let obj = &#123; test:&#x27;hello world&#x27;&#125;//å¯¹å·²æœ‰çš„å±æ€§æ·»åŠ ç‰¹æ€§æè¿°Object.defineProperty(obj,&quot;test&quot;,&#123; configurable:true | false, enumerable:true | false, value:ä»»æ„ç±»å‹çš„å€¼, writable:true | false&#125;);//å¯¹æ–°æ·»åŠ çš„å±æ€§çš„ç‰¹æ€§æè¿°Object.defineProperty(obj,&quot;newKey&quot;,&#123; configurable:true | false, enumerable:true | false, value:ä»»æ„ç±»å‹çš„å€¼, writable:true | false&#125;); æ•°æ®æè¿°ä¸­æœ‰å››ä¸ªå±æ€§ï¼Œéƒ½æ˜¯å¯é€‰çš„ï¼Œæ¥çœ‹ä¸€ä¸‹æ¯ä¸€ä¸ªå±æ€§çš„ä½œç”¨ã€‚ 1.1.1.1 valueå±æ€§å¯¹åº”çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„ç±»å‹çš„å€¼ï¼Œé»˜è®¤ä¸º undefinedã€‚ 123456789101112let obj = &#123;&#125;//ç¬¬ä¸€ç§æƒ…å†µï¼šä¸è®¾ç½®valueå±æ€§Object.defineProperty(obj,&quot;newKey&quot;,&#123;&#125;);console.log( obj.newKey ); //undefined----------------------------------------//ç¬¬äºŒç§æƒ…å†µï¼šè®¾ç½®valueå±æ€§Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;&#125;);console.log( obj.newKey ); //hello 1.1.1.2 writableå±æ€§çš„å€¼æ˜¯å¦å¯ä»¥è¢«é‡å†™ã€‚è®¾ç½®ä¸ºtrueå¯ä»¥è¢«é‡å†™ï¼›è®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«é‡å†™ã€‚é»˜è®¤ä¸ºfalseã€‚ 123456789101112131415161718let obj = &#123;&#125;//ç¬¬ä¸€ç§æƒ…å†µï¼šwritableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½é‡å†™ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false&#125;);//æ›´æ”¹newKeyçš„å€¼obj.newKey = &quot;change value&quot;;console.log( obj.newKey ); //hello------------------------------//ç¬¬äºŒç§æƒ…å†µï¼šè®¾ç½®valueå±æ€§Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:true&#125;);//æ›´æ”¹newKeyçš„å€¼obj.newKey = &quot;change value&quot;;console.log( obj.newKey ); //change value 1.1.1.3 configurableæ˜¯å¦å¯ä»¥åˆ é™¤ç›®æ ‡å±æ€§æˆ–æ˜¯å¦å¯ä»¥å†æ¬¡ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼ˆwritable, configurable, enumerableï¼‰ã€‚è®¾ç½®ä¸ºtrueå¯ä»¥è¢«åˆ é™¤æˆ–å¯ä»¥é‡æ–°è®¾ç½®ç‰¹æ€§ï¼›è®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«å¯ä»¥è¢«åˆ é™¤æˆ–ä¸å¯ä»¥é‡æ–°è®¾ç½®ç‰¹æ€§ã€‚é»˜è®¤ä¸ºfalseã€‚ è¿™ä¸ªå±æ€§èµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼š ç›®æ ‡å±æ€§æ˜¯å¦å¯ä»¥ä½¿ç”¨deleteåˆ é™¤ ç›®æ ‡å±æ€§æ˜¯å¦å¯ä»¥å†æ¬¡è®¾ç½®ç‰¹æ€§ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758//-----------------æµ‹è¯•ç›®æ ‡å±æ€§æ˜¯å¦èƒ½è¢«åˆ é™¤------------------------let obj = &#123;&#125;//ç¬¬ä¸€ç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«åˆ é™¤ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false, enumerable:false, configurable:false&#125;);//åˆ é™¤å±æ€§delete obj.newKey;console.log( obj.newKey ); //hello//ç¬¬äºŒç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥è¢«åˆ é™¤ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false, enumerable:false, configurable:true&#125;);//åˆ é™¤å±æ€§delete obj.newKey;console.log( obj.newKey ); //undefined//-----------------æµ‹è¯•æ˜¯å¦å¯ä»¥å†æ¬¡ä¿®æ”¹ç‰¹æ€§------------------------let obj = &#123;&#125;//ç¬¬ä¸€ç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½å†æ¬¡ä¿®æ”¹ç‰¹æ€§ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false, enumerable:false, configurable:false&#125;);//é‡æ–°ä¿®æ”¹ç‰¹æ€§//æŠ¥é”™ï¼šUncaught TypeError: Cannot redefine property: newKey// å› ä¸º writableå’Œ configurableéƒ½ä¸º false å³æ— æ³•é‡æ–°é…ç½®Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:true, enumerable:true, configurable:true&#125;);//ç¬¬äºŒç§æƒ…å†µï¼šconfigurableè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥å†æ¬¡ä¿®æ”¹ç‰¹æ€§ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false, enumerable:false, configurable:true&#125;);//é‡æ–°ä¿®æ”¹ç‰¹æ€§Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:true, enumerable:true, configurable:true&#125;);console.log( obj.newKey ); //hello 1.1.1.4 enumerableæ­¤å±æ€§æ˜¯å¦å¯ä»¥è¢«æšä¸¾ï¼ˆä½¿ç”¨forâ€¦inæˆ–Object.keys()ï¼‰ã€‚è®¾ç½®ä¸ºtrueå¯ä»¥è¢«æšä¸¾ï¼›è®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«æšä¸¾ã€‚é»˜è®¤ä¸ºfalseã€‚ 1234567891011121314151617181920212223let obj = &#123;&#125;//ç¬¬ä¸€ç§æƒ…å†µï¼šenumerableè®¾ç½®ä¸ºfalseï¼Œä¸èƒ½è¢«æšä¸¾ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false, enumerable:false&#125;);//æšä¸¾å¯¹è±¡çš„å±æ€§for( var attr in obj )&#123; console.log( attr ); // æ‰“å°ä¸ºç©º&#125;//ç¬¬äºŒç§æƒ…å†µï¼šenumerableè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥è¢«æšä¸¾ã€‚Object.defineProperty(obj,&quot;newKey&quot;,&#123; value:&quot;hello&quot;, writable:false, enumerable:true&#125;);//æšä¸¾å¯¹è±¡çš„å±æ€§for( var attr in obj )&#123; console.log( attr ); //newKey&#125; ä¸€æ—¦ä½¿ç”¨Object.definePropertyç»™å¯¹è±¡æ·»åŠ å±æ€§ï¼Œé‚£ä¹ˆå¦‚æœä¸è®¾ç½®å±æ€§çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆconfigurableã€enumerableã€writableè¿™äº›å€¼éƒ½ä¸ºé»˜è®¤çš„false color:orange 1.1.2 å­˜å–å™¨æè¿°å­˜å–å™¨æè¿°ç¬¦ä¹Ÿæœ‰å››ä¸ªå±æ€§ï¼šgetã€setã€enumerableã€configureã€‚ 1234567let obj = &#123;&#125;;Object.defineProperty(obj,&quot;newKey&quot;,&#123; get:function ()&#123;&#125; | undefined, set:function (value)&#123;&#125; | undefined configurable: true | false enumerable: true | false&#125;); å½“ä½¿ç”¨äº†getteræˆ–setteræ–¹æ³•ï¼Œä¸å…è®¸ä½¿ç”¨writableå’Œvalueè¿™ä¸¤ä¸ªå±æ€§ 1.1.2.1 getter&#x2F;setterå½“è®¾ç½®æˆ–è·å–å¯¹è±¡çš„æŸä¸ªå±æ€§çš„å€¼çš„æ—¶å€™ï¼Œå¯ä»¥æä¾›getter&#x2F;setteræ–¹æ³•ã€‚ getter æ˜¯ä¸€ç§è·å¾—å±æ€§å€¼çš„æ–¹æ³• setteræ˜¯ä¸€ç§è®¾ç½®å±æ€§å€¼çš„æ–¹æ³•ã€‚ åœ¨ç‰¹æ€§ä¸­ä½¿ç”¨get&#x2F;setå±æ€§æ¥å®šä¹‰å¯¹åº”çš„æ–¹æ³•ã€‚ 12345678910111213141516171819let obj = &#123;&#125;;let initValue = &#x27;hello&#x27;;Object.defineProperty(obj,&quot;newKey&quot;,&#123; get:function ()&#123; //å½“è·å–å€¼çš„æ—¶å€™è§¦å‘çš„å‡½æ•° return initValue; &#125;, set:function (value)&#123; //å½“è®¾ç½®å€¼çš„æ—¶å€™è§¦å‘çš„å‡½æ•°,è®¾ç½®çš„æ–°å€¼é€šè¿‡å‚æ•°valueæ‹¿åˆ° initValue = value; &#125;&#125;);//è·å–å€¼console.log( obj.newKey ); //hello//è®¾ç½®å€¼obj.newKey = &#x27;change value&#x27;;console.log( obj.newKey ); //change value æ³¨æ„ï¼šgetæˆ–setä¸æ˜¯å¿…é¡»æˆå¯¹å‡ºç°ï¼Œä»»å†™å…¶ä¸€å°±å¯ä»¥ã€‚å¦‚æœä¸è®¾ç½®æ–¹æ³•ï¼Œåˆ™getå’Œsetçš„é»˜è®¤å€¼ä¸ºundefined configurableå’ŒenumerableåŒä¸Šé¢çš„ç”¨æ³•ã€‚ å±æ€§æè¿°ç¬¦å’Œæ•°æ®æè¿°ç¬¦éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¦‚æœä½ åœ¨ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­æ—¢å†™äº† value&#x2F;writableï¼Œåˆå†™äº† get&#x2F;set åˆ™ä¼šæŠ¥é”™ã€‚ 1.1.3 å…¼å®¹æ€§ å…¼å®¹æ€§å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ie8ä¸‹åªèƒ½åœ¨DOMå¯¹è±¡ä¸Šä½¿ç”¨ï¼Œå°è¯•åœ¨åŸç”Ÿçš„å¯¹è±¡ä½¿ç”¨ Object.defineProperty()ä¼šæŠ¥é”™ã€‚ 1.1.4 å›°æƒ‘çš„é—®é¢˜ å¦‚ä¸Šï¼Œåœ¨ä½¿ç”¨ get æ–¹æ³•åï¼Œæ— æ³•ç›´æ¥çœ‹åˆ°å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œéœ€è¦ç‚¹å‡»æ‰å¯ä»¥ã€‚ 1.2 Proxy1.2.1 definePropertyçš„ç¼ºç‚¹æˆ‘ä»¬çŸ¥é“Vue2ä¸­çš„æ•°æ®å“åº”å¼å¤„ç†ä½¿ç”¨çš„æ˜¯ Object.definePropertyï¼Œè€Œ Vue3ä¸­å®ç°æ•°æ®å“åº”ä½¿ç”¨çš„æ˜¯ Proxyã€‚ Object.definePropertyè™½ç„¶å¯ä»¥å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯æ— æ³•å¯¹æ•°ç»„æˆ–è€…æ·±å±‚æ¬¡å¯¹è±¡è¿›è¡Œç›‘å¬å¤„ç†ã€‚ 1.2.1.1 æ•°ç»„123456789101112131415161718192021let arr = [1,2,3,4,5];arr.forEach((item,index)=&gt;&#123; Object.defineProperty(arr,index,&#123; get() &#123; console.log(&#x27;æ•°ç»„è¢«getteræ‹¦æˆª&#x27;) return item &#125;, set(value) &#123; console.log(&#x27;æ•°ç»„è¢«setteræ‹¦æˆª&#x27;) return item = value &#125; &#125;)&#125;)arr[1] = 11;console.log(arr[1]);arr.push(6)arr[10] = 10// ç»“æœæ•°ç»„è¢«setteræ‹¦æˆªæ•°ç»„è¢«getteræ‹¦æˆª11 å¾ˆæ˜¾ç„¶ï¼Œå·²çŸ¥é•¿åº¦çš„æ•°ç»„å¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡Œå±æ€§çš„è®¾ç½®ä¸è®¿é—® color:orangeã€‚ ç„¶è€Œï¼Œæ•°ç»„çš„æ·»åŠ æ“ä½œå´æ— æ³•è¢«ç›´æ¥æ‹¦æˆªã€‚ è¿™å¾ˆå®¹æ˜“ç†è§£ï¼šæ— è®ºæ˜¯é€šè¿‡ arr.push() æ–¹æ³•è¿˜æ˜¯ç›´æ¥èµ‹å€¼å¦‚ arr[10] &#x3D; 10 æ¥æ·»åŠ å…ƒç´ ï¼Œæ–°æ·»åŠ çš„ç´¢å¼•å¹¶æœªè¢«åŒ…å«åœ¨é¢„è®¾çš„æ•°æ®æ‹¦æˆªæœºåˆ¶ä¸­ï¼Œå› æ­¤æ— æ³•å®ç°æ‹¦æˆªå¤„ç†ã€‚ è¿™æ˜¯ä½¿ç”¨ Object.defineProperty è¿›è¡Œæ•°æ®ä»£ç†çš„ä¸€ä¸ªå±€é™æ€§ã€‚ Vue åœ¨å…¶å“åº”å¼ç³»ç»Ÿä¸­å¯¹æ•°ç»„æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œä»è€Œé—´æ¥åœ°è§£å†³äº†æ­¤é—®é¢˜ã€‚ 1.2.1.2 æ·±å±‚æ¬¡å¯¹è±¡12345678910111213141516171819202122let obj=&#123; level1:&#123; level2:&quot;ç¬¬äºŒå±‚&quot; &#125;&#125;// ä¿å­˜ level1 çš„åŸå§‹å€¼ é¿å…å¾ªç¯å¼•ç”¨çš„é”™è¯¯let originalLevel1 = obj.level1;Object.defineProperty(obj,&#x27;level1&#x27;,&#123; get()&#123; console.log(&quot;å¯¹è±¡è¢«getteræ‹¦æˆª&quot;) return originalLevel1 &#125;, set(value)&#123; console.log(&quot;å¯¹è±¡è¢«setteræ‹¦æˆª&quot;) originalLevel1 = value; &#125;&#125;)// ç»“æœå¯¹è±¡è¢«setteræ‹¦æˆªå¯¹è±¡è¢«getteræ‹¦æˆªobj.level1 = &#123;level3:&quot;ç¬¬ä¸‰å±‚&quot;&#125;console.log(obj.level1)// &#123;level3:&quot;ç¬¬ä¸‰å±‚&quot;&#125; å¯ä»¥çœ‹åˆ°æ›´æ–°è®¾ç½®çš„é‚£ä¸€å±‚æ˜¯æ²¡é—®é¢˜çš„ã€‚ ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ›´æ–°æ›´æ·±å±‚æ¬¡çš„å¯¹è±¡ï¼Œå°±æ— æ³•ç›‘å¬åˆ°ã€‚ 1234567891011121314151617181920let obj=&#123; level1:&#123; level2:&quot;ç¬¬äºŒå±‚&quot; &#125;&#125;// ä¿å­˜ level1 çš„åŸå§‹å€¼ é¿å…å¾ªç¯å¼•ç”¨çš„é”™è¯¯let originalLevel1 = obj.level1;Object.defineProperty(obj,&#x27;level1&#x27;,&#123; get()&#123; console.log(&quot;å¯¹è±¡è¢«getteræ‹¦æˆª&quot;) return originalLevel1 &#125;, set(value)&#123; console.log(&quot;å¯¹è±¡è¢«setteræ‹¦æˆª&quot;) originalLevel1 = value; &#125;&#125;) obj.level1.level2 = &#x27;ç¬¬äºŒå±‚-å¤åˆ¶&#x27;//ç»“æœå¯¹è±¡è¢«getteræ‹¦æˆª å¯ä»¥çœ‹å‡ºæ¥å¹¶æ²¡æœ‰æ‰§è¡Œ set æ–¹æ³•ï¼Œå¦‚æœæƒ³è¦æ·±å±‚æ¬¡çš„å±æ€§ä¹Ÿè¢«ç›‘å¬åˆ°çš„è¯ï¼Œéœ€è¦é€’å½’åœ°ç»™å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§æ·»åŠ å±æ€§æè¿°ã€‚ 1234567891011121314151617181920212223242526272829function walk(obj)&#123; // å¦‚æœä¸æ˜¯å¯¹è±¡ æ— éœ€å¤„ç† if(!(obj instanceof Object)) return obj for(let k in obj)&#123; let val = obj[k]; walk(val); Object.defineProperty(obj,k,&#123; enumerable:true, configurable:true, get()&#123; console.log(`è®¿é—®obj.$&#123;k&#125;å±æ€§è§¦å‘`) return val &#125;, set(newValue) &#123; console.log(`ä¿®æ”¹obj.$&#123;k&#125;å±æ€§è§¦å‘` , newValue) if (val === newValue) return; val = newValue walk(newValue) &#125; &#125;) &#125; return obj;&#125;// é€’å½’ç›‘å¬æ‰€æœ‰å±‚çº§å¯¹è±¡let obj = &#123;a:&#123;b:&#123;c:&#x27;d&#x27;&#125;&#125;&#125;walk(obj)obj.aobj.a.bobj.a.b.c 1.2.2 Proxyçš„ä»‹ç»Proxyå°±å¯ä»¥è§£å†³Object.definePropertyçš„è¿™äº›é—®é¢˜ã€‚ ä»£ç†æ˜¯ç›®æ ‡å¯¹è±¡çš„æŠ½è±¡ã€‚ ä»–å¯ä»¥ç”¨ä½œç›®æ ‡å¯¹è±¡çš„æ›¿èº«ï¼Œä½†åˆå®Œå…¨ç‹¬ç«‹äºç›®æ ‡å¯¹è±¡ã€‚ ç›®æ ‡å¯¹è±¡æ—¢å¯ä»¥ç›´æ¥è¢«æ“ä½œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç†æ¥æ“ä½œã€‚ä½†æ˜¯ç›´æ¥æ“ä½œä¼šç»•è¿‡ä»£ç†èµ‹äºˆçš„è¡Œä¸ºã€‚ 1.2.2.1 ç©ºä»£ç†æœ€ç®€å•çš„ä»£ç†æ˜¯ç©ºä»£ç†ï¼Œå³é™¤äº†ä½œä¸ºä¸€ä¸ªæŠ½è±¡çš„ç›®æ ‡å¯¹è±¡ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚ ä»£ç†å¯¹è±¡ä¸Šæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½ä¼šæ— éšœç¢çš„ä¼ æ’­åˆ°ç›®æ ‡å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930const target = &#123; id: &#x27;target&#x27;&#125;const handler = &#123;&#125;const proxy = new Proxy(target, handler)// idå±æ€§ä¼šè®¿é—®åŒä¸€ä¸ªå€¼console.log(target.id); // targetconsole.log(proxy.id); // target// ç»™ç›®æ ‡å±æ€§èµ‹å€¼ä¼šåæ˜ åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Š// å› ä¸ºä¸¤ä¸ªå¯¹è±¡è®¿é—®çš„æ˜¯åŒä¸€ä¸ªå€¼target.id = &#x27;foo&#x27;;console.log(target.id); // fooconsole.log(proxy.id); // foo // ç»™ä»£ç†å±æ€§èµ‹å€¼ä¼šåæ˜ åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Š// å› ä¸ºè¿™ä¸ªèµ‹å€¼ä¼šè½¬ç§»åˆ°ç›®æ ‡å¯¹è±¡proxy.id = &#x27;bar&#x27;;console.log(target.id); // barconsole.log(proxy.id); // bar// Proxy.prototype æ˜¯ undefined// å› æ­¤ä¸èƒ½ä½¿ç”¨ instanceof æ“ä½œç¬¦console.log(target instanceof Proxy); // TypeError: Function has non-object prototype console.log(proxy instanceof Proxy); // TypeError: Function has non-object prototype// ä¸¥æ ¼ç›¸ç­‰å¯ä»¥ç”¨æ¥åŒºåˆ†ä»£ç†å’Œç›®æ ‡console.log(target === proxy); // false 1.2.2.2 å®šä¹‰æ•è·å™¨å½“ç„¶ï¼Œæ­£å¸¸ä½¿ç”¨ä¸ä¼šç»™ä¸€ä¸ªç©ºä»£ç†ï¼Œè‚¯å®šæ˜¯è¦é€šè¿‡ä»£ç†å¯¹è®¿é—®å’Œä¿®æ”¹è¿›è¡Œæ•è·ã€‚ æœ¬èŠ‚æš‚ä¸”ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æ•è·å™¨ã€‚è¦†ç›–Vue2ä¸­ä½¿ç”¨çš„æ‰€æœ‰æ•è·å™¨ã€‚ 1.2.2.2.1 get æ•è·å™¨getæ•è·å™¨ä¼šåœ¨è·å–å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ã€‚ 12345678910111213141516const target = &#123; foo: &#x27;bar&#x27;&#125;; const handler = &#123; // æ•è·å™¨åœ¨å¤„ç†ç¨‹åºå¯¹è±¡ä¸­ä»¥æ–¹æ³•åä¸ºé”® get()&#123; return &#x27;handler override&#x27;; &#125;&#125;const proxy = new Proxy(target, handler)// åªæœ‰åœ¨ä»£ç†å¯¹è±¡ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œæ‰ä¼šè§¦å‘æ•è·å™¨ åœ¨ç›®æ ‡å¯¹è±¡ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œä»ç„¶ä¼šäº§ç”Ÿæ­£å¸¸çš„è¡Œä¸ºconsole.log(target.foo) // barconsole.log(proxy.foo) // handler override è¿”å›å€¼ è¿”å›å€¼æ— é™åˆ¶ã€‚ æ‹¦æˆªçš„æ“ä½œ proxy.property proxy[property] Object.create(proxy)[property] Reflect.get(proxy, property, receiver) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•° target: ç›®æ ‡å¯¹è±¡ property: å¼•ç”¨ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ receiver: ä»£ç†å¯¹è±¡æˆ–ç»§æ‰¿ä»£ç†å¯¹è±¡çš„å¯¹è±¡ 1.2.2.2.2 setæ•è·å™¨set()æ•è·å™¨ä¼šåœ¨è®¾ç½®å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ã€‚ 123456789const myTarget = &#123;&#125;;const proxy = new Proxy(myTarget, &#123; set(target, property, value, receiver) &#123; console.log(&#x27;è§¦å‘äº†set&#x27;); return Reflect.set(...arguments) &#125;&#125;);proxy.foo = &#x27;bar&#x27;;// è§¦å‘äº†set è¿”å›å€¼ è¿”å› true è¡¨ç¤ºæˆåŠŸï¼›è¿”å› false è¡¨ç¤ºå¤±è´¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡º TypeErrorã€‚ æ‹¦æˆªçš„æ“ä½œ proxy.property &#x3D; value proxy.[property] &#x3D; value Object.create(proxy)[property] &#x3D; value Reflect.set(proxy, property, value, receiver) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•° target: ç›®æ ‡å¯¹è±¡ property: å¼•ç”¨ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ valueï¼šè¦èµ‹ç»™å±æ€§çš„å€¼ã€‚ receiver: æ¥æ”¶æœ€åˆèµ‹å€¼çš„å¯¹è±¡ 1.2.2.2.3 hasæ•è·å™¨has()æ•è·å™¨ä¼šåœ¨ in æ“ä½œç¬¦ä¸­è¢«è°ƒç”¨ã€‚ 123456789const myTarget = &#123;&#125;;const proxy = new Proxy(myTarget, &#123; has(target, property) &#123; console.log(&#x27;è§¦å‘äº†haså‡½æ•°&#x27;); return Reflect.has(...arguments) &#125;&#125;);&#x27;foo&#x27; in proxy;// è§¦å‘äº†haså‡½æ•° è¿”å›å€¼ has()å¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦å­˜åœ¨ã€‚è¿”å›éå¸ƒå°”å€¼ä¼šè¢«è½¬å‹ä¸ºå¸ƒå°”å€¼ã€‚ æ‹¦æˆªçš„æ“ä½œ property in proxy property in Object.create(proxy) with(proxy) {(property);} Reflect.has(proxy, property) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•° target: ç›®æ ‡å¯¹è±¡ property: å¼•ç”¨ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ 1.2.3 è¯•è¯•æ·±å±‚æ¬¡å¯¹è±¡å’Œæ•°ç»„ä¸Šé¢æˆ‘ä»¬è¯´åˆ°Object.definePropertyå¯¹äºæ•°ç»„æ ¼å¼å’Œæ·±å±‚æ¬¡å¯¹è±¡å¤„ç†ä¸äº†ã€‚ é‚£æˆ‘ä»¬æ¥è¯•è¯• Proxyæ˜¯å¦å¯ä»¥å¤„ç†ã€‚ 1.2.3.1 å¤„ç†æ•°ç»„123456789101112131415let target = [1,2,3,4] let proxy = new Proxy(target,&#123; get()&#123; console.log(&quot;è§¦å‘äº†è·å–æ•°ç»„&quot;) return Reflect.get(...arguments) &#125;, set()&#123; console.log(&quot;è§¦å‘äº†è®¾ç½®æ•°ç»„&quot;) return Reflect.set(...arguments) &#125;&#125;) proxy1.push(5);console.log(proxy1[4]); å¯ä»¥çœ‹åˆ°æ‰“å°äº†å¤šæ¬¡ã€‚ ä½†æ˜¯è¿™é‡Œæœ‰ç‚¹ä»¤æˆ‘å›°æƒ‘çš„æ˜¯ä¸ºä»€ä¹ˆä¼šæ‰“å°è¿™ä¹ˆå¤šæ¬¡?ã€‚ 1.2.3.2 å¤„ç†æ·±å±‚æ¬¡å¯¹è±¡123456789101112131415let target = &#123;a:&#123;b:&#123;c:&#x27;d&#x27;&#125;&#125;&#125;let proxy = new Proxy(target,&#123; get()&#123; console.log(&quot;è§¦å‘äº†è·å–å¯¹è±¡&quot;) return Reflect.get(...arguments) &#125;, set()&#123; console.log(&quot;è§¦å‘äº†è®¾ç½®å¯¹è±¡&quot;) return Reflect.set(...arguments) &#125;&#125;) proxy.a.b.cproxy.a.b.c = &#x27;e&#x27; äºŒã€initProxyè™½ç„¶Vue2ä¸­çš„æ•°æ®åŠ«æŒå¹¶æ²¡æœ‰ä½¿ç”¨ Proxyï¼Œä½†æ˜¯å´åœ¨æ£€æµ‹ data æ—¶ä½¿ç”¨äº†Proxyã€‚ è¿˜è®°å¾—æˆ‘ä»¬åœ¨å‰é¢ç« èŠ‚ä¸“æ ç¬¬å››ç¯‡-åˆå§‹åŒ–å¹²äº†ä»€ä¹ˆäº‹ä¸­ä»‹ç»äº†Vueå®ä¾‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨ initProxyï¼Œä½†æ˜¯å½“æ—¶æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ·±åº¦å‰–æï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ä½¿ç”¨ Proxy æ¥è¿›è¡Œæ•°æ®ä»£ç†ã€‚ ä½†æ˜¯æˆ‘ä»¬ç°åœ¨å·²ç»å­¦ä¹ äº† Proxyï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™å‡ æ¥è¯¦ç»†çœ‹ä¸‹è¿™å—çš„é€»è¾‘ã€‚ 1234567Vue.prototype._init = function (options) &#123; if (__DEV__) &#123; initProxy(vm) &#125; else &#123; vm._renderProxy = vm &#125;&#125; åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œè°ƒç”¨äº† initProxyã€‚ è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¹¶æ²¡æœ‰è°ƒç”¨ï¼Œè€Œæ˜¯å°†å®ä¾‹æœ¬èº«èµ‹å€¼åˆ°_renderProxyå±æ€§ä¸­ã€‚ ä¸€èˆ¬ä»…å­˜åœ¨äºå¼€å‘ç¯å¢ƒä¸­çš„é€»è¾‘éƒ½æ˜¯ä¸€äº›æŠ¥é”™æç¤ºä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›²çŒœinitProxyä¹Ÿæ˜¯æ·»åŠ äº†å¼€å‘æ—¶æŠ¥é”™çš„æç¤ºä¿¡æ¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738const hasHandler = &#123; has(target, key) &#123; const has = key in target const isAllowed = allowedGlobals(key) || (typeof key === &#x27;string&#x27; &amp;&amp; key.charAt(0) === &#x27;_&#x27; &amp;&amp; !(key in target.$data)) if (!has &amp;&amp; !isAllowed) &#123; if (key in target.$data) warnReservedPrefix(target, key) else warnNonPresent(target, key) &#125; return has || !isAllowed &#125;&#125;const getHandler = &#123; get(target, key) &#123; if (typeof key === &#x27;string&#x27; &amp;&amp; !(key in target)) &#123; if (key in target.$data) warnReservedPrefix(target, key) else warnNonPresent(target, key) &#125; return target[key] &#125;&#125;initProxy = function initProxy(vm) &#123; if (hasProxy) &#123; // determine which proxy handler to use const options = vm.$options const handlers = options.render &amp;&amp; options.render._withStripped ? getHandler : hasHandler vm._renderProxy = new Proxy(vm, handlers) &#125; else &#123; vm._renderProxy = vm &#125; &#125;&#125; 2.1 hasProxyé¦–å…ˆåˆ¤æ–­å½“å‰å®¿ä¸»ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨Proxyï¼Œé€šè¿‡Proxyæ˜¯å¦å®šä¹‰å’Œæ˜¯åŸç”Ÿå±æ€§æ¥åˆ¤æ–­ã€‚ 12345export function isNative(Ctor: any): boolean &#123; return typeof Ctor === &#x27;function&#x27; &amp;&amp; /native code/.test(Ctor.toString())&#125;const hasProxy = typeof Proxy !== &#x27;undefined&#x27; &amp;&amp; isNative(Proxy) 2.2 _renderProxyåœ¨å¼€å‘ç¯å¢ƒä¸‹ç»™ vm è®¾ç½®ä»£ç†åï¼Œå°†_renderProxyè®¾ç½®ä¸ºä»£ç†å¯¹è±¡ã€‚ä»£ç†ç›®æ ‡ä¸º vueå®ä¾‹ vmã€‚è¿™æ„å‘³ç€å½“è®¿é—® vmæ—¶ï¼Œä¼šè§¦å‘ä»£ç†æ•è·å™¨ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ç›´æ¥å°†_renderProxyè®¾ç½®ä¸ºå®ä¾‹ vmã€‚ æ‰€ä»¥å¯ä»¥çœ‹å‡ºæ¥ä¸è®ºæ˜¯åœ¨å¼€å‘ç¯å¢ƒæˆ–è€…ç”Ÿäº§ç¯å¢ƒå¦‚ä½•éƒ½æ˜¯ç»™ vm._renderProxyè®¾ç½®å€¼ã€‚ é‚£ä¹ˆè¿™é‡Œçš„_renderProxyæ˜¯åœ¨ä½•æ—¶ä½¿ç”¨çš„å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯åœ¨æ‰§è¡Œ_renderæ–¹æ³•ç”Ÿæˆ vnodeçš„æ—¶å€™ï¼Œå°† vm._renderProxy å½“åšç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥renderæ–¹æ³•ä¸­ã€‚ 1vnode = render.call(vm._renderProxy, vm.$createElement) æ¯”å¦‚æˆ‘ä»¬åœ¨.vueæ–‡ä»¶çš„æ¨¡ç‰ˆä¸­ç¼–å†™ä¸€æ®µä»£ç ï¼š 1&lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt; ä¸Šé¢è¿™æ®µä»£ç ä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªrenderå‡½æ•°ã€‚ 12345678910render = function()&#123; // è·å– this const _vm = this; // _vm._self æ˜¯ vue å®ä¾‹ // _cæ˜¯åˆ›å»º vnodeçš„æ–¹æ³• const _c = _vm._self._c // _sæ˜¯è½¬æˆå­—ç¬¦ä¸²çš„æ–¹æ³• const _s = _vm._self._s return _c(&#x27;div&#x27;,_s(_vm.msg))&#125; å¯ä»¥çœ‹å‡ºæ¥ renderå‡½æ•°çš„ thisæŒ‡å‘çš„å°±æ˜¯vm._renderProxyï¼Œä¹Ÿå°±æ˜¯ vueå®ä¾‹ã€‚ ç„¶åé€šè¿‡ vm.xxx è®¿é—®å®ä¾‹ä¸Šçš„å±æ€§æ—¶å°±å¯ä»¥è§¦å‘ä»£ç†ä¸Šçš„å®šä¹‰çš„æ•è·å™¨é€»è¾‘ã€‚ 2.3 æ¨¡æ¿æ¸²æŸ“çš„å‡ ç§æƒ…å†µåœ¨æˆ‘ä»¬äº†è§£æ•è·å™¨ä¸­çš„è¯¦ç»†é€»è¾‘å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ç¼–å†™Vueæ¸²æŸ“ä¸­çš„ä¸‰ç§æƒ…å†µã€‚ çŸ¥é“å¯¹åº”çš„ä»£ç å¤„ç†çš„æ˜¯å“ªäº›åœºæ™¯æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„äº†è§£æºç ã€‚ 2.3.1 ç”¨æˆ·è‡ªå®šä¹‰ template æ¨¡æ¿12345678new Vue(&#123; template:`&lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;`, data()&#123; return &#123; msg:&#x27;Hello World&#x27; &#125; &#125;&#125;).$mount(&quot;#app&quot;); å¯¹templateé€‰é¡¹è¿›è¡Œæ¨¡ç‰ˆç¼–è¯‘æ˜¯å‘ç”Ÿåœ¨å®ä¾‹çš„æŒ‚è½½é˜¶æ®µã€‚ æ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€‰é¡¹ä¸­åªæœ‰ templateæ ‡ç­¾ã€‚ ç»è¿‡é€‰é¡¹åˆå¹¶åï¼Œvm.$optionsä¸Šåªæœ‰ templateé€‰é¡¹å¹¶æ²¡æœ‰ renderæ–¹æ³•ã€‚ æ‰€ä»¥è¿™ç§æƒ…å†µåœ¨æ‰§è¡ŒinitProxyæ–¹æ³•å¯¹ç›®æ ‡å¯¹è±¡å®ä¾‹ vm è¿›è¡Œä»£ç†æ—¶ï¼Œæ³¨å†Œçš„æ˜¯hasHandleræ–¹æ³•ã€‚ hasHandleræ–¹æ³•ä¸­ä½¿ç”¨çš„æ˜¯hasæ•è·å™¨ï¼Œhasæ•è·å™¨ç”¨äºå¤„ç†å±æ€§çš„å­˜åœ¨æ€§æ£€æŸ¥ã€‚ vueåœ¨å¯¹templateé€‰é¡¹è¿›è¡Œæ¨¡æ¿ç¼–è¯‘æ—¶ï¼Œä¼šå°†å…¶è½¬åŒ–ä¸º renderå‡½æ•°ï¼Œä¸”ä¼šè¢« withåŒ…è£¹ã€‚ è€Œå‰é¢æˆ‘ä»¬è¯´è¿‡hasæ•è·å™¨å¯ä»¥æ‹¦æˆª withè¯­å¥ä¸‹çš„ä½œç”¨ã€‚åœ¨æ‰§è¡Œ withè¯­å¥çš„è¿‡ç¨‹ä¸­ï¼Œè¯¥ä½œç”¨åŸŸä¸‹çš„å˜é‡éƒ½ä¼šè§¦å‘ hasé’©å­ã€‚è¿™ä¹Ÿæ˜¯æ¨¡ç‰ˆæ¸²æŸ“æ—¶ä¹‹æ‰€ä»¥ä¼šè§¦å‘ä»£ç†æ‹¦æˆªçš„åŸå› ã€‚ 2.3.2 ä½¿ç”¨.vueæ–‡ä»¶æ¥ç¼–å†™é¡µé¢è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¼–å†™ vueé¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„å†™æ³•ã€‚ 1234567891011121314151617// Test.vue&lt;template&gt; &lt;div&gt; &#123;&#123; msg &#125;&#125; &lt;/div&gt; &lt;/template&gt;&lt;script&gt; export default &#123; data()&#123; return &#123; msg: &quot;Hello World&quot; &#125; &#125;&#125;;&lt;/script&gt; .vueæ–‡ä»¶åœ¨webpacké¢„ç¼–è¯‘é˜¶æ®µä¼šè¢« vue-loader è§£ææˆä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­æ¨¡æ¿éƒ¨åˆ†ä¼šè¢«è§£ææˆrenderå‡½æ•°ã€‚ å¹¶ä¸”åœ¨ä¼šåœ¨renderæ–¹æ³•ä¸­æŒ‚è½½_withStrippedä¸ºtrueã€‚ æ‰€ä»¥è¿™ä¸ªå˜é‡æ ‡è¯†ç€å½“å‰çš„ renderå‡½æ•°æ˜¯ä½¿ç”¨.vueæ–‡ä»¶ç¼–å†™ç¼–è¯‘è€Œæ¥çš„ã€‚ æ‰€ä»¥è¿™ç§æƒ…å†µåœ¨æ‰§è¡ŒinitProxyæ–¹æ³•å¯¹ç›®æ ‡å¯¹è±¡å®ä¾‹ vm è¿›è¡Œä»£ç†æ—¶ï¼Œæ³¨å†Œçš„æ˜¯getHandleræ–¹æ³•ã€‚ getHandleræ–¹æ³•ä¸­ä½¿ç”¨çš„æ˜¯getæ•è·å™¨ï¼Œgetæ•è·å™¨ç”¨äºå¤„ç†å¯¹ Vue å®ä¾‹å±æ€§çš„è¯»å–æ“ä½œã€‚ webpack + vue-loaderå¯¹.vueæ–‡ä»¶è¿›è¡Œç¼–è¯‘æ—¶ï¼Œä¼šè½¬åŒ–æˆä¸‹é¢è¿™ç§å½¢å¼ã€‚ å¯ä»¥çœ‹åˆ°ç›´æ¥ä½¿ç”¨ vm.xxx è®¿é—®çš„å±æ€§ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨ getæ•è·å™¨è¿›è¡Œæ•è·ã€‚ 2.3.3 ç”¨æˆ·è‡ªå®šä¹‰ renderæ–¹æ³•æ¥ç¼–å†™é¡µé¢123456789101112131415161718// main.jsimport Fun from &quot;./Fun.js&quot;; new Vue(Fun).$mount(&quot;#app&quot;);// fun.jslet Component = &#123; render:function(h)&#123; return h(&#x27;div&#x27;,this.msg) &#125;, data()&#123; return &#123; msg:&#x27;Hello World&#x27; &#125; &#125;&#125;export default Component; è™½ç„¶è¿™ç§æƒ…å†µåœ¨ä¹Ÿå­˜åœ¨ renderæ–¹æ³•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ _withStripped å±æ€§ æ‰€ä»¥è¿™ç§æƒ…å†µåœ¨æ‰§è¡ŒinitProxyæ–¹æ³•å¯¹ç›®æ ‡å¯¹è±¡å®ä¾‹ vm è¿›è¡Œä»£ç†æ—¶ï¼Œæ³¨å†Œçš„æ˜¯hasHandleræ–¹æ³•ã€‚ ä½†æ˜¯è‡ªå®šä¹‰ renderçš„æƒ…å†µå¹¶æ²¡æœ‰ä½¿ç”¨ inæˆ–è€… withçš„æƒ…å†µã€‚ æ‰€ä»¥ç”¨æˆ·è‡ªå®šä¹‰çš„æ–¹æ³•ä¸ä¼šæœ‰æŠ¥é”™æç¤ºã€‚ 2.4 æ•è·å™¨é‡Œé¢çš„å…·ä½“é€»è¾‘å‰é¢æˆ‘ä»¬è¯´åˆ°äº†ä¸‰ç§æƒ…å†µéƒ½æœ‰å¯¹åº”çš„æ•è·æ–¹æ³•ã€‚ é‚£ä¹ˆè¿™ä¸ªæ•è·æ–¹æ³•å†…éƒ¨ç©¶ç«Ÿåšäº†äº›ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ ä¸»è¦æ˜¯åœ¨å¼€å‘è€…å¼€å‘æ—¶å¯¹å±æ€§å’Œæ–¹æ³•çš„å®šä¹‰åšæç¤ºã€‚ å½“å¼€å‘è€…åœ¨æ¸²æŸ“å†…å®¹ä¸­ä½¿ç”¨äº†_ä½œä¸ºå˜é‡åçš„å‰ç¼€æ—¶ï¼Œæç¤ºä¸å¯ä»¥ä½¿ç”¨è¿™ç§å‘½åæ–¹å¼ã€‚å› ä¸ºè¿™ç§æ–¹å¼å¯èƒ½ä¼šä¸å†…éƒ¨çš„å˜é‡å­˜åœ¨å†²çªã€‚ å½“å¼€å‘è€…åœ¨æ¸²æŸ“å†…å®¹ä¸­ä½¿ç”¨äº†æœªå®šä¹‰çš„å˜é‡æ—¶ï¼Œæç¤ºè¯¥å˜é‡å¹¶æ²¡æœ‰åœ¨ vueå®ä¾‹ä¸Šæ‰¾åˆ°ã€‚ è€Œå‰é¢æˆ‘ä»¬è¯´åˆ°äº†ç”¨æˆ·è‡ªå®šä¹‰çš„æ–¹æ³•ä¸ä¼šæœ‰æŠ¥é”™æç¤ºã€‚ æˆ‘ä»¬å¯ä»¥å®éªŒä¸€ä¸‹ï¼š 12345678910111213141516171819// main.jsimport Fun from &quot;./Fun.js&quot;; new Vue(Fun).$mount(&quot;#app&quot;);// fun.jslet Component = &#123; render:function(h)&#123; // ä½¿ç”¨äº†æœªå®šä¹‰çš„å˜é‡ return h(&#x27;div&#x27;,this.msg1) &#125;, data()&#123; return &#123; msg:&#x27;Hello World&#x27; &#125; &#125;&#125;export default Component; æˆ‘ä»¬åœ¨renderæ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªæœªä½¿ç”¨çš„å˜é‡ msg1ã€‚ ç„¶åæ‰“å¼€æ§åˆ¶å°å¹¶æ²¡æœ‰æŠ¥é”™æç¤ºã€‚ å› ä¸ºæ­¤æ—¶ä»£ç†ä½¿ç”¨çš„æ˜¯hasæ•è·å™¨ï¼Œè€Œæˆ‘ä»¬æ—¢æ²¡æœ‰ä½¿ç”¨ withï¼Œä¹Ÿæ²¡ä½¿ç”¨ inã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰è§£å†³åŠæ³•å‘¢ï¼Ÿ æœ‰ï¼Œé‚£å°±æ˜¯åœ¨ renderä¸ŠæŒ‚è½½ä¸€ä¸ª_withStrippedå˜é‡ï¼Œè®©ä»–åœ¨ initProxyæ—¶æ³¨å†Œ getæ•è·å™¨ã€‚ 12345678910111213let Component = &#123; render:function(h)&#123; return h(&#x27;div&#x27;,this.msg1) &#125;, data()&#123; return &#123; msg:&#x27;Hello World&#x27; &#125; &#125;&#125;// åœ¨ renderæ–¹æ³•ä¸­æŒ‚è½½_withStrippedå±æ€§Component.render._withStripped = true;export default Component; å¯ä»¥çœ‹åˆ°æ§åˆ¶å°å‡ºç°äº†æŠ¥é”™ä¿¡æ¯ã€‚ ä¸‰ã€å®ç°ç®€æ˜“ç‰ˆvueä¾èµ–æ”¶é›†å› ä¸ºVueä¸­æ•°æ®å“åº”å¼çš„ä»£ç æ¯”è¾ƒå¤šï¼Œæ¶‰åŠå¤šä¸ªæ–‡ä»¶ã€‚ ä½†æ˜¯æˆ‘ä»¬çŸ¥é“æ•°æ®å“åº”å¼çš„åŸç†å°±æ˜¯é¡µé¢æ¸²æŸ“è®¿é—®æ•°æ®æ—¶æ”¶é›†ä¾èµ–ï¼Œåœ¨æ•°æ®æ›´æ–°æ—¶æ›´æ–°å¯¹åº”ä¾èµ–çš„æ¸²æŸ“å†…å®¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142// =================== æ–°å¢ç‚¹å‡»äº‹ä»¶æ›´æ”¹ ===================const btnElement = document.createElement(&#x27;button&#x27;);document.body.appendChild(btnElement);btnElement.innerHTML = &#x27;ç‚¹å‡»&#x27;;btnElement.onclick = function()&#123; // ç‚¹å‡»äº‹ä»¶ PageA.msg = &#x27;æˆ‘ä¿®æ”¹äº†&#x27;&#125;// =================== å¢åŠ å±æ€§ç›‘å¬ ===================// å­˜å‚¨é¡µé¢çš„ä¾èµ–let Dep = undefined;// Aé¡µé¢let PageA = &#123; msg:&#x27;Hello World&#x27;, render()&#123; const appElement = document.getElementById(&#x27;app&#x27;); // å½“è®¿é—® msgå˜é‡æ—¶ ä¼šè§¦å‘æ•°æ®ä»£ç†çš„ getæ–¹æ³• è¿›è¡Œä¾èµ–æ”¶é›† appElement.innerHTML = this.msg; &#125;&#125;let pageMsg = PageA.msg;Object.defineProperty(PageA,&#x27;msg&#x27;,&#123; get()&#123; //è®¿é—®msgå˜é‡æ—¶æ‰§è¡Œ console.log(&quot;è®¿é—®äº† msgå˜é‡&quot;) // å°†ä¾èµ–è®¾ç½®ä¸ºé¡µé¢ A Dep = PageA; return pageMsg; &#125;, set(newVal)&#123; //è®¾ç½®msgå˜é‡æ—¶æ‰§è¡Œ console.log(&quot;è®¾ç½®äº† msgå˜é‡&quot;) pageMsg = newVal; // æ‰§è¡Œä¾èµ–çš„ renderæ–¹æ³• Dep.render(); &#125;&#125;)// æ‰§è¡Œæ¸²æŸ“å‡½æ•°PageA.render(); æŠŠä¸Šé¢çš„ä»£ç æ‹·è´åˆ°æµè§ˆå™¨ä¸­ã€‚ è¿™äº›ä»£ç éå¸¸å¥½ç†è§£ï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œè¿™å°±æ˜¯ Vueä¸­æœ€æ ¸å¿ƒçš„åŸç†å“åº”å¼ã€‚ å¦‚æœä½ å®Œå…¨çœ‹æ‡‚å¹¶èƒ½ç†è§£ä»¥åï¼Œå¯ä»¥è¯´ä½ å°±æŒæ¡äº† Vueçš„å“åº”å¼æ ¸å¿ƒåŸç†ã€‚ å››ã€åˆå§‹åŒ–æ—¶å¢åŠ ä¾¦å¬å™¨çš„é€»è¾‘4.1 initDataä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬ç®€å•çš„å®ç°äº†æ•°æ®å“åº”ã€‚ æˆ‘ä»¬çŸ¥é“æ•°æ®å“åº”çš„å‰ææ˜¯æ•°æ®è¢«ä»£ç†äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¢« Object.defineProperty è®¾ç½®äº†ä¾¦å¬ã€‚ è¿™æ ·åœ¨æ•°æ®è¢«è®¿é—®å’Œè®¾ç½®çš„æ—¶å€™æ‰èƒ½çŸ¥æ™“ä»è€Œè§¦å‘å¯¹åº”çš„æ“ä½œã€‚ Vueé€‰é¡¹ä¸­çš„ dataå°±æ˜¯åœ¨ vueå®ä¾‹åŒ–åˆå§‹åŒ–çš„æ—¶å€™åœ¨initDataä¸­è®¾ç½®ç›‘å¬çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839function initData(vm)&#123; let data = vm.$options.data; data = vm._data = isFunction(data) ? getData(data, vm) : data || &#123;&#125;; // å¦‚æœä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿›è¡Œæç¤º if (!isPlainObject(data)) &#123; data = &#123;&#125; __DEV__ &amp;&amp; warn( &#x27;data functions should return an object: &#x27; + &#x27;https://v2.vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#x27;, vm ) &#125; // proxy data on instance const keys = Object.keys(data) const props = vm.$options.props const methods = vm.$options.methods let i = keys.length while (i--) &#123; const key = keys[i] if (__DEV__) &#123; if (methods &amp;&amp; hasOwn(methods, key)) &#123; warn(`Method &quot;$&#123;key&#125;&quot; has already been defined as a data property.`, vm) &#125; &#125; if (props &amp;&amp; hasOwn(props, key)) &#123; __DEV__ &amp;&amp; warn( `The data property &quot;$&#123;key&#125;&quot; is already declared as a prop. ` + `Use prop default value instead.`, vm ) &#125; else if (!isReserved(key)) &#123; proxy(vm, `_data`, key) &#125; &#125; const ob = observe(data) ob &amp;&amp; ob.vmCount++&#125; initDataåœ¨ mergeOptionsåé¢æ‰§è¡Œï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥åœ¨ vm.$optionsä¸Šè·å–åˆ° dataã€‚ 4.1.1 ç¼–å†™dataçš„ 2 ç§å½¢å¼æˆ‘ä»¬çŸ¥é“é€šå¸¸æˆ‘ä»¬ç¼–å†™ dataæœ‰ 2 ç§å½¢å¼ï¼š 1234567891011// ç›´æ¥ç¼–å†™å¯¹è±¡data:&#123; msg:&#x27;Hello World&#x27;&#125;// ç¼–å†™ä¸€ä¸ªå‡½æ•°data()&#123; return &#123; msg:&quot;Hello World&quot; &#125;&#125; æ‰€ä»¥è¿™é‡Œåˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•°ç”¨æ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘è·å– data: å¦‚æœæ˜¯å‡½æ•°ï¼Œæ‰§è¡ŒgetDataæ¥è·å– data å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œè¿™ç›´æ¥è·å– data 12345678910111213141516let data = vm.$options.data; data = vm._data = isFunction(data) ? getData(data, vm) : data || &#123;&#125;;// å°†å½“å‰ä¾èµ–å˜æˆ undefinedï¼Œåœ¨æ”¶é›†ä¾èµ–æ—¶å°±å¯ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºçš„ å¦‚æœæ˜¯ç©ºçš„å°±ä¸è¿›è¡Œä¾èµ–æ”¶é›†export function getData(data: Function, vm: Component): any &#123; // #7573 disable dep collection when invoking data getters pushTarget() try &#123; return data.call(vm, vm) &#125; catch (e: any) &#123; handleError(e, vm, `data()`) return &#123;&#125; &#125; finally &#123; popTarget() &#125;&#125; 4.1.2 åˆ¤æ–­ dataæ˜¯å¦æ˜¯å¯¹è±¡123456789if (!isPlainObject(data)) &#123; data = &#123;&#125; __DEV__ &amp;&amp; warn( &#x27;data functions should return an object: &#x27; + &#x27;https://v2.vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#x27;, vm )&#125; isPlainObjectå‡½æ•°ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ å¦‚æœ dataä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æç¤ºåº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚ 4.1.3 åˆ¤æ–­ä¸èƒ½ä¸methods&#x2F;propsé‡å12345678910111213141516171819202122const keys = Object.keys(data)const props = vm.$options.propsconst methods = vm.$options.methodslet i = keys.lengthwhile (i--) &#123; const key = keys[i] if (__DEV__) &#123; if (methods &amp;&amp; hasOwn(methods, key)) &#123; warn(`Method &quot;$&#123;key&#125;&quot; has already been defined as a data property.`, vm) &#125; &#125; if (props &amp;&amp; hasOwn(props, key)) &#123; __DEV__ &amp;&amp; warn( `The data property &quot;$&#123;key&#125;&quot; is already declared as a prop. ` + `Use prop default value instead.`, vm ) &#125; else if (!isReserved(key)) &#123; proxy(vm, `_data`, key) &#125;&#125; é¦–å…ˆä½¿ç”¨ Object.keysè·å–æ‰€æœ‰dataçš„æ•°é‡ã€‚ ç„¶åä½¿ç”¨ whileå¾ªç¯å°†æ‰€æœ‰ dataä¸­çš„keyå€¼å’Œ props&#x2F;methodsåšæ¯”è¾ƒã€‚ å¦‚æœæœ‰é‡åçš„åˆ™ç»™äºˆæç¤ºã€‚ 4.1.4 ç»™ dataä¸­æ¯ä¸€é¡¹éƒ½è®¾ç½®ä»£ç†12345678910111213141516171819202122// å¦‚æœä¸æ˜¯å…³é”®å­—ï¼Œåˆ™å¯¹ vm._dataè¿›è¡Œä¿ç•™if (!isReserved(key)) &#123; proxy(vm, `_data`, key)&#125;const sharedPropertyDefinition = &#123; enumerable: true, configurable: true, get: noop, set: noop&#125;export function proxy(target: Object, sourceKey: string, key: string) &#123; sharedPropertyDefinition.get = function proxyGetter() &#123; return this[sourceKey][key] &#125; sharedPropertyDefinition.set = function proxySetter(val) &#123; this[sourceKey][key] = val &#125; Object.defineProperty(target, key, sharedPropertyDefinition)&#125; å‰é¢æˆ‘ä»¬å°†dataèµ‹å€¼ç»™äº†vm._dataã€‚ æ‰€ä»¥è¿™é‡Œä»£ç†çš„æ„æ€å°±æ˜¯ï¼Œæ¯å½“ä½ ä½¿ç”¨ this.xxxæ¥è®¿é—®dataä¸­çš„å±æ€§æ—¶ï¼Œä¼šç›´æ¥åœ¨ vm._dataä¸Šé¢è¿›è¡ŒæŸ¥æ‰¾è¿”å›ã€‚ è¿™æ ·å°±ä¸ç”¨å°†dataä¸­çš„æ¯ä¸€é¡¹éƒ½æŒ‚è½½åˆ°å®ä¾‹ä¸Šäº†ã€‚ 4.1.5 å¯¹dataè¿›è¡Œä¾¦å¬æ¥ä¸‹æ¥å°±æ˜¯é‡å¤´æˆäº†ï¼Œå‰é¢æˆ‘ä»¬è¯´åˆ°vueåœ¨åˆå§‹åŒ–æ—¶ä¼šå¯¹ dataä¸­çš„æ¯ä¸€é¡¹è¿›è¡Œä¾¦å¬ã€‚ å°±æ˜¯ä½¿ç”¨ observeæ–¹æ³•è¿›è¡Œä¾¦å¬çš„ã€‚ 1const ob = observe(data); observe æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡æˆ–æ•°ç»„è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚å®ƒä¼šé€’å½’åœ°éå†å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸º getter&#x2F;setterï¼Œä»¥ä¾¿ Vue èƒ½å¤Ÿè·Ÿè¸ªå±æ€§çš„å˜åŒ–ã€‚ å¯ä»¥çœ‹åˆ°observeå°±æ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ª Observerçš„ç±»ã€‚ 4.2 Observerç±»ä¸­è®¾ç½®ä¾¦å¬1234567891011121314151617181920export function observe( value, shallow, ssrMockReactivity)&#123; if (value &amp;&amp; hasOwn(value, &#x27;__ob__&#x27;) &amp;&amp; value.__ob__ instanceof Observer) &#123; return value.__ob__ &#125; if ( shouldObserve &amp;&amp; (ssrMockReactivity || !isServerRendering()) &amp;&amp; (isArray(value) || isPlainObject(value)) &amp;&amp; Object.isExtensible(value) &amp;&amp; !value.__v_skip /* ReactiveFlags.SKIP */ &amp;&amp; !isRef(value) &amp;&amp; !(value instanceof VNode) ) &#123; return new Observer(value, shallow, ssrMockReactivity) &#125;&#125; ä¸ŠèŠ‚æˆ‘ä»¬è¯´åˆ°åœ¨initDataä¸­ä¼šè°ƒç”¨observeæ–¹æ³•ç»™dataè®¾ç½®ä¾¦å¬ã€‚ å¦‚ä¸Šæ‰€ç¤ºï¼Œobserveä¸­å®é™…ä¸Šå°±æ˜¯å®ä¾‹åŒ–äº† Observerç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950export class Observer &#123; // ä¸€ä¸ª Dep å®ä¾‹ï¼Œç”¨äºä¾èµ–æ”¶é›†ï¼Œå³è·Ÿè¸ªå“ªäº› watcher ä¾èµ–äºè¯¥å¯¹è±¡çš„æ•°æ®å˜åŒ–ã€‚ dep: Dep // è®°å½•æœ‰å¤šå°‘ä¸ª Vue å®ä¾‹å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå®ƒä»¬çš„æ ¹ $dataã€‚ vmCount: number // number of vms that have this object as root $data constructor(public value: any, public shallow = false, public mock = false) &#123; // this.value = value this.dep = mock ? mockDep : new Dep() this.vmCount = 0 def(value, &#x27;__ob__&#x27;, this) if (isArray(value)) &#123; if (!mock) &#123; if (hasProto) &#123; /* eslint-disable no-proto */ ;(value as any).__proto__ = arrayMethods /* eslint-enable no-proto */ &#125; else &#123; for (let i = 0, l = arrayKeys.length; i &lt; l; i++) &#123; const key = arrayKeys[i] def(value, key, arrayMethods[key]) &#125; &#125; &#125; if (!shallow) &#123; this.observeArray(value) &#125; &#125; else &#123; /** * Walk through all properties and convert them into * getter/setters. This method should only be called when * value type is Object. */ const keys = Object.keys(value) for (let i = 0; i &lt; keys.length; i++) &#123; const key = keys[i] defineReactive(value, key, NO_INITIAL_VALUE, undefined, shallow, mock) &#125; &#125; &#125; /** * Observe a list of Array items. */ observeArray(value: any[]) &#123; for (let i = 0, l = value.length; i &lt; l; i++) &#123; observe(value[i], false, this.mock) &#125; &#125;&#125; è¿™ä¸ª Observer ç±»æ˜¯ Vue.js å“åº”å¼ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå°†æ™®é€šçš„ JavaScript å¯¹è±¡æˆ–æ•°ç»„è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚ 4.2.1 ä¸‰ä¸ªå‚æ•° valueï¼šå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡ã€‚Observeç±»ä¼šå°†è¿™ä¸ªå€¼è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ï¼Œä½¿å¾— Vueèƒ½å¤Ÿè·Ÿè¸ªå…¶å±æ€§çš„å˜åŒ–å¹¶æ›´æ–°è§†å›¾ã€‚ shallowï¼šè¿™æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦è¿›è¡Œæµ…å±‚å“åº”å¼è½¬æ¢ã€‚å¦‚æœ shallow ä¸º trueï¼Œåˆ™ Observer åªä¼šå¯¹å¯¹è±¡çš„ç›´æ¥å±æ€§è¿›è¡Œå“åº”å¼è½¬æ¢ï¼Œè€Œä¸ä¼šé€’å½’åœ°å¯¹å…¶åµŒå¥—å¯¹è±¡çš„å±æ€§è¿›è¡Œå“åº”å¼è½¬æ¢ã€‚ mockï¼šè¿™ä¸ªå‚æ•°ä¹Ÿæ˜¯å¸ƒå°”ç±»å‹ï¼Œç”¨äºæŒ‡ç¤ºæ˜¯å¦åœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ç¯å¢ƒä¸‹æ¨¡æ‹Ÿå“åº”å¼è¡Œä¸ºã€‚å½“ mock ä¸º true æ—¶ï¼ŒObserver ä¼šä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ Dep å®ä¾‹ï¼ˆmockDepï¼‰ï¼Œä»¥ä¾¿åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ä¸ä¼šå®é™…è§¦å‘è§†å›¾æ›´æ–°ã€‚ 4.2.2 ç±»æˆå‘˜ dep: Depï¼šæ¯ä¸ªObserverå®ä¾‹éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„Depå®ä¾‹ã€‚Depä»£è¡¨â€œDependencyâ€ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ä¾èµ–äºè¯¥Observerå®ä¾‹çš„è§‚å¯Ÿè€…ï¼ˆå¦‚è®¡ç®—å±æ€§æˆ–æ¸²æŸ“å‡½æ•°ï¼‰ã€‚ vmCount: numberï¼šè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªVueå®ä¾‹å°†æ­¤å¯¹è±¡ä½œä¸ºæ ¹$dataå¯¹è±¡ã€‚è¿™æœ‰åŠ©äºVueå†…éƒ¨ç®¡ç†æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸã€‚ 4.2.3 æ„é€ å‡½æ•°å†…éƒ¨é€»è¾‘ åˆå§‹åŒ–ä¾èµ–ï¼šå¦‚æœå¤„äº ssræ¸²æŸ“æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ä¼ å…¥çš„ mockDepï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ Depå®ä¾‹ã€‚ å®šä¹‰è§‚æµ‹æ ‡è¯†ï¼šdefæ˜¯ definePropertyçš„å°è£…å‡½æ•°ï¼Œé€šè¿‡defæ–¹æ³•ç»™valueå¯¹è±¡æ·»åŠ ä¸€ä¸ªä¸å¯æšä¸¾çš„å±æ€§__ob__ï¼Œå…¶å€¼ä¸ºå½“å‰Observerå®ä¾‹ã€‚è¿™æ˜¯Vueå†…éƒ¨ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«è§‚æµ‹è¿‡çš„æ–¹å¼ã€‚ å¤„ç†æ•°ç»„ï¼šå¦‚æœvalueæ˜¯ä¸€ä¸ªæ•°ç»„ä¸”ä¸æ˜¯æ¨¡æ‹Ÿæ¨¡å¼ï¼š å¦‚æœç¯å¢ƒæ”¯æŒ__proto__ï¼Œåˆ™å°†æ•°ç»„çš„æ–¹æ³•æŒ‡å‘arrayMethodsï¼Œè¿™æ˜¯ä¸€ä¸ªç»è¿‡ä¿®æ”¹çš„æ•°ç»„åŸå‹æ–¹æ³•é›†åˆï¼Œç”¨äºæ‹¦æˆªæ•°ç»„çš„å˜å¼‚æ–¹æ³•ï¼ˆå¦‚push, popç­‰ï¼‰ã€‚ å¦‚æœä¸æ”¯æŒ__proto__ï¼Œåˆ™æ‰‹åŠ¨éå†arrayKeysï¼Œå¹¶ç”¨defæ–¹æ³•è¦†ç›–åŸç”Ÿæ•°ç»„æ–¹æ³•ï¼Œä½¿å…¶æŒ‡å‘arrayMethodsä¸­çš„å¯¹åº”æ–¹æ³•ã€‚ å¦‚æœä¸æ˜¯æµ…å±‚è§‚æµ‹ï¼Œåˆ™è°ƒç”¨observeArrayæ–¹æ³•é€’å½’åœ°è§‚æµ‹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚ å¤„ç†å¯¹è±¡ï¼šå¦‚æœvalueæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™éå†å¯¹è±¡çš„æ‰€æœ‰é”®ï¼Œå¹¶å¯¹æ¯ä¸ªé”®è°ƒç”¨defineReactiveæ–¹æ³•æ¥è½¬æ¢æˆgetter&#x2F;setterå½¢å¼ï¼Œä»è€Œå®ç°å“åº”å¼ã€‚ 4.3 defineReactiveå®šä¹‰å“åº”å¼è°ƒç”¨ Observer æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ defineReactiveæ–¹æ³•å¯¹ dataä¸­çš„æ¯ä¸€é¡¹è¿›è¡Œæ·»åŠ ä¾¦å¬ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687export function defineReactive( obj: object, key: string, val?: any, customSetter?: Function | null, shallow?: boolean, mock?: boolean, observeEvenIfShallow = false) &#123; const dep = new Dep() const property = Object.getOwnPropertyDescriptor(obj, key) if (property &amp;&amp; property.configurable === false) &#123; return &#125; // cater for pre-defined getter/setters const getter = property &amp;&amp; property.get const setter = property &amp;&amp; property.set if ( (!getter || setter) &amp;&amp; (val === NO_INITIAL_VALUE || arguments.length === 2) ) &#123; val = obj[key] &#125; let childOb = shallow ? val &amp;&amp; val.__ob__ : observe(val, false, mock) Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function reactiveGetter() &#123; const value = getter ? getter.call(obj) : val if (Dep.target) &#123; if (__DEV__) &#123; dep.depend(&#123; target: obj, type: TrackOpTypes.GET, key &#125;) &#125; else &#123; dep.depend() &#125; if (childOb) &#123; childOb.dep.depend() if (isArray(value)) &#123; dependArray(value) &#125; &#125; &#125; return isRef(value) &amp;&amp; !shallow ? value.value : value &#125;, set: function reactiveSetter(newVal) &#123; const value = getter ? getter.call(obj) : val if (!hasChanged(value, newVal)) &#123; return &#125; if (__DEV__ &amp;&amp; customSetter) &#123; customSetter() &#125; if (setter) &#123; setter.call(obj, newVal) &#125; else if (getter) &#123; // #7981: for accessor properties without setter return &#125; else if (!shallow &amp;&amp; isRef(value) &amp;&amp; !isRef(newVal)) &#123; value.value = newVal return &#125; else &#123; val = newVal &#125; childOb = shallow ? newVal &amp;&amp; newVal.__ob__ : observe(newVal, false, mock) if (__DEV__) &#123; dep.notify(&#123; type: TriggerOpTypes.SET, target: obj, key, newValue: newVal, oldValue: value &#125;) &#125; else &#123; dep.notify() &#125; &#125; &#125;) return dep&#125; 4.3.1 åˆ›å»ºä¾èµ–é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Depå®ä¾‹ dep,ç”¨äºå­˜å‚¨æ‰€æœ‰ä¾èµ–äºè¯¥å±æ€§çš„è§‚å¯Ÿè€…ã€‚ åœ¨Observerçš„æ„é€ å‡½æ•°ä¸­ï¼Œä¼šéå†å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§ï¼Œå¹¶å¯¹æ¯ä¸€ä¸ªå±æ€§æ‰§è¡ŒdefineReactiveã€‚ æ‰€ä»¥è¯´æ¯ä¸€ä¸ªå®šä¹‰åœ¨ dataä¸­çš„æ¯ä¸€ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ä¾èµ–åˆ—è¡¨ï¼Œè®°å½•ç€å½“ dataå˜åŒ–æ—¶éœ€è¦æ›´æ–°çš„ä¾èµ–ã€‚ 1234567891011export function defineReactive( obj: object, key: string, val?: any, customSetter?: Function | null, shallow?: boolean, mock?: boolean, observeEvenIfShallow = false) &#123; const dep = new Dep()&#125; 4.3.2 æ£€æŸ¥å±æ€§é…ç½®1234const property = Object.getOwnPropertyDescriptor(obj, key)if (property &amp;&amp; property.configurable === false) &#123; return&#125; å› ä¸ºåé¢çš„é€»è¾‘æ˜¯ç»™è¿™ä¸ªå¯¹è±¡è®¾ç½®ä»£ç†ï¼ˆObject.definePropertyï¼‰ã€‚ getOwnPropertyDescriptorå¯ä»¥è·å–å¯¹è±¡ä¸Šçš„å±æ€§æè¿°ç¬¦ã€‚ å¦‚æœè¯¥å±æ€§ä¸å¯é…ç½®ï¼Œå°±ä¸å¯ä»¥å†é…ç½® Object.definePropertyäº†ï¼Œæ‰€ä»¥å¦‚æœ configurableä¸º false,ç›´æ¥è¿”å›ï¼Œä¸åšä»»ä½•å¤„ç†ã€‚ 4.3.3 ç”¨äºå¤„ç†å¯¹è±¡å±æ€§çš„ getter å’Œ setter12345678const getter = property &amp;&amp; property.getconst setter = property &amp;&amp; property.setif ( (!getter || setter) &amp;&amp; (val === NO_INITIAL_VALUE || arguments.length === 2)) &#123; val = obj[key]&#125; å°è¯•ä»å¯¹è±¡çš„å±æ€§æè¿°ç¬¦ï¼ˆpropertyï¼‰ä¸­è·å–ç°æœ‰çš„ getter å’Œ setter å‡½æ•°ã€‚å¦‚æœ property å­˜åœ¨ä¸”æœ‰ get æ–¹æ³•ï¼Œåˆ™ getter ä¼šè¢«è®¾ç½®ä¸ºè¯¥æ–¹æ³•ï¼›åŒç†ï¼Œå¦‚æœ property å­˜åœ¨ä¸”æœ‰ set æ–¹æ³•ï¼Œåˆ™ setter ä¼šè¢«è®¾ç½®ä¸ºè¯¥æ–¹æ³•ã€‚ å¦‚æœæ»¡è¶³ä¸‹åˆ—ä¸¤ç§æƒ…å†µï¼Œåˆ™å°† valè®¾ç½®ä¸ºå¯¹è±¡ä¸Šå½“å‰å±æ€§çš„å€¼ï¼Œå³ obj[key]ã€‚è¿™æ„å‘³ç€å¦‚æœå±æ€§å·²ç»æœ‰ getter&#x2F;setter æˆ–è€…æ²¡æœ‰æä¾›åˆå§‹å€¼ï¼ŒVue å°†ä¸ä¼šå°è¯•è¦†ç›–è¿™äº›å±æ€§ï¼Œè€Œæ˜¯ä½¿ç”¨å¯¹è±¡ä¸Šå·²ç»å­˜åœ¨çš„å€¼ã€‚ æ£€æŸ¥æ˜¯å¦å­˜åœ¨ setteræˆ–è€…ä¸å­˜åœ¨ getterã€‚å¦‚æœå±æ€§å·²ç»æœ‰ setter(æˆ–è€…æ²¡æœ‰ getter)ï¼Œè¿™æ„å‘³ç€å±æ€§å¯èƒ½å·²ç»è¢«å®šä¹‰ä¸ºå…·æœ‰è‡ªå®šä¹‰è¡Œä¸ºçš„å±æ€§ï¼Œå› æ­¤ Vueä¸ä¼šè¦†ç›–å®ƒã€‚(å‰é¢æˆ‘ä»¬ä½¿ç”¨è¿‡ proxyå¯¹ vmä¸Šçš„å±æ€§åšè¿‡ä»£ç†ï¼Œè€Œè¿™é‡Œæ˜¯å¯¹ dataä¸­çš„æ•°æ®åšä»£ç†ï¼Œæ‰€ä»¥ä½œç”¨ç‚¹ä¸åŒ) æ£€æŸ¥ä¼ å…¥çš„ val æ˜¯å¦æ˜¯ NO_INITIAL_VALUEï¼ˆä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œè¡¨ç¤ºæ²¡æœ‰åˆå§‹å€¼ï¼‰æˆ–è€…è°ƒç”¨ defineReactive æ—¶åªæä¾›äº†ä¸¤ä¸ªå‚æ•°ï¼ˆå³æ²¡æœ‰æä¾› setter å€¼ï¼‰ è¿™æ®µä»£ç çš„ç›®çš„æ˜¯å¤„ç†é‚£äº›å¯èƒ½å·²ç»æœ‰é¢„å®šä¹‰ getter&#x2F;setter çš„å±æ€§ã€‚åœ¨ Vue çš„å“åº”å¼ç³»ç»Ÿä¸­ï¼Œå½“ä½ å°è¯•å°†ä¸€ä¸ªå±æ€§è½¬æ¢ä¸ºå“åº”å¼æ—¶ï¼Œå¦‚æœè¯¥å±æ€§å·²ç»æœ‰ getter&#x2F;setterï¼ŒVue é€šå¸¸ä¸ä¼šè¦†ç›–å®ƒä»¬ï¼Œé™¤éä½ æ˜ç¡®æä¾›äº†ä¸€ä¸ªæ–°çš„å€¼ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…ç ´åå·²ç»å­˜åœ¨çš„å±æ€§è¡Œä¸ºã€‚ 4.3.4 è§‚æµ‹å­å±æ€§1let childOb = shallow ? val &amp;&amp; val.__ob__ : observe(val, false, mock) shallow æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦è¿›è¡Œæµ…å±‚å“åº”å¼è½¬æ¢ã€‚å¦‚æœä¸º trueï¼Œåˆ™åªå¯¹å¯¹è±¡çš„ç›´æ¥å±æ€§è¿›è¡Œå“åº”å¼è½¬æ¢ï¼Œè€Œä¸é€’å½’åœ°å¯¹å…¶åµŒå¥—å¯¹è±¡çš„å±æ€§è¿›è¡Œå“åº”å¼è½¬æ¢ã€‚é»˜è®¤ä¸ºfalseï¼Œå³é€’å½’çš„å¯¹åµŒå¥—å¯¹è±¡çš„å±æ€§è¿›è¡Œå“åº”å¼è½¬æ¢ã€‚ valæ˜¯å½“å‰æ­£åœ¨å¤„ç†çš„å¯¹è±¡å±æ€§çš„å€¼ã€‚ val.__ob__æ˜¯ä¸€ä¸ªæ£€æŸ¥ï¼Œç”¨äºç¡®å®š val æ˜¯å¦å·²ç»è¢« Vue çš„å“åº”å¼ç³»ç»Ÿè½¬æ¢è¿‡ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å·²ç»è¢«è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ï¼ŒVue ä¼šåœ¨è¯¥å¯¹è±¡ä¸Šæ·»åŠ ä¸€ä¸ª ob å±æ€§ï¼Œå…¶å€¼ä¸ºå¯¹åº”çš„ Observer å®ä¾‹ã€‚ è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯æ ¹æ® shallow å‚æ•°çš„å€¼æ¥å†³å®šæ˜¯å¦éœ€è¦å¯¹å¯¹è±¡çš„å€¼è¿›è¡Œé€’å½’çš„å“åº”å¼è½¬æ¢ã€‚å¦‚æœ shallow ä¸º trueï¼Œåˆ™åªä½¿ç”¨ç°æœ‰çš„å“åº”å¼å¯¹è±¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å“åº”å¼å¯¹è±¡ã€‚è¿™ç§æ–¹å¼å…è®¸ Vue åœ¨ä¸åŒåœºæ™¯ä¸‹çµæ´»åœ°å¤„ç†å¯¹è±¡çš„å“åº”å¼è½¬æ¢ï¼ŒåŒæ—¶é¿å…äº†ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚ 4.3.5 å®šä¹‰ getter å’Œ setter1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function reactiveGetter() &#123; const value = getter ? getter.call(obj) : val if (Dep.target) &#123; if (__DEV__) &#123; dep.depend(&#123; target: obj, type: TrackOpTypes.GET, key &#125;) &#125; else &#123; dep.depend() &#125; if (childOb) &#123; childOb.dep.depend() if (isArray(value)) &#123; dependArray(value) &#125; &#125; &#125; return isRef(value) &amp;&amp; !shallow ? value.value : value &#125;, set: function reactiveSetter(newVal) &#123; const value = getter ? getter.call(obj) : val if (!hasChanged(value, newVal)) &#123; return &#125; if (__DEV__ &amp;&amp; customSetter) &#123; customSetter() &#125; if (setter) &#123; setter.call(obj, newVal) &#125; else if (getter) &#123; // #7981: for accessor properties without setter return &#125; else if (!shallow &amp;&amp; isRef(value) &amp;&amp; !isRef(newVal)) &#123; value.value = newVal return &#125; else &#123; val = newVal &#125; childOb = shallow ? newVal &amp;&amp; newVal.__ob__ : observe(newVal, false, mock) if (__DEV__) &#123; dep.notify(&#123; type: TriggerOpTypes.SET, target: obj, key, newValue: newVal, oldValue: value &#125;) &#125; else &#123; dep.notify() &#125; &#125;&#125;) function dependArray(value: Array&lt;any&gt;) &#123; for (let e, i = 0, l = value.length; i &lt; l; i++) &#123; e = value[i] if (e &amp;&amp; e.__ob__) &#123; e.__ob__.dep.depend() &#125; if (isArray(e)) &#123; dependArray(e) &#125; &#125; &#125; 4.3.5.1 getterå‡½æ•°åœ¨Vueæ‰§è¡Œæ¸²æŸ“æ—¶ï¼Œä¼šè®¿é—® dataä¸­çš„å±æ€§ï¼Œä»è€Œæ‰§è¡Œè¿™é‡Œå®šä¹‰çš„ reactiveGetteræ–¹æ³•ã€‚ å¦‚æœå­˜åœ¨åŸå§‹çš„ getterï¼ˆæ•°æ®ä» Object.definePropertyå®šä¹‰ï¼‰ï¼Œåˆ™è°ƒç”¨å®ƒã€‚å¦åˆ™ï¼Œè¿”å›å±æ€§çš„å€¼ valã€‚ Dep.Targetæ˜¯ä¸€ä¸ªå…¨å±€å±æ€§ï¼Œå› ä¸ºæ¯æ¬¡åªèƒ½åŒæ—¶æ‰§è¡Œä¸€æ¬¡æ¸²æŸ“ï¼Œæ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šå¯¹åº”ä¸€ä¸ª Watcherå®ä¾‹ã€‚ åœ¨æ¯æ¬¡æ¸²æŸ“å‰éƒ½ä¼šå°† Dep.Targetè®¾ç½®ä¸ºå½“å‰çš„è¿™ä¸ª Watcherå®ä¾‹ï¼Œç„¶ååœ¨æ¸²æŸ“åä¼šå°† Dep.Targetè®¾ç½®ä¸ºç©ºã€‚ æ‰€ä»¥è¿™ä¸ª Dep.TargetæŒ‡çš„å°±æ˜¯å½“å‰æ¸²æŸ“å¯¹åº”çš„é‚£ä¸ª Watcherå®ä¾‹ã€‚ æ­¤æ—¶è°ƒç”¨dep.dependæ”¶é›†ä¾èµ–ã€‚ å¦‚æœæœ‰å­å±æ€§ï¼Œåˆ™è°ƒç”¨å­å±æ€§çš„ dep.dependæ–¹æ³•ã€‚ å¦‚æœå±æ€§å€¼æ˜¯æ•°ç»„ï¼Œé€’å½’åœ°ä¾èµ–æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ æœ€åï¼Œå¦‚æœå±æ€§å€¼æ˜¯ä¸€ä¸ª ref å¯¹è±¡ï¼ˆVue 3 å¼•å…¥çš„å“åº”å¼å¼•ç”¨ç±»å‹ï¼‰ï¼Œå¹¶ä¸”ä¸æ˜¯æµ…å±‚å“åº”å¼ï¼Œåˆ™è¿”å›å…¶å†…éƒ¨å€¼ï¼›å¦åˆ™è¿”å›åŸå§‹å€¼ã€‚ 4.3.5.2 setterå‡½æ•°å½“å±æ€§è¢«é‡æ–°èµ‹å€¼æ—¶ï¼Œå¦‚ this.xxxx = xxxã€‚ä¼šæ‰§è¡Œ reactiveSetter æ–¹æ³•ã€‚ å¦‚æœæ–°å€¼ä¸æ—§å€¼ç›¸åŒï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚ åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¦‚æœæä¾›äº†è‡ªå®šä¹‰çš„ setterï¼Œåˆ™è°ƒç”¨å®ƒã€‚ å¦‚æœå­˜åœ¨åŸå§‹çš„ setterï¼Œåˆ™è°ƒç”¨å®ƒã€‚ å¦‚æœæ²¡æœ‰ setter ä½†æœ‰ getterï¼Œä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ã€‚ å¦‚æœå±æ€§å€¼æ˜¯ ref å¯¹è±¡ï¼Œå¹¶ä¸”ä¸æ˜¯æµ…å±‚å“åº”å¼ï¼Œåˆ™æ›´æ–°å…¶å†…éƒ¨å€¼ã€‚ å¦åˆ™ï¼Œç›´æ¥æ›´æ–°å±æ€§çš„å€¼ã€‚ å› ä¸ºå€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å†æ¬¡è®¾ç½®æ–°å€¼ä¸ºå“åº”å¼ã€‚ æœ€åé€šçŸ¥æ‰€æœ‰ä¾èµ–äºè¯¥å±æ€§çš„ watcherï¼Œå±æ€§å€¼å·²æ”¹å˜ã€‚ ç„¶åå†æ¬¡æ‰§è¡Œæ¸²æŸ“æ“ä½œã€‚ 4.4 æ€»ç»“åœ¨å‰é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å¸¦å¤§å®¶çœ‹äº† vue æ˜¯å¦‚ä½•è®¾ç½®ä¾¦å¬çš„ã€‚ ä¸»è¦æ˜¯é€šè¿‡ observeæ¥å°†æ•°æ®è®¾ç½®ä¸ºå“åº”å¼ã€‚ äº”ã€æ•°æ®å“åº”å¼çš„æ ¸å¿ƒæ¨¡å—ç»è¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“: Vueä¸­æ¯ä¸€ä¸ª dataä¸­éƒ½ç»‘å®šäº†ä¸€ä¸ªå¯¹åº”çš„ä¾èµ–åˆ—è¡¨ã€‚ Vueä¸­æ¯ä¸€æ¬¡ æ¸²æŸ“éƒ½å¯¹åº”ç€ä¸€ä¸ª Watcherå®ä¾‹ï¼Œè¿™ä¸ª Watcherå®ä¾‹ä¸Šå­˜å‚¨ç€å¯ä»¥æ‰§è¡Œè¿™æ¬¡æ¸²æŸ“çš„æ–¹æ³•ã€‚ Vueå®ç°æ•°æ®å“åº”å¼å°±æ˜¯é€šè¿‡æ•°æ®è®¿é—®æ—¶åœ¨æ•°æ®å¯¹åº”çš„ä¾èµ–åˆ—è¡¨ä¸­å¢åŠ å½“å‰æ¸²æŸ“çš„ Watcherå®ä¾‹ï¼Œç„¶ååœ¨æ•°æ®ä¿®æ”¹æ—¶é€šçŸ¥ä¾èµ–ä¸­å­˜å‚¨çš„ Watcherå®ä¾‹éœ€è¦å†æ¬¡æ‰§è¡Œå¯¹åº”çš„æ¸²æŸ“æ–¹æ³•ã€‚ å…¶ä¸­çš„ä¾èµ–å’ŒWatcheræ˜¯å•ç‹¬çš„æ¨¡å—ï¼Œæˆ‘ä»¬è¿™å‡ ä¼šå¯¹è¿™ 2 ä¸ªä¸»è¦æ¨¡å—è¿›è¡Œåˆ†æè®²è§£ã€‚ 5.1 Depæ¨¡å—Depè¡¨ç¤ºä¾èµ–ç±»ï¼Œæ¯ä¸€ä¸ª dataä¸­éƒ½ä¼šç»‘å®šä¸€ä¸ª Depå®ä¾‹ depã€‚ åœ¨è®¿é—®æ•°æ®æ—¶ï¼Œä¼šè°ƒç”¨depä¸Šçš„ dependæ–¹æ³•è¿›è¡Œä¾èµ–æ”¶é›†ã€‚ 5.1.1 Dep.Target123456789101112Dep.target = nullconst targetStack: Array&lt;DepTarget | null | undefined&gt; = []export function pushTarget(target?: DepTarget | null) &#123; targetStack.push(target) Dep.target = target&#125;export function popTarget() &#123; targetStack.pop() Dep.target = targetStack[targetStack.length - 1]&#125; æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½å¯¹åº”ç€ä¸€ä¸ª Watcherå®ä¾‹ï¼Œå®é™…ä¸Šæ¸²æŸ“æ˜¯ Watcherå®ä¾‹ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ Dep.target æ˜¯ä¸€ä¸ªé™æ€å±æ€§ï¼Œç”¨äºå­˜å‚¨å½“å‰æ­£åœ¨æ‰§è¡Œæ¸²æŸ“çš„ Watcher å®ä¾‹ã€‚ æ¯æ¬¡åœ¨æ¸²æŸ“å‰éƒ½ä¼šè°ƒç”¨ pushTarget å°† Dep.Targetè®¾ç½®ä¸ºå½“å‰æ‰§è¡Œæ¸²æŸ“çš„ Watcherå®ä¾‹ã€‚ ç„¶ååœ¨æ¸²æŸ“å®Œæˆåä¼šè°ƒç”¨ popTarget å°† Dep.target è®¾ç½®ä¸ºç©ºã€‚ 12345678910111213class Watcher&#123; constructor()&#123; this.initRender(); &#125; initRender()&#123; // æ¸²æŸ“å‰è®¾ç½®Dep.targetä¸ºå½“å‰ Watcherå®ä¾‹ pushTarget(this); // æ¸²æŸ“ render() // æ¸²æŸ“åè®¾ç½®Dep.targetä¸ºç©º popTarget(); &#125;&#125; æ‰€ä»¥åœ¨æ¸²æŸ“æ—¶è§¦å‘æ•°æ®çš„getteré€»è¾‘æ”¶é›†ä¾èµ–æ—¶å¯ä»¥é€šè¿‡ Dep.targetè·å–å½“å‰æ¸²æŸ“å¯¹åº”çš„ Watcherå®ä¾‹å¹¶æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ã€‚ 5.1.2 subsé›†åˆDepç±»ç»´æŠ¤äº†ä¸€ä¸ª subsé›†åˆï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ä¾èµ–äºè¯¥å±æ€§çš„ Watcherå®ä¾‹ã€‚ æ¯å½“ç”¨æˆ·è®¿é—®æ•°æ®æ—¶ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡ Dep.Targetè·å–åˆ°æœ¬æ¬¡æ¸²æŸ“å¯¹åº”çš„ Watcherå®ä¾‹ã€‚ æ‰€ä»¥å°±å¯ä»¥å°†Watcherå®ä¾‹æ·»åŠ è¿› subsé›†åˆä¸Šï¼Œä»¥ä¾¿åç»­çš„ä½¿ç”¨ã€‚ 5.1.3 dependæ–¹æ³•12345678910111213141516171819202122//======================= Depç±»====================depend(info?: DebuggerEventExtraInfo) &#123; // å½“å‰æ¸²æŸ“å¯¹åº”çš„ watcher if (Dep.target) &#123; Dep.target.addDep(this); &#125;&#125;addSub(sub: DepTarget) &#123; this.subs.push(sub)&#125;//======================= Watcherç±»================ addDep(dep: Dep) &#123; const id = dep.id if (!this.newDepIds.has(id)) &#123; this.newDepIds.add(id) this.newDeps.push(dep) if (!this.depIds.has(id)) &#123; dep.addSub(this) &#125; &#125; &#125; åœ¨æ•°æ®è®¿é—®æ—¶ï¼Œä¼šè°ƒç”¨æ•°æ®å¯¹åº”çš„ Depå®ä¾‹ä¸Šçš„ dependæ–¹æ³•ï¼Œè¿›è€Œæ‰§è¡Œ Watcherå®ä¾‹ä¸Šçš„ addDepæ–¹æ³•ã€‚ è€Œåœ¨Watcherå®ä¾‹ä¸Šçš„ addDepæ–¹æ³•ä¸­æœ€ç»ˆåˆä¼šè°ƒç”¨ Depå®ä¾‹ä¸Šçš„ addSubæ–¹æ³•ã€‚ ç„¶åå†åœ¨Depå®ä¾‹ä¸Šçš„subsé›†åˆä¸Šæ·»åŠ Watcherå®ä¾‹ã€‚ ä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥åœ°å°†å½“å‰ Watcherå®ä¾‹æ·»åŠ åˆ° subsä¸­å‘¢ï¼Œè€Œæ˜¯è¦ç»•è¿™ä¹ˆä¸€å¤§åœˆå‘¢ï¼Ÿ depä¸­ä¸ä¼šå­˜åœ¨é‡å¤çš„ watcherï¼ŒåŒæ—¶ watcherä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒçš„ dep 5.1.3.1 å»é‡æœºåˆ¶é€šè¿‡ Watcher çš„ addDep æ–¹æ³•ï¼Œå¯ä»¥åœ¨ Watcher çº§åˆ«è¿›è¡Œå»é‡ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åŒä¸€ä¸ª Dep ä¸ä¼šå¤šæ¬¡æ·»åŠ ç›¸åŒçš„ Watcherï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„é‡å¤ä¾èµ–ã€‚ 12345678910addDep(dep: Dep) &#123; const id = dep.id if (!this.newDepIds.has(id)) &#123; this.newDepIds.add(id) this.newDeps.push(dep) if (!this.depIds.has(id)) &#123; dep.addSub(this) &#125; &#125;&#125; newDepIds å’Œ newDepsï¼šè¿™ä¸¤ä¸ªé›†åˆç”¨äºè®°å½•å½“å‰æ”¶é›†å‘¨æœŸä¸­æ–°æ·»åŠ çš„ä¾èµ–ã€‚newDepIds æ˜¯ä¸€ä¸ª Setï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾æ˜¯å¦å·²ç»æ·»åŠ è¿‡æŸä¸ª Depï¼›newDeps æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–°æ·»åŠ çš„ Dep å®ä¾‹ã€‚ depIdsï¼šè¿™æ˜¯ä¸€ä¸ª Setï¼Œç”¨äºè®°å½•å·²ç»å­˜åœ¨çš„ä¾èµ–ã€‚å¦‚æœ depId ä¸åœ¨ depIds ä¸­ï¼Œè¯´æ˜è¿™æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ è¯¥ä¾èµ–ï¼Œå› æ­¤è°ƒç”¨ dep.addSub(this) å°† Watcher æ·»åŠ åˆ° Dep çš„ subs é›†åˆä¸­ã€‚ 5.1.3.2 æœ‰å“ªäº›éœ€è¦å»é‡çš„åœºæ™¯5.1.3.2.1 å»é‡åœºæ™¯ä¸€ï¼šå¤šæ¬¡è®¿é—®åŒä¸€ä¸ªå“åº”å¼å±æ€§å½“ä¸€ä¸ªç»„ä»¶åœ¨åŒä¸€ä¸ªæ¸²æŸ“å‘¨æœŸå†…å¤šæ¬¡è®¿é—®åŒä¸€ä¸ªå“åº”å¼å±æ€§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡å¤æ·»åŠ  Watcherã€‚ä¾‹å¦‚ï¼Œåœ¨æ¨¡æ¿ä¸­å¤šæ¬¡å¼•ç”¨åŒä¸€ä¸ªæ•°æ®å±æ€§ï¼š 12345678910111213141516&lt;template&gt; &lt;div&gt; &#123;&#123; message &#125;&#125; &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123; data() &#123; return &#123; message: &#x27;Hello, Vue!&#x27; &#125;; &#125;&#125;;&lt;/script&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œmessage è¢«å¼•ç”¨äº†ä¸¤æ¬¡ã€‚å¦‚æœä¸è¿›è¡Œå»é‡å¤„ç†ï¼Œæ¯æ¬¡è®¿é—® message éƒ½ä¼šå°è¯•æ·»åŠ ä¸€ä¸ªæ–°çš„ Watcherã€‚ 5.1.3.2.2 å»é‡åœºæ™¯äºŒï¼šè®¡ç®—å±æ€§å’Œä¾¦å¬å™¨çš„å¤šé‡ä¾èµ–è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨ï¼ˆwatchï¼‰å¯èƒ½ä¼šä¾èµ–å¤šä¸ªå“åº”å¼å±æ€§ï¼Œå¦‚æœè¿™äº›å±æ€§åœ¨åŒä¸€ä¸ªæ¸²æŸ“å‘¨æœŸå†…è¢«å¤šæ¬¡è®¿é—®ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´é‡å¤æ·»åŠ  Watcherã€‚ 12345678910111213computed: &#123; fullName() &#123; return `$&#123;this.firstName&#125; $&#123;this.lastName&#125;`; &#125;&#125;,watch: &#123; firstName() &#123; console.log(&#x27;firstName changed&#x27;); &#125;, lastName() &#123; console.log(&#x27;lastName changed&#x27;); &#125;&#125; å¦‚æœ fullName è®¡ç®—å±æ€§åœ¨åŒä¸€ä¸ªæ¸²æŸ“å‘¨æœŸå†…è¢«å¤šæ¬¡è®¿é—®ï¼ŒfirstName å’Œ lastName ä¼šè¢«å¤šæ¬¡ä¾èµ–ï¼Œå¦‚æœæ²¡æœ‰å»é‡å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡å¤çš„ Watcherã€‚ 5.1.3.2.3 å»é‡åœºæ™¯ä¸‰ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ï¼Œå¦‚æœå¤šæ¬¡è®¿é—®åŒä¸€ä¸ªå“åº”å¼å±æ€§ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´é‡å¤æ·»åŠ  Watcherã€‚ 1234mounted() &#123; console.log(this.message); console.log(this.message);&#125; 5.1.3.2.4 å»é‡åœºæ™¯å››ï¼šåŠ¨æ€ç»„ä»¶å’Œæ¡ä»¶æ¸²æŸ“åœ¨åŠ¨æ€ç»„ä»¶å’Œæ¡ä»¶æ¸²æŸ“ä¸­ï¼Œå¦‚æœåŒä¸€ä¸ªå“åº”å¼å±æ€§åœ¨ä¸åŒçš„æ¡ä»¶åˆ†æ”¯ä¸­è¢«å¤šæ¬¡è®¿é—®ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´é‡å¤æ·»åŠ  Watcherã€‚ 12345678910111213141516171819&lt;template&gt; &lt;div&gt; &lt;component :is=&quot;currentComponent&quot; /&gt; &lt;p v-if=&quot;showMessage&quot;&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt; &lt;p v-else&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123; data() &#123; return &#123; currentComponent: &#x27;ComponentA&#x27;, showMessage: true, message: &#x27;Hello, Vue!&#x27; &#125;; &#125;&#125;;&lt;/script&gt; 5.1.4 notifyæ–¹æ³•notify æ–¹æ³•æ˜¯ Dep ç±»ä¸­çš„ä¸€ä¸ªé‡è¦æ–¹æ³•ï¼Œç”¨äºåœ¨æ•°æ®å˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰ä¾èµ–äºè¯¥æ•°æ®çš„ Watcher å®ä¾‹ã€‚ è¿™ä¸ªæ–¹æ³•ç¡®ä¿æ‰€æœ‰ç›¸å…³çš„ Watcher éƒ½èƒ½æ¥æ”¶åˆ°æ•°æ®å˜åŒ–çš„é€šçŸ¥ï¼Œå¹¶è§¦å‘ç›¸åº”çš„æ›´æ–°æ“ä½œã€‚ 123456789101112131415161718192021notify(info?: DebuggerEventExtraInfo) &#123; // stabilize the subscriber list first const subs = this.subs.filter(s =&gt; s) as DepTarget[] if (__DEV__ &amp;&amp; !config.async) &#123; // subs aren&#x27;t sorted in scheduler if not running async // we need to sort them now to make sure they fire in correct // order subs.sort((a, b) =&gt; a.id - b.id) &#125; for (let i = 0, l = subs.length; i &lt; l; i++) &#123; const sub = subs[i] if (__DEV__ &amp;&amp; info) &#123; sub.onTrigger &amp;&amp; sub.onTrigger(&#123; effect: subs[i], ...info &#125;) &#125; sub.update() &#125;&#125; 5.1.4.1 å»æ‰ç©ºå€¼1const subs = this.subs.filter(s =&gt; s) as DepTarget[] è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿ subs åˆ—è¡¨ä¸­æ²¡æœ‰ null æˆ– undefined çš„å€¼ã€‚filter(s &#x3D;&gt; s) ä¼šè¿‡æ»¤æ‰æ‰€æœ‰éçœŸå€¼çš„é¡¹ã€‚ 5.1.4.2 æ’åºè®¢é˜…è€…ï¼ˆä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸”æœªå¼‚æ­¥è¿è¡Œæ—¶ï¼‰123456if (__DEV__ &amp;&amp; !config.async) &#123; // subs aren&#x27;t sorted in scheduler if not running async // we need to sort them now to make sure they fire in correct // order subs.sort((a, b) =&gt; a.id - b.id)&#125; DEV æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¡¨ç¤ºå½“å‰æ˜¯å¦å¤„äºå¼€å‘æ¨¡å¼ã€‚ config.async æ˜¯ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œè¡¨ç¤ºæ˜¯å¦å¼‚æ­¥æ‰§è¡Œæ›´æ–°ã€‚ å¦‚æœå¤„äºå¼€å‘æ¨¡å¼ä¸”æœªå¼‚æ­¥è¿è¡Œï¼Œsubs åˆ—è¡¨éœ€è¦æŒ‰ id æ’åºï¼Œä»¥ç¡®ä¿ Watcher æŒ‰æ­£ç¡®çš„é¡ºåºè§¦å‘æ›´æ–°ã€‚è¿™æ˜¯å› ä¸ºå¼‚æ­¥è°ƒåº¦å™¨ä¼šè‡ªåŠ¨å¤„ç†æ’åºï¼Œè€Œåœ¨åŒæ­¥æ¨¡å¼ä¸‹éœ€è¦æ‰‹åŠ¨æ’åºã€‚ 5.1.4.3 é€šçŸ¥æ¯ä¸ªè®¢é˜…è€…1234567891011for (let i = 0, l = subs.length; i &lt; l; i++) &#123; const sub = subs[i] if (__DEV__ &amp;&amp; info) &#123; sub.onTrigger &amp;&amp; sub.onTrigger(&#123; effect: subs[i], ...info &#125;) &#125; sub.update()&#125; éå† subs åˆ—è¡¨ï¼Œé€ä¸ªé€šçŸ¥æ¯ä¸ª Watcherã€‚ å¦‚æœå¤„äºå¼€å‘æ¨¡å¼ä¸”æä¾›äº† infoï¼Œè°ƒç”¨ sub.onTrigger æ–¹æ³•ï¼Œä¼ é€’è°ƒè¯•ä¿¡æ¯ã€‚ æœ€ç»ˆè°ƒç”¨ sub.update() æ–¹æ³•ï¼Œè§¦å‘ Watcher çš„æ›´æ–°æ“ä½œã€‚ 5.2 Watcheræ¨¡å—5.2.1 å°†æ¸²æŸ“å‡½æ•°æŒ‚è½½åˆ°å®ä¾‹ä¸Šåœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆæ¬¡æ¸²æŸ“æ—¶ä¼šå®ä¾‹åŒ–ä¸€ä¸ª watcherå®ä¾‹ã€‚ ç„¶åå°†æ¸²æŸ“çš„æ–¹æ³•ä¼ å…¥ watcherå®ä¾‹ä¸­ã€‚ ç„¶åå°±ä¼šæ‰§è¡Œå¯¹åº”çš„æ¸²æŸ“æ–¹æ³•ã€‚ æ‰€ä»¥å¯ä»¥æƒ³åˆ°æ¸²æŸ“çš„é€»è¾‘åº”è¯¥æ˜¯å†™åœ¨äº† Watcherç±»çš„æ„é€ å™¨ä¸­ã€‚ 1234567891011// åˆæ¬¡æ¸²æŸ“æ—¶ new Watcher(æ¸²æŸ“å‡½æ•°)class Watcher&#123; constructor(æ¸²æŸ“å‡½æ•°)&#123; this.æ¸²æŸ“å‡½æ•° = æ¸²æŸ“å‡½æ•°; // æ‰§è¡Œæ¸²æŸ“ this.æ¸²æŸ“å‡½æ•°(); &#125;&#125; å½“ç„¶æºç ä¸­å®é™…ä¸Šä¸ä»…ä»…è¿™ä¹ˆç®€å•ã€‚ 1234567891011// åˆæ¬¡æ¸²æŸ“æ—¶ new Watcher(æ¸²æŸ“å‡½æ•°)class Watcher&#123; constructor(æ¸²æŸ“å‡½æ•°)&#123; this.æ¸²æŸ“å‡½æ•° = æ¸²æŸ“å‡½æ•°; // æ‰§è¡Œæ¸²æŸ“ this.æ¸²æŸ“å‡½æ•°(); &#125;&#125; æºç ä¸­å°†æ¸²æŸ“å‡½æ•°æŒ‚è½½åˆ°äº† getterä¸Šã€‚ 1this.getter = expOrFn ç„¶ååœ¨ getæ–¹æ³•ä¸­è°ƒç”¨ getteræ–¹æ³•ã€‚ åœ¨ getæ–¹æ³•ä¸­è®¾ç½® Dep.targetä¸ºå½“å‰çš„ watcherã€‚ 1234567891011121314151617181920212223get() &#123; pushTarget(this) let value const vm = this.vm try &#123; value = this.getter.call(vm, vm) &#125; catch (e: any) &#123; if (this.user) &#123; handleError(e, vm, `getter for watcher &quot;$&#123;this.expression&#125;&quot;`) &#125; else &#123; throw e &#125; &#125; finally &#123; // &quot;touch&quot; every property so they are all tracked as // dependencies for deep watching if (this.deep) &#123; traverse(value) &#125; popTarget() this.cleanupDeps() &#125; return value &#125; 5.2.2 updateæ–¹æ³•åœ¨æ•°æ®è¢«è®¿é—®æ—¶ï¼Œä¼šè°ƒç”¨ dep.notifyé€šçŸ¥ä¾èµ–éœ€è¦æ›´æ–°æ¸²æŸ“ï¼Œç„¶åè°ƒç”¨ watcher.updateã€‚ ç„¶åä¼šè°ƒç”¨ runæ–¹æ³•ï¼Œæœ€åè°ƒç”¨ getæ–¹æ³•é‡æ–°æ‰§è¡Œæ¸²æŸ“æ–¹æ³•ã€‚ å…­ã€æ€»ç»“è¿™ä¸€ç¯‡ä¸­æˆ‘ä»¬è¯¦ç»†è§£é‡Šäº†æ•°æ®å“åº”å¼ç›¸å…³çš„åŸç†ã€‚ ä¸€å¥è¯å°±æ˜¯åœ¨æ•°æ®è®¿é—®æ—¶æ”¶é›†ä¾èµ–ï¼Œåœ¨æ•°æ®è¢«ä¿®æ”¹æ—¶æ›´æ–°ä¾èµ–"},{"title":"ğŸ”¥Vue2åˆæ¬¡æ¸²æŸ“æµç¨‹","path":"//posts/vue2-init-render.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬ä¸ƒç¯‡-åˆæ¬¡æ¸²æŸ“æµç¨‹ ä¸Šç¯‡æˆ‘ä»¬ä»‹ç»äº†Vueæ¸²æŸ“çš„åŸºç¡€-è™šæ‹ŸDOMã€‚ åœ¨æ¸²æŸ“é˜¶æ®µï¼ŒVueé€šè¿‡è™šæ‹Ÿ DOMæ¥åˆ›å»ºå…ƒç´ ã€‚ ä¸€ã€ç¼–è¯‘æ—¶çš„æŒ‚è½½æ“ä½œåœ¨ä¸“æ ç¬¬å››ç¯‡ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†åœ¨Vueå®ä¾‹åŒ–æ—¶ï¼Œä¼šæ‰§è¡Œinitå‡½æ•°æ¥åˆå§‹åŒ–ä¸€äº›åç»­éœ€è¦çš„é€‰é¡¹ã€‚ é€šå¸¸åœ¨å®ä¾‹åŒ–åæˆ‘ä»¬ä¼šæ‰§è¡ŒæŒ‚è½½æ“ä½œã€‚ è€Œæœç´¢æºç å¯ä»¥å‘ç°ï¼Œ$mountæ–¹æ³•è¢«å®šä¹‰äº† 2 æ¬¡ã€‚ æ ¹æ®æ˜¯å¦éœ€è¦æ¨¡ç‰ˆç¼–è¯‘ï¼Œå­˜åœ¨ 2 ä¸ª$mountæ–¹æ³•ã€‚ åœ¨æ¨¡æ¿ç¼–è¯‘ç‰ˆæœ¬çš„ Vueä¸­ï¼Œé‡å†™äº†è¿è¡Œæ—¶çš„$mountæ–¹æ³•ï¼Œå…¶ä¸­æ·»åŠ äº†ä¸€äº›æ¨¡æ¿ç¼–è¯‘çš„æ–¹æ³•ã€‚ æ¨¡æ¿ç¼–è¯‘æ„ä¸ºå°† templateè½¬åŒ–æˆ renderå‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273const mount = Vue.prototype.$mountVue.prototype.$mount = function ( el?: string | Element, hydrating?: boolean): Component &#123; el = el &amp;&amp; query(el) /* istanbul ignore if */ if (el === document.body || el === document.documentElement) &#123; __DEV__ &amp;&amp; warn( `Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.` ) return this &#125; const options = this.$options // resolve template/el and convert to render function if (!options.render) &#123; let template = options.template if (template) &#123; if (typeof template === &#x27;string&#x27;) &#123; if (template.charAt(0) === &#x27;#&#x27;) &#123; template = idToTemplate(template) /* istanbul ignore if */ if (__DEV__ &amp;&amp; !template) &#123; warn( `Template element not found or is empty: $&#123;options.template&#125;`, this ) &#125; &#125; &#125; else if (template.nodeType) &#123; template = template.innerHTML &#125; else &#123; if (__DEV__) &#123; warn(&#x27;invalid template option:&#x27; + template, this) &#125; return this &#125; &#125; else if (el) &#123; // @ts-expect-error template = getOuterHTML(el) &#125; if (template) &#123; /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; mark(&#x27;compile&#x27;) &#125; const &#123; render, staticRenderFns &#125; = compileToFunctions( template, &#123; outputSourceRange: __DEV__, shouldDecodeNewlines, shouldDecodeNewlinesForHref, delimiters: options.delimiters, comments: options.comments &#125;, this ) options.render = render options.staticRenderFns = staticRenderFns /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; mark(&#x27;compile end&#x27;) measure(`vue $&#123;this._name&#125; compile`, &#x27;compile&#x27;, &#x27;compile end&#x27;) &#125; &#125; &#125; return mount.call(this, el, hydrating)&#125; é¦–å…ˆè·å–ä¼ å…¥elå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æŒ‚è½½çš„èŠ‚ç‚¹ã€‚ ç„¶ååˆ¤æ–­æŒ‚è½½èŠ‚ç‚¹æ˜¯å¦æ˜¯bodyèŠ‚ç‚¹æˆ–è€…htmlèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™æç¤ºæ— æ³•æŒ‚è½½å¹¶è¿”å›ã€‚ å¦‚æœæ²¡æœ‰renderæ–¹æ³•ï¼Œè·å–templateé€‰é¡¹ã€‚ å¦‚æœå­˜åœ¨ templateé€‰é¡¹ï¼š templateæ˜¯ä¸€ä¸ªé€‰æ‹©èŠ‚ç‚¹å­—ç¬¦ä¸²(#app)ï¼Œå°†templateå˜é‡è®¾ç½®ä¸ºèŠ‚ç‚¹å­—ç¬¦ä¸²å¯¹åº”çš„HTMLä»£ç ã€‚ templateæ˜¯ä¸€ä¸ªçœŸå®DOMèŠ‚ç‚¹ï¼Œå°†templateå˜é‡è®¾ç½®ä¸ºèŠ‚ç‚¹å¯¹åº”çš„HTMLä»£ç ã€‚ å¦‚æœéƒ½ä¸æ˜¯ï¼Œåˆ™ä¼šæç¤ºæ— æ•ˆçš„templateé€‰é¡¹ã€‚ å¦‚æœä¸å­˜åœ¨ templateé€‰é¡¹ï¼Œä½†æ˜¯æœ‰ elèŠ‚ç‚¹ï¼Œåˆ™å°†templateå˜é‡è®¾ç½®ä¸ºelèŠ‚ç‚¹å¯¹åº”çš„ HTMLä»£ç ã€‚ è·å–åˆ°å¯¹åº”çš„æ¨¡æ¿ï¼Œç„¶åå°†è¿™ä¸ªå°†è¿™ä¸ªæ¨¡æ¿è½¬æ¢æˆ renderå‡½æ•° å¦‚æœæœ‰renderæ–¹æ³•ï¼Œç›´æ¥æ‰§è¡Œ mountæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œæ—¶å®šä¹‰çš„$mountæ–¹æ³•ã€‚ äºŒã€è¿è¡Œæ—¶çš„æŒ‚è½½æ“ä½œä¸Šé¢æˆ‘ä»¬è¯´åˆ°ç¼–è¯‘æ—¶çš„$mountæ–¹æ³•å°†æ¨¡æ¿è½¬æ¢æˆäº†renderæ–¹æ³•ã€‚ ç„¶åè°ƒç”¨äº†è¿è¡Œæ—¶çš„$mountæ–¹æ³•ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹$mountæ–¹æ³•éƒ½åšäº†ä»€ä¹ˆæ“ä½œã€‚ 1234567Vue.prototype.$mount = function ( el?: string | Element, hydrating?: boolean): Component &#123; el = el &amp;&amp; inBrowser ? query(el) : undefined return mountComponent(this, el, hydrating)&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å°±æ˜¯è·å–èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨äº†mountComponentæ–¹æ³•ã€‚ ä¸‰ã€mountComponentå¯ä»¥çœ‹å‡ºæ¥æœ€ç»ˆæ‰§è¡Œäº†mountComponentæ–¹æ³•ã€‚ æˆ‘ä»¬æŠŠç›®å…‰ç§»åˆ°mountComponentæ–¹æ³•ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798export function mountComponent( vm: Component, el: Element | null | undefined, hydrating?: boolean): Component &#123; vm.$el = el if (!vm.$options.render) &#123; // @ts-expect-error invalid type vm.$options.render = createEmptyVNode if (__DEV__) &#123; /* istanbul ignore if */ if ( (vm.$options.template &amp;&amp; vm.$options.template.charAt(0) !== &#x27;#&#x27;) || vm.$options.el || el ) &#123; warn( &#x27;You are using the runtime-only build of Vue where the template &#x27; + &#x27;compiler is not available. Either pre-compile the templates into &#x27; + &#x27;render functions, or use the compiler-included build.&#x27;, vm ) &#125; else &#123; warn( &#x27;Failed to mount component: template or render function not defined.&#x27;, vm ) &#125; &#125; &#125; callHook(vm, &#x27;beforeMount&#x27;) let updateComponent /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; updateComponent = () =&gt; &#123; const name = vm._name const id = vm._uid const startTag = `vue-perf-start:$&#123;id&#125;` const endTag = `vue-perf-end:$&#123;id&#125;` mark(startTag) const vnode = vm._render() mark(endTag) measure(`vue $&#123;name&#125; render`, startTag, endTag) mark(startTag) vm._update(vnode, hydrating) mark(endTag) measure(`vue $&#123;name&#125; patch`, startTag, endTag) &#125; &#125; else &#123; updateComponent = () =&gt; &#123; vm._update(vm._render(), hydrating) &#125; &#125; const watcherOptions: WatcherOptions = &#123; before() &#123; if (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123; callHook(vm, &#x27;beforeUpdate&#x27;) &#125; &#125; &#125; if (__DEV__) &#123; watcherOptions.onTrack = e =&gt; callHook(vm, &#x27;renderTracked&#x27;, [e]) watcherOptions.onTrigger = e =&gt; callHook(vm, &#x27;renderTriggered&#x27;, [e]) &#125; // we set this to vm._watcher inside the watcher&#x27;s constructor // since the watcher&#x27;s initial patch may call $forceUpdate (e.g. inside child // component&#x27;s mounted hook), which relies on vm._watcher being already defined new Watcher( vm, updateComponent, noop, watcherOptions, true /* isRenderWatcher */ ) hydrating = false // flush buffer for flush: &quot;pre&quot; watchers queued in setup() const preWatchers = vm._preWatchers if (preWatchers) &#123; for (let i = 0; i &lt; preWatchers.length; i++) &#123; preWatchers[i].run() &#125; &#125; // manually mounted instance, call mounted on self // mounted is called for render-created child components in its inserted hook if (vm.$vnode == null) &#123; vm._isMounted = true callHook(vm, &#x27;mounted&#x27;) &#125; return vm&#125; å°†ä¼ å…¥çš„èŠ‚ç‚¹æŒ‚è½½ vm.$elä¸Šã€‚ åˆ¤æ–­æ˜¯å¦æœ‰ renderæ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰renderæ–¹æ³•åˆ™ä¼šèµ‹äºˆrenderæ–¹æ³•ä¸€ä¸ªåˆ›å»ºç©º VNodeçš„æ–¹æ³•ä»¥åŠæç¤ºå¦åˆ™ã€‚æœ‰åˆ™ç»§ç»­å‘ä¸‹æ‰§è¡Œä»£ç ã€‚ è°ƒç”¨ beforeMounté’©å­ å®šä¹‰updateComponentæ–¹æ³•ï¼Œå…¶ä¸­æ ¹æ®æ˜¯å¦é…ç½®æ€§èƒ½é…ç½®åœ¨è¯¥æ–¹æ³•ä¸­æ‰“äº†ä¸€ä¸ªæ€§èƒ½ tagã€‚ ä¼ å…¥updateComponentæ–¹æ³•å¹¶å®ä¾‹åŒ– Watcherï¼Œåœ¨å®ä¾‹åŒ–æ—¶ä¼šæ‰§è¡Œä¼ å…¥çš„updateComponentæ–¹æ³•ã€‚ åˆ¤æ–­$vnodeæ˜¯å¦æœ‰å€¼ï¼Œæœ‰å€¼åˆ™è°ƒç”¨ mountedæ–¹æ³•ã€‚ è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº†æŒ‚è½½é˜¶æ®µçš„æºç é˜…è¯»ã€‚ å®é™…ä¸Š updateComponent å°±æ˜¯çœŸæ­£æ¸²æŸ“å’ŒæŒ‚è½½èŠ‚ç‚¹çš„åœ°æ–¹ã€‚ 1updateComponent = vm._update(vm._render()) æˆ‘ä»¬æ¥ç”»ä¸ªæµç¨‹å›¾æ¥åŠ æ·±å·©å›ºä¸€ä¸‹æ•´ä¸ªæ¸²æŸ“æµç¨‹ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡ºæ¥ã€‚ Vueæ¸²æŸ“å¤§ä½“ä¸Šåˆ†ä¸º 2 æ­¥ï¼š è°ƒç”¨vm._renderæ–¹æ³•è·å– vnodeã€‚ è°ƒç”¨vm._updateå°†è·å–åˆ°çš„ vnodeæ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ å››ã€è°ƒç”¨_renderæ–¹æ³•æ¥è·å– vnode123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869Vue.prototype._render = function (): VNode &#123; const vm: Component = this const &#123; render, _parentVnode &#125; = vm.$options if (_parentVnode &amp;&amp; vm._isMounted) &#123; vm.$scopedSlots = normalizeScopedSlots( vm.$parent!, _parentVnode.data!.scopedSlots, vm.$slots, vm.$scopedSlots ) if (vm._slotsProxy) &#123; syncSetupSlots(vm._slotsProxy, vm.$scopedSlots) &#125; &#125; // set parent vnode. this allows render functions to have access // to the data on the placeholder node. vm.$vnode = _parentVnode! // render self const prevInst = currentInstance const prevRenderInst = currentRenderingInstance let vnode try &#123; setCurrentInstance(vm) currentRenderingInstance = vm vnode = render.call(vm._renderProxy, vm.$createElement) &#125; catch (e: any) &#123; handleError(e, vm, `render`) // return error render result, // or previous vnode to prevent render error causing blank component /* istanbul ignore else */ if (__DEV__ &amp;&amp; vm.$options.renderError) &#123; try &#123; vnode = vm.$options.renderError.call( vm._renderProxy, vm.$createElement, e ) &#125; catch (e: any) &#123; handleError(e, vm, `renderError`) vnode = vm._vnode &#125; &#125; else &#123; vnode = vm._vnode &#125; &#125; finally &#123; currentRenderingInstance = prevRenderInst setCurrentInstance(prevInst) &#125; // if the returned array contains only a single node, allow it if (isArray(vnode) &amp;&amp; vnode.length === 1) &#123; vnode = vnode[0] &#125; // return empty vnode in case the render function errored out if (!(vnode instanceof VNode)) &#123; if (__DEV__ &amp;&amp; isArray(vnode)) &#123; warn( &#x27;Multiple root nodes returned from render function. Render function &#x27; + &#x27;should return a single root node.&#x27;, vm ) &#125; vnode = createEmptyVNode() &#125; // set parent vnode.parent = _parentVnode return vnode &#125; å¯ä»¥çœ‹å‡ºæ¥_renderæ–¹æ³•å°±æ˜¯è·å–é€‰é¡¹ä¸Šçš„renderå‡½æ•°å¹¶æ‰§è¡Œï¼Œå°±å¯ä»¥è·å–vnodeäº†ã€‚ renderå‡½æ•°çš„å…·ä½“é€»è¾‘åœ¨ä¸Šä¸€ç« ä¸­æˆ‘ä»¬ä¹Ÿäº†è§£çš„å·®ä¸å¤šäº†ã€‚ å°±æ˜¯é€šè¿‡å†…éƒ¨çš„ createElement å‡½æ•°æ¥åˆ›å»ºVNodeã€‚ äº”ã€è°ƒç”¨_updateæ–¹æ³•æ¥è¿›è¡Œæ¸²æŸ“_updateæ–¹æ³•è¢«å®šä¹‰åœ¨lifecycleMixinæ–¹æ³•ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) &#123; const vm: Component = this const prevEl = vm.$el const prevVnode = vm._vnode const restoreActiveInstance = setActiveInstance(vm) vm._vnode = vnode // Vue.prototype.__patch__ is injected in entry points // based on the rendering backend used. if (!prevVnode) &#123; // initial render vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */) &#125; else &#123; // updates vm.$el = vm.__patch__(prevVnode, vnode) &#125; restoreActiveInstance() // update __vue__ reference if (prevEl) &#123; prevEl.__vue__ = null &#125; if (vm.$el) &#123; vm.$el.__vue__ = vm &#125; // if parent is an HOC, update its $el as well let wrapper: Component | undefined = vm while ( wrapper &amp;&amp; wrapper.$vnode &amp;&amp; wrapper.$parent &amp;&amp; wrapper.$vnode === wrapper.$parent._vnode ) &#123; wrapper.$parent.$el = wrapper.$el wrapper = wrapper.$parent &#125; // updated hook is called by the scheduler to ensure that children are // updated in a parent&#x27;s updated hook. &#125; 5.1 é€šè¿‡vm._vnodeæ¥åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ¬¡æ¸²æŸ“_updateæ–¹æ³•çš„æ‰§è¡Œç›´æ¥æœ‰ 2 ä¸ªï¼š1.åˆæ¬¡æ¸²æŸ“ã€2.æ›´æ–°æ¸²æŸ“ã€‚color:orangeã€‚ åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œä¼šå°†å½“å‰ä¼ å…¥çš„ vnodeèµ‹å€¼ç»™ vm._vnodeã€‚ è€Œåœ¨åšæ­¤æ“ä½œå‰ï¼Œä¼šè·å–vm._vnodeæ„å‘³ä¸Šä¸€æ¬¡æ¸²æŸ“çš„ vnodeã€‚ é‚£ä¹ˆåœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼ŒprevVnodeè¿™ä¸ªå€¼æ˜¯ç©ºçš„ã€‚ æ‰€ä»¥å°±å¯ä»¥æ ¹æ®è¿™ä¸ªå€¼æ¥åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ¬¡æ¸²æŸ“ã€‚ å¦‚æœæ˜¯åˆæ¬¡æ¸²æŸ“ï¼Œè°ƒç”¨__patch__å‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°åˆ†åˆ«ä¸º vm.$elã€vnodeã€‚ å¦‚æœæ˜¯æ›´æ–°æ¸²æŸ“ï¼Œè°ƒç”¨__patch__å‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°åˆ†åˆ«ä¸º prevVnodeã€vnodeã€‚ 5.2 vm.$elæ˜¯ä»€ä¹ˆvm.$elæ˜¯åœ¨ mountComponentå‡½æ•°ä¸­èµ‹å€¼çš„ã€‚ ä¹Ÿå°±æ˜¯æ‰§è¡Œ$mountæ–¹æ³•ä¸­ä¼ å…¥çš„æŒ‚è½½çš„èŠ‚ç‚¹ã€‚ 1vm.$mount(&#x27;#app&#x27;) æ‰€ä»¥åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œvm.$elå°±æ˜¯çœŸå®çš„ DOMèŠ‚ç‚¹ã€‚ 5.3 patchè¯¥æ–¹æ³•æ˜¯é€šè¿‡createPatchFunctionå‡½æ•°æ¥åˆ›å»ºçš„ã€‚ æ‰€ä»¥ createPatchFunctionå‡½æ•°è¿”å›äº†ä¸€ä¸ªå‡½æ•°ã€‚ 1export const patch: Function = createPatchFunction(&#123; nodeOps, modules &#125;) nodeOpsæ˜¯æµè§ˆå™¨æ“ä½œDOMçš„ç›¸å…³æ–¹æ³•ã€‚å¦‚åˆ é™¤ DOMã€æ·»åŠ  DOMç­‰ã€‚ modulesä¸­å­˜åœ¨äº†ä¸€äº›å¤„ç† DOM å±æ€§çš„æ–¹æ³•ã€‚å¦‚è®¾ç½®æ ·å¼ç­‰ã€‚ 5.4 createPatchFunction5.4.1 ç¬¬ä¸€ä¸ªå‚æ•°oldVNodeå’Œç¬¬äºŒä¸ªå‚æ•°vnode12345function createPatchFunction()&#123; return function patch(oldVnode,vnode)&#123; // xxx &#125;&#125; å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯oldVnodeï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ vnodeã€‚ oldVnodeè¡¨ç¤ºæ—§çš„ vnodeã€‚ Vueåœ¨æ›´æ–°æ¸²æŸ“æ—¶ï¼Œä¼šè¿›è¡ŒåŒç«¯ diffå¯¹æ¯”ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦è·å–æ—§çš„ vnodeè¿›è¡Œå¯¹æ¯”ã€‚ å› ä¸ºè¿™ä¸ªå‡½æ•°æ—¶åˆæ¬¡æ¸²æŸ“å’Œæ›´æ–°æ¸²æŸ“çš„é€šç”¨å‡½æ•°ã€‚ è€Œå‰é¢æˆ‘ä»¬è¯´åˆ°åœ¨å¤„ç†æ¸²æŸ“æ—¶ä¼ é€’çš„æ˜¯ vm.$elï¼Œè¿™ä»£è¡¨æŒ‚è½½çš„èŠ‚ç‚¹ã€‚ æ‰€ä»¥å¯¹äºåˆæ¬¡æ¸²æŸ“ï¼ˆå°†è™šæ‹ŸèŠ‚ç‚¹æ¸²æŸ“åˆ°çœŸå®èŠ‚ç‚¹ï¼‰æ¥è¯´ï¼Œæ—§èŠ‚ç‚¹è¡¨ç¤ºçœŸå®çš„èŠ‚ç‚¹ã€‚ å®é™…ä¸ŠæŒ‚è½½èŠ‚ç‚¹ç›¸å½“äºä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹ï¼Œä¼šæ ¹æ®ä»–çš„ä½ç½®è¿›è¡ŒæŒ‚è½½èŠ‚ç‚¹ï¼ŒæŒ‚è½½èŠ‚ç‚¹åœ¨åˆæ¬¡æ¸²æŸ“åå°±ä¼šè¢«åˆ é™¤ã€‚ 5.4.2 å¤„ç†æ—§èŠ‚ç‚¹çš„é”€æ¯å¦‚æœæ—§çš„è™šæ‹ŸèŠ‚ç‚¹å­˜åœ¨ï¼Œä½†æ˜¯æ–°çš„è™šæ‹ŸèŠ‚ç‚¹ä¸å­˜åœ¨ã€‚ åˆ™è¡¨ç¤ºè¯¥èŠ‚ç‚¹å¯èƒ½ç”±äºæ¡ä»¶æ¸²æŸ“ï¼ˆv-ifï¼‰è¢«ç§»é™¤ï¼Œè¿™æ—¶å€™è°ƒç”¨invokeDestroyHookå‡½æ•°ï¼Œç¡®ä¿æ—§èŠ‚ç‚¹è¢«æ­£ç¡®çš„é”€æ¯å’Œæ¸…ç†ã€‚ å¦‚æœæ–°èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™ç»ˆæ­¢å½“å‰çš„ patchæ“ä½œã€‚ è¿™æ˜¯å› ä¸ºæ²¡æœ‰æ–°çš„èŠ‚ç‚¹éœ€è¦æ¸²æŸ“ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦ç»§ç»­æ‰§è¡Œæ›´æ–° DOMçš„æ“ä½œã€‚ 1234if (isUndef(vnode)) &#123; if (isDef(oldVnode)) invokeDestroyHook(oldVnode) return&#125; 5.4.3 åˆ¤æ–­æ—§çš„vnodeæ˜¯å¦æ˜¯çœŸå®èŠ‚ç‚¹å› ä¸ºåœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œæ—§çš„ vnodeæ˜¯æŒ‚è½½å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçœŸå® DOMã€‚ è€Œ patchå†…éƒ¨çš„å¤„ç†åŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäºè™šæ‹Ÿ DOMæ¥å¤„ç†çš„ã€‚ æ‰€ä»¥éœ€è¦å°†çœŸå® DOMé€šè¿‡emptyNodeAtå‡½æ•°åŒ…è£…æˆè™šæ‹Ÿ DOMã€‚ 123function emptyNodeAt(elm) &#123; return new VNode(nodeOps.tagName(elm).toLowerCase(), &#123;&#125;, [], undefined, elm)&#125; å°†è™šæ‹ŸèŠ‚ç‚¹çš„elmå±æ€§æŒ‡å‘ä¼ å…¥çš„domèŠ‚ç‚¹ã€‚ 5.4.4 createElmåˆ›å»ºå­èŠ‚ç‚¹åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒæ›´æ–°çš„é€»è¾‘ã€‚ åªéœ€è¦å°†æœ€æ–°çš„ vnodeæ¸²æŸ“åˆ°é¡µé¢ä¸Šå³å¯ã€‚ ç›´æ¥è°ƒç”¨ createElmæ–¹æ³•ã€‚ 5.4.4.1 åˆ›å»ºDOMå…ƒç´ 1234567891011121314151617181920212223export function createElm( vnode, parentElm, refElm)&#123; const tag = vnode.tag; const children = vnode.children; if(isDef(tag))&#123; vnode.elm = nodeOps.createElement(tag); createChildren(vnode, children); &#125;&#125;export function createChildren(vnode, children)&#123; if(isArray(children))&#123; createElm( children[i], vnode.elm, null ) &#125;&#125; å¯ä»¥çœ‹åˆ°createElmæ–¹æ³•ä¸­è°ƒç”¨äº†document.createElementåˆ›å»ºäº† DOMå…ƒç´ å¹¶å°†åˆ›å»ºçš„å…ƒç´ èµ‹å€¼ç»™è™šæ‹ŸèŠ‚ç‚¹çš„ elmå±æ€§ä¸­ã€‚ 5.4.4.2 æ‰§è¡Œ insetæ–¹æ³•å°†åˆ›å»ºçš„ DOMæŒ‚è½½åˆ°çˆ¶èŠ‚ç‚¹ä¸Š12345678910111213insert(parentElm, vnode.elm, refElm)function insert(parent, elm, ref) &#123; if (isDef(parent)) &#123; if (isDef(ref)) &#123; if (nodeOps.parentNode(ref) === parent) &#123; nodeOps.insertBefore(parent, elm, ref) &#125; &#125; else &#123; nodeOps.appendChild(parent, elm) &#125; &#125;&#125; å¦‚æœæœ‰ refèŠ‚ç‚¹ï¼Œåˆ™è°ƒç”¨ insetBeforeæ’å…¥ refèŠ‚ç‚¹ä¹‹å‰ã€‚ å¦åˆ™è°ƒç”¨ appendChild ç›´æ¥æ’å…¥æ•°ç»„æœ€åé¢ã€‚ 5.4.4.3 åˆæ¬¡æ¸²æŸ“æ—¶éœ€è¦åˆ é™¤æ—§èŠ‚ç‚¹èŠ‚ç‚¹åˆæ¬¡æŒ‚è½½åï¼Œéœ€è¦å°†æ—§çš„èŠ‚ç‚¹ç»™åˆ é™¤æ‰ã€‚ 123456// destroy old nodeif (isDef(parentElm)) &#123; removeVnodes([oldVnode], 0, 0)&#125; else if (isDef(oldVnode.tag)) &#123; invokeDestroyHook(oldVnode)&#125; å…­ã€æ€»ç»“æˆ‘ä»¬è¿™ç¯‡ä¸­ç®€å•ä»‹ç»äº†åˆæ¬¡æŒ‚è½½æ—¶çš„å¤§æ¦‚æµç¨‹ã€‚ å®é™…ä¸Šå°±æ˜¯é€šè¿‡æµè§ˆå™¨çš„ä¸€äº› APIå¦‚createElementã€appendChildæ¥åˆ›å»ºçœŸå® DOMã€‚ å…¶ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›ç»†èŠ‚å¹¶æ²¡æœ‰åšè¯¦ç»†é˜è¿°ï¼Œæ¯”å¦‚è¯´ç»„ä»¶çš„å¤„ç†ï¼Œæ ·å¼äº‹ä»¶å±æ€§çš„æ³¨å†Œç­‰ã€‚ åœ¨åé¢çš„æ–‡ç« ä¸­æˆ‘ä»¬ä¼šä¸€ä¸€ç»™å¤§å®¶è§£ç­”ã€‚"},{"title":"ğŸ”¥Vue2æ¸²æŸ“åŸºç¡€-è™šæ‹ŸDOM","path":"//posts/vue2-vnode.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬å…­ç¯‡-è™šæ‹ŸèŠ‚ç‚¹ä»¥åŠcreateElementå‡½æ•° åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Vueåˆå§‹åŒ–çš„ä¸€ç³»åˆ—æ“ä½œã€‚ å¯ä»¥Vueç»ˆå½’åªæ˜¯ä¸ºäº†ç”»é¡µé¢ã€‚ åé¢çš„ç« èŠ‚å°±å¸¦ç€å¤§å®¶æ¥è§£ææ¸²æŸ“ç›¸å…³çš„é€»è¾‘ï¼Œä¸€æ­¥ä¸€æ­¥è§£æVueæ˜¯å¦‚ä½•å°†æ¨¡æ¿æŒ‚è½½åˆ°é¡µé¢ä¸Šçš„ã€‚ ä½†æ˜¯åœ¨è§£ææ¸²æŸ“ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Vueæ¡†æ¶æ¸²æŸ“çš„åŸºç¡€-è™šæ‹Ÿ DOMã€‚ ä¸€ã€æ¸²æŸ“å™¨çš„æ¸²æŸ“æµç¨‹åœ¨è®¨è®ºè™šæ‹ŸèŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æµè§ˆå™¨æ¸²æŸ“çš„æµç¨‹ã€‚ å½“æµè§ˆå™¨æ¥æ”¶åˆ°ä¸€ä¸ª HTML æ–‡ä»¶åï¼ŒJavaScript å¼•æ“ä¸æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“éšå³å¼€å§‹è¿è¡Œã€‚ ä»æ¸²æŸ“å¼•æ“çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒé¦–å…ˆä¼šæŠŠ HTML æ–‡ä»¶è§£æä¸ºä¸€ä¸ª DOM æ ‘ã€‚ ä¸æ­¤åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šè¯†åˆ«å¹¶åŠ è½½ CSS æ ·å¼ï¼Œç„¶åå°†å…¶ä¸ DOM æ ‘åˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚ åœ¨æœ‰äº†æ¸²æŸ“æ ‘ä¹‹åï¼Œæ¸²æŸ“å¼•æ“ä¼šè®¡ç®—æ‰€æœ‰å…ƒç´ çš„ä½ç½®ä¿¡æ¯ï¼Œæœ€åé€šè¿‡ç»˜åˆ¶æ“ä½œï¼Œåœ¨å±å¹•ä¸Šå‘ˆç°å‡ºæœ€ç»ˆçš„å†…å®¹ã€‚ JavaScript å¼•æ“å’Œæ¸²æŸ“å¼•æ“è™½ç„¶å¤„äºä¸¤ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¹‹ä¸­ï¼Œç„¶è€Œ JavaScript å¼•æ“å´èƒ½å¤Ÿè§¦å‘æ¸²æŸ“å¼•æ“å¼€å§‹å·¥ä½œã€‚ å½“æˆ‘ä»¬å€ŸåŠ©è„šæœ¬å»æ›´æ”¹å…ƒç´ çš„ä½ç½®æˆ–è€…å¤–è§‚æ—¶ï¼ŒJavaScript å¼•æ“ä¼šè¿ç”¨ä¸ DOM ç›¸å…³çš„ API æ–¹æ³•æ¥æ“ä½œ DOM å¯¹è±¡ã€‚ æ­¤æ—¶æ¸²æŸ“å¼•æ“ä¾¿å¼€å§‹è¿ä½œï¼Œæ¸²æŸ“å¼•æ“ä¼šè§¦å‘å›æµæˆ–è€…é‡ç»˜æ“ä½œã€‚ æˆ‘ä»¬æ¥äº†è§£ä¸‹å›æµä»¥åŠé‡ç»˜çš„æ¦‚å¿µï¼š å›æµï¼šå½“æˆ‘ä»¬å¯¹DOMçš„ä¿®æ”¹å¼•å‘äº†å…ƒç´ å°ºå¯¸çš„å˜åŒ–æ—¶ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼Œæœ€åå°†é‡æ–°è®¡ç®—çš„ç»“æœç»˜åˆ¶å‡ºæ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›æµã€‚ é‡ç»˜ï¼šå½“æˆ‘ä»¬å¯¹DOMçš„ä¿®æ”¹åªå•çº¯æ”¹å˜å…ƒç´ çš„é¢œè‰²æ—¶ï¼Œæµè§ˆå™¨æ­¤æ—¶å¹¶ä¸éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼Œè€Œåªè¦é‡æ–°ç»˜åˆ¶æ–°æ ·å¼ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé‡ç»˜ã€‚ å¾ˆæ˜¾ç„¶ï¼Œå›æµæ¯”èµ·é‡ç»˜æ›´åŠ æ¶ˆè€—æ€§èƒ½ã€‚ é€šè¿‡äº†è§£æµè§ˆå™¨åŸºæœ¬çš„æ¸²æŸ“æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸éš¾è”æƒ³åˆ°ï¼Œå½“ä¸æ–­åœ°é€šè¿‡ JavaScript ä¿®æ”¹ DOM æ—¶ï¼Œå¾ˆå®¹æ˜“åœ¨ä¸ç»æ„é—´è§¦å‘æ¸²æŸ“å¼•æ“çš„å›æµæˆ–è€…é‡ç»˜ï¼Œè€Œè¿™ç§æ“ä½œæ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€æ˜¯éå¸¸å·¨å¤§çš„ã€‚ å› æ­¤ï¼Œä¸ºäº†é™ä½æ€§èƒ½å¼€é”€ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°½å¯èƒ½åœ°å‡å°‘å¯¹ DOM çš„æ“ä½œã€‚ è™šæ‹ŸèŠ‚ç‚¹å°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹å­•è‚²è€Œç”Ÿã€‚ äºŒ. ç¼“å†²å±‚-è™šæ‹ŸDOMè™šæ‹Ÿ DOM ï¼ˆVirtual DOM ä»¥ä¸‹ç®€ç§° VDOMï¼‰æ˜¯ä¸ºäº†è§£å†³é¢‘ç¹æ“ä½œ DOM æ‰€å¼•å‘çš„æ€§èƒ½é—®é¢˜è€Œäº§ç”Ÿçš„äº§ç‰©ã€‚ VDOMæ˜¯æŠŠé¡µé¢çš„çŠ¶æ€æŠ½è±¡æˆ JS å¯¹è±¡çš„å½¢å¼å‘ˆç°ã€‚ ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒå¤„äº JS ä¸çœŸå® DOM ä¹‹é—´ï¼Œèµ·ç€ä¸­é—´å±‚çš„ä½œç”¨ã€‚ å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ JS è„šæœ¬è¿›è¡Œå¤§æ‰¹é‡çš„ DOM æ“ä½œæ—¶ï¼Œä¼šä¼˜å…ˆåœ¨è™šæ‹Ÿ VDOM è¿™ä¸ª JS å¯¹è±¡ä¸Šè¿›è¡Œæ“ä½œã€‚ æœ€åï¼Œé€šè¿‡å¯¹æ¯”æ‰¾å‡ºå°†è¦æ”¹åŠ¨çš„éƒ¨åˆ†ï¼Œå¹¶å°†è¿™äº›æ”¹åŠ¨é€šçŸ¥å¹¶æ›´æ–°åˆ°çœŸå®çš„ DOM ä¸Šã€‚ å°½ç®¡æœ€ç»ˆä»ç„¶æ˜¯å¯¹çœŸå®çš„ DOM è¿›è¡Œæ“ä½œï¼Œç„¶è€Œè™šæ‹Ÿ DOM èƒ½å¤Ÿå°†å¤šä¸ªæ”¹åŠ¨åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹é‡æ“ä½œã€‚ è¿™æ ·åšå¯ä»¥å‡å°‘ DOM é‡æ’çš„æ¬¡æ•°ï¼Œè¿›è€Œç¼©çŸ­ç”Ÿæˆæ¸²æŸ“æ ‘ä»¥åŠè¿›è¡Œç»˜åˆ¶æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªçœŸå®çš„ DOM å…·ä½“åŒ…å«äº†å“ªäº›å†…å®¹ã€‚ æµè§ˆå™¨å°†çœŸå®çš„ DOM è®¾è®¡å¾—æä¸ºå¤æ‚ã€‚ å®ƒä¸ä½†åŒ…å«äº†è‡ªèº«çš„å±æ€§æè¿°ï¼Œå¦‚å¤§å°ã€ä½ç½®ç­‰å®šä¹‰ï¼Œè¿˜å›Šæ‹¬äº† DOM æ‰€æ‹¥æœ‰çš„æµè§ˆå™¨äº‹ä»¶ç­‰å†…å®¹ã€‚ æ­£æ˜¯ç”±äºå…¶å¦‚æ­¤å¤æ‚çš„ç»“æ„ï¼Œæˆ‘ä»¬é¢‘ç¹åœ°å»æ“ä½œ DOM æˆ–å¤šæˆ–å°‘ä¼šç»™æµè§ˆå™¨å¸¦æ¥æ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚ è€Œä½œä¸ºæ•°æ®ä¸çœŸå® DOM ä¹‹é—´çš„ä¸€å±‚ç¼“å†²ï¼Œè™šæ‹Ÿ DOM åªæ˜¯ç”¨äºæ˜ å°„åˆ°çœŸå® DOM è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åŒ…å«æ“ä½œ DOM çš„æ–¹æ³•ã€‚ å®ƒåªéœ€åœ¨å¯¹è±¡ä¸­é‡ç‚¹å…³æ³¨å‡ ä¸ªå±æ€§å°±å¯ä»¥äº†ã€‚ ä¸‰ã€ VNode12345678910111213141516171819// çœŸå®DOM&lt;div id=&quot;app&quot;&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;/div&gt;// çœŸå®DOMå¯¹åº”çš„JSå¯¹è±¡(VNode)&#123; tag:&#x27;div&#x27;, data:&#123; id:&#x27;app&#x27; &#125;, children:[&#123; tag:&#x27;span&#x27;, children:[ &#123; tag:undefined, text:&#x27;Hello World&#x27; &#125; ] &#125;]&#125; é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥æ¯ä¸€ä¸ª DOMèŠ‚ç‚¹ éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ª VNode æ¥è¡¨ç¤ºã€‚ åœ¨ Vueå†…éƒ¨ï¼Œä½¿ç”¨ VNode è¿™ä¸ªæ„é€ å‡½æ•°å»æè¿°ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071export default class VNode &#123; tag?: string data: VNodeData | undefined children?: Array&lt;VNode&gt; | null text?: string elm: Node | undefined ns?: string context?: Component // rendered in this component&#x27;s scope key: string | number | undefined componentOptions?: VNodeComponentOptions componentInstance?: Component // component instance parent: VNode | undefined | null // component placeholder node // strictly internal raw: boolean // contains raw HTML? (server only) isStatic: boolean // hoisted static node isRootInsert: boolean // necessary for enter transition check isComment: boolean // empty comment placeholder? isCloned: boolean // is a cloned node? isOnce: boolean // is a v-once node? asyncFactory?: Function // async component factory function asyncMeta: Object | void isAsyncPlaceholder: boolean ssrContext?: Object | void fnContext: Component | void // real context vm for functional nodes fnOptions?: ComponentOptions | null // for SSR caching devtoolsMeta?: Object | null // used to store functional render context for devtools fnScopeId?: string | null // functional scope id support isComponentRootElement?: boolean | null // for SSR directives constructor( tag?: string, data?: VNodeData, children?: Array&lt;VNode&gt; | null, text?: string, elm?: Node, context?: Component, componentOptions?: VNodeComponentOptions, asyncFactory?: Function ) &#123; this.tag = tag this.data = data this.children = children this.text = text this.elm = elm this.ns = undefined this.context = context this.fnContext = undefined this.fnOptions = undefined this.fnScopeId = undefined this.key = data &amp;&amp; data.key this.componentOptions = componentOptions this.componentInstance = undefined this.parent = undefined this.raw = false this.isStatic = false this.isRootInsert = true this.isComment = false this.isCloned = false this.isOnce = false this.asyncFactory = asyncFactory this.asyncMeta = undefined this.isAsyncPlaceholder = false &#125; // DEPRECATED: alias for componentInstance for backwards compat. /* istanbul ignore next */ get child(): Component | void &#123; return this.componentInstance &#125;&#125; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ new å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ª VNodeã€‚ 12345678// åˆ›å»ºä¸€ä¸ªdivçš„ vnodenew VNode(&#x27;div&#x27;,&#123;&#125;,&#x27;Hello World&#x27;)// åˆ›å»ºä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„ vnodenew VNode(&#x27;div&#x27;,&#123;&#125;,[ new VNode(&#x27;span&#x27;,&#123;&#125;,&#x27;1&#x27;), new VNode(&#x27;span&#x27;,&#123;&#125;,&#x27;2&#x27;), new VNode(&#x27;span&#x27;,&#123;&#125;,&#x27;3&#x27;)]) VNodeè¿™ä¸ªæ„é€ å‡½æ•°ä¸Šæœ‰éå¸¸å¤šçš„å±æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆåˆ—ä¸¾å››ä¸ªå¸¸ç”¨çš„å±æ€§ï¼štagã€dataã€childrenã€textã€‚ å…¶ä½™å±æ€§åœ¨æˆ‘ä»¬åé¢çš„è§£æä¸­ä¼šä¸€ä¸€è¿›è¡Œè§£æã€‚ 3.1 tagå±æ€§tagè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ ‡ç­¾åç§°ã€‚ å†³å®šäº†æœ€ç»ˆä¼šæ¸²æŸ“æˆä»€ä¹ˆæ ·çš„ DOMå…ƒç´ ã€‚ tagå¯ä»¥æ˜¯ HTML å…ƒç´ ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²spanã€'div'ã€‚ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶å¼•ç”¨ï¼ŒåŒæ ·å¯ä»¥æ˜¯ä¸€ä¸ªåŠ¨æ€æ ‡ç­¾ã€‚ 123456789101112// ç¼–è¯‘å‰ï¼ˆæ™®é€šèŠ‚ç‚¹ï¼‰&lt;div&gt;&lt;/div&gt; // ç¼–è¯‘åVNode &#123; tag:&quot;div&quot;&#125;// ç¼–è¯‘å‰ï¼ˆç»„ä»¶èŠ‚ç‚¹ï¼‰&lt;CustomComponent&gt;&lt;/CustomComponent&gt; // ç¼–è¯‘åVNode &#123; tag:&quot;CustomComponent&quot;&#125; 3.2 dataå±æ€§data å‚æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ç”¨äºæè¿° VNode çš„å„ç§å±æ€§å’Œé…ç½®ä¿¡æ¯ã€‚ data å‚æ•°å¯ä»¥ç”±ä»¥ä¸‹å‡ ç§æ„æˆï¼š attrs:è¡¨ç¤ºå…ƒç´ çš„ä¸Šé™æ€å±æ€§ï¼Œå¦‚srcã€altç­‰ã€‚ staicClass:è¡¨ç¤ºå…ƒç´ ä¸Šçš„é™æ€cssç±»ã€‚ style:è¡¨ç¤ºå…ƒç´ ä¸Šçš„å†…è”æ ·å¼ã€‚ on:è¡¨ç¤ºå…ƒç´ ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨ã€‚ slot:è¡¨ç¤ºä½œç”¨åŸŸæ’æ§½æˆ–æ™®é€šæ’æ§½çš„ä½ç½®ã€‚ props:è¡¨ç¤ºä¼ é€’ç»„ä»¶çš„ props æ•°æ®ã€‚ directives:è¡¨ç¤ºæ·»åŠ çš„è‡ªå®šä¹‰çš„è¡Œä¸ºï¼Œå¦‚ v-modelã€v-showç­‰ã€‚ key:è¡¨ç¤ºç»„ä»¶å”¯ä¸€æ ‡è¯†ã€‚ 3.3 childrenchildren å‚æ•°æ˜¯æŒ‡å®šä¸€ä¸ª VNodeï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰çš„å­èŠ‚ç‚¹å†…å®¹ã€‚ è¿™ä¸ªå‚æ•°å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼Œç”¨äºæè¿°å­èŠ‚ç‚¹çš„ç»“æ„å’Œå†…å®¹ã€‚ 3.4 textæˆ‘ä»¬çŸ¥é“å¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰tagçš„ï¼Œæ¯”å¦‚æ–‡å­—èŠ‚ç‚¹å°±æ²¡æœ‰tagã€‚ åœ¨Vueä¸­ï¼Œæ–‡å­—ä¹Ÿä»£è¡¨ä¸€ä¸ªvnodeã€‚ 123456// ç¼–è¯‘å‰&quot;æˆ‘æ˜¯&quot; // ç¼–è¯‘åVNode &#123; text:&quot;æˆ‘æ˜¯&quot;&#125; 3.1.5 elmæˆ‘ä»¬çŸ¥é“åœ¨æ¸²æŸ“æ—¶ä¼šæ ¹æ® VNode åˆ›å»ºDOMå…ƒç´ ã€‚ æ¸²æŸ“åæ¯ä¸ªVNodeèŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„çœŸå® DOMå…ƒç´ ã€‚ è€Œè¿™ä¸ª elm å°±æŒ‡å‘è¿™ä¸ªçœŸå® DOMå…ƒç´ ã€‚ å››. createElementå‡½æ•°ç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“è™šæ‹ŸDOMå°±æ˜¯ä¸€ä¸ªJSå¯¹è±¡ï¼Œåªä¸è¿‡ä»–æœ‰å¾ˆå¤šå±æ€§ã€‚ æ‰€ç¤ºè¯´åˆ›å»ºä¸€ä¸ªè™šæ‹ŸDOMä¹Ÿç»ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œä½†æ˜¯ Vue æ¡†æ¶ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå‡½æ•°createElementã€‚ è¿™ä¸ªå‡½æ•°å¯ä»¥æ›´æ–¹ä¾¿çš„å¸®æˆ‘ä»¬ç”Ÿæˆè™šæ‹Ÿ DOMï¼Œåœ¨å…¶ä¸­ç£¨å¹³äº†ä¸€äº›ç»†èŠ‚ã€‚ å®ƒè¢«å®šä¹‰åœ¨ src/core/vdom/create-element.js ä¸­ï¼š 4.1 createElementåœ¨å¼€å‘æ—¶çš„ä½¿ç”¨åœºæ™¯äº†è§£createElementçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›å¯¹çœ‹æºç æ˜¯æœ‰ä¸€å®šçš„å¸®åŠ©çš„ã€‚ æœ‰åœºæ™¯å¸¦å…¥æºç æ‰çŸ¥é“å¯¹åº”çš„é€»è¾‘æ˜¯åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™ä½ å…‰çœ‹æºç ï¼Œå¯¹äºä¸€äº›é€»è¾‘ä½ æ˜¯æ— æ³•çœ‹æ‡‚çš„ã€‚ 4.1.1 webpackç¼–è¯‘æ—¶ä½¿ç”¨Vueæ¡†æ¶åº•å±‚æ¸²æŸ“æ—¶ä¼šè°ƒç”¨å®ä¾‹ä¸Šçš„_renderæ–¹æ³•ï¼Œè¿™ä¸ª renderæ–¹æ³•å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†å®ä¾‹é€‰é¡¹ä¸Šçš„ renderæ–¹æ³•ã€‚ 1vm._render =&gt; vm.$options.render ä½ å¯èƒ½ä¼šæœ‰äº›å›°æƒ‘ï¼Œå› ä¸ºå¹³æ—¶æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨.vueæ–‡ä»¶è¿›è¡Œå•é¡µé¢å¼€å‘ï¼Œæ²¡æœ‰å†™è¿‡ä»€ä¹ˆ renderæ–¹æ³•å•Šï¼Œé‚£è¿™ä¸ª renderæ–¹æ³•æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ å…¶å®æˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„ templateæ¨¡æ¿æ ‡ç­¾åœ¨ webpacké¢„ç¼–è¯‘é˜¶æ®µä¼šå˜æˆä¸€ä¸ªåˆ›å»ºvnodeçš„å‡½æ•°ã€‚ æ¯”å¦‚æˆ‘ä»¬åœ¨æ¨¡ç‰ˆä¸­ç¼–å†™ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼š 123&lt;template&gt; &lt;div&gt;hello world&lt;/div&gt;&lt;/template&gt; .vueæ–‡ä»¶åœ¨webpacké¢„ç¼–è¯‘æ—¶ä¼šè§£ææˆä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ¨¡æ¿éƒ¨åˆ†åˆ™ä¼šç¼–è¯‘æˆ renderå‡½æ•°ã€‚ æ‰€ä»¥å¹³æ—¶æˆ‘ä»¬import Test from &quot;./Test&quot;ï¼Œè¿™é‡Œçš„Testæ‰“å°å‡ºæ¥æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ æˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿™é‡Œç¼–è¯‘çš„ renderæ–¹æ³•ï¼Œå‘ç°æ²¡æœ‰ä½¿ç”¨ createElementå‡½æ•°æ¥åˆ›å»ºèŠ‚ç‚¹ï¼Œè€Œä½¿ç”¨äº†_cã€‚ é‚£ä¹ˆè¿™é‡Œçš„_cä»£è¡¨ä»€ä¹ˆï¼Ÿ _cå®é™…ä¸Šæ˜¯åœ¨ vueåˆå§‹åŒ–æ—¶åœ¨initRenderæ–¹æ³•ä¸­æ³¨å…¥çš„ï¼Œæœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯è°ƒç”¨äº† createElementã€‚ 12// ç¬¬å…­ä¸ªå‚æ•°ä»£è¡¨æ˜¯å¦éœ€è¦è§„èŒƒåŒ–å­èŠ‚ç‚¹ è¿™é‡Œè¡¨ç¤ºä¸éœ€è¦ å› ä¸º webpack é¢„ç¼–è¯‘æ—¶ä¼šç¼–è¯‘å­èŠ‚ç‚¹vm._c = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, false) 4.1.2 ç”¨æˆ·è‡ªå®šä¹‰renderæ–¹æ³•æˆ‘ä»¬çŸ¥é“.vueæ–‡ä»¶ä¼šè¢«è§£ææˆä¸€ä¸ªå¯¹è±¡çš„å½¢å¼ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ª jsæ–‡ä»¶ï¼Œè‡ªå·±å®šä¹‰ renderæ–¹æ³•ã€‚Vueæä¾›äº†è¿™ç§èƒ½åŠ›ã€‚ æˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™ä¹ˆè‡ªå®šä¹‰å‡½æ•°ã€‚ 1234567&#123; render:(h)=&gt;&#123; return &#123; h(&#x27;div&#x27;,&#x27;hello world&#x27;) &#125; &#125;&#125; è€Œæºç ä¸­ä¼šå°† vm.$createElementä¼ å…¥ renderæ–¹æ³•ä¸­ã€‚ 12345try &#123; vnode = render.call(vm._renderProxy, vm.$createElement)&#125; catch (e: any) &#123; ///&#125; æ‰€ä»¥è¿™é‡Œçš„ vm.$createElementå°±æ˜¯hå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åˆ›å»º VNodeçš„å‡½æ•°ã€‚ $createElementå’Œ_cä¸€æ ·ä¹Ÿæ˜¯åœ¨vueåˆå§‹åŒ–æ—¶åœ¨initRenderæ–¹æ³•ä¸­æ³¨å…¥çš„ã€‚ 12// ç¬¬å…­ä¸ªå‚æ•°æ˜¯ true è¡¨ç¤ºéœ€è¦å¤„ç†å­èŠ‚ç‚¹ä¸º VNodeèŠ‚ç‚¹vm.$createElement = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, true) _cå’Œ$createElementçš„ä¸åŒä¹‹å¤„æ˜¯$createElementä¸­å¯¹äº createElementçš„ç¬¬å…­ä¸ªå‚æ•°ä¼ é€’çš„å€¼ä¸åŒã€‚ 4.2 createElementå‡½æ•°è§£æ123456789101112131415161718export function createElement( context: Component, tag: any, data: any, children: any, normalizationType: any, alwaysNormalize: boolean): VNode | Array&lt;VNode&gt; &#123; if (isArray(data) || isPrimitive(data)) &#123; normalizationType = children children = data data = undefined &#125; if (isTrue(alwaysNormalize)) &#123; normalizationType = ALWAYS_NORMALIZE &#125; return _createElement(context, tag, data, children, normalizationType)&#125; createElementçš„å‚æ•°åˆ†åˆ«æ˜¯ï¼š ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcontextï¼šè¡¨ç¤ºä¸Šä¸‹æ–‡ï¼Œä¸€èˆ¬è¿™é‡Œä¼ é€’çš„æ˜¯vueå®ä¾‹vmã€‚ ç¬¬äºŒä¸ªå‚æ•°ä¸º tagï¼šè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ ‡ç­¾ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º dataï¼šè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®ã€‚ ç¬¬å››ä¸ªå‚æ•°ä¸º childrenï¼šè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚ ç¬¬äº”ä¸ªå‚æ•°ä¸º normalizationTypeï¼šè¿™ä¸ªå‚æ•°å†³å®šè§„èŒƒåŒ–çš„ç±»å‹ã€‚ ç¬¬å…­ä¸ªå‚æ•°ä¸º alwaysNormalizeï¼šè¡¨ç¤ºæ˜¯å¦è§„èŒƒåŒ–å­èŠ‚ç‚¹ã€‚ createElement æ–¹æ³•å®é™…ä¸Šæ˜¯å¯¹ _createElement æ–¹æ³•çš„å°è£…ï¼Œå®ƒå…è®¸ä¼ å…¥çš„å‚æ•°æ›´åŠ çµæ´»ï¼Œåœ¨å¤„ç†è¿™äº›å‚æ•°åï¼Œè°ƒç”¨çœŸæ­£åˆ›å»º VNode çš„å‡½æ•° _createElementã€‚ 4.2.1 å¯¹ç¬¬äºŒä¸ªå‚æ•°åšå…¼å®¹1234// å­˜åœ¨ dataçš„æƒ…å†µcreateElement(context,&#x27;div&#x27;,&#123;style:&#123;color:&quot;red&quot;&#125;&#125;,&#x27;hello world&#x27;) // ä¸å­˜åœ¨ dataçš„æƒ…å†µcreateElement(context,&#x27;div&#x27;,null,&#x27;hello world&#x27;) å¦‚ä¸Šï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤º dataï¼Œç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºchildrenã€‚ è€Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¼ é€’ dataå±æ€§ï¼Œä½†æ˜¯ç”±äºå‚æ•°é¡ºåºçš„åŸå› ï¼Œä¾æ—§éœ€è¦ä¼ é€’ä¸€ä¸ªç©ºå¯¹è±¡æ¥è¿›è¡Œå ä½ã€‚ è¿™ä¸ªæ—¶å€™å‡½æ•°å†…éƒ¨å¯¹è¿™ä¸ªå‚æ•°è¿›è¡Œäº†å…¼å®¹å¤„ç†ã€‚ åˆ¤æ–­å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°ç»„æˆ–è€…åŸå§‹ç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•°å­—ç­‰ï¼‰ï¼Œåˆ™å°†å…¶ç¬¬ä¸‰ä¸ªå‚æ•°è§†ä¸ºæ˜¯ä¼ é€’çš„å­èŠ‚ç‚¹ã€‚ åŒæ—¶å°†dataç½®ä¸ºundefinedï¼ŒnormalizationTypeä½¿ç”¨ç¬¬å››ä¸ªå‚æ•°ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè°ƒç”¨ï¼Œä¸ç”¨å†ä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦äº†ã€‚ 12// ä¸å­˜åœ¨ dataçš„æƒ…å†µ ä¸éœ€è¦ä¼ é€’ dataè¿›è¡Œå ä½createElement(context,&#x27;div&#x27;,&#x27;hello world&#x27;) 4.2.2 å¯¹childrençš„è§„èŒƒåŒ–ç”±äºVNodeå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸€ä¸ªVNodeå¯èƒ½ä¼šæœ‰è‹¥å¹²ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™äº›å­èŠ‚ç‚¹åº”è¯¥ä¹Ÿæ˜¯ VNode çš„ç±»å‹ã€‚ _createElement æ¥æ”¶çš„ç¬¬ 4 ä¸ªå‚æ•° children æ˜¯ä»»æ„ç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬è§„èŒƒæˆ VNode ç±»å‹ã€‚ normalizationTypeçš„å€¼æœ‰ 2 ç§ï¼š SIMPLE_NORMALIZEï¼šå€¼ä¸º 1ï¼Œè¡¨ç¤ºç®€å•å¤„ç†å­èŠ‚ç‚¹ ALWAYS_NORMALIZEï¼šå€¼ä¸º 2ï¼Œè¡¨ç¤ºé€’å½’å¤„ç†æ‰€æœ‰å­èŠ‚ç‚¹ éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºrenderæ–¹æ³•ï¼ŒnormalizationTypeä¸€ç›´ä¸ºALWAYS_NORMALIZEã€‚è¡¨ç¤ºéœ€è¦è§„èŒƒå¤„ç†å­èŠ‚ç‚¹ã€‚ å› ä¸ºç”¨æˆ·æœ‰å¯èƒ½ä¸æ˜¯å¾ˆç†Ÿæ‚‰ createElementçš„ä½¿ç”¨æ–¹å¼å’Œ Vueçš„æ¸²æŸ“æœºåˆ¶å¯¼è‡´ä¸€äº›é”™è¯¯æƒ…å†µçš„å‘ç”Ÿï¼Œå¦‚ä¸‹ï¼š 12345678// å¦‚æœä¸è¿›è¡Œå¤„ç†ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ææœ‰å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜render(h)&#123; return h(&#x27;ul&#x27;,[ &quot;è‹¹æœ&quot;, &quot;é¦™è•‰&quot;, &quot;æ¢¨&quot; ])&#125; è¿™é‡Œæ ¹æ® normalizationType çš„ä¸åŒï¼Œåˆ†åˆ«è°ƒç”¨äº†normalizeChildren(children) å’Œ simpleNormalizeChildren(children)æ–¹æ³•ã€‚ å®ƒä»¬çš„å®šä¹‰éƒ½åœ¨ src/core/vdom/helpers/normalzie-children.js ä¸­ï¼š 4.2.2.1 simpleNormalizeChildren1234567891011121314151617181920// The template compiler attempts to minimize the need for normalization by// statically analyzing the template at compile time.//// For plain HTML markup, normalization can be completely skipped because the// generated render function is guaranteed to return Array&lt;VNode&gt;. There are// two cases where extra normalization is needed:// 1. When the children contains components - because a functional component// may return an Array instead of a single root. In this case, just a simple// normalization is needed - if any child is an Array, we flatten the whole// thing with Array.prototype.concat. It is guaranteed to be only 1-level deep// because functional components already normalize their own children.export function simpleNormalizeChildren(children: any) &#123; for (let i = 0; i &lt; children.length; i++) &#123; if (isArray(children[i])) &#123; return Array.prototype.concat.apply([], children) &#125; &#125; return children&#125; å½“ normalizationType ä¸º SIMPLE_NORMALIZE æ—¶ï¼Œæ‰ä¼šè°ƒç”¨simpleNormalizeChildrenæ–¹æ³•ã€‚ é‚£ä¹ˆ normalizationType ä½•æ—¶æ‰ä¼šæ˜¯ SIMPLE_NORMALIZEå‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ç”¨æˆ·è‡ªå®šä¹‰ renderå‡½æ•°çš„æ—¶å€™ï¼ŒnormalizationTypeæ’ä¸ºALWAYS_NORMALIZEï¼Œæ‰€ä»¥åªæœ‰æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™åœ¨_cä¸­æ‰ä¼šå°†å€¼å˜æˆ SIMPLE_NORMALIZEã€‚ ç†è®ºä¸Šç¼–è¯‘ç”Ÿæˆçš„childrenéƒ½å·²ç»æ˜¯ VNodeç±»å‹äº†ï¼Œä¸éœ€è¦å¤„ç†äº†æ‰å¯¹ã€‚ ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µéœ€è¦è€ƒè™‘ï¼Œå°±æ˜¯å‡½æ•°ç»„ä»¶è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„è€Œä¸æ˜¯ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œ 1234567export default &#123; functional: true, props: [&#x27;items&#x27;], render(h, &#123; props &#125;) &#123; return props.items.map(item =&gt; h(&#x27;li&#x27;, item)); &#125;&#125;; æ­¤æ—¶éœ€è¦å°†æ•°ç»„æ‰“å¹³æˆä¸€çº§ã€‚ 4.2.2.2 normalizeChildrené€’å½’å¤„ç†å­èŠ‚ç‚¹1234567export function normalizeChildren(children: any): Array&lt;VNode&gt; | undefined &#123; return isPrimitive(children) ? [createTextVNode(children)] : isArray(children) ? normalizeArrayChildren(children) : undefined&#125; normalizeChildrenç”¨åœ¨ç”¨æˆ·è‡ªå®šä¹‰renderæ—¶å¯¹ childrenè¿›è¡Œè§„èŒƒåŒ–ï¼Œå› ä¸ºç¼–è¯‘æ—¶å·²ç»å°† children éƒ½è§„èŒƒåŒ–ä¸ºäº†createElementåˆ›å»ºå‡½æ•°ã€‚ Vueå…è®¸ç”¨æˆ·æŠŠchildrenå†™æˆåŸºç¡€ç±»å‹ç”¨æ¥åˆ›å»ºå•ä¸ªç®€å•çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¯¹åº”è¿™ç§åœºæ™¯ï¼Œvueä¼šè°ƒç”¨ createTextVNodeåˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹çš„ VNodeï¼Œå¹¶ä¸”ä¼šè½¬åŒ–æˆæ•°ç»„çš„å½¢å¼ã€‚ 1234567891011121314151617// ç”¨æˆ·è‡ªå®šä¹‰ renderå‡½æ•°export default &#123; render:function(h)&#123; return h(&#x27;div&#x27;,&#x27;Hello World&#x27;) &#125;&#125;// ç”Ÿæˆçš„ VNodeVNode &#123; tag:&#x27;div&#x27;, // å°†æ–‡å­—è½¬åŒ–æˆäº†childrenæ•°ç»„ children:[ VNode &#123; tag: undefined, text: &#x27;Hello World&#x27; &#125; ]&#125; å¦‚æœ childrenæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦é€’å½’å¤„ç† childrenï¼Œéå†æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå°†æ¯ä¸€ä¸ªå­èŠ‚ç‚¹è½¬åŒ–ä¸ºæ ‡å‡†çš„ VNodeï¼Œå…¶ä¸­è¿™ä¸ªè½¬åŒ–æ“ä½œæ˜¯ä½¿ç”¨normalizeArrayChildrenå‡½æ•°æ¥å®Œæˆçš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152function normalizeArrayChildren( children: any, nestedIndex?: string): Array&lt;VNode&gt; &#123; const res: VNode[] = [] let i, c, lastIndex, last for (i = 0; i &lt; children.length; i++) &#123; c = children[i] if (isUndef(c) || typeof c === &#x27;boolean&#x27;) continue lastIndex = res.length - 1 last = res[lastIndex] // nested if (isArray(c)) &#123; if (c.length &gt; 0) &#123; c = normalizeArrayChildren(c, `$&#123;nestedIndex || &#x27;&#x27;&#125;_$&#123;i&#125;`) // merge adjacent text nodes if (isTextNode(c[0]) &amp;&amp; isTextNode(last)) &#123; res[lastIndex] = createTextVNode(last.text + c[0].text) c.shift() &#125; res.push.apply(res, c) &#125; &#125; else if (isPrimitive(c)) &#123; if (isTextNode(last)) &#123; // merge adjacent text nodes // this is necessary for SSR hydration because text nodes are // essentially merged when rendered to HTML strings res[lastIndex] = createTextVNode(last.text + c) &#125; else if (c !== &#x27;&#x27;) &#123; // convert primitive to vnode res.push(createTextVNode(c)) &#125; &#125; else &#123; if (isTextNode(c) &amp;&amp; isTextNode(last)) &#123; // merge adjacent text nodes res[lastIndex] = createTextVNode(last.text + c.text) &#125; else &#123; // default key for nested array children (likely generated by v-for) if ( isTrue(children._isVList) &amp;&amp; isDef(c.tag) &amp;&amp; isUndef(c.key) &amp;&amp; isDef(nestedIndex) ) &#123; c.key = `__vlist$&#123;nestedIndex&#125;_$&#123;i&#125;__` &#125; res.push(c) &#125; &#125; &#125; return res&#125; è¯¥å‡½æ•°çš„ä¸»è¦é€»è¾‘å°±æ˜¯éå†childrenæ•°ç»„ï¼Œè·å–æ¯ä¸€é¡¹çš„æ•°æ®ç±»å‹ï¼Œç„¶ååšç›¸åº”å¤„ç†ã€‚ å¦‚æœæ˜¯æœªå®šä¹‰&#x2F;null&#x2F;å¸ƒå°”å€¼ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚ å¦‚æœæ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™é€’å½’è°ƒç”¨normalizeArrayChildrenã€‚ å¦‚æœæ˜¯åŸºç¡€ç±»å‹ï¼Œåˆ™é€šè¿‡ createTextVNodeæ–¹æ³•è½¬æ¢æˆ VNodeç±»å‹ã€‚ å¦‚æœä¸æ˜¯ä¸Šé¢ä¸‰ç§ç±»å‹ï¼Œåˆ™è¡¨ç¤ºå·²ç»æ˜¯ VNodeç±»å‹äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹è¿™ 3 ç§æƒ…å†µéƒ½åšäº†å¦‚ä¸‹å¤„ç†ï¼šå¦‚æœå­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„ text èŠ‚ç‚¹ï¼Œä¼šæŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ª text èŠ‚ç‚¹ã€‚ 4.2.2.3 æ€»ç»“ç»è¿‡å¯¹ childrençš„ç»Ÿä¸€å¤„ç†ï¼Œç°åœ¨ VNodeå·²ç»æ˜¯ä¸€ä¸ªè§„èŒƒåŒ–çš„ VNodeèŠ‚ç‚¹äº†ã€‚ 4.3 VNodeçš„åˆ›å»ºç»è¿‡å…¼å®¹å¤„ç†å’Œ childrenè§„èŒƒåŒ–å¤„ç†åï¼Œå°±å¯ä»¥åˆ›å»ºVNodeäº†ã€‚ 4.3.1 éç»„ä»¶ VNodeå½“ tagä¸ºå­—ç¬¦ä¸²ï¼Œä¸”ä¸æ˜¯æ³¨å†Œç»„ä»¶ï¼Œåˆ™ç›´æ¥è°ƒç”¨ VNodeæ¥åˆ›å»º VNodeã€‚ tagæ˜¯å­—ç¬¦ä¸²ä¸€èˆ¬æœ‰ 2 ç§æƒ…å†µï¼š æ™®é€šçš„HTMLæ ‡ç­¾ 1234567// æ¨¡æ¿ç¼–è¯‘å‰&lt;template&gt; &lt;div&gt;Hello World&lt;/div&gt;&lt;/template&gt;// æ¨¡æ¿ç¼–è¯‘å// _vè¡¨ç¤ºcreateTextVNode ç”¨ä½œåˆ›å»ºå­èŠ‚ç‚¹_c(&#x27;div&#x27;,[_v(&#x27;Hello World&#x27;)]) ç»„ä»¶ç±»å‹ 1234567// æ¨¡æ¿ç¼–è¯‘å‰&lt;template&gt; &lt;Component /&gt;&lt;/template&gt;// æ¨¡æ¿ç¼–è¯‘å// _vè¡¨ç¤ºcreateTextVNode ç”¨ä½œåˆ›å»ºå­èŠ‚ç‚¹_c(&#x27;Component&#x27;) 4.3.2 ç»„ä»¶ VNodeå½“ tagä¸æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ˜¯æ³¨å†Œç»„ä»¶çš„å…³é”®å­—ï¼Œåˆ™è¡¨ç¤ºéœ€è¦åˆ›å»ºä¸€ä¸ªç»„ä»¶VNodeã€‚æ­¤æ—¶è°ƒç”¨ createComponentæ¥åˆ›å»ºç»„ä»¶VNodeã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110export function createComponent( Ctor: typeof Component | Function | ComponentOptions | void, data: VNodeData | undefined, context: Component, children?: Array&lt;VNode&gt;, tag?: string): VNode | Array&lt;VNode&gt; | void &#123; if (isUndef(Ctor)) &#123; return &#125; const baseCtor = context.$options._base // plain options object: turn it into a constructor if (isObject(Ctor)) &#123; Ctor = baseCtor.extend(Ctor as typeof Component) &#125; // if at this stage it&#x27;s not a constructor or an async component factory, // reject. if (typeof Ctor !== &#x27;function&#x27;) &#123; if (__DEV__) &#123; warn(`Invalid Component definition: $&#123;String(Ctor)&#125;`, context) &#125; return &#125; // async component let asyncFactory // @ts-expect-error if (isUndef(Ctor.cid)) &#123; asyncFactory = Ctor Ctor = resolveAsyncComponent(asyncFactory, baseCtor) if (Ctor === undefined) &#123; // return a placeholder node for async component, which is rendered // as a comment node but preserves all the raw information for the node. // the information will be used for async server-rendering and hydration. return createAsyncPlaceholder(asyncFactory, data, context, children, tag) &#125; &#125; data = data || &#123;&#125; // resolve constructor options in case global mixins are applied after // component constructor creation resolveConstructorOptions(Ctor as typeof Component) // transform component v-model data into props &amp; events if (isDef(data.model)) &#123; // @ts-expect-error transformModel(Ctor.options, data) &#125; // extract props // @ts-expect-error const propsData = extractPropsFromVNodeData(data, Ctor, tag) // functional component // @ts-expect-error if (isTrue(Ctor.options.functional)) &#123; return createFunctionalComponent( Ctor as typeof Component, propsData, data, context, children ) &#125; // extract listeners, since these needs to be treated as // child component listeners instead of DOM listeners const listeners = data.on // replace with listeners with .native modifier // so it gets processed during parent component patch. data.on = data.nativeOn // @ts-expect-error if (isTrue(Ctor.options.abstract)) &#123; // abstract components do not keep anything // other than props &amp; listeners &amp; slot // work around flow const slot = data.slot data = &#123;&#125; if (slot) &#123; data.slot = slot &#125; &#125; // install component management hooks onto the placeholder node installComponentHooks(data) // return a placeholder vnode // @ts-expect-error const name = getComponentName(Ctor.options) || tag const vnode = new VNode( // @ts-expect-error `vue-component-$&#123;Ctor.cid&#125;$&#123;name ? `-$&#123;name&#125;` : &#x27;&#x27;&#125;`, data, undefined, undefined, undefined, context, // @ts-expect-error &#123; Ctor, propsData, listeners, tag, children &#125;, asyncFactory ) return vnode&#125; åˆ›å»ºç»„ä»¶ VNodeæ—¶ï¼Œä¼šåœ¨ VNodeæ–°å¢ä¸€äº›ç»„ä»¶ç‰¹æœ‰çš„å±æ€§ï¼š ä½¿ç”¨ Vue.extendç”Ÿæˆä¸€ä¸ªå­ç±»æ„é€ å™¨ï¼Œä¼šæŒ‚è½½åˆ° VNodeçš„componentsOptionså±æ€§çš„ Ctorä¸Šã€‚ å¤„ç†å¼‚æ­¥ç»„ä»¶ å¤„ç† model æ³¨å…¥ä¸€äº› hooks ç­‰ 4.4 createElementå‡½æ•°çš„ä¼˜åŠ¿createElementå‡½æ•°çš„æ„ä¹‰åœ¨äºå®ƒæä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿ã€æ›´ç®€æ´ä¸”æ›´å…·å¯è¯»æ€§çš„æ–¹å¼æ¥åˆ›å»ºvnodeï¼Œç›¸æ¯”ç›´æ¥ç¼–å†™ VNode å…·æœ‰ä»¥ä¸‹å¥½å¤„ï¼š 4.4.1 ç›´è§‚çš„å‚æ•°å½¢å¼ä½¿ç”¨createElementå‡½æ•°å¯ä»¥é€šè¿‡ç›´è§‚çš„å‚æ•°æ¥æè¿°è™šæ‹ŸèŠ‚ç‚¹çš„å±æ€§ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œç›´æ¥ç¼–å†™ VNode å¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ„å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªå±æ€§çš„ JavaScript å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç è¾ƒä¸ºå†—é•¿å’Œå¤æ‚ï¼Œé™ä½äº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 4.4.2 ç»Ÿä¸€çš„åˆ›å»ºæ–¹å¼åœ¨é¡¹ç›®ä¸­ä½¿ç”¨createElementå‡½æ•°å¯ä»¥ç¡®ä¿è™šæ‹ŸèŠ‚ç‚¹çš„åˆ›å»ºæ–¹å¼ä¸€è‡´ã€‚ ç›´æ¥ç¼–å†™ VNode å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„å¼€å‘è€…é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥æ„å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»è€Œé™ä½äº†ä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 4.4.3 åŠ¨æ€å±æ€§å’Œæ¡ä»¶åˆ¤æ–­createElementå‡½æ•°å¯ä»¥æ¥æ”¶åŠ¨æ€çš„å‚æ•°ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶æ¥å†³å®šè™šæ‹ŸèŠ‚ç‚¹çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å˜åŒ–åŠ¨æ€åœ°æ·»åŠ æˆ–ä¿®æ”¹å±æ€§ï¼Œæˆ–è€…æ ¹æ®æ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ªå­èŠ‚ç‚¹ã€‚ ç›´æ¥ç¼–å†™ VNode å¯¹è±¡æ—¶ï¼Œè¦å®ç°ç±»ä¼¼çš„åŠ¨æ€è¡Œä¸ºå¯èƒ½éœ€è¦æ›´å¤šçš„ä»£ç å’Œé€»è¾‘å¤„ç†ï¼Œå¢åŠ äº†ä»£ç çš„å¤æ‚æ€§ã€‚ äº”ã€æ€»ç»“ä¸ºäº†é¿å…é‡å¤æ“ä½œçœŸå® DOM æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œvueæ¡†æ¶å¼•å…¥äº†è™šæ‹Ÿ DOMã€‚ è™šæ‹Ÿ DOMæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå…·æœ‰ç‰¹æœ‰å±æ€§çš„ä¸€ä¸ª JSå¯¹è±¡ã€‚ ä¸ºäº†å®ç°åˆ›å»ºè™šæ‹Ÿ DOM çš„ä¸€è‡´æ€§ï¼Œvueæä¾›äº†ä¸€ä¸ªæ–¹æ³• createElement ç”¨æ¥æ–¹ä¾¿å¿«æ·çš„ç”Ÿæˆè™šæ‹Ÿ DOMã€‚"},{"title":"ğŸ”¥Vue2åˆå§‹åŒ–æ—¶éƒ½å¹²äº†ä»€ä¹ˆäº‹","path":"//posts/vue2-init.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬å››ç¯‡-åˆå§‹åŒ–å¹²äº†ä»€ä¹ˆäº‹ &emsp;&emsp;ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬çŸ¥é“ Vueå°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåœ¨ä½¿ç”¨ Vueçš„æ—¶å€™éœ€è¦å®ä¾‹åŒ– Vueï¼Œè¿™ä¸€ç« æˆ‘ä»¬å°±æ¥çœ‹çœ‹åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å†…éƒ¨åšäº†ä¸€äº›ä»€ä¹ˆæ“ä½œã€‚ é›¶ã€è°ƒç”¨äº†_initæ–¹æ³•123456function Vue()&#123; if(!this instanceof Vue)&#123; return warn(&quot;å¿…é¡»ä½¿ç”¨ new å…³é”®å­—æ¥å®ä¾‹åŒ–&quot;) &#125; this._init();&#125; é™¤äº†åœ¨æ„é€ å‡½æ•°å†…éƒ¨å¯¹æ˜¯å¦ä½¿ç”¨ new å…³é”®å­—è¿›è¡Œåˆ¤æ–­ã€‚ è¿˜åœ¨æ ¡éªŒè¿‡åè°ƒç”¨äº†_initæ–¹æ³•ã€‚ ä» init è¿™ä¸ªåå­—ä¸éš¾çœ‹å‡ºï¼Œè‚¯å®šåœ¨å†…éƒ¨åšäº†ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œã€‚ è¯¥æ–¹æ³•æ˜¯åœ¨Vueè¢«å¼•å…¥æ—¶è°ƒç”¨ initMixin æ–¹æ³•åœ¨Vueä¸Šæ³¨å…¥çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768let uid = 0;export function initMixin(Vue)&#123; Vue.prototype._init = function (options?: Record&lt;string, any&gt;) &#123; const vm: Component = this // a uid vm._uid = uid++ let startTag, endTag /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; startTag = `vue-perf-start:$&#123;vm._uid&#125;` endTag = `vue-perf-end:$&#123;vm._uid&#125;` mark(startTag) &#125; // a flag to mark this as a Vue instance without having to do instanceof // check vm._isVue = true // avoid instances from being observed vm.__v_skip = true // effect scope vm._scope = new EffectScope(true /* detached */) // #13134 edge case where a child component is manually created during the // render of a parent component vm._scope.parent = undefined vm._scope._vm = true // merge options if (options &amp;&amp; options._isComponent) &#123; // optimize internal component instantiation // since dynamic options merging is pretty slow, and none of the // internal component options needs special treatment. initInternalComponent(vm, options as any) &#125; else &#123; vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm ) &#125; /* istanbul ignore else */ if (__DEV__) &#123; initProxy(vm) &#125; else &#123; vm._renderProxy = vm &#125; // expose real self vm._self = vm initLifecycle(vm) initEvents(vm) initRender(vm) callHook(vm, &#x27;beforeCreate&#x27;, undefined, false /* setContext */) initInjections(vm) // resolve injections before data/props initState(vm) initProvide(vm) // resolve provide after data/props callHook(vm, &#x27;created&#x27;) /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; vm._name = formatComponentName(vm, false) mark(endTag) measure(`vue $&#123;vm._name&#125; init`, startTag, endTag) &#125; if (vm.$options.el) &#123; vm.$mount(vm.$options.el) &#125; &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè¯¦ç»†è§£é‡Šä¸‹æ¯ä¸€æ­¥ä¸­å…·ä½“éƒ½åšäº†ä»€ä¹ˆã€‚ ä¸€ã€vm._uid12345let uid = 0;Vue.prototype.init=function()&#123; vm._uid = uid++&#125; åœ¨_initæ–¹æ³•çš„ç¬¬ä¸€è¡Œå¯ä»¥çœ‹åˆ°åœ¨å®ä¾‹ä¸ŠæŒ‚è½½äº†ä¸€ä¸ªvm._uidå±æ€§ã€‚ æ¯ä¸ªVueå®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„_uidï¼ˆUnique Identifierï¼Œå”¯ä¸€æ ‡è¯†ç¬¦ã€‚ è¿™ä¸ªæ ‡è¯†ç¬¦æ˜¯åœ¨ Vue å®ä¾‹åˆ›å»ºæ—¶ç”±ä¸€ä¸ªé€’å¢çš„è®¡æ•°å™¨ç”Ÿæˆçš„ï¼Œå…¶ä¸»è¦ç”¨é€”æ˜¯åœ¨å†…éƒ¨å¤„ç†ä¸­æä¾›å”¯ä¸€æ€§ã€‚ å°¤å…¶æ˜¯åœ¨æ¶‰åŠåˆ°å®ä¾‹é—´çš„æ¯”è¾ƒæˆ–è€…è·Ÿè¸ªçš„æ—¶å€™ã€‚ äºŒã€è¿½è¸ªåˆå§‹åŒ–æ¶ˆè€—æ—¶é—´123456789101112// _init å‡½æ•°åˆšæ‰§è¡Œæ—¶let startTag, endTagif (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; startTag = `vue-perf-start:$&#123;vm._uid&#125;` endTag = `vue-perf-end:$&#123;vm._uid&#125;` mark(startTag)&#125;// _init å‡½æ•°åˆå§‹åŒ–é€»è¾‘å®Œæˆif (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; mark(endTag) measure(`vue $&#123;vm._uid&#125; init`, startTag, endTag)&#125; 2.1 è¦†ç›–é»˜è®¤é…ç½®æˆ‘ä»¬çŸ¥é“åœ¨ Vue å¯ä»¥è¦†ç›–é»˜è®¤é…ç½®ã€‚ 12// å¼€å¯ vueæ€§èƒ½é…ç½®Vue.config.performance = true; é‚£ä¹ˆ vue æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ core/config.jsæ–‡ä»¶æ˜¯vueçš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ 12345// core/config.jsexport default &#123; // é»˜è®¤ä¸å¼€å¯perf performance: false&#125; Vueè¢«å¼•å…¥æ—¶ï¼Œåœ¨ initGlobalAPIæ–¹æ³•ä¸­ç»™ Vueè®¾ç½®äº† configå±æ€§ã€‚ 12345678910111213141516import config from &#x27;../config&#x27;export function initGlobalAPI(Vue)&#123; // çœç•¥éƒ¨åˆ†ä»£ç  const configDef = &#123;&#125;; configDef.get = () =&gt; config; if (__DEV__) &#123; configDef.set = () =&gt; &#123; warn( &#x27;ä¸è¦æ›¿æ¢Vue.é…ç½®å¯¹è±¡ï¼Œè€Œæ˜¯è®¾ç½®å•ç‹¬çš„å­—æ®µ&#x27; ) &#125; &#125; Object.defineProperty(Vue,&#x27;config&#x27;,configDef);&#125; è€Œå¼•å…¥çš„configå°±æ˜¯Vueçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå…¶å¯¼å‡ºå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293export default &#123; /** * Option merge strategies (used in core/util/options) */ // $flow-disable-line optionMergeStrategies: Object.create(null), /** * Whether to suppress warnings. */ silent: false, /** * Show production mode tip message on boot? */ productionTip: __DEV__, /** * Whether to enable devtools */ devtools: __DEV__, /** * Whether to record perf */ performance: false, /** * Error handler for watcher errors */ errorHandler: null, /** * Warn handler for watcher warns */ warnHandler: null, /** * Ignore certain custom elements */ ignoredElements: [], /** * Custom user key aliases for v-on */ // $flow-disable-line keyCodes: Object.create(null), /** * Check if a tag is reserved so that it cannot be registered as a * component. This is platform-dependent and may be overwritten. */ isReservedTag: no, /** * Check if an attribute is reserved so that it cannot be used as a component * prop. This is platform-dependent and may be overwritten. */ isReservedAttr: no, /** * Check if a tag is an unknown element. * Platform-dependent. */ isUnknownElement: no, /** * Get the namespace of an element */ getTagNamespace: noop, /** * Parse the real tag name for the specific platform. */ parsePlatformTagName: identity, /** * Check if an attribute must be bound using property, e.g. value * Platform-dependent. */ mustUseProp: no, /** * Perform updates asynchronously. Intended to be used by Vue Test Utils * This will significantly reduce performance if set to false. */ async: true, /** * Exposed for legacy reasons */ _lifecycleHooks: LIFECYCLE_HOOKS&#125; as unknown as Config æ ¹æ®ä¸Šé¢çš„é…ç½®å¯ä»¥çŸ¥é“ Vue.configè·å–çš„å°±æ˜¯configæ–‡ä»¶ä¸­ä¸­é…ç½®çš„å†…å®¹ã€‚ exportæˆ–export defaultä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¯¹è±¡æœ¬èº«åœ¨å¤–éƒ¨è„šæœ¬ä¸­æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚ä½†æ˜¯å¯¹è±¡çš„å±æ€§åœ¨å¤–éƒ¨è„šæœ¬ä¸­éƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚ æ‰€ä»¥ä½ å¯ä»¥é€šè¿‡Vue.config.xxx = xxx æ¥è®¾ç½®é…ç½®æˆ–è€…è¦†ç›–é»˜è®¤çš„é…ç½®ã€‚ 2.2 markå‡½æ•° &amp; measureå‡½æ•°markå‡½æ•° å’Œ measureå‡½æ•°æ˜¯vueä¸­è¿›è¡Œæ€§èƒ½æ£€æµ‹çš„å‡½æ•°ã€‚ å‡½æ•°ä½äºcore/util/perfæ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718192021222324// åˆ¤æ–­æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­import &#123; inBrowser &#125; from &#x27;./env&#x27;export let markexport let measure// åªæœ‰åœ¨å¼€å‘ç¯å¢ƒä¸­æ‰ä¼šè®¾ç½® mark å’Œ measureif (__DEV__) &#123; const perf = inBrowser &amp;&amp; window.performance if ( perf &amp;&amp; perf.mark &amp;&amp; perf.measure &amp;&amp; perf.clearMarks &amp;&amp; perf.clearMeasures ) &#123; mark = tag =&gt; perf.mark(tag) measure = (name, startTag, endTag) =&gt; &#123; perf.measure(name, startTag, endTag) perf.clearMarks(startTag) perf.clearMarks(endTag) &#125; &#125;&#125; å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†window.performanceç›¸å…³çš„ apiï¼š performance.markï¼šä¸»è¦ç”¨äºåˆ›å»ºæ ‡è®° performance.measureï¼š ä¸»è¦ç”¨äºè®°å½•ä¸¤ä¸ªæ ‡è®°çš„æ—¶é—´é—´éš” performance.clearMarksï¼š ç”¨äºæ¸…é™¤æ ‡è®° 123456789window.performance.mark(&quot;_start&quot;)for(let i=0;i&lt;10000;i++)&#123; console.log();&#125;window.performance.mark(&quot;_end&quot;)window.performance.measure(&quot;timestamp&quot;,&quot;_start&quot;,&quot;_end&quot;)// å¯ä»¥è·å–ç›´æ¥é—´éš”window.performance.getEntriesByName(&quot;timestamp&quot;)[0] å¯ä»¥ä½¿ç”¨getEntriesByNameè·å–ä¸¤ä¸ªæ ‡è®°æœŸé—´ä»£ç æ‰§è¡Œçš„æ—¶é—´ã€‚ ä»è€Œè¿™é‡Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°åˆå§‹åŒ–_initå‡½æ•°æ‰§è¡Œçš„æ—¶æœºã€‚ 2.3 æ€»ç»“åœ¨ _init å‡½æ•°å¼€å§‹æ—¶æ‰“ä¸€ä¸ªåä¸ºâ€œvue-perf-startâ€çš„æ ‡è®°ã€‚ ç„¶ååœ¨é€»è¾‘å¤„ç†ç»“æŸåæ‰“ä¸€ä¸ªåä¸ºâ€œvue-perf-endâ€çš„æ ‡è®°ã€‚ æœ€åé€šè¿‡measureå‡½æ•°è®¾ç½®ä¸€ä¸ª measure å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚ è¿™ä¸ªé—´éš”æ—¶é—´å°±å¯ä»¥çœ‹æˆè¿™ä¸ªå®ä¾‹åˆå§‹åŒ–èŠ±è´¹çš„æ—¶é—´ï¼Œä»¥æ­¤æ¥è¯„æµ‹æ€§èƒ½ã€‚ ä¸‰. vm._isVue123Vue.prototype.init=function()&#123; vm._isVue = true&#125; æ¯ä¸ª vueå®ä¾‹ åœ¨åˆå§‹æ—¶éƒ½ä¼šè®¾ç½®_isVueå˜é‡ã€‚ è¿™ä¸ªå˜é‡å¯ä»¥åœ¨å†…éƒ¨&#x2F;æ‰©å±•æ’ä»¶ä¸­åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ vueå®ä¾‹ã€‚ å››ã€vm.__v_skip123Vue.prototype.init=function()&#123; vm.__v_skip = true&#125; åœ¨åˆå§‹åŒ–æ—¶å°†è¯¥å˜é‡è®¾ç½®ä¸º trueã€‚ è¿™ä¸ªå˜é‡ç”¨äºæŒ‡ç¤ºVueçš„ç›¸åº”æ˜¯ç³»ç»Ÿè·³è¿‡å¯¹è¯¥å¯¹è±¡çš„è§‚æµ‹ã€‚ å½“ä¸€ä¸ªå¯¹è±¡è¢«æ ‡è®°ä¸º __v_skip &#x3D; true æ—¶ï¼ŒVue ä¸ä¼šå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œæ·±åº¦è§‚æµ‹ï¼Œè¿™æ„å‘³ç€å¯¹è±¡å†…éƒ¨çš„å±æ€§å˜åŒ–å°†ä¸ä¼šè§¦å‘è§†å›¾æ›´æ–°ã€‚ äº”ã€åˆå¹¶é€‰é¡¹123456789101112if (options &amp;&amp; options._isComponent) &#123; // optimize internal component instantiation // since dynamic options merging is pretty slow, and none of the // internal component options needs special treatment. initInternalComponent(vm, options as any)&#125; else &#123; vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm )&#125; ç¬¬äº”æ­¥æ˜¯æ‰§è¡Œåˆå¹¶ optionsçš„æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ª optionsæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥è¯´ Vueä¸­çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯åŸºäº optionsæ¥å®Œæˆçš„ï¼Œè¿™ä¸ª optionsä¸­å­˜å‚¨äº†ç”¨æˆ·ä¼ å…¥çš„é€‰é¡¹ä»¥åŠä¸€äº›å†…ç½®çš„ Vueé€‰é¡¹ã€‚ ç”±äºoptionsåœ¨ Vueä¸­æ¯”è¾ƒé‡è¦ï¼Œå…³äºè¿™ä¸€å—æˆ‘ä»¬åé¢ä¼šä¸“é—¨å¼€ä¸€ç¯‡æ–‡ç« æ¥è¯¦ç»†è§£é‡Šã€‚ åœ¨è¿™ç¯‡ä¸“æ ä¸­å…·ä½“è¯´æ˜äº†åˆå¹¶é€‰é¡¹ï¼šç¬¬äº”ç¯‡ä¸“æ  å…­ã€è®¾ç½®æ•°æ®ä»£ç†æ£€æµ‹12345if (__DEV__) &#123; initProxy(vm)&#125;else &#123; vm._renderProxy = vm&#125; è¿™é‡Œçš„ç›®çš„æ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸‹ç»™vmè®¾ç½®ä»£ç†ï¼Œä»è€Œè¾¾åˆ°å¼€å‘æ—¶æç¤ºçš„åŠŸèƒ½ï¼Œè¿™ä¸ªæˆ‘ä»¬åç»­ä¹Ÿä¼šå•å¼€ä¸€ç¯‡æ–‡ç« è¿›è¡Œè¯´æ˜ã€‚ ä¸ƒã€vm._self &#x3D; vm123Vue.prototype.init=function()&#123; vm._self = vm&#125; å°†_selfå±æ€§æŒ‡å‘è‡ªèº«è¿™ä¸ªå®ä¾‹ã€‚ å¯ä»¥ç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£ç¡®å¼•ç”¨å½“å‰å®ä¾‹ã€‚ å…«ã€æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œåé¢æˆ‘ä»¬ä¼šæ‰§è¡Œä¸€äº›ç”¨äºåˆå§‹åŒ–çš„æ“ä½œã€‚ å†…éƒ¨å…·ä½“åšäº†ä»€ä¹ˆæˆ‘ä»¬å’±ä¸è€ƒè™‘ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šä¸€ä¸€è¿›è¡Œè®¨è®ºã€‚ 123456789101112// åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸinitLifeCycle(vm);// åˆå§‹åŒ–äº‹ä»¶ä¸­å¿ƒinitEvents(vm)// åˆå§‹åŒ–æ¸²æŸ“initRender(vm)// åˆå§‹åŒ– injectinitInjections(vm)// åˆå§‹åŒ– propsã€dataã€computed ç­‰initState(vm)// åˆå§‹åŒ– providerinitProvide(vm) è¿™äº›å‡½æ•°åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨å®ä¾‹ä¸ŠæŒ‚è½½äº†ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚æ¸²æŸ“æ‰§è¡Œçš„_updateå°±æ˜¯åœ¨ initLifecycleä¸­å®šä¹‰çš„ã€è·Ÿæ¸²æŸ“ç›¸å…³çš„_renderå‡½æ•°å°±æ˜¯åœ¨ initRenderä¸­å®šä¹‰çš„ã€‚ ä¹ã€æ‰§è¡Œä¸€äº›ç”Ÿå‘½é’©å­åœ¨æ‰§è¡Œ initRender åï¼Œä¼šè°ƒç”¨ beforeCreate é’©å­ã€‚è¿™è¡¨ç¤ºbeforeCreate é’©å­ è°ƒç”¨çš„æ—¶æœºä¸ºVueå®ä¾‹åŒ– dataæ•°æ®å‰ï¼Œæ‰€ä»¥æ­¤æ—¶è·å– dataæ˜¯æ— æ³•è·å–åˆ°çš„ï¼Œå› ä¸ºè¿™æ—¶å€™è¿˜æ²¡æœ‰åˆå§‹åŒ– dataã€‚ åœ¨æ‰§è¡Œå®Œæœ€åä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°initProvideåï¼Œä¼šè°ƒç”¨ createdé’©å­ã€‚è¿™è¡¨ç¤ºcreatedé’©å­ è°ƒç”¨çš„æ—¶æœºä¸ºVueå®ä¾‹åˆå§‹åŒ–åã€‚ 123456// çœç•¥initRender(vm)callHook(vm, &#x27;beforeCreate&#x27;, undefined, false /* setContext */)// çœç•¥initProvide(vm) // resolve provide after data/propscallHook(vm, &#x27;created&#x27;) åã€æ‰§è¡ŒæŒ‚è½½123if (vm.$options.el) &#123; vm.$mount(vm.$options.el)&#125; åˆ¤æ–­æ˜¯å¦æœ‰vmä¸Šæ˜¯å¦æœ‰$optionsé€‰é¡¹ï¼Œå¦‚æœå­˜åœ¨$optionsé€‰é¡¹ï¼Œåˆ™æ‰§è¡ŒæŒ‚è½½æ–¹æ³•ã€‚ åä¸€ã€æ€»ç»“åœ¨ initå‡½æ•°å†…éƒ¨ï¼Œä¸»è¦æ˜¯æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚è®¾ç½®åŸºç¡€çš„ä»£ç†ã€‚åˆå§‹åŒ–dataã€ç»™å®ä¾‹ä¸Šè®¾ç½®_updateã€_renderæ–¹æ³•ç­‰ã€‚"},{"title":"ğŸ”¥Vue2ä¸°å¯Œçš„é€‰é¡¹åˆå¹¶ç­–ç•¥","path":"//posts/vue2-merge-options.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬äº”ç¯‡-ä¸°å¯Œçš„é€‰é¡¹åˆå¹¶ç­–ç•¥ ä¸€ã€å®ä¾‹åŒ–æ—¶åˆå¹¶é€‰é¡¹åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰§è¡ŒVueåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´åˆ°äº†é€‰é¡¹åˆå¹¶ã€‚ é‚£ä»€ä¹ˆæ˜¯é€‰é¡¹å‘¢ï¼Ÿ åœ¨ new Vue(é€‰é¡¹)ä¸­ï¼ŒVueæ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„æ•°æ®å°±æ˜¯é€‰é¡¹ï¼Œä»£è¡¨ä¼ å…¥çš„é€‰é¡¹ï¼Œä¸€èˆ¬ä»¥å¯¹è±¡å½¢å¼ä¼ å…¥ã€‚ åœ¨Vueæºç ä¸­ä½¿ç”¨å˜é‡optionsè¡¨ç¤ºé€‰é¡¹ï¼Œåœ¨æºç ä¸­ä½ ç»å¸¸èƒ½çœ‹åˆ° optionsçš„èº«å½±ã€‚ åœ¨å®ä¾‹åŒ–æ—¶éœ€è¦å°†å®ä¾‹å¯¹åº”çš„æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹åˆå¹¶åˆ°å®ä¾‹çš„é€‰é¡¹ä¸Šã€‚ 12345vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor), options || &#123;&#125;, vm) ä¸Šé¢ mergeOptions åˆ™æ˜¯ç”¨äºåˆå¹¶ 2 ä¸ª optionsï¼ŒresolveConstructorOptionsç”¨äºè·å–æ„é€ å‡½æ•°ä¸Šçš„optionsã€‚ åœ¨å‰é¢çš„æ–‡ç«  Vueçš„åŸå‹è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ vm.constructor å°±æ˜¯æŒ‡çš„ Vueæ„é€ å‡½æ•° äºŒã€Vueæ„é€ å‡½æ•°çš„é»˜è®¤é€‰é¡¹å‰é¢æˆ‘ä»¬çŸ¥é“ vm.$options ä¸­ä¼šåˆå¹¶Vueæ„é€ å‡½æ•°çš„ optionsã€‚ é‚£ä¹ˆ Vue.options æœ‰å€¼å—ï¼Ÿ å®é™…ä¸ŠVueæ„é€ å‡½æ•°æœ¬èº«ä¼šè‡ªå¸¦ä¸€äº›é»˜è®¤çš„é€‰é¡¹ã€‚ åœ¨Vueè¢«å¼•å…¥æ—¶ï¼Œä¼šæ‰§è¡Œå¤šä¸ªæ–¹æ³•ç»™Vue.optionsæ³¨å…¥å±æ€§ã€‚ 2.1 initGlobalAPIæ–¹æ³•åˆ›å»º Vue.optionsinitGlobalAPIæ–¹æ³•åœ¨Vueè¢«å¼•å…¥æ—¶æ‰§è¡Œã€‚ 1234567891011121314151617// core/global-api/index.tsconst ASSET_TYPES = [&#x27;component&#x27;,&#x27;directive&#x27;,&#x27;filter&#x27;];const builtInComponents = &#123; KeepAlive&#125;export function initGlobalAPI(Vue)&#123; // Object.createç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ è¯¥å¯¹è±¡æ²¡æœ‰åŸå‹ Vue.options = Object.create(null) ASSET_TYPES.forEach(type =&gt; &#123; Vue.options[type + &#x27;s&#x27;] = Object.create(null) &#125;); Vue.options._base = Vue; extend(Vue.options.components, builtInComponents) &#125; å¯ä»¥çœ‹åˆ°ï¼ŒinstallGlobalAPIæ–¹æ³•ä¸­åˆ›å»ºäº† Vue.optionsä¸ºä¸€ä¸ªçº¯å‡€çš„ç©ºå¯¹è±¡ï¼Œç„¶ååœ¨optionsä¸Šé¢æ³¨å…¥äº†ä¸€äº›å±æ€§ã€‚ _baseå°±æ˜¯ Vueæ„é€ å‡½æ•°ã€‚æ¯ä¸ªVueç»„ä»¶éƒ½æ˜¯é€šè¿‡_baseå±æ€§è·å–åˆ°Vueæ„é€ å‡½æ•°ï¼Œç„¶åä½¿ç”¨Vue.extendæ¥ç”Ÿæˆå¯¹åº”çš„ VueComponentæ„é€ å‡½æ•°ã€‚ extendæ–¹æ³•æ˜¯vueä¸­çš„ä¸€ä¸ªé€šç”¨æ–¹æ³•ã€‚ç”¨äºå°†ç¬¬äºŒä¸ªå‚æ•°çš„å€¼åˆå¹¶åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ç›´æ¥è¦†ç›–è¿›ç¬¬ä¸€ä¸ªå‚æ•° extendå‡½æ•°æºç 1234567891011export function extend( to, _from)&#123; // ç”¨äºåˆå¹¶ç¬¬äºŒä¸ªå‚æ•°åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ for (const key in _from) &#123; // è¦†ç›–å‚æ•°å±æ€§ to[key] = _from[key] &#125; return to&#125; 2.2 åˆå¹¶æŒ‡ä»¤ &amp; å†…ç½®ç»„ä»¶1234567891011121314// platforms/web/runtime/indexconst platformDirectives = &#123; model, show&#125;const platformComponents = &#123; Transition, TransitionGroup&#125;extend(Vue.options.directives, platformDirectives)extend(Vue.options.components, platformComponents) è¯¥æ®µé€»è¾‘ä¹Ÿæ˜¯åœ¨ Vueè¢«å¼•å…¥æ—¶æ‰§è¡Œï¼Œæ‰©å±•äº†ä¸€äº›è·Ÿ webå¹³å°ç›¸å…³çš„æŒ‡ä»¤å’Œç»„ä»¶ã€‚ 2.3 æ€»ç»“ç»è¿‡æˆ‘ä»¬çš„ç ”ç©¶å‘ç°ï¼ŒVueæ„é€ å‡½æ•°çš„é»˜è®¤é€‰é¡¹æœ‰ï¼š _baseï¼š ä»£è¡¨Vueæ„é€ å‡½æ•°ï¼Œåç»­ç”¨æ¥åˆ›å»ºç»„ä»¶çš„æ„é€ å‡½æ•°VueComponentã€‚ directiveï¼šä»£è¡¨éœ€è¦æ³¨å†Œçš„æŒ‡ä»¤ï¼Œé»˜è®¤çš„æä¾›äº† v-modelã€v-showçš„å†…ç½®æŒ‡ä»¤ã€‚ componentsï¼šä»£è¡¨éœ€è¦æ³¨å†Œçš„ç»„ä»¶é€‰é¡¹ï¼Œé»˜è®¤æä¾›äº† KeepAliveã€Transitionã€TransitionGroupçš„å†…ç½®ç»„ä»¶ã€‚ filter ï¼šä»£è¡¨éœ€è¦æ³¨å†Œçš„è¿‡æ»¤å™¨ï¼Œé»˜è®¤æ²¡æœ‰æä¾›é»˜è®¤å€¼ã€‚ ä¸‰ã€å­ç±»æ„é€ å‡½æ•°çš„ optionså­¦ä¹ å®Œä¸ŠèŠ‚æˆ‘ä»¬çŸ¥é“åœ¨Vueè¢«å¼•å…¥æ—¶ï¼Œåœ¨Vueæ„é€ å‡½æ•°ä¸Šæ³¨å…¥äº†ä¸€äº›é»˜è®¤é€‰é¡¹ã€‚ åœ¨ä¸“æ ç¬¬ä¸‰ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Vue.extendå‡½æ•°ã€‚ åœ¨renderé˜¶æ®µç”Ÿæˆè™šæ‹ŸèŠ‚ç‚¹æ—¶ï¼Œä¼šè°ƒç”¨ Vue.extend ç”Ÿæˆç»„ä»¶æ„é€ å‡½æ•°VueComponentï¼Œå¹¶å­˜åœ¨ vnodeä¸Šã€‚ ç„¶ååœ¨updateé˜¶æ®µå¼€å§‹æŒ‚è½½èŠ‚ç‚¹æ—¶ï¼Œä¼šè°ƒç”¨ç»„ä»¶æ„é€ å‡½æ•° VueComponentæ¥åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œå†è¿›è¡Œåç»­ç»„ä»¶å®ä¾‹åˆå§‹åŒ–ã€æ¸²æŸ“ç­‰æ“ä½œã€‚ é‚£ä¹ˆVueComponentæ„é€ å‡½æ•°ä½œä¸ºVueæ„é€ å‡½æ•°çš„å­ç±»ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿç»§æ‰¿äº†å®ƒçš„é»˜è®¤é€‰é¡¹å‘¢ï¼Ÿ æˆ‘ä»¬å†æ¬¡æ‰“å¼€ Vue.extend çš„æºç ä¸€æ¢ç©¶ç«Ÿã€‚ 1234567891011Vue.extend = function(extendOptions)&#123; extendOptions = extendOptions || &#123;&#125; // æ–°å¢_Ctorå±æ€§ const cachedCtors = extendOptions._Ctor || (extendOptions._Ctor = &#123;&#125;) const Super = this; const Sub = function VueComponent()&#123; this._init(); &#125; // mergeOptionsç”¨äºåˆå¹¶2ä¸ªé€‰é¡¹è¿”å›ä¸€ä¸ªåˆå¹¶é€‰é¡¹ Sub.options = mergeOptions(Super.options, extendOptions)&#125; è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“ mergeOptionsçš„å…·ä½“é€»è¾‘ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼ŒVueComponentæ„é€ å‡½æ•°ä¸Šçš„ optionså±æ€§åˆå¹¶äº†â€œçˆ¶ç±»â€œæ„é€ å‡½æ•°ä¸Šçš„optionså±æ€§ä»¥åŠextendæ–¹æ³•ä¼ å…¥çš„é€‰é¡¹ã€‚ åœ¨ VueComponentæ„é€ å‡½æ•°ä¸Šæ–°å¢äº†ä¸€ä¸ª_Ctorå±æ€§ï¼Œå¯ä»¥é¿å…æ¯æ¬¡é‡æ–°åˆ›å»ºå­ç±»ï¼Œæé«˜æ€§èƒ½ï¼Œåé¢æˆ‘ä»¬ä¼šä¸“é—¨è¯´è¿™é‡Œï¼Œè¿™é‡Œä¸è¿›è¡Œå±•å¼€ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå­ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ç»§æ‰¿äº†å…¶çˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 123const VueComponent = Vue.extend(&#123; template:`&lt;div&gt;æˆ‘æ˜¯å­ç±»æ„é€ å‡½æ•°&lt;/div&gt;`&#125;); æ­¤æ—¶ VueComponent.options ä¸Šæ—¢åŒ…å«äº†è‡ªèº«ä¼ å…¥çš„ template é€‰é¡¹ï¼Œä¹ŸåŒ…å«äº†ç»§æ‰¿è‡ªVueæ„é€ å‡½æ•°ä¸Šçš„å±æ€§ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆå¹¶çˆ¶ç±»æ„é€ å‡½æ•°çš„ optionsæ—¶ï¼Œä¸åŒ optionçš„åˆå¹¶ç­–ç•¥ä¸åŒï¼Œå¯¹äºcomponentsã€filterã€directivesç­‰å†…ç½®é€‰é¡¹ä¼šåˆå¹¶åˆ°åŸå‹é“¾ä¸­ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒVueComponentæ„é€ å‡½æ•°æœ¬èº«æ˜¯å…·æœ‰å†æ¬¡æ‰©å±•çš„èƒ½åŠ›çš„ã€‚ 1234567const VueComponentChild = VueComponent.extend(&#123; data()&#123; return &#123; name:&quot;VueComponentChildConstructor&quot; &#125; &#125;&#125;) åŒç†ï¼ŒVueComponentChildConstructoræ˜¯VueComponentçš„å­ç±»ï¼Œæ‰€ä»¥VueComponentChildConstructorå°±ç»§æ‰¿äº†VueComponentçš„ optionsã€‚ å››ã€è·å–æ„é€ å‡½æ•°ä¸Šçš„ optionsåœ¨Vueåˆå§‹åŒ–æ“ä½œæ‰§è¡Œæ—¶ï¼Œä½¿ç”¨ resolveConstructorOptions å‡½æ•°æ¥è·å–æ„é€ å‡½æ•°ä¸Šçš„ optionsã€‚ 1234567891011121314151617181920212223export function resolveConstructorOptions(Ctor)&#123; let options = Ctor.options; if (Ctor.super) &#123; const superOptions = resolveConstructorOptions(Ctor.super) const cachedSuperOptions = Ctor.superOptions if (superOptions !== cachedSuperOptions) &#123; // super option changed, // need to resolve new options. Ctor.superOptions = superOptions // check if there are any late-modified/attached options (#4976) const modifiedOptions = resolveModifiedOptions(Ctor) // update base extend options if (modifiedOptions) &#123; extend(Ctor.extendOptions, modifiedOptions) &#125; options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions) if (options.name) &#123; options.components[options.name] = Ctor &#125; &#125; &#125; return options;&#125; çœ‹åˆ°è¿™ä¹ˆå¤šä»£ç ï¼Œæƒ³å¿…å¤§å®¶ä¹Ÿæ˜¯æå…¶æ‡µé€¼çš„ã€‚ å› ä¸ºæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼š Vueæ„é€ å‡½æ•°çš„é€‰é¡¹æ˜¯åœ¨åˆå§‹åŒ–æ—¶æ³¨å…¥çš„ã€‚ VueComponentæ„é€ å‡½æ•°åŠå…¶æ‰©å±•å­ç±»çš„é€‰é¡¹åˆ™æ˜¯åœ¨extendæ–¹æ³•ä¸­è¿›è¡Œæ³¨å…¥çš„ã€‚ é‚£ç›´æ¥ä½¿ç”¨.optionsè·å–æ„é€ å‡½æ•°çš„é€‰é¡¹ä¸å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰è¿™ä¹ˆä¸€å¤§æ®µé€»è¾‘å‘¢ï¼Ÿ 12Vue.options // è·å–Vueæ„é€ å‡½æ•°çš„é€‰é¡¹VueComponent.options // è·å–VueComponentæ„é€ å‡½æ•°çš„é€‰é¡¹ å…¶å®è¿™ä¸€æ®µé€»è¾‘ä¸»è¦æ˜¯åº”å¯¹çˆ¶ç±»æ„é€ å‡½æ•°ä¸Šé€‰é¡¹å˜åŒ–çš„æƒ…å†µã€‚ 4.1 Ctor.superå¯ä»¥çœ‹åˆ°åªæœ‰ Ctor.super å­˜åœ¨æ—¶æ‰ä¼šèµ°è¿™ä¸€å¤§æ®µé€»è¾‘ã€‚ é‚£ä¹ˆ Ctor.super æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åœ¨ä½¿ç”¨ extendç”Ÿæˆå­ç±»æ„é€ å‡½æ•°æ—¶ï¼Œä¼šåœ¨å­ç±»æ„é€ å‡½æ•°ä¸Šæ–°å¢äº†ä¸€ä¸ª superå±æ€§ï¼ŒæŒ‡å‘å®ƒçš„çˆ¶ç±»ã€‚ 123456789Vue.extend = function()&#123; let Sub = function VueComponent()&#123; this._init &#125; let Super = this; // çœç•¥éƒ¨åˆ†ä»£ç  // superå³ä»£è¡¨å®ƒçš„çˆ¶ç±» Sub[&#x27;super&#x27;] = Super;&#125; æ‰€ä»¥å¦‚æœå­˜åœ¨ super å±æ€§ï¼Œåˆ™ä»£è¡¨ç°åœ¨è¿™é‡Œçš„ Ctorä½¿ç”¨çš„æ˜¯extendç”Ÿæˆçš„VueComponentæ„é€ å‡½æ•°ã€‚æ‰€ä»¥è¿™é‡Œåˆ†ä¸º 2 ç§æƒ…å†µï¼š æ²¡æœ‰superå±æ€§ï¼Œä»£è¡¨è¿™æ˜¯ Vueæ„é€ å‡½æ•°ï¼Œç›´æ¥è¿”å› Vue.options å³å¯ã€‚ å¦‚æœå­˜åœ¨superå±æ€§ï¼Œä»£è¡¨è¿™æ˜¯extendç”Ÿæˆçš„ VueComponentæ„é€ å‡½æ•°ï¼Œéœ€è¦è¿›è¡Œè¿›ä¸€æ­¥åˆ¤æ–­ã€‚ å› ä¸º VueComponent.optionsçš„å€¼æ˜¯åœ¨ extendæ—¶åˆå¹¶äº†çˆ¶ç±»é€‰é¡¹å’Œextendä¼ å…¥é€‰é¡¹çš„å…¨æ–°é€‰é¡¹ã€‚ æ‰€ä»¥å¦‚æœåç»­Vue.optionså˜åŒ–äº†æ— æ³•è·å–æœ€æ–°çš„é€‰é¡¹ã€‚ 4.2 åˆ¤æ–­çˆ¶ç±»æ„é€ å‡½æ•°ä¸Šçš„ options æ˜¯å¦å˜åŒ–é‚£ä¹ˆæœ‰å“ªäº›æ“ä½œå¯ä»¥ä¿®æ”¹çˆ¶ç±»æ„é€ å‡½æ•°ä¸Šçš„ optionså‘¢ï¼Ÿ æ¯”å¦‚ä½¿ç”¨ Vue.mixin apiï¼Œè¿™ä¸ª apiå°±ä¿®æ”¹äº†Vue.optionsé€‰é¡¹ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€äº›é€»è¾‘å¯ä»¥æ›´æ–° VueComponentä¸Šçš„ optionsã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹ Vueæ˜¯æ€ä¹ˆæ›´æ–°çš„ã€‚ 12345const superOptions = resolveConstructorOptions(Ctor.super)const cachedSuperOptions = Ctor.superOptionsif (superOptions !== cachedSuperOptions) &#123; // è¿›å…¥è¿™ä¸ªé€»è¾‘è¯´æ˜ Vue.optionså˜åŒ–äº†&#125; ä¸Šé¢ä»£ç ä¸­å¦‚æœ superOptions ä¸ç­‰äº cachedSuperOptionsï¼Œå³è¡¨ç¤ºçˆ¶ç±»æ„é€ å‡½æ•°å‘ç”Ÿäº†å˜åŒ–ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ææ˜ç™½è¿™ 2 ä¸ªå€¼åˆ†åˆ«è¡¨ç¤ºä»€ä¹ˆï¼Ÿ superOptionsæ˜¯åœ¨resolveConstructorOptionsä¸­é€’å½’å‘ä¸ŠæŸ¥æ‰¾çš„ï¼Œå°±æ˜¯è¡¨ç¤ºçˆ¶ç±»æ„é€ å‡½æ•°çš„æœ€æ–°é€‰é¡¹ã€‚ cachedSuperOptions æ˜¯æŒ‡çš„æ„é€ å‡½æ•°ä¸Šçš„ superOptionså±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯åœ¨ extendä¸­å®šä¹‰çš„ï¼š 12345678Vue.extend = function()&#123; let Super = this; let Sub = function VueComponent()&#123; this._init(); &#125; // è¿™é‡Œå­˜å‚¨çš„å°±æ˜¯çˆ¶ç±»æ„é€ å‡½æ•°çš„ options Sub.superOptions = Super.options&#125; æ‰€ä»¥è¿™ 2 ä¸ªå€¼éƒ½æ˜¯æŒ‡çš„çˆ¶ç±»æ„é€ å‡½æ•°ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜åœ°å€ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰ä¸ä¸€æ ·çš„æƒ…å†µå‘¢ï¼Ÿ åœ¨ Vue æ—§ç‰ˆæœ¬ä¸­æ›¾ç»æœ‰ä¸€ä¸ªç›¸å…³çš„ bugã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¿™ä¸ª bugï¼š 4.2.1 Vueæ—§ç‰ˆæœ¬çš„ buggithub issue #4976 è¿™ä¸ªbugçš„å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼šå…ˆç”ŸæˆVueComponentæ„é€ å‡½æ•°ï¼Œç„¶åå†åœ¨æ„é€ å‡½æ•°ä¸Šçš„ options æ·»åŠ å±æ€§ï¼Œåœ¨resolveComponentOptionså‡½æ•°æ‰§è¡Œåï¼Œåæ·»åŠ çš„å±æ€§æ¶ˆå¤±äº†ã€‚ è¿™æ˜¯å¤ç°é“¾æ¥ï¼šoptionsæ¶ˆå¤±ã€‚ æˆ‘ä»¬è¿™é‡Œçœ‹ä¸€ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627const Test = Vue.extend(&#123; foo: &#x27;Foo&#x27;&#125;)// Inject options later// vue-loader and vue-hot-reload-api are doing like thisTest.options.computed = &#123; $style: &#123; test: &#x27;abcde&#x27; &#125; &#125;Test.options.beforeCreate = [ () =&gt; &#123; console.log(&#x27;Should be printed&#x27;) &#125;]Test.options.render = function (h) &#123; return h(&#x27;div&#x27;, &#x27;$style: &#x27; + this.$style)&#125;// Update super constructor&#x27;s optionsVue.mixin(&#123;&#125;)new Vue(&#123;\trender: h =&gt; h(Test)&#125;).$mount(&#x27;#app&#x27;)// This is retainedconsole.log(Test.options.foo)// Should be appear but notconsole.log(Test.options.computed)console.log(Test.options.beforeCreate) å¯ä»¥çœ‹åˆ°é¦–å…ˆä½¿ç”¨ Vue.extend ç”Ÿæˆäº†ä¸€ä¸ª Testæ„é€ å‡½æ•°ã€‚ ç„¶ååœ¨ Testçš„ optionsä¸Šæ–°å¢äº† 2 ä¸ªå±æ€§ã€‚ æ‰§è¡Œå®ŒVue.mixinåï¼Œå…ˆå‰å®šä¹‰çš„computedã€beforeCreate2ä¸ªå±æ€§ä¸è§äº†ã€‚ 4.2.2 Vue.mixiné‚£ä¹ˆè¿™ä¸ª Vue.mixinç©¶ç«Ÿæ˜¯å¹²äº†å•¥å‘¢ï¼Ÿ 1234Vue.mixin = function (mixin: Object) &#123; this.options = mergeOptions(this.options, mixin) return this&#125; å¯ä»¥çœ‹åˆ°mixinå‡½æ•°ä»…ä»…æ˜¯æ”¹å˜äº†æ„é€ å‡½æ•°ä¸Šçš„optionsã€‚ ä½†æ˜¯ mergeOptions ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´æ„é€ å‡½æ•°çš„ options å‘ç”Ÿäº†å˜åŒ–ã€‚ ä¹Ÿå°±å¯¼è‡´äº†å‰é¢è¯´çš„ superOptions !== cachedSuperOptions æƒ…å†µçš„å‘ç”Ÿã€‚ å› ä¸º superOptions è·å–çš„æ˜¯å½“å‰æœ€æ–°çš„é€‰é¡¹ï¼Œä¹Ÿå°±æ˜¯ mixin æ‰§è¡Œè¿‡çš„åˆå¹¶é€‰é¡¹ã€‚ è€Œ cachedSuperOptions åˆ™æ˜¯åœ¨æ‰§è¡Œ Vue.extend æ—¶å½“æ—¶çš„çˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚ 4.2.3 æ—§ç‰ˆæœ¬Vueä¸­ resolveConstructorOptions çš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿä½†æ˜¯ Vue.mixin ä»…ä»…æ˜¯æ›´æ”¹äº† Vue.optionsã€‚ åº”è¯¥ä¸ä¼šå°†VueComponentæ„é€ å‡½æ•°è‡ªèº«æ·»åŠ çš„å±æ€§æ¸…é™¤ã€‚ æ‰€ä»¥åº”è¯¥æ˜¯ Vueå†…éƒ¨å¯¹å…¶åšäº†ä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚ æˆ‘ä»¬æ‰“å¼€ Vue 2.1.10 ç‰ˆæœ¬çš„ç›¸å…³æºç ã€‚ 1234567891011121314151617181920export function resolveConstructorOptions (Ctor) &#123; let options = Ctor.options if (Ctor.super) &#123; const superOptions = Ctor.super.options const cachedSuperOptions = Ctor.superOptions const extendOptions = Ctor.extendOptions if (superOptions !== cachedSuperOptions) &#123; // super option changed Ctor.superOptions = superOptions extendOptions.render = options.render extendOptions.staticRenderFns = options.staticRenderFns extendOptions._scopeId = options._scopeId options = Ctor.options = mergeOptions(superOptions, extendOptions) if (options.name) &#123; options.components[options.name] = Ctor &#125; &#125; &#125; return options&#125; è·å–äº†çˆ¶æ„é€ å‡½æ•°çš„å½“å‰çš„ optionsï¼šconst superOptions = Ctor.super.optionsã€‚ è·å–äº†çˆ¶æ„é€ å‡½æ•°æ‰§è¡Œextendæ—¶çš„optionsï¼šconst cachedSuperOptions = Ctor.superOptionsã€‚ è·å–äº†å­æ„é€ å‡½æ•° extendæ—¶ä¼ å…¥çš„é€‰é¡¹extendOptionsã€‚ å› ä¸ºæ‰§è¡Œäº†mixinï¼Œå¯¼è‡´çˆ¶æ„é€ å‡½æ•°ä¸­çš„ optionså‘ç”Ÿäº†å˜åŒ–ï¼Œå³superOptions !== cachedSuperOptionsï¼Œç„¶åç»§ç»­æ‰§è¡Œå†…éƒ¨çš„é€»è¾‘ã€‚ 1options = Ctor.options = mergeOptions(superOptions, extendOptions) å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å°†è·å–åˆ°çš„çˆ¶æ„é€ å‡½æ•° optionså’Œå½“åˆ extendä¼ å…¥çš„ optionsåˆå¹¶ï¼Œç„¶åé‡æ–°èµ‹å€¼ç»™äº† Ctor.optionsã€‚ æ‰€ä»¥åæ·»åŠ çš„computedã€beforeCreateå°±æ¶ˆå¤±äº†ï¼Œå› ä¸ºæŒ‡å‘äº†ä¸åŒçš„å†…å­˜ç©ºé—´ã€‚ 4.2.4 æ€»ç»“é€šè¿‡ä¸Šé¢å‡ èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä¸ºä»€ä¹ˆéœ€è¦åˆ¤æ–­çˆ¶ç±»æ„é€ å‡½æ•°çš„å˜åŒ–ã€‚ æˆ‘ä»¬ç³»ç»Ÿæä¾›äº†å…¨å±€æ³¨å…¥çš„ APIï¼šVue.mixinã€‚ ä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥å‘å…¨å±€æ³¨å…¥ä¸€äº›é€‰é¡¹ã€‚ è€Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡æ”¹å˜Vueæ„é€ å‡½æ•°ä¸Šçš„optionï¼Œå†é€šè¿‡è¿™é‡Œçš„å˜æ›´é€»è¾‘é‡æ–°èµ‹å€¼åˆ° VueComponent.optionsä¸Šï¼Œè¿™æ ·ç”Ÿæˆçš„å®ä¾‹å°±å¯ä»¥è®¿é—®åˆ° Vue.mixinæ³¨å…¥çš„å±æ€§äº†ã€‚ 4.3 ä½¿ç”¨resolveModifiedOptionsè·å–æ›´æ”¹çš„å±æ€§åº”å¯¹ä¸Šé¢è¯´çš„è¿™ä¸ª bugï¼ŒVueå®˜æ–¹ä¹Ÿå¯¹è¿™resolveConstructorOptionsæ–¹æ³•è¿›è¡Œäº†è°ƒæ•´ã€‚ é’ˆå¯¹VueComponentæ„é€ å‡½æ•°ä¸Šå¯èƒ½å­˜åœ¨çš„optionsæ›´æ”¹è¿›è¡Œäº†å¤„ç†ã€‚ é¦–å…ˆåœ¨ Vue.extendsä¸­ä¿å­˜äº†VueComponentçš„å½“æ—¶çš„optionsã€‚ 12345Vue.extend = function()&#123; // çœç•¥éƒ¨åˆ†ä»£ç  // å­˜å‚¨äº†å½“æ—¶çš„ options Sub.sealedOptions = extend(&#123;&#125;, Sub.options)&#125; ä½¿ç”¨resolveModifiedOptionsæŸ¥æ‰¾ä¿®æ”¹çš„optionéƒ¨åˆ† 123456789101112function resolveModifiedOptions(Ctor)&#123; let modified const latest = Ctor.options const sealed = Ctor.sealedOptions for (const key in latest) &#123; if (latest[key] !== sealed[key]) &#123; if (!modified) modified = &#123;&#125; modified[key] = latest[key] &#125; &#125; return modified&#125; å°†ä¿®æ”¹çš„ optionsåˆè¿› extendOptions 123if (modifiedOptions) &#123; extend(Ctor.extendOptions, modifiedOptions)&#125; åˆå¹¶ extendOptionsä»¥åŠ superOptions extendOptionsæ˜¯æœ€æ–°çš„å­ç±»æ„é€ å‡½æ•° optionsã€‚ superOptionsæ˜¯æœ€æ–°çš„çˆ¶ç±»æ„é€ å‡½æ•° optionsã€‚ å°†ä¸¤è€…åˆå¹¶å°±ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚ 1options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions) 5.4 æ€»ç»“è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–åˆ°æ„é€ å‡½æ•°ä¸Šæœ€æ–°çš„optionsã€‚ åŒæ—¶å¯ä»¥æ›´æ–°å­ç±»æ„é€ å‡½æ•°å’Œçˆ¶ç±»æ„é€ å‡½æ•°ä¸Šçš„superOptionsã€extendOptionsä»¥åŠ optionsã€‚ äº”ã€mergeOptionsçš„åˆå¹¶åœºæ™¯mergeOptionsåœ¨å®ä¾‹åŒ–æ—¶ç”¨äºåˆå¹¶æ„é€ å‡½æ•°çš„ optionså’Œä¼ å…¥çš„ optionsã€‚ mergeOptions æ˜¯å®ç°ç»§æ‰¿å’Œå®ä¾‹åŒ–çš„æ ¸å¿ƒå‡½æ•°ã€‚ 123456function mergeOptions(parent,child,vm)&#123; // parentä»£è¡¨åˆå¹¶çˆ¶ç±» // childä»£è¡¨åˆå¹¶å­ç±» // vmä»£è¡¨å½“å‰çš„ vmå®ä¾‹ // å¦‚æœvmå®ä¾‹å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè¿™æ˜¯åœ¨å®ä¾‹åŒ–æ—¶è°ƒç”¨çš„&#125; mergeOptionså‡½æ•°ä¸ä»…ä»…ç”¨äºç”Ÿæˆå®ä¾‹çš„$optionså±æ€§ã€‚ ä¹Ÿå¯ä»¥ç”¨äºå­ç±»æ„é€ å‡½æ•°å’Œçˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹åˆå¹¶ã€‚ åœ¨å¤šä¸ªåœºæ™¯éƒ½æ˜¯ç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚ 5.1 Vue.extend1234Vue.extend = function(extendOptions)&#123; // çœç•¥éƒ¨åˆ†ä»£ç  Sub.options = mergeOptions(Super.options,extendOptions)&#125; å‰é¢æˆ‘ä»¬å·²ç»å¤šæ¬¡æåŠè¿™ä¸ªæ–¹æ³•äº†ã€‚ è¿™é‡Œçš„ mergeOptions ç”¨äºåˆå¹¶çˆ¶ç±»æ„é€ å‡½æ•°é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹ï¼Œç”Ÿæˆå­ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚ åœ¨è¿™é‡Œï¼šçˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ç›¸å½“äºçˆ¶ç±»ï¼Œè€Œä¼ å…¥çš„é€‰é¡¹ç›¸å½“äºå­ç±»ã€‚ä¸ä¼ å…¥vmå®ä¾‹ã€‚ 5.2 Vue.mixin1234Vue.mixin = function (mixin: Object) &#123; this.options = mergeOptions(this.options, mixin) return this&#125; å‰é¢æˆ‘ä»¬ä¹Ÿå¤šæ¬¡æåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨äºåˆå¹¶æ„é€ å‡½æ•°çš„optionsï¼Œå’Œä¼ å…¥mixiné€‰é¡¹ï¼Œç”Ÿæˆå…¨æ–°çš„æ„é€ å‡½æ•°çš„ optionsã€‚ åœ¨è¿™é‡Œï¼šæ„é€ å‡½æ•°çš„é€‰é¡¹ç›¸å½“äºçˆ¶ç±»ï¼Œè€Œä¼ å…¥çš„ mixiné€‰é¡¹ç›¸å½“äºå­ç±»ã€‚ä¸ä¼ å…¥vmå®ä¾‹ã€‚ 5.3 vm.$options12345vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm) è¯¥æ–¹æ³•ç”¨äºåœ¨å®ä¾‹åŒ–çš„æ—¶å€™ç”Ÿæˆå®ä¾‹çš„$optionså±æ€§ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºåˆå¹¶å®ä¾‹å¯¹åº”çš„æ„é€ å‡½æ•°çš„é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´åœ°å®ä¾‹é€‰é¡¹ã€‚ åœ¨è¿™é‡Œï¼šæ„é€ å‡½æ•°çš„é€‰é¡¹ç›¸å½“äºçˆ¶ç±»ï¼Œè€Œå®ä¾‹åŒ–æ—¶ä¼ å…¥çš„ mixiné€‰é¡¹ç›¸å½“äºå­ç±»`ã€‚`æ­¤æ—¶ä¼ å…¥vmå®ä¾‹ã€‚ å…­ã€åˆå¹¶ç­–ç•¥åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼šå°†æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹å’Œç”¨æˆ·ä¼ å…¥çš„é€‰é¡¹è¿›è¡Œåˆå¹¶ï¼Œå°†æœ€ç»ˆçš„åˆå¹¶é€‰é¡¹æ³¨å…¥åˆ°å®ä¾‹ä¸­ã€‚ 12345vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm) mergeOptionså‡½æ•°ç”¨äºåˆå¹¶2ä¸ªé€‰é¡¹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„é€‰é¡¹ã€‚ 123456789101112131415161718function mergeOptions(parent,child)&#123; // çœç•¥éƒ¨åˆ†ä»£ç  let key const options = &#123;&#125;; for(key in parent)&#123; mergeField(key) &#125; for (key in child) &#123; if (!hasOwn(parent, key)) &#123; mergeField(key) &#125; &#125; function mergeField(key)&#123; const strat = strats[key] || defaultStrat; options[key] = strat(parent[key], child[key], vm, key) &#125; return options;&#125; å¤§å®¶å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹åˆå¹¶2ä¸ªå¯¹è±¡éœ€è¦æ³¨æ„äº›ä»€ä¹ˆå‘¢ï¼Ÿ å‡è®¾æ„é€ å‡½æ•°çš„optionså’Œä¼ å…¥çš„optionsä¸­éƒ½å­˜åœ¨dataï¼Œè¿™ä¸ªæ—¶å€™åˆå¹¶çš„æ˜¯ï¼š ç›´æ¥è¦†ç›–ï¼Ÿ å¦‚æœè¦†ç›–çš„è¯æ˜¯ä½¿ç”¨æ„é€ å‡½æ•°çš„dataè¿˜æ˜¯ä¼ å…¥çš„data? è¿˜æ˜¯å°†dataä¸­çš„å†…å®¹å†è¿›è¡Œåˆå¹¶å‘¢ï¼Ÿ å®é™…ä¸Šä¸åŒçš„é€‰é¡¹ä¸­çš„éƒ½å­˜åœ¨è‡ªå·±çš„åˆå¹¶é€»è¾‘ã€‚ æ¯”å¦‚dataé€‰é¡¹å’Œç”Ÿå‘½å‘¨æœŸé’©å­é€‰é¡¹åˆå¹¶ç­–ç•¥è‚¯å®šæ˜¯ä¸åŒçš„ã€‚ 6.1 è‡ªå®šä¹‰ç­–ç•¥åœ¨Vueä¸­ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ä¸åŒçš„åˆå¹¶ç­–ç•¥ã€‚ 1234// å¯ä»¥é…ç½®åˆå¹¶ç­–ç•¥Vue.config.optionMergeStrategies = &#123; customArray:[]&#125;; é…ç½®å®Œä»¥åï¼Œå°±å¯ä»¥åœ¨optionMergeStrategiesè·å–ç”¨æˆ·é…ç½®çš„ç­–ç•¥ã€‚ 12// æºç ä¸­å®šä¹‰ç­–ç•¥å˜é‡é¦–å…ˆè·å–optionMergeStrategies å¦‚æœæ²¡æœ‰é…ç½® optionMergeStrategies é»˜è®¤æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡const strats = config.optionMergeStrategies ç„¶åå†åœ¨ stratsè¿™ä¸ªå¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå®šä¹‰ä¸åŒçš„ç­–ç•¥ã€‚ 123456789101112// dataçš„åˆå¹¶ç­–ç•¥strats.data = (parentVal,ChildVal,vm)=&gt;&#123; // xxx&#125;// propsçš„åˆå¹¶ç­–ç•¥strats.props = (parentVal,ChildVal,vm)=&gt;&#123; // xxx&#125;// computedçš„åˆå¹¶ç­–ç•¥strats.computed = (parentVal,ChildVal,vm)=&gt;&#123; // xxx&#125; ç”±äºstratsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä½ å¦‚æœå®šä¹‰äº†å’Œå†…éƒ¨å®šä¹‰çš„ç­–ç•¥ç›¸åŒçš„é€‰é¡¹ï¼Œä¼šè¢«è¦†ç›–æ‰ã€‚ä¹Ÿå°±æ„å‘³ç€ä½ æ— æ³•é‡æ–°å®šä¹‰ dataã€computedã€propsç­‰å†…éƒ¨ç­–ç•¥ ä½†æ˜¯ä½ å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„é€‰é¡¹ã€‚ 12345678910111213import Vue from &quot;vue/dist/vue.esm.browser&quot; import Test from &quot;./Test.vue&quot; Vue.mixin(&#123; customArray:[1,3,5,8,9]&#125;) const vm = new Vue(&#123; render: h=&gt;h(Test), customArray: [1,4,5,7]&#125;).$mount(&quot;#app&quot;) console.log(vm); æ¯”å¦‚ä½ æƒ³è¦å®ç°ä½ è‡ªå®šä¹‰çš„ customArrayé€‰é¡¹ æ•°ç»„å†…å®¹åˆå¹¶å¹¶ä¸”å»é‡ï¼Œå¯ä»¥ä½¿ç”¨ä½¿ç”¨optionMergeStrategies: 123456// parentValä»£è¡¨æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹å€¼ï¼Œ childValä»£è¡¨ä¼ å…¥çš„é€‰é¡¹å€¼Vue.config.optionMergeStrategies.customArray = (parentVal,childVal)=&gt;&#123; // å…¶ä»–Vueç»„ä»¶æ²¡æœ‰å®šä¹‰ä¸è¿›è¡Œå¤„ç† if(!childVal) return []; return Array.from(new Set([...parentVal,...childVal]))&#125; æˆ‘ä»¬æ‰“å°ä¸€ä¸‹è¿™ä¸ªå®ä¾‹ï¼Œå¯ä»¥å‘ç°å·²ç»æˆåŠŸäº†ã€‚ 6.2 é»˜è®¤çš„åˆå¹¶ç­–ç•¥ç”±äºå¯ä»¥é€‰é¡¹é«˜åº¦å¯è‡ªå®šä¹‰ï¼Œæ‰€ä»¥ Vueä¸­å†…ç½®äº†ä¸€å¥—é»˜è®¤çš„åˆå¹¶ç­–ç•¥ã€‚ ä¸»è¦åº”å¯¹æ²¡æœ‰è®¾ç½®å¯¹åº”ç­–ç•¥çš„åˆå¹¶æƒ…å†µã€‚ 123const defaultStrat = function (parentVal, childVal) &#123; return childVal === undefined ? parentVal : childVal&#125; å¯ä»¥çœ‹å‡ºæ¥é»˜è®¤çš„åˆå¹¶ç­–ç•¥æ˜¯ä¼ å…¥çš„optionsç›´æ¥å¯¹æ„é€ å‡½æ•°çš„optionsè¿›è¡Œå¼ºåˆ¶è¦†ç›–ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ã€‚ 6.3 elã€propsDataçš„åˆå¹¶ç­–ç•¥å¯ä»¥çœ‹å‡ºæ¥ elã€propsDataçš„åˆå¹¶ç­–ç•¥å’Œé»˜è®¤ç­–ç•¥ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå¼€å‘ç¯å¢ƒçš„æŠ¥é”™æç¤ºã€‚ 12345678910111213141516if (__DEV__) &#123; strats.el = strats.propsData = function ( parent: any, child: any, vm: any, key: any ) &#123; if (!vm) &#123; warn( `option &quot;$&#123;key&#125;&quot; can only be used during instance ` + &#x27;creation with the `new` keyword.&#x27; ) &#125; return defaultStrat(parent, child) &#125;&#125; é‚£ä¹ˆè¿™ä¸ªæŠ¥é”™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ ç­–ç•¥å‡½æ•°çš„çš„ç¬¬ä¸‰ä¸ªå‚æ•°vmä»£è¡¨vueå®ä¾‹ã€‚ è€Œè¿™ä¸ªvmåŒæ—¶ä¹Ÿæ˜¯mergeOptionsçš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ è€Œ mergeOptionsä½œä¸ºä¸€ä¸ªé€šç”¨å‡½æ•°ï¼Œä¸ä»…åªæ˜¯åœ¨å®ä¾‹åˆå§‹åŒ–çš„æ—¶å€™è¢«è°ƒç”¨ï¼ŒåŒæ—¶ä¹Ÿåœ¨Vue.extendã€Vue.mixinç­‰å¤šä¸ªæ–¹æ³•ä¸­è¢«ä½¿ç”¨ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ç”Ÿæˆ vmå®ä¾‹ï¼Œæ‰€ä»¥ vmä¸ºç©ºã€‚è€Œ elå±æ€§ã€propsDataå±æ€§æ˜¯å±äºè·Ÿå®ä¾‹ç›¸å…³çš„å±æ€§ï¼Œæ‰€ä»¥å¦‚æœåœ¨Vue.mixinç­‰æ–¹æ³•ä¸­æ³¨å…¥ elå±æ€§ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™è¡ŒæŠ¥é”™çš„æ„æ€å°±æ˜¯ç¦æ­¢åœ¨é™¤äº†å®ä¾‹åŒ–ä¹‹å¤–çš„åœ°æ–¹æ³¨å…¥ elé€‰é¡¹ã€‚ æ¯”å¦‚è°ƒç”¨ï¼š 123Vue.mixin(&#123; el:&quot;#select&quot;&#125;) æ§åˆ¶å°å°±ä¼šæŠ¥é”™ï¼š 6.4 dataçš„åˆå¹¶ç­–ç•¥dataé€‰é¡¹åœ¨ Vueä¸­æ— ç–‘æ˜¯ä½¿ç”¨æœ€é¢‘ç¹çš„é€‰é¡¹ä¹‹ä¸€ã€‚ æ‰€ä»¥å®ƒçš„åˆå¹¶ç­–ç•¥ç›¸å½“å¤æ‚ã€‚ 12345678910111213141516171819202122strats.data = function ( parentVal: any, childVal: any, vm?: Component): Function | null &#123; if (!vm) &#123; if (childVal &amp;&amp; typeof childVal !== &#x27;function&#x27;) &#123; __DEV__ &amp;&amp; warn( &#x27;The &quot;data&quot; option should be a function &#x27; + &#x27;that returns a per-instance value in component &#x27; + &#x27;definitions.&#x27;, vm ) return parentVal &#125; return mergeDataOrFn(parentVal, childVal) &#125; return mergeDataOrFn(parentVal, childVal, vm)&#125; 6.4.1 åœ¨å®šä¹‰æ—¶æŠ¥é”™æˆ‘ä»¬çŸ¥é“é€šå¸¸åœ¨ç»„ä»¶ä¸­ï¼Œå»ºè®®å°† dataå®šä¹‰æˆå‡½æ•°ï¼Œå› ä¸ºå¦‚æœå°† dataå®šä¹‰æˆæ™®é€šå¯¹è±¡ï¼Œåœ¨è¯¥ç»„ä»¶è¢«å¼•å…¥åˆ°å¤šå¤„æ—¶ï¼Œç”±äº extendå‡½æ•°å†…éƒ¨ä¼šç¼“å­˜è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ dataä¸­çš„æ•°æ®å¯èƒ½ä¼šè¢«å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¯¼è‡´ bugçš„äº§ç”Ÿã€‚ childValåœ¨è¿™é‡Œä»£è¡¨ä¼ å…¥çš„é€‰é¡¹ï¼Œå³åœ¨ç»„ä»¶ä¸­å®šä¹‰çš„é€‰é¡¹ã€‚ æ‰€ä»¥ä¼šæç¤ºä½ éœ€è¦å°† dataå®šä¹‰æˆå‡½æ•°ï¼Œå¹¶ä¸”ä¾æ—§è°ƒç”¨ mergeDataOrFnã€‚ åœ¨æ‰§è¡Œæ„é€ å‡½æ•°æ—¶åˆ›å»ºå­ç±»æ„é€ å‡½æ•°æ—¶ï¼Œè™½ç„¶å·²ç»æœ‰äº† vmäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¼ å…¥ mergeOptionsã€‚ 123Vue.extend = function()&#123; Sub.options = mergeOptions(Super.options, extendOptions);&#125; æ‰€ä»¥è¿™ä¸ªæŠ¥é”™æ˜¯åœ¨åˆ›å»ºå­ç±»æ„é€ å‡½æ•°æ—¶è¿›è¡Œæç¤ºçš„ã€‚ 6.4.2 mergeDataOrFn1234567891011121314151617181920export function mergeDataOrFn( parentVal, childVal, vm) &#123; return function mergedInstanceDataFn() &#123; // instance merge const instanceData = isFunction(childVal) ? childVal.call(vm, vm) : childVal const defaultData = isFunction(parentVal) ? parentVal.call(vm, vm) : parentVal if (instanceData) &#123; return mergeData(instanceData, defaultData) &#125; else &#123; return defaultData &#125; &#125;&#125; è¯¥å‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ªåˆå¹¶å‡½æ•°ã€‚ å½“è¿™ä¸ªåˆå¹¶å‡½æ•°æ‰§è¡Œçš„æ—¶å€™å°†è·å–æ„é€ å‡½æ•°çš„ä¸Šçš„dataå’Œä¼ å…¥çš„data å½“ä¼ å…¥çš„é€‰é¡¹ä¸­å­˜åœ¨ dataï¼Œåˆ™è°ƒç”¨mergeDataåˆå¹¶ 2 ä¸ªdataå¹¶è¿”å›ã€‚ å½“ä¼ å…¥çš„é€‰é¡¹ä¸­ä¸å­˜åœ¨ dataæ—¶ï¼Œåˆ™ç›´æ¥è¿”å›æ„é€ å‡½æ•°ä¸Šçš„ dataã€‚ 6.4.3 mergeDataå½“æ„é€ å‡½æ•°çš„é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹éƒ½å­˜åœ¨ dataæ—¶ï¼Œéœ€è¦è°ƒç”¨ mergeDataå¯¹ 2 ä¸ªé€‰é¡¹è¿›è¡Œåˆå¹¶ã€‚ 123456789101112131415161718192021222324252627282930function mergeData( to, from, recursive = true)&#123; if (!from) return to let key, toVal, fromVal const keys = hasSymbol ? Reflect.ownKeys(from) : Object.keys(from) for (let i = 0; i &lt; keys.length; i++) &#123; key = keys[i] // in case the object is already observed... if (key === &#x27;__ob__&#x27;) continue toVal = to[key] fromVal = from[key] if (!recursive || !hasOwn(to, key)) &#123; set(to, key, fromVal) &#125; else if ( toVal !== fromVal &amp;&amp; isPlainObject(toVal) &amp;&amp; isPlainObject(fromVal) ) &#123; mergeData(toVal, fromVal) &#125; &#125; return to&#125; è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯åˆå¹¶ä¸¤ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥ç”¨äºåˆå§‹åŒ–ç»„ä»¶çš„æ•°æ®å¯¹è±¡ï¼Œæˆ–è€…åœ¨ç»„ä»¶çš„ created é’©å­ä¸­åˆå¹¶çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶çš„æ•°æ®ã€‚é€šè¿‡ recursive å‚æ•°ï¼Œå®ƒå¯ä»¥çµæ´»åœ°è¿›è¡Œæµ…åˆå¹¶æˆ–æ·±åº¦åˆå¹¶ã€‚ ç”±äºå…¶ä¸­æ¶‰åŠåˆ°å“åº”å¼æ•°æ®çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸åœ¨è¿™é‡Œæ·±å…¥è®¨è®ºã€‚ åé¢ä¼šå•ç‹¬å‡ºå“åº”å¼æ•°æ®çš„å†…å®¹ã€‚ 6.5 ç”Ÿå‘½å‘¨æœŸçš„åˆå¹¶ç­–ç•¥1234567891011121314151617181920212223242526272829303132333435363738394041424344export const LIFECYCLE_HOOKS = [ &#x27;beforeCreate&#x27;, &#x27;created&#x27;, &#x27;beforeMount&#x27;, &#x27;mounted&#x27;, &#x27;beforeUpdate&#x27;, &#x27;updated&#x27;, &#x27;beforeDestroy&#x27;, &#x27;destroyed&#x27;, &#x27;activated&#x27;, &#x27;deactivated&#x27;, &#x27;errorCaptured&#x27;, &#x27;serverPrefetch&#x27;, &#x27;renderTracked&#x27;, &#x27;renderTriggered&#x27;]LIFECYCLE_HOOKS.forEach(hook =&gt; &#123; strats[hook] = mergeLifecycleHook&#125;)// ç”Ÿå‘½å‘¨æœŸçš„åˆå¹¶ç­–ç•¥export function mergeLifecycleHook( parentVal, childVal)&#123; const res = childVal ? parentVal ? parentVal.concat(childVal) : isArray(childVal) ? childVal : [childVal] : parentVal return res ? dedupeHooks(res) : res&#125;function dedupeHooks(hooks) &#123; const res = [] for (let i = 0; i &lt; hooks.length; i++) &#123; if (res.indexOf(hooks[i]) === -1) &#123; res.push(hooks[i]) &#125; &#125; return res&#125; ä¸Šé¢è¿™ä¸ªä¸‰å…ƒè¡¨è¾¾å¼è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚ å¦‚æœå­ç±»å’Œçˆ¶ç±»éƒ½æ‹¥æœ‰ç›¸åŒçš„é’©å­é€‰é¡¹ï¼Œåˆ™å°†å­ç±»é€‰é¡¹å’Œçˆ¶ç±»é€‰é¡¹åˆå¹¶ã€‚ å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨é’©å­é€‰é¡¹ï¼Œå­ç±»å­˜åœ¨æ—¶ï¼Œåˆ™ä»¥æ•°ç»„å½¢å¼è¿”å›å­ç±»é’©å­é€‰é¡¹ã€‚ å½“å­ç±»ä¸å­˜åœ¨é’©å­é€‰é¡¹æ—¶ï¼Œåˆ™ä»¥çˆ¶ç±»é€‰é¡¹è¿”å›ã€‚ å­çˆ¶åˆå¹¶æ—¶ï¼Œæ˜¯å°†å­ç±»é€‰é¡¹æ”¾åœ¨æ•°ç»„çš„æœ«å°¾ï¼Œè¿™æ ·åœ¨æ‰§è¡Œé’©å­æ—¶ï¼Œæ°¸è¿œæ˜¯çˆ¶ç±»é€‰é¡¹ä¼˜å…ˆäºå­ç±»é€‰é¡¹æ‰§è¡Œã€‚ ç®€å•æ€»ç»“ä¸€ä¸‹ï¼šå¯¹äºç”Ÿå‘½å‘¨æœŸé’©å­é€‰é¡¹ï¼Œå­ç±»å’Œçˆ¶ç±»ç›¸åŒçš„é€‰é¡¹å°†åˆå¹¶æˆæ•°ç»„ï¼Œè¿™æ ·åœ¨æ‰§è¡Œå­ç±»é’©å­å‡½æ•°æ—¶ï¼Œçˆ¶ç±»é’©å­é€‰é¡¹ä¹Ÿä¼šæ‰§è¡Œï¼Œå¹¶ä¸”çˆ¶ä¼šä¼˜å…ˆäºå­æ‰§è¡Œã€‚ 6.6 ç»„ä»¶ã€æŒ‡ä»¤ã€è¿‡æ»¤å™¨çš„åˆå¹¶ç­–ç•¥12345678910111213141516171819export const ASSET_TYPES = [&#x27;component&#x27;, &#x27;directive&#x27;, &#x27;filter&#x27;]ASSET_TYPES.forEach(function (type) &#123; strats[type + &#x27;s&#x27;] = mergeAssets&#125;)function mergeAssets( parentVal, childVal, vm, key) &#123; const res = Object.create(parentVal || null) if (childVal) &#123; return extend(res, childVal) &#125; else &#123; return res &#125;&#125; å¾ˆæ˜æ˜¾ ç»„ä»¶ã€æŒ‡ä»¤ã€è¿‡æ»¤å™¨çš„åˆå¹¶ç­–ç•¥å°±æ˜¯ç›´æ¥å¯¹æ„é€ å‡½æ•°çš„é€‰é¡¹è¿›è¡Œè¦†ç›–ã€‚ Object.create()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨åˆ›å»ºçš„å¯¹è±¡æ¥æä¾›æ–°åˆ›å»ºçš„å¯¹è±¡çš„__proto__ã€‚ è¿™æ„å‘³ç€è¿™ä¸ªåˆå¹¶ç­–ç•¥è®©å†…ç½®çš„ä¸€äº›èµ„æºé€‰é¡¹å˜æˆäº†åŸå‹é“¾çš„å½¢å¼ã€‚ è¿™æ ·å­ç±»å¿…é¡»é€šè¿‡åŸå‹é“¾æ‰èƒ½æŸ¥æ‰¾å¹¶ä½¿ç”¨å†…ç½®çš„ç»„ä»¶å’Œå†…ç½®æŒ‡ä»¤ã€‚ 6.7 watchçš„åˆå¹¶ç­–ç•¥åœ¨ä½¿ç”¨ Vue è¿›è¡Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹æ•°æ®å˜åŒ–åšå‡ºå“åº”ï¼Œå°¤å…¶æ˜¯å½“æ¶‰åŠåˆ°éœ€è¦æ‰§è¡Œå¼‚æ­¥æ“ä½œæˆ–è®¡ç®—æˆæœ¬è¾ƒé«˜çš„ä»»åŠ¡æ—¶ï¼Œwatch é€‰é¡¹å°±æ˜¾å¾—å°¤ä¸ºé«˜æ•ˆã€‚ å…³äº watch é€‰é¡¹çš„åˆå¹¶ç­–ç•¥ï¼Œå®ƒä¸ç”Ÿå‘½å‘¨æœŸé’©å­çš„åˆå¹¶æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼šå¦‚æœçˆ¶ç»„ä»¶å’Œå­ç»„ä»¶æœ‰ç›¸åŒçš„è§‚å¯Ÿå­—æ®µï¼Œå®ƒä»¬çš„ watch é€‰é¡¹å°†è¢«åˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ã€‚ å½“ç›‘æµ‹åˆ°å­—æ®µå˜åŒ–æ—¶ï¼Œçˆ¶ç±»å’Œå­ç±»çš„ç›‘å¬ä»£ç å°†è¢«åŒæ—¶è§¦å‘ã€‚ ä¸ç”Ÿå‘½å‘¨æœŸé’©å­çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œwatch é€‰é¡¹åœ¨åˆå¹¶åçš„æ•°ç»„ä¸­å¯ä»¥å‘ˆç°å¤šç§å½¢å¼ï¼šå®ƒä»¬å¯ä»¥æ˜¯åŒ…å«é€‰é¡¹çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å›è°ƒå‡½æ•°ï¼Œæˆ–è€…æ˜¯æ–¹æ³•åçš„å­—ç¬¦ä¸²ã€‚ è¿™ç§çµæ´»æ€§ä½¿å¾— watch é€‰é¡¹èƒ½å¤Ÿé€‚åº”æ›´å¤šçš„ä½¿ç”¨åœºæ™¯ï¼Œæ— è®ºæ˜¯ç®€å•çš„æ•°æ®å˜åŒ–ç›‘å¬è¿˜æ˜¯å¤æ‚çš„å¼‚æ­¥æ“ä½œå¤„ç†ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒVue å…è®¸å¼€å‘è€…åœ¨ç»„ä»¶å’Œæ··å…¥ä¸­çµæ´»åœ°å®šä¹‰å’Œåˆå¹¶ watch é€‰é¡¹ï¼Œä»è€Œå®ç°ç²¾ç»†åŒ–çš„æ•°æ®ç›‘æ§å’Œç®¡ç†ã€‚ 12345678910111213141516171819202122232425262728strats.watch = function (parentVal,childVal,vm,key) &#123; //ç«ç‹æµè§ˆå™¨åœ¨Objectçš„åŸå‹ä¸Šæ‹¥æœ‰watchæ–¹æ³•ï¼Œè¿™é‡Œå¯¹è¿™ä¸€ç°è±¡åšäº†å…¼å®¹ // var nativeWatch = (&#123;&#125;).watch; if (parentVal === nativeWatch) &#123; parentVal = undefined; &#125; if (childVal === nativeWatch) &#123; childVal = undefined; &#125; // æ²¡æœ‰å­ï¼Œåˆ™é»˜è®¤ç”¨çˆ¶é€‰é¡¹ if (!childVal) &#123; return Object.create(parentVal || null) &#125; &#123; // ä¿è¯watché€‰é¡¹æ˜¯ä¸€ä¸ªå¯¹è±¡ assertObjectType(key, childVal, vm); &#125; // æ²¡æœ‰çˆ¶åˆ™ç›´æ¥ç”¨å­é€‰é¡¹ if (!parentVal) &#123; return childVal &#125; var ret = &#123;&#125;; extend(ret, parentVal); for (var key$1 in childVal) &#123; var parent = ret[key$1]; var child = childVal[key$1]; // çˆ¶çš„é€‰é¡¹å…ˆè½¬æ¢æˆæ•°ç»„ if (parent &amp;&amp; !Array.isArray(parent)) &#123; parent = [parent]; &#125; ret[key$1] = parent ? parent.concat(child) : Array.isArray(child) ? child : [child]; &#125; return ret&#125;; ä¸‹é¢ç»“åˆå…·ä½“çš„ä¾‹å­çœ‹åˆå¹¶ç»“æœï¼š 1234567891011121314151617181920212223242526var Parent = Vue.extend(&#123; watch: &#123; &#x27;test&#x27;: function() &#123; console.log(&#x27;parent change&#x27;) &#125; &#125;&#125;)var Child = Parent.extend(&#123; watch: &#123; &#x27;test&#x27;: &#123; handler: function() &#123; console.log(&#x27;child change&#x27;) &#125; &#125; &#125;, data() &#123; return &#123; test: 1 &#125; &#125;&#125;)var vm = new Child().$mount(&#x27;#app&#x27;);vm.test = 2;// è¾“å‡ºç»“æœparent changechild change ç®€è€Œè¨€ä¹‹:Vue åœ¨å¤„ç† watch é€‰é¡¹çš„åˆå¹¶æ—¶ï¼Œä¼šå°†å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„ watch é€‰é¡¹åˆå¹¶æˆä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„æˆå‘˜å¯ä»¥æ˜¯å›è°ƒå‡½æ•°ã€åŒ…å«é…ç½®çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯æŒ‡å‘å‡½æ•°çš„æ–¹æ³•åã€‚è¿™æ ·çš„è®¾è®¡æä¾›äº†çµæ´»çš„é€‰é¡¹ï¼Œä»¥é€‚åº”ä¸åŒçš„æ•°æ®ç›‘æ§éœ€æ±‚ã€‚ 6.8 props methods inject computedåˆå¹¶åœ¨ Vue çš„æºç è®¾è®¡ä¸­ï¼Œpropsã€methodsã€inject å’Œ computed è¿™äº›é€‰é¡¹è¢«å½’ä¸ºä¸€ç±»ï¼Œå¹¶ä¸”å®ƒä»¬éµå¾ªç›¸åŒçš„åˆå¹¶ç­–ç•¥ã€‚ 12345678910111213141516171819strats.props = strats.methods = strats.inject = strats.computed = function ( parentVal, childVal, vm, key) &#123; if (childVal &amp;&amp; __DEV__) &#123; assertObjectType(key, childVal, vm) &#125; if (!parentVal) return childVal const ret = Object.create(null) extend(ret, parentVal) if (childVal) extend(ret, childVal) return ret&#125; ç®€è€Œè¨€ä¹‹ã€‚ çˆ¶ç±»æ²¡æœ‰ç›¸åº”çš„é€‰é¡¹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å­ç±»çš„é€‰é¡¹ å½“çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶éƒ½æä¾›äº†è¿™äº›é€‰é¡¹æ—¶ï¼Œå­ç»„ä»¶çš„é€‰é¡¹ä¼šè¦†ç›–çˆ¶ç»„ä»¶çš„é€‰é¡¹ã€‚è¿™ç§ç­–ç•¥ç¡®ä¿äº†ç»„ä»¶èƒ½å¤Ÿç»§æ‰¿å’Œæ‰©å±•è¡Œä¸ºï¼ŒåŒæ—¶å…è®¸å­ç»„ä»¶é€šè¿‡æä¾›è‡ªå·±çš„é€‰é¡¹æ¥è¦†ç›–ç»§æ‰¿è‡ªçˆ¶ç»„ä»¶æˆ–æ··å…¥çš„é€‰é¡¹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 12345678910111213141516171819202122232425262728var Parent = Vue.extend(&#123; methods:&#123; handleClick:function()&#123; console.log(&quot;çˆ¶ç±»ç‚¹å‡»äº‹ä»¶&quot;) &#125;, getParentName:function()&#123; console.log(&quot;è·å–çˆ¶ç±»åç§°&quot;) &#125; &#125;&#125;)var Child = Parent.extend(&#123; methods:&#123; handleClick:function()&#123; console.log(&quot;å­ç±»ç‚¹å‡»äº‹ä»¶&quot;) &#125;, getChildName:function()&#123; console.log(&quot;è·å–çˆ¶ç±»åç§°&quot;) &#125; &#125;&#125;)var vm = new Child().$mount(&#x27;#app&#x27;);console.log(vm.$options.methods);// åˆå¹¶å­ç±»å’Œçˆ¶ç±»ï¼Œé‡åˆ°ç›¸åŒçš„å±æ€§ï¼Œä½¿ç”¨å­ç±»è¦†ç›–çˆ¶ç±»&#123; getChildName:f(), getParentName:f(), handleClick:f(),&#125; 6.9 provideåˆå¹¶ç¡®ä¿äº†å­ç»„ä»¶çš„ provide é€‰é¡¹å¯ä»¥è¦†ç›–çˆ¶ç»„ä»¶çš„åŒåé€‰é¡¹ï¼ŒåŒæ—¶ä¿ç•™äº†çˆ¶ç»„ä»¶çš„å…¶ä»–é€‰é¡¹ã€‚è¿™ç§è®¾è®¡å…è®¸ç»„ä»¶åœ¨ç»§æ‰¿å’Œæ‰©å±• provide æ•°æ®æ—¶æœ‰æ›´å¤šçš„çµæ´»æ€§ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒVue å…è®¸å¼€å‘è€…åœ¨ç»„ä»¶æ ‘ä¸­æœ‰æ•ˆåœ°ä¼ é€’æ•°æ®ï¼Œè€Œæ— éœ€é€šè¿‡æ¯ä¸ªå±‚çº§çš„ç»„ä»¶æ˜¾å¼åœ°ä¼ é€’ propsã€‚ 123456789101112131415strats.provide = function (parentVal, childVal) &#123; if (!parentVal) return childVal return function () &#123; const ret = Object.create(null) mergeData(ret, isFunction(parentVal) ? parentVal.call(this) : parentVal) if (childVal) &#123; mergeData( ret, isFunction(childVal) ? childVal.call(this) : childVal, false // non-recursive ) &#125; return ret &#125;&#125;"},{"title":"ğŸ”¥Vue2çš„åŸºæœ¬ä½¿ç”¨å’ŒåŸå‹è®¾è®¡","path":"//posts/vue2-constructor.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬ä¸‰ç¯‡-åŸºæœ¬ä½¿ç”¨å’ŒåŸå‹è®¾è®¡ &emsp;&emsp;åœ¨å‰é¢ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰äº†æºç çš„ç›®å½•ç»“æ„ä»¥åŠæ„å»ºæ–¹å¼ã€‚ &emsp;&emsp;ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ¥è¯´ä¸‹Vueçš„åŸå‹è®¾è®¡ã€‚ ä¸€ã€Vueçš„åŸºç¡€ä½¿ç”¨å®˜æ–¹æ¨è Vue çš„ä½¿ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šé€šè¿‡ CDN å’Œ NPMã€‚ ä½¿ç”¨ CDNï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ HTML ä¸­æ·»åŠ  &lt;script&gt; æ ‡ç­¾ç›´æ¥å¼•å…¥æ‰“åŒ…å¥½çš„ vue.js æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ç§å¿«é€Ÿä¸”ç®€ä¾¿çš„æ–¹æ³•ã€‚ 12// CDNæ–¹å¼&lt;script src=&quot;vue.js&quot;&gt;&lt;/script&gt; è€Œ NPM æ–¹å¼åˆ™æ¶‰åŠåˆ°ä¸æ¨¡å—æ‰“åŒ…å·¥å…·å¦‚ webpack æˆ– Browserify çš„é›†æˆï¼Œé€šè¿‡æ‰§è¡Œ npm install vue å‘½ä»¤æ¥å®‰è£… Vueï¼Œè¿™é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨å¼€å‘å¤§å‹åº”ç”¨æ—¶çš„é¦–é€‰æ–¹å¼ã€‚ 12// NPMæ–¹å¼import Vue from &#x27;vue&#x27;; å½“Vueè¢«å¼•å…¥æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåœ¨å…¥å£æ–‡ä»¶ä¸­å» new ä¸€ä¸ªVueå®ä¾‹ã€‚ ç„¶åå†åˆ©ç”¨å®ä¾‹ä¸Šçš„$mountæ–¹æ³•å°†å¯¹åº”çš„æ¨¡ç‰ˆå†…å®¹æŒ‚è½½åˆ°æµè§ˆå™¨ä¸­#appèŠ‚ç‚¹çš„ä½ç½®ä¸Šã€‚ 12345678// NPMæ–¹å¼// Nodejsç‰ˆæœ¬import Vue from &#x27;vue/dist/vue.common&#x27;;// éœ€è¦å®ä¾‹åŒ– Vuenew Vue(&#123; template:`&lt;div&gt;Hello World&lt;/div&gt;`&#125;).$mount(&quot;#app&quot;); äºŒã€ä¸ºä»€ä¹ˆVueä¸æ˜¯ä¸€ä¸ªç±»ä¸Šä¸€èŠ‚æˆ‘ä»¬è¯´äº†ä½¿ç”¨ Vue éœ€è¦ new ä¸€ä¸‹ã€‚ æ‰€ä»¥ä½ å¯èƒ½ä¼šä¹ æƒ¯æ€§çš„è®¤ä¸º Vue æ˜¯ä¸€ä¸ªç±»ã€‚ ä½†æ˜¯æˆ‘ä»¬æ‰“å¼€Vueè¢«å®šä¹‰çš„core/instance/index.jsæ–‡ä»¶ã€‚ 123456function Vue(options) &#123; if (__DEV__ &amp;&amp; !(this instanceof Vue)) &#123; warn(&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;) &#125; this._init(options)&#125; ä¼šå‘ç°Vueæ˜¯ä½¿ç”¨å‡½æ•°å®šä¹‰çš„ã€‚ é‚£ä¹ˆVueæºç ä¸­ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç±»å‘¢ï¼Ÿ åœ¨Vueä¸­æœ‰å¤§é‡çš„æ‰©å±•å®ä¾‹å±æ€§çš„æ“ä½œå¦‚ï¼šVue.prototype.$mount=xxxã€‚ å…¶å®æœ¬è´¨ä¸Šç±»åªæ˜¯functionçš„è¯­æ³•ç³–ã€‚ è™½ç„¶è¯´ä½¿ç”¨ç±»ä¹Ÿå¯ä»¥è¿›è¡Œæ‰©å±•ï¼š 123456class Animate&#123;&#125;Animate.prototype.eat = function()&#123; console.log(&quot;åŠ¨ç‰©åƒä¸œè¥¿&quot;)&#125;new Animate().eat();// åŠ¨ç‰©åƒä¸œè¥¿ ä½†æ˜¯ç”¨ç±»å’ŒåŸå‹è¿™ä¹ˆæ··åˆä½¿ç”¨ï¼Œéš¾å…ä¼šè®©äººæ„Ÿåˆ°ä¸é€‚ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§å¼€å‘è§„èŒƒå’Œä¹ æƒ¯å§ã€‚ å¤§éƒ¨åˆ†å¼€æºåº“ä¾æ—§ä½¿ç”¨çš„æ˜¯æ„é€ å‡½æ•°functionçš„æ–¹å¼ã€‚ ä¸‰ã€å¿…é¡»ä½¿ç”¨newå…³é”®å­—æ¥è°ƒç”¨å¯ä»¥çœ‹åˆ°åœ¨Vueæ„é€ å‡½æ•°å†…éƒ¨å­˜åœ¨ä¸€ä¸ªåˆ¤æ–­ this instanceof Vueï¼Œé‚£ä¹ˆè¿™è¡Œä»£ç åº”è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“é€šè¿‡ instanceofå¯ä»¥é¡ºç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾å¯¹åº”çš„æ„é€ å‡½æ•°ã€‚ æ‰€ä»¥è¿™ä¸ªåˆ¤æ–­çš„æ„æ€å°±æ˜¯æ£€æŸ¥å½“å‰ä¸Šä¸‹æ–‡ï¼ˆthisï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ª Vueå®ä¾‹ã€‚ å¦‚æœä¸æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå°±ä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Šã€‚ è¿™è¦å‘ŠçŸ¥å¼€å‘è€…Vueåº”è¯¥è¦ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°æ¥ä½¿ç”¨ã€‚ 123456// instance/index.jsfunction Vue(options) &#123; if(__DEV__ &amp;&amp; !this instanceof Vue)&#123; warn(&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;) &#125;&#125; å‡è®¾ä½ è¿™ä¹ˆä½¿ç”¨ Vueï¼š 1const vm = Vue() é‚£ä¹ˆä½ å°†ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ä¸€æ¡æŠ¥é”™ä¿¡æ¯ã€‚ å››ã€Vueçš„åŸå‹è®¾è®¡Vueæ˜¯ä¸€ä¸ªåŸºäºåŸå‹è®¾è®¡çš„å‰ç«¯æ¡†æ¶ã€‚ åœ¨Vueè¢«å¼•å…¥ import Vue from vueæ—¶ï¼Œä¼šé€šè¿‡å¤šä¸ªå‡½æ•°åœ¨VueåŸå‹ä¸Šæ·»åŠ ä¸Šä¸€ç³»åˆ—çš„æ–¹æ³•ã€‚ 123456// è¯¥å‡½æ•°åœ¨ Vueè¢«å¼•å…¥æ—¶æ‰§è¡Œexport function lifecycleMixin(Vue)&#123; Vue.prototype._update = ()=&gt;&#123; // xxxx &#125;&#125; é‚£ä¹ˆåœ¨Vue.prototypeä¸Šå®šä¹‰æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ å‰é¢2èŠ‚ï¼Œæˆ‘ä»¬è¯´åˆ° Vueæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š 123function Vue()&#123; //xxx&#125; æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ newå…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ª vueå®ä¾‹ã€‚ 1const vm = new Vue(); æ„é€ å‡½æ•°ä¸åŸå‹å¯¹è±¡ï¼šæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ª prototypeå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡è¢«å«åšåŸå‹å¯¹è±¡ï¼ŒåŒ…å«äº†ç”±è¯¥æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹å…±äº«å±æ€§å’Œæ–¹æ³•ã€‚ å®ä¾‹å¯¹è±¡çš„ __proto__ å±æ€§ï¼šæ¯ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª __proto__ å±æ€§ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šVueæ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ï¼ˆVue.prototypeï¼‰å’ŒåŸºäºå®ƒåˆ›å»ºçš„å®ä¾‹çš„éšå¼åŸå‹ï¼ˆvm.__proto__ï¼‰æŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜ç©ºé—´ã€‚ å½“ Vueå®ä¾‹è®¿é—®æŸä¸ªå±æ€§æ—¶ï¼Œå¦‚æœåœ¨è‡ªèº«å±æ€§ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šæ²¿ç€__proto__å±æ€§æŒ‡å‘çš„åŸå‹å¯¹è±¡è¿›è¡ŒæŸ¥æ‰¾ã€‚ æ‰€ä»¥é€šè¿‡ vm å¯ä»¥è®¿é—®åˆ°å®šä¹‰åœ¨ Vue.prototype çš„å±æ€§å’Œæ–¹æ³•ã€‚ é€šç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•æ–¹æ³•ï¼Œå¹¶ä¸ç”¨æ˜¾ç¤ºçš„åœ¨ vm ä¸Šè®¾ç½®æ–¹æ³•ï¼Œåšåˆ°äº†ç›¸å¯¹éš”ç¦»ã€‚ äº”ã€Vue.extendåˆ©ç”¨åŸå‹é“¾ç»§æ‰¿ç”Ÿæˆâ€œå­ç±»â€œæ„é€ å‡½æ•°Vue.extendæ˜¯å®šä¹‰åœ¨Vueè¿™ä¸ªæ„é€ å‡½æ•°ä¸Šçš„æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¸»è¦ç”¨äºåˆ›å»ºVueæ„é€ å‡½æ•°çš„â€œå­ç±»â€œï¼Œè¯¥â€œå­ç±»â€œç»§æ‰¿ Vueæ„é€ å‡½æ•°ä¸Šçš„åŸå‹æ–¹æ³•å’ŒåŸå‹å±æ€§ã€‚ è™½ç„¶Vueåœ¨æŠ€æœ¯ä¸Šä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç±»ï¼Œä½†æ˜¯Vue.extendæä¾›äº†ä¸€ç§ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ç»§æ‰¿çš„æ–¹å¼æ¥å®šä¹‰ç»„ä»¶ã€‚ 123456789101112131415// å¯¹åŸå‡½æ•°è¿›è¡Œäº†ä¸€äº›ç®€åŒ– åªä¿ç•™äº†æ ¸å¿ƒVue.extend = function()&#123; // this ä¸º Vueæ„é€ å‡½æ•° const Super = this; // Sub ä¸º VueComponentæ„é€ å‡½æ•°ï¼Œä»£è¡¨ç»„ä»¶æ„é€ å‡½æ•° const Sub = function VueComponent(this)&#123; // å’Œ Vueæ„é€ å‡½æ•°ä¸€æ · ä¼šè°ƒç”¨_initæ–¹æ³• this._init(options); &#125;; // åŸºäº Vue.prototype åˆ›å»ºä¸€å—æ–°çš„å†…å­˜ï¼Œå…±äº«å…¶å±æ€§å’Œæ–¹æ³•ã€‚ Sub.prototype = Object.create(Super.prototype); // ä¿®æ­£ constructoræŒ‡å‘ Sub.prototype.constructor = Sub; return Sub;&#125; æˆ‘ä»¬ç®€å•çš„åˆ†æä¸€ä¸‹è¿™å‡ è¡Œä»£ç ã€‚ å£°æ˜äº†Superå˜é‡å’Œ Subå˜é‡åˆ†åˆ«æŒ‡å‘Vueæ„é€ å‡½æ•°å’Œ VueComponentæ„é€ å‡½æ•°ã€‚ 5.1 ä½¿ç”¨åœºæ™¯åœ¨Vueæºç å†…éƒ¨å’Œä½¿ç”¨Vueç¼–å†™ä¸šåŠ¡ä»£ç æ—¶éƒ½å¯ä»¥ä½¿ç”¨ Vue.extendè¿™ä¸ª apiã€‚ 5.1.1 å†…éƒ¨åˆ›å»ºç»„ä»¶æ¯ä¸€ä¸ªVueç»„ä»¶éƒ½å¯¹åº”ç€ä¸€ä¸ªå®ä¾‹ã€‚ è€Œè¿™äº›å®ä¾‹éƒ½æ˜¯é€šè¿‡ extend æ–¹æ³•åˆ›å»ºçš„ VueComponentæ„é€ å‡½æ•° ç”Ÿæˆçš„ã€‚ åœ¨renderé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯åœ¨ç”Ÿæˆç»„ä»¶çš„vnodeçš„æ—¶å€™ä¼šé€šè¿‡ extend æ–¹æ³•åˆ›å»ºVueComponentæ„é€ å‡½æ•°ã€‚ å¹¶èµ‹å€¼åˆ° vnode ä¸­çš„ componentOptionså±æ€§ä¸­ã€‚ 1234567891011// åˆ›å»ºç»„ä»¶çš„ vnode çš„æ–¹æ³•export function createComponent(Ctor,context)&#123; // _baseåœ¨å¼•å…¥æ—¶è¢«è®¾ç½®ä¸º Vue // è¿™é‡Œçš„optionsåé¢æˆ‘ä»¬ä¼šè¯¦ç»†è¯´æ˜ const base = context.$options._base; // åˆ›å»ºVueå­ç±»æ„é€ å‡½æ•° Ctor = base.extend(); return new Vnode( &#123;componentOptions:&#123;Ctor&#125;&#125; )&#125; è¿™é‡Œçš„_baseå®é™…ä¸Šå°±æ˜¯ Vueã€‚ è¿™é‡Œçš„ contextæ˜¯vmå®ä¾‹ï¼Œvm.$optionsæ˜¯åœ¨å®ä¾‹åŒ–æ„é€ å‡½æ•°æ—¶é€šè¿‡ mergeOptionså‡½æ•°ç”Ÿæˆçš„ã€‚ ç„¶ååœ¨updateé˜¶æ®µï¼ˆæ¸²æŸ“é¡µé¢ï¼‰ï¼Œä¼šåŸºäºCtorç”Ÿæˆå¯¹åº”çš„å®ä¾‹ï¼Œæ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–ã€æ¸²æŸ“æ–¹æ³•ç­‰ã€‚ 12345// æ¯ä¸ªç»„ä»¶éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆ›å»ºå¯¹åº”çš„å®ä¾‹// è¿™é‡Œçš„ componentOptions.Ctor å°±æ˜¯å¯¹åº”çš„VueComponentæ„é€ å‡½æ•°export function createComponentInstanceForVnode(vnode)&#123; return new vnode.componentOptions.Ctor()&#125; 5.1.2 åœ¨ä¸šåŠ¡ä¸­çš„å®é™…åº”ç”¨åœºæ™¯åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½å¯ä»¥åˆ©ç”¨ extend æ¥æ‰©å±•ç»„ä»¶ã€‚ åŒ…æ‹¬åˆ›å»ºå¯å¤ç”¨çš„ç»„ä»¶ã€åŠ¨æ€ç»„ä»¶ã€å…¨å±€å’Œå±€éƒ¨æ³¨å†Œã€ä¸´æ—¶ç»„ä»¶ã€è‡ªå®šä¹‰æŒ‡ä»¤å’Œæ’ä»¶ã€‚ æˆ‘ä»¬å¸¸ç”¨çš„ Elementæ¡†æ¶å†…éƒ¨å°±åˆ©ç”¨äº† Vue.extend æ¥æ‰©å±•æŸäº›ä¸´æ—¶æ€§çš„ç»„ä»¶ï¼Œä¾‹å¦‚æ¨¡æ€å¯¹è¯æ¡†ã€æç¤ºä¿¡æ¯ç­‰ã€‚ é€šè¿‡ Vue.extend åˆ›å»ºçš„ç»„ä»¶æ„é€ å‡½æ•°å¯ä»¥æŒ‰éœ€åˆ›å»ºå’Œé”€æ¯ï¼Œé€‚åˆè¿™ç±»ä¸´æ—¶ç»„ä»¶çš„ç®¡ç†ã€‚ 123456789101112131415161718const Main = &#123; template:&#x27;&lt;div&gt;hello main&lt;/div&gt;&#x27;&#125;const NotificationConstructor = Vue.extend(Main);let instance;const Notification = function() &#123; // é€šè¿‡VueComponentåˆ›å»ºç»„ä»¶å®ä¾‹ instance = new NotificationConstructor(); // ä½¿ç”¨$mountå¯ä»¥åˆ›å»ºä¸€ä¸ªDOMèŠ‚ç‚¹ å¹¶æŒ‚è½½åˆ°instance.$elä¸Š instance.$mount(); document.body.appendChild(instance.$el); return instance;&#125; Notification(); $mountæ–¹æ³•å¦‚æœæ²¡æœ‰ä¼ å‚ä¸ä¼šæŒ‚è½½ï¼Œä½†æ˜¯ä¾æ—§å¯ä»¥ç”Ÿæˆ DOMèŠ‚ç‚¹ï¼Œå¹¶èµ‹å€¼åœ¨ vm.$elä¸Šã€‚ åœ¨ element ä¸­çš„ Notificationç»„ä»¶ å°±ä½¿ç”¨äº† extend è¿›è¡Œæ‰©å±•ã€‚ 5.1.3 ä½¿ç”¨VueComponentç»§ç»­æ‰©å±•å®ƒçš„â€œå­ç±»â€æ„é€ å‡½æ•°éœ€è¦å…³æ³¨çš„æ˜¯åœ¨Vue.extendä¸­ï¼Œå°†Vue.extendæ–¹æ³•åŒæ—¶èµ‹å€¼ç»™äº† VueComponentã€‚ æ„å‘³ç€èµ‹äºˆäº† VueComponentç»§ç»­æ‰©å±•çš„èƒ½åŠ›ï¼š 12345678Vue.extend = function()&#123; const Super = this; const Sub = function VueComponent()&#123; this._init(); &#125; // çœç•¥éƒ¨åˆ†ä»£ç  Sub.extend = Super.extend;&#125; è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ— é™çš„åŸºäº VueComponentå’Œå®ƒçš„â€œå­ç±»â€æ‰©å±•å­ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243import Vue from &quot;@/my-vue2/platforms/web/entry-runtime-with-compiler-esm&quot;// åŸºäºVueæ„é€ å‡½æ•°åˆ›å»ºçš„åŸºç¡€æ„é€ å‡½æ•°const VueComponentConstructor = Vue.extend(&#123; template:`&lt;div&gt;&#123;&#123; name &#125;&#125;æˆ‘æ˜¯æ„é€ å‡½æ•°&lt;/div&gt;`, data()&#123; return &#123; name:&quot;VueComponentConstructor&quot; &#125; &#125;&#125;);// å¯ä»¥å¤ç”¨çˆ¶ç±»æ„é€ å‡½æ•°VueComponentConstructorä¸Šçš„å±æ€§const VueComponentChild1Constructor = VueComponentConstructor.extend(&#123; data()&#123; return &#123; name:&quot;VueComponentChild1Constructor&quot; &#125; &#125;&#125;)// å¯ä»¥å¤ç”¨çˆ¶ç±»æ„é€ å‡½æ•°VueComponentConstructorä¸Šçš„å±æ€§const VueComponentChild2Constructor = VueComponentConstructor.extend(&#123; data()&#123; return &#123; name:&quot;VueComponentChild2Constructor&quot; &#125; &#125;&#125;)function addNode()&#123; const vm1 = new VueComponentConstructor(); const vm2 = new VueComponentChild1Constructor(); const vm3 = new VueComponentChild2Constructor(); vm1.$mount() vm2.$mount() vm3.$mount() document.body.appendChild(vm1.$el) document.body.appendChild(vm2.$el) document.body.appendChild(vm3.$el)&#125;addNode(); ä¸Šè¿°ä»£ç ä¸­ï¼ŒVueComponentConstructor æ˜¯é€šè¿‡ Vue.extend åˆ›å»ºçš„ä¸€ä¸ªåŸºç¡€ç»„ä»¶æ„é€ å‡½æ•°ã€‚ åœ¨è¿™ä¸ªåŸºç¡€æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†æ¨¡æ¿é€‰é¡¹ï¼Œæˆ‘ä»¬ä¹‹ååˆ›å»ºçš„æ„é€ å‡½æ•°å°±å¯ä»¥å¤ç”¨ templateé€‰é¡¹ï¼Œé¿å…ç¼–å†™é‡å¤çš„æ¨¡æ¿ã€‚ æˆ‘ä»¬è¿™é‡Œåªæ˜¯ç®€å•çš„ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬äº†è§£åˆ°äº†extendçš„é‡è¦æ„ä¹‰ã€‚çœŸå®çš„å¤ç”¨ç»“æ„è‚¯å®šæ›´ä¸ºå¤æ‚ã€‚ ä¸è¿‡åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬åº”ç”¨ä¸­åŸºæœ¬åªå­˜åœ¨ Vueæ„é€ å‡½æ•°å’Œå®ƒçš„ç›´æ¥æ„é€ å‡½æ•° VueComponentã€‚ åœ¨ç»„ä»¶åº“ç­‰åŸºç¡€åº“ä¸­å¯èƒ½ä¼šå­˜åœ¨è¿™ç§å­ç±»ç»§ç»­æ‰©å±•å­ç±»çš„æƒ…å†µã€‚ å…­ã€ä¸ºä»€ä¹ˆVueå®ä¾‹è¢«å«åš vmæºç ä¸­ä½ ä¼šçœ‹åˆ°å¤§é‡çš„ vmã€‚ ä½¿ç”¨ new Vue() åˆ›å»ºçš„Vueå®ä¾‹é€šå¸¸è¢«å«åš vmã€‚ Vueè¢«ç§°ä¸ºVMï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŸºäºMVVMï¼ˆModel-View-ViewModelï¼‰æ¶æ„çš„å‰ç«¯æ¡†æ¶ã€‚ åœ¨MVVMæ¶æ„ä¸­ï¼ŒVMä»£è¡¨ViewModelï¼Œè´Ÿè´£ç®¡ç†è§†å›¾ï¼ˆViewï¼‰å’Œæ•°æ®æ¨¡å‹ï¼ˆModelï¼‰ä¹‹é—´çš„é€šä¿¡å’Œäº¤äº’ã€‚ ä¸ƒã€å¼•å…¥æ—¶åŸºäºåŸå‹æŒ‚è½½æ–¹æ³•Vueæ˜¯åŸºäºåŸå‹è®¾è®¡çš„å‰ç«¯æ¡†æ¶ã€‚ åç»­çš„æ“ä½œéƒ½æ˜¯åœ¨è°ƒç”¨åŸå‹ä¸Šå®šä¹‰çš„æ–¹æ³•ã€‚ é‚£ä¹ˆ Vueæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å¯¹è¿™äº›æ–¹æ³•è¿›è¡ŒæŒ‚è½½çš„å‘¢ï¼Ÿ ä¸€éƒ¨åˆ†æ˜¯åœ¨ Vueå¼•å…¥çš„æ—¶å€™æŒ‚è½½çš„ï¼Œä¸€éƒ¨åˆ†æ˜¯åœ¨ Vueå®ä¾‹åŒ–çš„æ—¶å€™è¿›è¡ŒæŒ‚è½½çš„ã€‚ é‚£ä¹ˆ Vueæ˜¯å¦‚ä½•åœ¨å¼•å…¥çš„æ—¶å€™è¿›è¡ŒæŒ‚è½½å‘¢ï¼Ÿ æˆ‘ä»¬æ‰“å¼€å…¥å£æ–‡ä»¶å¯ä»¥çœ‹åˆ° Vue è¢«æœ‰å±‚æ¬¡çš„å¯¼å…¥å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸Šå¯¹åº”çš„åŸå‹æ–¹æ³•ã€‚ æ¯”å¦‚åœ¨: åœ¨platforms/web/runtime-with-compiler.jsæ–‡ä»¶ä¸­ï¼š Vueä¸Šæ‰©å±•äº†å®šä¹‰äº†Vue.compile é‡å†™äº† Vue.prototype.$mount åœ¨platforms/web/runtime/index.jsæ–‡ä»¶ä¸­ï¼š å®šä¹‰äº†Vue.prototype.$mount å®šä¹‰äº†Vue.prototype.patch æ‰©å±•äº†æ‰©å±• Vue.configä¸€äº›å±æ€§ æ‰©å±• Vue.options.directive æ‰©å±• Vue.options.components åœ¨core/index.jsæ–‡ä»¶ä¸­ï¼š ä½¿ç”¨äº†initGlobalAPIå®šä¹‰äº†ä¸€äº›å…¨å±€æ–¹æ³• å¦‚ mixin å®šä¹‰äº†Vue.prototype.$isServer å®šä¹‰äº†Vue.prototype.$ssrContext å®šä¹‰äº†Vue.FunctionalRenderContext å®šä¹‰äº†Vue.version åœ¨core/instance/indexæ–‡ä»¶ä¸­ï¼š ä½¿ç”¨ initMixin æ³¨å…¥äº† åˆå§‹åŒ–æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$init ä½¿ç”¨ stateMixin æ³¨å…¥äº† è·ŸçŠ¶æ€æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$setã€Vue.prototype.$watchã€Vue.prototype.$delete ä½¿ç”¨ eventsMixin æ³¨å…¥äº† è·Ÿäº‹ä»¶æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$onã€Vue.prototype.$offã€Vue.prototype.$once ä½¿ç”¨ lifecycleMixin æ³¨å…¥äº† è·Ÿæ•´ä¸ª vueç”Ÿå‘½å‘¨æœŸæ›´æ–°æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$update ä½¿ç”¨ renderMixin æ³¨å…¥äº† è·Ÿæ¸²æŸ“ç›¸å…³çš„å±æ€§å¦‚ï¼šVue.prototype._render å¯ä»¥å‘ç° Vueæºç ä¸­æ˜¯ä¸€å±‚ä¸€å±‚è¿›è¡Œå¯¼å…¥ã€‚ é‚£ä¹ˆVueä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ç›®å½•ç»“æ„å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ¨¡å—éƒ½å¯¹ Vueå¯¹è±¡åšäº†ç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´æ‰©å±•å±æ€§ã€æ‰©å±•å®ä¾‹å±æ€§ç­‰ã€‚ Vue æŒ‰åŠŸèƒ½æŠŠè¿™äº›æ‰©å±•åˆ†æ•£åˆ°å¤šä¸ªæ¨¡å—ä¸­å»å®ç°ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªæ¨¡å—é‡Œå®ç°æ‰€æœ‰ã€‚ è¿™ç§æŠ€å·§ä¾¿äºåæœŸVueçš„ç»´æŠ¤å’Œè¿­ä»£ã€‚"},{"title":"ğŸ”¥Vue2æºç æ„å»º","path":"//posts/vue2-core-build.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬äºŒç¯‡-æºç æ„å»º &emsp;&emsp;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¤§æ¦‚äº†è§£äº†Vueçš„ç›®å½•ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ã€‚ &emsp;&emsp;åœ¨è¿™ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šçŸ¥æ™“ Vue æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚ ä¸€ã€Vueçš„æ„å»º1.1 æ ¹æ®ä½¿ç”¨åœºæ™¯æ‰“åŒ…åœ¨ä¸Šä¸€ç¯‡ä¸“æ æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰äº† Vueæºç ä¸­çš„ä»£ç ç»“æ„ã€‚ å…¶ä¸­æˆ‘ä»¬ä»‹ç»äº†å‡ ä¸ªå…¥å£æ–‡ä»¶ï¼š entry-runtime.ts entry-runtime-with-compiler.ts entry-runtime-esm.ts entry-runtime-with-compiler-esm.ts åœ¨æˆ‘ä»¬å¼€å‘é¡¹ç›®ç»“æŸåï¼Œéœ€è¦è¿›è¡Œæ‰“åŒ…å¹¶éƒ¨ç½²åˆ°çº¿ä¸Šã€‚ é€šå¸¸æˆ‘ä»¬é¡¹ç›®æ‰“åŒ…æ—¶éœ€è¦ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œ webpacké€šè¿‡è¿™ä¸ªå…¥å£æ–‡ä»¶é€’å½’æ–‡ä»¶è¿›è¡Œä¾èµ–åˆ†æç„¶åæ‰“åŒ…ã€‚ å…¶å®æ¡†æ¶æ‰“åŒ…ä¹Ÿä¸€æ ·ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªå…¥å£æ–‡ä»¶è¿›è¡Œé€’å½’ä¾èµ–åˆ†ææ‰“åŒ…ç”Ÿæˆ jsæ–‡ä»¶æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œä½¿ç”¨ã€‚ å’Œé¡¹ç›®ä¸ä¸€æ ·çš„æ˜¯ï¼Œé¡¹ç›®å¾€å¾€åªæœ‰ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œè€Œæ¡†æ¶ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µé‡‡ç”¨ä¸åŒçš„å…¥å£æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œä¸Šé¢çš„è¿™å››ä¸ªæ–‡ä»¶å°±æ˜¯Vueæ¡†æ¶çš„å…¥å£æ–‡ä»¶ã€‚ Vueæ˜¯ä½¿ç”¨rollupè¿›è¡Œæ‰“åŒ…çš„ã€‚ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·è¿›è¡Œä½¿ç”¨ï¼ŒVueåœ¨ä½¿ç”¨rollupè¿›è¡Œæ‰“åŒ…æ—¶æ ¹æ®å¼€å‘ç¯å¢ƒ&#96;å’Œå¼€å‘æ¨¡å¼æ‰“åŒ…å‡ºäº†ä¸åŒåŠŸèƒ½çš„æ–‡ä»¶ï¼Œä»¥é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚ æ„å»ºçš„rollupæ‰“åŒ…è„šæœ¬çš„ä»£ç åœ¨scripts/config.jsæ–‡ä»¶ä¸­ã€‚ 1234567891011121314151617const builds = &#123; &#x27;runtime-cjs-dev&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.common.dev.js&#x27;), format: &#x27;cjs&#x27;, env: &#x27;development&#x27;, banner &#125;, &#x27;runtime-cjs-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.common.prod.js&#x27;), format: &#x27;cjs&#x27;, env: &#x27;production&#x27;, banner &#125;, // çœç•¥&#125; æ€»å…±æ‰“åŒ…ç”Ÿæˆ 12 ä¸ªæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ æ ¹æ®æ˜¯å¦å¸¦ç¼–è¯‘å™¨çš„è§’åº¦ä¸Šåˆ†ä¸ºFullå’ŒRuntime-Only 2ä¸ªç‰ˆæœ¬ã€‚Fullç‰ˆæœ¬åŒ…å«ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶çš„å…¨éƒ¨åŠŸèƒ½ã€‚Runtime-Only ä»…å«è¿è¡Œæ—¶åŠŸèƒ½ã€‚ æ‰“åŒ…çš„æ–‡ä»¶æ ¹æ®ä½¿ç”¨åœºæ™¯åˆ†ä¸º esmã€cjsã€umdä¸‰ä¸ªç‰ˆæœ¬ã€‚å…¶ä¸­umdå¯ä»¥é€šè¿‡&lt;script&gt;æ ‡ç­¾å¼•å…¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼ŒVueä¼šæš´éœ²ä¸€ä¸ªå…¨å±€å˜é‡ Windows.Vueã€‚è€Œ CommonJSé€‚é…const Vue &#x3D; require(â€˜vueâ€™)è¿™ç§ nodeå¼çš„æ¨¡å—ç³»ç»Ÿã€‚ESåˆ™é€‚é…import Vue from â€˜vueâ€™è¿™ç§es6æ ¼å¼ã€‚ æ‰“åŒ…çš„æ–‡ä»¶æ ¹æ®ç¯å¢ƒåˆ†ä¸º dev&#x2F;prodï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­å¯ä»¥ä½¿ç”¨ devç‰ˆæœ¬çš„ jsæ–‡ä»¶ï¼Œè€Œéƒ¨ç½²åˆ°å®¢æˆ·ç”Ÿäº§ç¯å¢ƒå°±å¯ä»¥ä½¿ç”¨ prodç‰ˆæœ¬çš„ jsæ–‡ä»¶ã€‚ devç‰ˆæœ¬çš„æ–‡ä»¶æœ‰ä¸€äº›æç¤ºï¼Œä¼šåœ¨å¼€å‘è€…å¼€å‘æ—¶ä¾¿äºè°ƒè¯•ã€‚ 1.2 Fullç‰ˆæœ¬çš„Vueåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ å¹³æ—¶æˆ‘ä»¬å¼€å‘ä¸­åªä½¿ç”¨äº† runtime-only ç‰ˆæœ¬ã€‚ è€Œ Fullç‰ˆæœ¬ä¸­ä¸ä»…æœ‰ runtime-onlyéƒ¨åˆ†ï¼Œè¿˜åŒ…æ‹¬ç¼–è¯‘å™¨éƒ¨åˆ†ã€‚ æ‰€è°“ç¼–è¯‘å™¨ï¼Œå°±æ˜¯åœ¨Vueå†…éƒ¨çš„ç¼–è¯‘å™¨å¯ä»¥å°†æ¨¡æ¿è½¬åŒ–ä¸ºå¯¹åº”çš„renderå‡½æ•°ã€‚ åœ¨Vueå†…éƒ¨æ¸²æŸ“å°±æ˜¯è°ƒç”¨çš„ renderæ–¹æ³•ç”Ÿæˆ vnodeã€‚ å› ä¸ºç¼–è¯‘å™¨ä»£ç ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œè€Œä¸”å¦‚æœåœ¨è¿è¡Œçš„æ—¶å€™è¿›è¡Œæ¨¡æ¿ç¼–è¯‘ï¼Œæå¤§å¯èƒ½ä¼šæ¶ˆè€—æ€§èƒ½ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨å¼€å‘é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ runtime-onlyç‰ˆæœ¬ã€‚ åœ¨ webpacké¢„ç¼–è¯‘é˜¶æ®µï¼Œå°±å°†.vueæ–‡ä»¶ç¼–è¯‘æˆrenderå‡½æ•°ï¼Œåœ¨è¿è¡Œæ—¶ç›´æ¥è¿è¡Œ renderå‡½æ•°å°±å¯ä»¥è·å–åˆ°å¯¹åº”çš„ vnodeã€‚ é€šè¿‡ runtime-only å’Œ esmå¾ˆå®¹æ˜“æ¨æµ‹å‡ºæ¥æˆ‘ä»¬é¡¹ç›®åœ¨å¼€å‘é˜¶æ®µä¸­ä½¿ç”¨çš„æ˜¯vue.runtime.esm.js 1.3 ä½¿ç”¨ Full è¿˜æ˜¯ç”¨ Runtime-Onlyç‰ˆæœ¬è¿™éœ€è¦ä¾æ®å…·ä½“æƒ…å†µè¿›è¡Œå…·ä½“åˆ†æã€‚ å€˜è‹¥ä½ éœ€è¦ç”¨åˆ° Vue æ‰€æä¾›çš„ html æ¨¡æ¿åŠŸèƒ½ï¼Œé‚£å°±é€‰ç”¨ Full ç‰ˆæœ¬ã€‚ åä¹‹ï¼Œæœ€å¥½é‡‡ç”¨ Runtime-only ç‰ˆæœ¬ï¼ŒåŸå› åœ¨äºå®ƒæ¯” Full ç‰ˆæœ¬çš„æ–‡ä»¶ä½“ç§¯å¤§çº¦å° 30%ã€‚ *.vue å•æ–‡ä»¶ç»„ä»¶ä¼šè¢« vue-loader ç›´æ¥æ„å»ºæˆä¸º JavaScriptï¼Œå¹¶æœªä½¿ç”¨åˆ° Vue çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Runtime-only ç‰ˆæœ¬ã€‚ äºŒã€ç¥å¥‡çš„â€œ__DEV__â€åœ¨å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œåœ¨æ‰“åŒ…æˆå¼€å‘ç¯å¢ƒçš„åŒ…æ—¶ï¼Œå¾€å¾€ä¼šå­˜åœ¨å¾ˆå¤šæç¤ºä¿¡æ¯ã€‚ è€Œæºç ä¸­åˆ¤æ–­å¼€å‘ç¯å¢ƒé€šå¸¸éƒ½æ˜¯ä½¿ç”¨__DEV__æ¥è¿›è¡Œåˆ¤æ–­ã€‚ 2.1 __DEV__çš„æœ¬è´¨åœ¨Vueæºç ä¸­ï¼Œåˆ°å¤„éƒ½èƒ½çœ‹åˆ°__DEV__å˜é‡çš„èº«å½±ã€‚ ä½†æ˜¯ä½ çœ‹ä¸åˆ°__DEV__è¢« import å¼•å…¥ï¼Œç”šè‡³ä½ éƒ½æ‰¾ä¸åˆ°åœ¨å“ªé‡Œå®šä¹‰äº†è¿™ä¸ªå˜é‡ã€‚ è¿™ä¸ªå˜é‡åœ¨ Vue ä¸­ä»£è¡¨å¼€å‘ç¯å¢ƒã€‚ å½“ä½ åœ¨æºç ä¸­çœ‹è§ if(__DEV__) ä»£è¡¨è¿™ä¸ªifä¸­çš„é€»è¾‘åªæœ‰åœ¨å¼€å‘ç¯å¢ƒæ‰è¿›å…¥æ‰§è¡Œã€‚ vueçš„æ„å»ºå·¥å…·æ˜¯rollupï¼Œåœ¨rollupæ‰“åŒ…çš„æ—¶å€™ä¼šä½¿ç”¨@rollup/plugin-replace æ’ä»¶æ¥æ›¿æ¢æºä»£ç ä¸­çš„__DEV__å˜é‡ï¼Œå¦‚ä¸‹ï¼š 123456789101112......const replace = require(&#x27;@rollup/plugin-replace&#x27;)......// built-in varsconst vars = &#123; ...... __DEV__: `process.env.NODE_ENV !== &#x27;production&#x27;`, ......&#125;......config.plugins.push(replace(vars))...... æ‰€ä»¥__DEV__çš„æœ¬è´¨å°±æ˜¯ proess.env.NODE_ENV!== &#39;production&#39; ã€‚ 2.2 çº¦å®šä¿—æˆçš„â€œprocess.env.NODE_ENV!&#x3D;&#x3D;â€™productionâ€å°† DEV å˜é‡è½¬æ¢ä¸º process.env.NODE_ENV !== &#39;production&#39; è¿™æ ·çš„æ¡ä»¶è¡¨è¾¾å¼åœ¨ç°ä»£å‰ç«¯æ„å»ºå·¥å…·ä¸­æ˜¯ä¸€ç§å¸¸è§çš„çº¦å®šå’Œå®è·µã€‚ åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š ç¯å¢ƒåŒºåˆ†ï¼šé€šè¿‡ process.env.NODE_ENV å¯ä»¥æ–¹ä¾¿åœ°åœ¨ä»£ç ä¸­åŒºåˆ†å¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰ä¸ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨ç‰¹å®šçš„è­¦å‘Šã€æ—¥å¿—è®°å½•æˆ–è€…çƒ­åŠ è½½åŠŸèƒ½ï¼›è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆ™ç¦ç”¨è¿™äº›åŠŸèƒ½ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚ Tree-shaking å’Œ UglifyJSï¼šå½“æ‰“åŒ…å·¥å…·å¦‚ Rollup æˆ– webpack é‡åˆ° process.env.NODE_DEV !== &#39;production&#39; åŒ…è£¹çš„ä»£ç å—æ—¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¼šè‡ªåŠ¨å»é™¤ï¼ˆtree-shakeï¼‰å…¶ä¸­ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­éœ€è¦çš„ä»£ç ï¼Œå› ä¸ºè¯¥æ¡ä»¶è¡¨è¾¾å¼æœ€ç»ˆä¼šè¢«ç¼–è¯‘å™¨æˆ–å‹ç¼©å·¥å…·è¯†åˆ«ä¸ºå§‹ç»ˆä¸º falseï¼Œå› æ­¤åŒ…è£¹çš„ä»£ç ä¸ä¼šè¢«æ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©ã€‚ æ ‡å‡†åŒ–ï¼šè®¸å¤šæ¡†æ¶å’Œåº“éƒ½é‡‡ç”¨äº†è¿™ç§æ¨¡å¼æ¥å¤„ç†ç¯å¢ƒç›¸å…³çš„é€»è¾‘ï¼Œè¿™æ ·å¼€å‘è€…å¯ä»¥ç»Ÿä¸€éµå¾ªè¿™ä¸ªçº¦å®šï¼Œå‡å°‘é…ç½®å’Œç†è§£æˆæœ¬ã€‚ çµæ´»é…ç½®ï¼šç”±äºæ„å»ºå·¥å…·æ”¯æŒ .env æ–‡ä»¶æˆ–å…¶ä»–æ–¹å¼æ¥è®¾ç½® NODE_ENV çš„å€¼ï¼Œè¿™ä½¿å¾—é¡¹ç›®é…ç½®æ›´åŠ çµæ´»ï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å¿«é€Ÿåˆ‡æ¢ä¸åŒç¯å¢ƒä¸‹çš„è¡Œä¸ºã€‚ è·¨å¹³å°å…¼å®¹æ€§ï¼šprocess.env.NODE_ENV ä½œä¸ºä¸€ä¸ªæ ‡å‡† Node.js ç¯å¢ƒå˜é‡æ¥å£ï¼Œå·²ç»è¢«å¹¿æ³›æ¥å—ï¼Œå¹¶ä¸”åœ¨å„ç§æ‰“åŒ…å·¥å…·ä¸­éƒ½æœ‰ç›¸åº”çš„æœºåˆ¶å°†å…¶æ˜ å°„åˆ°æœ€ç»ˆæµè§ˆå™¨æ‰§è¡Œçš„ä»£ç ä¸­ï¼Œç¡®ä¿äº†è·¨å¹³å°çš„ä¸€è‡´æ€§ã€‚ ä¸€èˆ¬é¡¹ç›®åœ¨å¼€å‘ç¯å¢ƒä¸­å°†process.env.NODE_ENVè®¾ç½®ä¸ºdevelopmentï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®ä¸ºproductionã€‚ æ‰€ä»¥é€šè¿‡process.env.NODE_ENV !== &#39;productionå°±å¯ä»¥åˆ¤æ–­ç°åœ¨æ˜¯å¤„äºä»€ä¹ˆç¯å¢ƒä¸‹ã€‚ 2.3 åœ¨æœ¬åœ°ç¯å¢ƒé…ç½®__DEV__å› ä¸ºæˆ‘ä»¬è¿™é—¨è¯¾ç¨‹æ˜¯å†™ä¸€ä¸ªå®Œæ•´ç‰ˆçš„vue2ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨__DEV__è¿™ä¸ªå˜é‡ä»£è¡¨å¼€å‘ç¯å¢ƒã€‚ æˆ‘ä»¬æœ¬åœ°çš„é¡¹ç›®æ˜¯ä½¿ç”¨ vue-cli æ­å»ºçš„ã€‚ å¯ä»¥åœ¨ webpacké…ç½®æ–‡ä»¶ vue.config.js æ–‡ä»¶æ–°å¢ä¸€ä¸ªé…ç½®è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ 1234567891011121314// vue.config.jsconst &#123; defineConfig &#125; = require(&#x27;@vue/cli-service&#x27;);const webpack = require(&#x27;webpack&#x27;);module.exports = defineConfig(&#123; transpileDependencies: true, lintOnSave:false, configureWebpack: &#123; plugins: [ new webpack.DefinePlugin(&#123; __DEV__: process.env.NODE_ENV === &#x27;development&#x27;, &#125;), ], &#125;,&#125;) DefinePlugin æ’ä»¶çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨ç¼–è¯‘æ—¶å°†é¢„å®šä¹‰çš„å€¼æ›¿æ¢åˆ°æºä»£ç ä¸­çš„ç‰¹å®šå˜é‡ã€‚ æˆ‘ä»¬æ‰§è¡Œyarn startå¯åŠ¨è¿™ä¸ªé¡¹ç›®æ‰“å°ä¸€ä¸‹__DEV__ä¸º trueå³ä¸ºæˆåŠŸã€‚ 1console.log(__DEV__); // true"},{"title":"ğŸ”¥Vue2ç›®å½•ç»“æ„çª¥æ¢","path":"//posts/vue2-catalog.html","content":"&nbsp; è¿”å› ä¸“æ ç¬¬ä¸€ç¯‡-ç›®å½•ç»“æ„çª¥æ¢ &emsp;&emsp;å› ä¸º Vue æ¡†æ¶æ˜¯åœ¨åå¤šå¹´å‰äº§ç”Ÿçš„ä¸€ä¸ªå¼€æºå‰ç«¯æ¡†æ¶ï¼Œç»è¿‡ä¸€äº›è¿­ä»£ä¿®å¤ï¼Œç›®å‰å·²ç»è¶‹äºç¨³å®šã€‚ &emsp;&emsp;Vue2æ¡†æ¶åœ¨å¯ç»´æŠ¤æ€§ã€æ€§èƒ½ã€TypeScriptæ”¯æŒç­‰æ–¹é¢æœ‰ä¸€äº›ç—›ç‚¹ï¼Œæ‰€ä»¥å°¤é›¨æºªæ¨å‡ºäº† Vue3ç‰ˆæœ¬ã€‚ &emsp;&emsp;ä¸è¿‡ç›®å‰å¤§éƒ¨åˆ†å…¬å¸å› ä¸ºæˆæœ¬ç­‰æ–¹é¢çš„åŸå› ï¼Œè¿˜æ˜¯ä½¿ç”¨åœ¨ Vue2 ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªä¸“æ å°±æ¥æ¢è®¨ä¸€ä¸‹ Vue2 çš„æºç éƒ¨åˆ†ã€‚ ä¸€ã€éæ ¸å¿ƒVueæºç ç›®å½•å¤§è‡´ç»“æ„ æˆ‘ä»¬çœ‹çš„Vueæºç ç‰ˆæœ¬2.7.16æ˜¯Vue2çš„æœ€æ–°ç‰ˆæœ¬ æˆ‘ä»¬æ‰“å¼€Vue2çš„githubæºç åœ°å€ã€‚ å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰å¾ˆå¤šä¸ªç›®å½•æ–‡ä»¶ï¼Œä½†æ˜¯å…¶å® Vue2 æºç æ ¸å¿ƒçš„éƒ½æ˜¯åœ¨ srcæ–‡ä»¶å¤¹ä¸­çš„ã€‚ æˆ‘ä»¬è¿™ç« å¤§æ¦‚ä»‹ç»ä¸€ä¸‹é™¤äº† src ä¸‹é¢çš„ä¸€äº›ç›®å½•ï¼Œäº†è§£ä¸€ä¸‹å¤§ä½“çš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚ 1.1 .githubè¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ä¸ gitHub ç›¸å…³çš„é…ç½®æ–‡ä»¶æˆ–è€…è„šæœ¬ã€‚ 1.2 benchmarksè¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ€§èƒ½åŸºå‡†æµ‹è¯•çš„ç›¸å…³æ–‡ä»¶å’Œè„šæœ¬ã€‚ æ€§èƒ½åŸºå‡†æµ‹è¯•æ˜¯ä¸€ç§ç”¨æ¥è¯„ä¼°è½¯ä»¶æ€§èƒ½çš„æ–¹æ³•ï¼Œå®ƒé€šè¿‡æ¨¡æ‹ŸçœŸå®ä¸–ç•Œä¸­çš„ä½¿ç”¨åœºæ™¯æ¥æµ‹é‡è½¯ä»¶åœ¨ä¸åŒæ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚ å¯ä»¥ç¡®ä¿æ–°åŠŸèƒ½ä¸ä¼šé™ä½æ¡†æ¶çš„æ•´ä½“æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥ä¼˜åŒ–ç°æœ‰ä»£ç ï¼Œä½¿å…¶æ›´åŠ é«˜æ•ˆã€‚ 1.3. compiler-sfcè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹é€»è¾‘å°±å¯ä»¥ååŠ© webpackè¿›è¡Œè§£æå¤„ç†å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰ã€‚ é€šå¸¸æˆ‘ä»¬å¼€å‘æ—¶ä¼šå€ŸåŠ©webpackå°†vueæ–‡ä»¶è½¬åŒ–ä¸ºä¸€ä¸ªJSå¯¹è±¡ã€‚ å¯ä»¥æŸ¥çœ‹ä»–çš„ index.jsæ–‡ä»¶ å‘ç°å®é™…ä¸Šå°±æ˜¯å¯¼å‡ºäº†@vue/compiler-sfcè¿™ä¸ªåŒ…ã€‚ 1module.exports = require(&#x27;@vue/compiler-sfc&#x27;) 1.4. distè¯¥æ–‡ä»¶å¤¹ä¸ºæ‰“åŒ…æ–‡ä»¶å­˜æ”¾çš„åœ°æ–¹ã€‚ 1.5. examplesè¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ç¤ºä¾‹åº”ç”¨ç¨‹åºæˆ–ä»£ç ç‰‡æ®µï¼Œç›®çš„æ˜¯å±•ç¤º Vue.js çš„åŸºæœ¬ç”¨æ³•å’ŒåŠŸèƒ½ã€‚ 1.6 packagesè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºç»„ç»‡ Vue.js çš„å„ä¸ªå­åŒ…æˆ–æ¨¡å—ã€‚ éšç€ Vue.js é¡¹ç›®çš„å¤æ‚åº¦å¢åŠ ï¼Œå°†ä¸åŒçš„åŠŸèƒ½æ¨¡å—æ‹†åˆ†æˆç‹¬ç«‹çš„å­åŒ…å·²ç»æˆä¸ºäº†ä¸€ç§å¸¸è§çš„åšæ³•ã€‚ è¿™æ ·ä¸ä»…æœ‰åˆ©äºæ¨¡å—åŒ–å¼€å‘ï¼Œè¿˜èƒ½æ–¹ä¾¿ä¾èµ–ç®¡ç†å’Œå‘å¸ƒã€‚ è¯¥ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªç›®å½•ã€‚ 1.6.1 compiler-sfcè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ä¸»è¦ç”¨äºå¤„ç†å•æ–‡ä»¶ç»„ä»¶ã€‚ 1.6.2 server-rendererè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å’ŒæœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³çš„å†…å®¹ã€‚ 1.6.3 template-compilerè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å­˜æ”¾æ¨¡æ¿ç¼–è¯‘ç›¸å…³çš„é€»è¾‘ã€‚ 1.7 scriptsè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºå­˜æ”¾å„ç§è‡ªåŠ¨åŒ–è„šæœ¬ã€‚ è¿™äº›è„šæœ¬é€šå¸¸ç”¨äºè¾…åŠ©é¡¹ç›®çš„æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒå’Œå…¶ä»–å¼€å‘ä»»åŠ¡ã€‚ 1.8 srcè¯¥æ–‡ä»¶å¤¹æ˜¯å­˜æ”¾ vueæ¡†æ¶æ ¸å¿ƒæºç çš„åœ°æ–¹ã€‚ 1.9 testè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºå­˜æ”¾å„ç§ç±»å‹çš„æµ‹è¯•æ–‡ä»¶ï¼Œè¿™äº›æµ‹è¯•æ–‡ä»¶ç”¨äºéªŒè¯ Vue.js æ¡†æ¶çš„åŠŸèƒ½æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚ 1.10 typesè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºå­˜æ”¾ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚ è¿™äº›ç±»å‹å®šä¹‰æ–‡ä»¶ä¸º Vue.js æä¾›äº†ç±»å‹æ”¯æŒï¼Œä½¿å¾—åœ¨ä½¿ç”¨ Vue.js æ—¶å¯ä»¥äº«å—é™æ€ç±»å‹æ£€æŸ¥çš„å¥½å¤„ï¼Œä»è€Œæé«˜ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚ 1.11 .editorconfigè¯¥æ–‡ä»¶ç”¨äºæŒ‡å®šç¼–è¾‘å™¨åº”è¯¥éµå¾ªçš„ä¸€ç³»åˆ—ç¼–ç å’Œæ ¼å¼åŒ–è§„åˆ™ã€‚ 1.12 .git-blame-ignore-revsè¯¥æ–‡ä»¶ç”¨äºå‘Šè¯‰ Git åœ¨æ‰§è¡Œ git blame å‘½ä»¤æ—¶å¿½ç•¥æŸäº›ç‰¹å®šçš„æäº¤è®°å½•ã€‚ 1.13 .gitignoreè¯¥æ–‡ä»¶ç”¨äºæŒ‡å®š Git åº”è¯¥å¿½ç•¥å“ªäº›æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³ä¸å°†è¿™äº›æ–‡ä»¶æˆ–ç›®å½•çº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚ 1.14 .prettierrcè¯¥æ–‡ä»¶ç”¨äºé…ç½® Prettierã€‚ Prettieræ˜¯ä¸€ä¸ªæµè¡Œçš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ä¿æŒä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚ Prettier å¯ä»¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆé¢„è®¾çš„ç¼–ç è§„èŒƒï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œä¸€è‡´æ€§ã€‚ 1.15 BACKERS.mdè¯¥æ–‡ä»¶ä¸»è¦ç”¨äºè®°å½•å’Œæ”¯æŒ Vue.js é¡¹ç›®çš„èµåŠ©è€…æˆ–è´¡çŒ®è€…ã€‚ è¿™ä»½æ–‡ä»¶é€šå¸¸åˆ—å‡ºäº†é‚£äº›é€šè¿‡èµ„é‡‘æˆ–å…¶ä»–å½¢å¼æ”¯æŒ Vue.js å‘å±•çš„ä¸ªäººæˆ–ç»„ç»‡ã€‚ 1.16 CHANGELOG.mdè¯¥æ–‡ä»¶ä¸»è¦ç”¨äºè®°å½•é¡¹ç›®çš„ç‰ˆæœ¬å˜æ›´å†å²ï¼ŒåŒ…æ‹¬æ¯ä¸ªç‰ˆæœ¬çš„æ–°å¢åŠŸèƒ½ã€æ”¹è¿›ã€ä¿®å¤çš„é”™è¯¯ä»¥åŠå…¶ä»–é‡è¦çš„å˜æ›´ä¿¡æ¯ã€‚ 1.17 LICENSEè¯¥æ–‡ä»¶ç”¨æ¥å®šä¹‰å’Œå£°æ˜é¡¹ç›®ä½¿ç”¨çš„è®¸å¯åè®®çš„æ–‡ä»¶ 1.18 README.mdè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„å…¥å£æ–‡æ¡£æ–‡ä»¶ã€‚ æ–‡ä»¶æä¾›äº†å…³äºé¡¹ç›®çš„æ¦‚è¿°ã€å®‰è£…æ­¥éª¤ã€ä½¿ç”¨æ–¹æ³•ã€è´¡çŒ®æŒ‡å—ç­‰å…³é”®ä¿¡æ¯ã€‚ 1.19 api-extractor.jsonè¯¥æ–‡ä»¶ç”¨äºé…ç½® API Extractor å·¥å…·ï¼ˆè¿™æ˜¯ä¸€ç§ç”¨äºç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰æ–‡æ¡£å’Œ API æŠ¥å‘Šçš„å·¥å…·ï¼‰ API Extractor é€šå¸¸ç”¨äºå¤§å‹ TypeScript é¡¹ç›®ä¸­ï¼Œå¸®åŠ©å¼€å‘è€…ç”Ÿæˆè¯¦ç»†çš„ API æ–‡æ¡£ï¼Œå¹¶ç¡®ä¿ç±»å‹å®šä¹‰çš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ã€‚ 1.20 api-extractor.tsconfig.jsonè¯¥æ–‡ä»¶ç”¨äºé…ç½® TypeScript ç¼–è¯‘é€‰é¡¹ï¼Œä»¥é…åˆ API Extractor å·¥å…·ç”Ÿæˆ API æ–‡æ¡£å’Œç±»å‹å®šä¹‰æ–‡ä»¶ã€‚ è¿™ä¸ªæ–‡ä»¶é€šå¸¸åŒ…å«äº†ä¸€äº›ç‰¹å®šçš„ TypeScript é…ç½®ï¼Œç¡®ä¿ API Extractor èƒ½å¤Ÿæ­£ç¡®åœ°è§£æå’Œå¤„ç†æºä»£ç ã€‚ 1.21 package.jsonè¯¥æ–‡ä»¶æ˜¯é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œç”¨äºæè¿°é¡¹ç›®çš„å…ƒæ•°æ®ä»¥åŠé¡¹ç›®ä¾èµ–å…³ç³»å’Œæ„å»ºè„šæœ¬ã€‚ 1.22 pnpm-lock.yamlè¯¥æ–‡ä»¶æ˜¯ç”± pnpm åŒ…ç®¡ç†å™¨ç”Ÿæˆçš„é”å®šæ–‡ä»¶ã€‚ ç”¨äºè®°å½•é¡¹ç›®ä¸­æ‰€æœ‰ä¾èµ–é¡¹çš„å…·ä½“ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•è¢«å®‰è£…çš„ã€‚ pnpm æ˜¯ä¸€ç§æ›¿ä»£ npm å’Œ yarn çš„é«˜æ€§èƒ½åŒ…ç®¡ç†å™¨ï¼Œå®ƒå…·æœ‰æ›´å¿«çš„é€Ÿåº¦å’Œæ›´å°‘çš„ç£ç›˜ç©ºé—´å ç”¨ã€‚ 1.23 pnpm-workspace.yamlè¯¥æ–‡ä»¶ç”¨äºé…ç½® pnpm å·¥ä½œåŒºï¼ˆworkspaceï¼‰ã€‚ pnpm æ”¯æŒå¤šé¡¹ç›®çš„å·¥ä½œåŒºæ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å…è®¸å¤šä¸ªç›¸å…³é¡¹ç›®å…±äº«ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†è¿™äº›é¡¹ç›®çš„ä¾èµ–å…³ç³»å’Œæ„å»ºæµç¨‹ã€‚ 1.24 tsconfig.jsonè¯¥æ–‡ä»¶æ˜¯ TypeScript ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ TypeScript ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æºä»£ç æ—¶åº”éµå¾ªçš„é€‰é¡¹å’Œè§„åˆ™ã€‚ 1.25 vitest.config.tsè¯¥æ–‡ä»¶ç”¨äºé…ç½® Vitest çš„æµ‹è¯•æ¡†æ¶é…ç½®æ–‡ä»¶ã€‚ Vitest æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ JavaScript å’Œ TypeScript æµ‹è¯•æ¡†æ¶ï¼Œå®ƒæä¾›äº†å¿«é€Ÿçš„æµ‹è¯•è¿è¡Œé€Ÿåº¦å’Œä¸°å¯Œçš„åŠŸèƒ½é›†ï¼Œé€‚ç”¨äºå‰ç«¯å’Œåç«¯å¼€å‘ã€‚ äºŒã€srcç›®å½•ä¸‹æœ‰ä»€ä¹ˆï¼Ÿä¸Šä¸€ç« èŠ‚æˆ‘ä»¬ç®€å•ä»‹ç»äº†ä¸€ä¸‹é srcæ–‡ä»¶å¤¹ä¸‹é¢çš„ä¸€äº›æ–‡ä»¶å†…å®¹ã€‚ è¿™äº›éƒ½æ˜¯åœ¨ä¸€ä¸ªå·¥ç¨‹åŒ–çš„æ¡†æ¶é¡¹ç›®ä¸­å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ã€‚ é‚£ä¹ˆæœ¬èŠ‚çš„å†…å®¹å°±æ˜¯çœ‹ä¸‹ src æ–‡ä»¶å¤¹ä¸‹åŒ…å«å“ªäº›å†…å®¹ã€‚ ä¸‹é¢è¿™ä¸ªç›®å½•ç»“æ„å»é™¤äº† tsç›¸å…³çš„å£°æ˜æ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147srcâ”œâ”€shared| â”œâ”€constants.ts| â””util.tsâ”œâ”€platforms| â”œâ”€web| | â”œâ”€entry-compiler.ts| | â”œâ”€entry-runtime-esm.ts| | â”œâ”€entry-runtime-with-compiler-esm.ts| | â”œâ”€entry-runtime-with-compiler.ts| | â”œâ”€entry-runtime.ts| | â”œâ”€runtime-with-compiler.ts| | â”œâ”€util| | | â”œâ”€attrs.ts| | | â”œâ”€class.ts| | | â”œâ”€compat.ts| | | â”œâ”€element.ts| | | â”œâ”€index.ts| | | â””style.ts| | â”œâ”€runtime| | | â”œâ”€class-util.ts| | | â”œâ”€index.ts| | | â”œâ”€node-ops.ts| | | â”œâ”€patch.ts| | | â”œâ”€transition-util.ts| | | â”œâ”€modules| | | | â”œâ”€attrs.ts| | | | â”œâ”€class.ts| | | | â”œâ”€dom-props.ts| | | | â”œâ”€events.ts| | | | â”œâ”€index.ts| | | | â”œâ”€style.ts| | | | â””transition.ts| | | â”œâ”€directives| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””show.ts| | | â”œâ”€components| | | | â”œâ”€index.ts| | | | â”œâ”€transition-group.ts| | | | â””transition.ts| | â”œâ”€compiler| | | â”œâ”€index.ts| | | â”œâ”€options.ts| | | â”œâ”€util.ts| | | â”œâ”€modules| | | | â”œâ”€class.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””style.ts| | | â”œâ”€directives| | | | â”œâ”€html.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””text.tsâ”œâ”€core| â”œâ”€config.ts| â”œâ”€index.ts| â”œâ”€vdom| | â”œâ”€create-component.ts| | â”œâ”€create-element.ts| | â”œâ”€create-functional-component.ts| | â”œâ”€patch.ts| | â”œâ”€vnode.ts| | â”œâ”€modules| | | â”œâ”€directives.ts| | | â”œâ”€index.ts| | | â””template-ref.ts| | â”œâ”€helpers| | | â”œâ”€extract-props.ts| | | â”œâ”€get-first-component-child.ts| | | â”œâ”€index.ts| | | â”œâ”€is-async-placeholder.ts| | | â”œâ”€merge-hook.ts| | | â”œâ”€normalize-children.ts| | | â”œâ”€normalize-scoped-slots.ts| | | â”œâ”€resolve-async-component.ts| | | â””update-listeners.ts| â”œâ”€util| | â”œâ”€debug.ts| | â”œâ”€env.ts| | â”œâ”€error.ts| | â”œâ”€index.ts| | â”œâ”€lang.ts| | â”œâ”€next-tick.ts| | â”œâ”€options.ts| | â”œâ”€perf.ts| | â””props.ts| â”œâ”€observer| | â”œâ”€array.ts| | â”œâ”€dep.ts| | â”œâ”€index.ts| | â”œâ”€scheduler.ts| | â”œâ”€traverse.ts| | â””watcher.ts| â”œâ”€instance| | â”œâ”€events.ts| | â”œâ”€index.ts| | â”œâ”€init.ts| | â”œâ”€inject.ts| | â”œâ”€lifecycle.ts| | â”œâ”€proxy.ts| | â”œâ”€render.ts| | â”œâ”€state.ts| | â”œâ”€render-helpers| | | â”œâ”€bind-dynamic-keys.ts| | | â”œâ”€bind-object-listeners.ts| | | â”œâ”€bind-object-props.ts| | | â”œâ”€check-keycodes.ts| | | â”œâ”€index.ts| | | â”œâ”€render-list.ts| | | â”œâ”€render-slot.ts| | | â”œâ”€render-static.ts| | | â”œâ”€resolve-filter.ts| | | â”œâ”€resolve-scoped-slots.ts| | | â””resolve-slots.ts| â”œâ”€global-api| | â”œâ”€assets.ts| | â”œâ”€extend.ts| | â”œâ”€index.ts| | â”œâ”€mixin.ts| | â””use.ts| â”œâ”€components| | â”œâ”€index.ts| | â””keep-alive.tsâ”œâ”€compiler| â”œâ”€codeframe.ts| â”œâ”€create-compiler.ts| â”œâ”€error-detector.ts| â”œâ”€helpers.ts| â”œâ”€index.ts| â”œâ”€optimizer.ts| â”œâ”€to-function.ts| â”œâ”€parser| | â”œâ”€entity-decoder.ts| | â”œâ”€filter-parser.ts| | â”œâ”€html-parser.ts| | â”œâ”€index.ts| | â””text-parser.ts| â”œâ”€directives| | â”œâ”€bind.ts| | â”œâ”€index.ts| | â”œâ”€model.ts| | â””on.ts| â”œâ”€codegen| | â”œâ”€events.ts| | â””index.ts ä¸‰ã€sharedæ–‡ä»¶å¤¹ 1234srcâ”œâ”€shared| â”œâ”€constants.ts| â””util.ts è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«äº†ä¸€äº›åœ¨ä¸åŒç¯å¢ƒä¸‹éƒ½éœ€è¦å…±äº«çš„å·¥å…·å‡½æ•°æˆ–è€…å¸¸é‡ã€‚ è¿™ä¸ªå·¥å…·å‡½æ•°ä¸å¹³å°æ— å…³ã€‚ æ—¢å¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡ç«¯ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šçš„ç¯å¢ƒç‰¹æ€§ï¼ˆä¾‹å¦‚ DOMï¼‰ã€‚ constants.tsæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›åœ¨æ•´ä¸ªæ¡†æ¶å†…é¢‘ç¹ä½¿ç”¨çš„å¸¸é‡ï¼Œæ¯”å¦‚ç‰¹æ®Šçš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ã€é…ç½®é”®åç­‰ã€‚ util.tsæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›åŸºç¡€çš„å·¥å…·å‡½æ•°ï¼Œæ¯”å¦‚ isStringã€isObjectå’Œå…¶ä»–ä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¦‚æ·±æ‹·è´ã€è­¦å‘Šè¾“å‡ºç­‰ã€‚ è¿™äº›æ–‡ä»¶çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚ é€šè¿‡å°†è¿™äº›åŠŸèƒ½æŠ½è±¡å‡ºæ¥ï¼ŒVue.js èƒ½å¤Ÿä¿æŒæ ¸å¿ƒé€»è¾‘çš„ç®€æ´ï¼Œå¹¶ä¸”ç¡®ä¿ä¸åŒéƒ¨åˆ†ä¹‹é—´çš„å…¼å®¹æ€§ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯å‡å°‘äº†é‡å¤ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ å››ã€platformsæ–‡ä»¶å¤¹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152srcâ”œâ”€platforms| â”œâ”€web| | â”œâ”€entry-compiler.ts| | â”œâ”€entry-runtime-esm.ts| | â”œâ”€entry-runtime-with-compiler-esm.ts| | â”œâ”€entry-runtime-with-compiler.ts| | â”œâ”€entry-runtime.ts| | â”œâ”€runtime-with-compiler.ts| | â”œâ”€util| | | â”œâ”€attrs.ts| | | â”œâ”€class.ts| | | â”œâ”€compat.ts| | | â”œâ”€element.ts| | | â”œâ”€index.ts| | | â””style.ts| | â”œâ”€runtime| | | â”œâ”€class-util.ts| | | â”œâ”€index.ts| | | â”œâ”€node-ops.ts| | | â”œâ”€patch.ts| | | â”œâ”€transition-util.ts| | | â”œâ”€modules| | | | â”œâ”€attrs.ts| | | | â”œâ”€class.ts| | | | â”œâ”€dom-props.ts| | | | â”œâ”€events.ts| | | | â”œâ”€index.ts| | | | â”œâ”€style.ts| | | | â””transition.ts| | | â”œâ”€directives| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””show.ts| | | â”œâ”€components| | | | â”œâ”€index.ts| | | | â”œâ”€transition-group.ts| | | | â””transition.ts| | â”œâ”€compiler| | | â”œâ”€index.ts| | | â”œâ”€options.ts| | | â”œâ”€util.ts| | | â”œâ”€modules| | | | â”œâ”€class.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””style.ts| | | â”œâ”€directives| | | | â”œâ”€html.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””text.ts 4.1 ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªplatformsç›®å½•å‘¢ï¼Ÿplatforms ç¿»è¯‘æˆä¸­æ–‡è¡¨ç¤ºâ€œå¹³å°â€œã€‚ vueä½œä¸ºä¸€ä¸ªè·¨å¹³å°çš„æ¡†æ¶ï¼Œä¸ä»…æ”¯æŒä¼ ç»Ÿçš„webæµè§ˆå™¨ç¯å¢ƒï¼Œè¿˜æ”¯æŒå…¶ä»–å¹³å°ï¼Œå¦‚æœåŠ¡å™¨æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Œç”šè‡³æ˜¯éæµè§ˆå™¨ç¯å¢ƒã€‚ å› æ­¤ï¼Œå°† Web å¹³å°ç›¸å…³çš„ä»£ç å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œæœ‰åŠ©äºä¿æŒä»£ç çš„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ã€‚ Webå¹³å°æœ‰è®¸å¤šç‰¹å®šçš„åŠŸï¼Œæ¯”å¦‚ DOMæ“ä½œã€CSSåŠ¨ç”»ã€äº‹ä»¶å¤„ç†ç­‰ã€‚è¿™äº›åŠŸèƒ½åœ¨ Vueçš„ Webç‰ˆæœ¬ä¸­æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯åœ¨å…¶ä»–å¹³å°ä¸Šåˆ™ä¸ä¸€å®šé€‚ç”¨ã€‚å°†è¿™äº›ä»£ç ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¯ä»¥ç¡®ä¿å®ƒä»¬åªåœ¨ Webå¹³å°ä¸Šç”Ÿæ•ˆï¼Œè€Œä¸ä¼šå½±å“åˆ°å…¶ä»–å¹³å°çš„æ„å»ºã€‚ å½“ç„¶ç›®å‰ä»…ä»…åªæœ‰ä¸€ä¸ªwebå¹³å°ï¼Œæ‰€ä»¥å¹³å°ä¸‹åªæœ‰ä¸€ä¸ª webç›®å½•ã€‚ 4.2 å‡ ä¸ªå…¥å£æ–‡ä»¶entry-*æ–‡ä»¶ä¸»è¦ç”¨äºå®šä¹‰ä¸åŒæ„å»ºé…ç½®ä¸‹çš„å…¥å£ç‚¹ã€‚ webç›®å½•ä¸‹æœ‰entry-compiler.tsã€entry-runtime-esm.tsã€entry-runtime-with-compiler-esm.tsã€entry-runtime-with-compilerã€entry-runtime.tsäº”ä¸ªå…¥å£æ–‡ä»¶ã€‚ åœ¨vueæºç scripts/config.jsä¸­æœ‰æ‰“åŒ…ç›¸å…³çš„é…ç½®ï¼Œå…¶ä¸­å°±åˆ©ç”¨äº†è¿™å‡ ä¸ªå…¥å£æ–‡ä»¶ã€‚ 4.2.1 entry-compiler.tsè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªæä¾›ç¼–è¯‘ html æ¨¡æ¿ç›¸å…³æ¥å£çš„æ¨¡å—ï¼Œé€šå¸¸ç”¨äºä¸º Vue ç¼–å†™çš„æ„å»ºæ’ä»¶ï¼Œæ¯”å¦‚ vue-loaderã€‚ 1234567891011// scripts/config.jslet builds = &#123; compiler: &#123; entry: resolve(&#x27;web/entry-compiler.ts&#x27;), dest: resolve(&#x27;packages/template-compiler/build.js&#x27;), format: &#x27;cjs&#x27;, external: Object.keys( require(&#x27;../packages/template-compiler/package.json&#x27;).dependencies ) &#125;,&#125; 4.2.2 entry-runtime.ts &amp; entry-runtime-esm.tsè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½ç”¨äºæ„å»ºä»…åŒ…å«è¿è¡Œæ—¶çš„æ–‡ä»¶ï¼Œä¸å…·å¤‡ç¼–è¯‘ html æ¨¡æ¿åŠŸèƒ½ã€‚åŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯ esmæ ¼å¼ï¼Œä¸€ä¸ªä¸æ˜¯ã€‚ 12345678910111213141516// scripts/config.jslet builds = &#123; &#x27;runtime-esm&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-esm.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.esm.js&#x27;), format: &#x27;es&#x27;, banner &#125;, &#x27;runtime-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.min.js&#x27;), format: &#x27;umd&#x27;, env: &#x27;production&#x27;, banner &#125;,&#125; 4.2.3 entry-runtime-with-compiler.ts &amp; entry-runtime-with-compiler-esm.tsè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½ç”¨äºæ„å»ºåŒæ—¶åŒ…å«ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶çš„å…¨åŠŸèƒ½æ–‡ä»¶ã€‚ åŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯ esmæ ¼å¼ï¼Œä¸€ä¸ªä¸æ˜¯ã€‚ ä¸‹é¢çš„full-cjs-prodå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªå…¨ç‰ˆæœ¬ï¼Œæœ‰ vueçš„å…¨éƒ¨åŠŸèƒ½ã€‚ 1234567891011121314151617181920// scripts/config.jslet builds = &#123; &#x27;full-cjs-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-with-compiler.ts&#x27;), dest: resolve(&#x27;dist/vue.common.prod.js&#x27;), format: &#x27;cjs&#x27;, env: &#x27;production&#x27;, alias: &#123; he: &#x27;./entity-decoder&#x27; &#125;, banner &#125;, &#x27;full-esm-browser-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-with-compiler-esm.ts&#x27;), dest: resolve(&#x27;dist/vue.esm.browser.min.js&#x27;), format: &#x27;es&#x27;, transpile: false, env: &#x27;production&#x27;, alias: &#123; he: &#x27;./entity-decoder&#x27; &#125;, banner &#125;,&#125; 4.3 runtime-with-compiler.tsä¹‹å‰æˆ‘ä»¬äº†è§£åˆ° Vueåˆ†ä¸º runtime å’Œ compilerä¸¤ä¸ªéƒ¨åˆ†ã€‚ è€Œ runtime-with-compiler.tsæ–‡ä»¶å°±æ˜¯æ—¢æœ‰ runtimeéƒ¨åˆ† ä¹Ÿæœ‰ compileréƒ¨åˆ†ã€‚ ä¸Šé¢çš„entry-runtime-with-compiler.tså’Œentry-runtime-with-compiler-esm.tså°±æ˜¯åŸºäºè¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…çš„ã€‚åªæ˜¯åˆ†åˆ«æ‰©å±•äº†vueçš„ä¸€äº›åŠŸèƒ½ã€‚ 4.4 utilç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vueåœ¨ Webå¹³å°ä¸Šå¸¸ç”¨çš„å·¥å…·å‡½æ•°å’Œä½¿ç”¨å·¥å…·ã€‚ è¿™äº›å·¥å…·ä¸»è¦ç”¨äºå¤„ç†ä¸ Webå¹³å°ç›¸å…³çš„å„ç§ç»†èŠ‚ã€‚ 4.5 runtimeç›®å½•4.5.1 componentsç›®å½•è¯¥ç›®å½•ä¸‹å­˜æ”¾ç€ vue webå¹³å°ä¸­ä½¿ç”¨çš„ç»„ä»¶å¦‚ transitionã€transition-groupç»„ä»¶ç­‰ï¼Œå€ŸåŠ©è¿™äº›ç»„ä»¶å¯ä»¥å®ç°è¿‡æ¸¡åŠ¨ç”»ã€‚ 4.5.2 directivesç›®å½•è¯¥ç›®å½•ä¸‹çš„ä¸»è¦å­˜æ”¾æ˜¯ vueçš„å†…éƒ¨æŒ‡ä»¤æ–‡ä»¶ï¼Œå¦‚v-modelã€v-showæŒ‡ä»¤ã€‚ 4.5.3 modulesç›®å½•è¯¥ç›®å½•ä¸‹çš„ä¸»è¦å­˜æ”¾çš„æ˜¯vueåœ¨ webå¹³å°ä¸Šå¸¸è§çš„ DOMæ“ä½œå’Œç‰¹æ€§å¤„ç†ã€‚ 4.5.3.1 attrs.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†å…ƒç´ å±æ€§çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£æ›´æ–°å’Œç®¡ç†å…ƒç´ çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå½“æ•°æ®æ¨¡å‹ä¸­çš„å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–° DOM ä¸­ç›¸åº”çš„å±æ€§å€¼ã€‚ 4.5.3.2 class.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†å…ƒç´ ç±»çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£æ›´æ–°å’Œç®¡ç†å…ƒç´ çš„ç±»åã€‚ä¾‹å¦‚ï¼Œæ ¹æ®æ•°æ®æ¨¡å‹ä¸­çš„æ¡ä»¶åŠ¨æ€æ·»åŠ æˆ–ç§»é™¤ç±»åã€‚ 4.5.3.3 dom-props.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç† DOM å±æ€§çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£åŒæ­¥å’Œæ›´æ–° DOM å±æ€§ï¼Œå¦‚ value, checked ç­‰ã€‚è¿™åœ¨å¤„ç†è¡¨å•æ§ä»¶æ—¶å°¤ä¸ºé‡è¦ã€‚ 4.5.3.4 events.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†äº‹ä»¶ç»‘å®šçš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£åœ¨ DOM å…ƒç´ ä¸Šæ·»åŠ ã€æ›´æ–°å’Œç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€‚è¿™ä½¿å¾— Vue.js å¯ä»¥å“åº”ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œå¹¶è§¦å‘ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ 4.5.3.5 style.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†å†…è”æ ·å¼çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£æ›´æ–°å’Œç®¡ç†å…ƒç´ çš„å†…è”æ ·å¼ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®æ•°æ®æ¨¡å‹ä¸­çš„æ¡ä»¶åŠ¨æ€è®¾ç½®æˆ–ç§»é™¤å†…è”æ ·å¼ã€‚ 4.5.3.6 transition.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†è¿‡æ¸¡åŠ¨ç”»çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£åº”ç”¨è¿‡æ¸¡ç±»ï¼Œç®¡ç†è¿‡æ¸¡çŠ¶æ€ï¼Œå¹¶ç¡®ä¿è¿‡æ¸¡æ•ˆæœæ­£ç¡®åœ°åº”ç”¨äºå…ƒç´ ã€‚ 4.5.4 transition-util.tsè¯¥æ–‡ä»¶åŒ…å«äº† Vue.js åœ¨ Web å¹³å°ä¸Šä¸è¿‡æ¸¡åŠ¨ç”»ç›¸å…³çš„å®ç”¨å·¥å…·å‡½æ•°ã€‚ è¿™äº›å·¥å…·å‡½æ•°ä¸º &lt;transition&gt; å’Œ &lt;transition-group&gt; ç»„ä»¶æä¾›äº†åº•å±‚çš„æ”¯æŒï¼Œä½¿å¾— Vue.js èƒ½å¤Ÿç®¡ç†å’Œæ§åˆ¶å…ƒç´ çš„è¿‡æ¸¡æ•ˆæœã€‚ 4.5.5 patch.tsè¯¥æ–‡ä»¶æ˜¯ Vue.js åœ¨ Web å¹³å°ä¸Šè´Ÿè´£ DOM æ›´æ–°çš„æ ¸å¿ƒæ¨¡å—ã€‚ è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº† patch å‡½æ•°ï¼Œå®ƒæ˜¯ Vue.js æ¸²æŸ“å¼•æ“çš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€ï¼Œç”¨äºå°†è™šæ‹Ÿ DOMï¼ˆVirtual DOMï¼‰æ›´æ–°åˆ°å®é™…çš„ DOM ä¸Šã€‚ ä»–å®é™…ä¸Šå¼•ç”¨äº†core/vdom/patchç›®å½•ä¸‹çš„ createPatchFunctionå‡½æ•°ã€‚ 4.5.6 node-ops.tsè¯¥æ–‡ä»¶åŒ…å«äº† Vue.js åœ¨ Web å¹³å°ä¸Šè¿›è¡Œ DOM æ“ä½œçš„å…·ä½“å®ç°ã€‚ è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ˜¯ Vue.js æ¸²æŸ“å¼•æ“åœ¨æ›´æ–° DOM æ—¶ä½¿ç”¨çš„å…·ä½“æ“ä½œã€‚å¦‚æ·»åŠ èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ç­‰ã€‚ 4.5.7 class-util.tsè¯¥æ–‡ä»¶åŒ…å«äº† vue åœ¨ webå¹³å°ä¸Šä¸å…ƒç´ ç±»ç›¸å…³çš„ä½¿ç”¨å·¥å…·å‡½æ•°ã€‚ è¿™äº›å·¥å…·å‡½æ•°ç”¨äºå¤„ç†å…ƒç´ çš„ç±»åï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤å’Œåˆ‡æ¢ç±»åç­‰æ“ä½œã€‚ 4.6 compilerç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vue.js åœ¨ Web å¹³å°ä¸Šè¿›è¡Œæ¨¡æ¿ç¼–è¯‘çš„ç›¸å…³å®ç°ã€‚ è¿™ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ¨¡å—è´Ÿè´£å°† Vue æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯ä»¥è¢« Vue æ¸²æŸ“å¼•æ“æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°ã€‚ å…¶ä¸­ directivesç›®å½•ä¸‹çš„æ–‡ä»¶ å®šä¹‰äº†ä¸€äº›å†…ç½®æŒ‡ä»¤å¦‚v-htmlã€v-textã€‚ modulesç›®å½•ä¸­å­˜æ”¾äº†å¯¹åº”å¤„ç†æ¨¡æ¿ç¼–è¯‘æ—¶éœ€è¦çš„ä¸€äº›é€šç”¨å¤„ç†æ–¹æ³•ã€‚ å…¶ä½™æ–‡ä»¶ä¸ºé€šç”¨å·¥å…·ç­‰ã€‚ äº”ã€coreæ–‡ä»¶å¤¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071srcâ”œâ”€core| â”œâ”€config.ts| â”œâ”€index.ts| â”œâ”€vdom| | â”œâ”€create-component.ts| | â”œâ”€create-element.ts| | â”œâ”€create-functional-component.ts| | â”œâ”€patch.ts| | â”œâ”€vnode.ts| | â”œâ”€modules| | | â”œâ”€directives.ts| | | â”œâ”€index.ts| | | â””template-ref.ts| | â”œâ”€helpers| | | â”œâ”€extract-props.ts| | | â”œâ”€get-first-component-child.ts| | | â”œâ”€index.ts| | | â”œâ”€is-async-placeholder.ts| | | â”œâ”€merge-hook.ts| | | â”œâ”€normalize-children.ts| | | â”œâ”€normalize-scoped-slots.ts| | | â”œâ”€resolve-async-component.ts| | | â””update-listeners.ts| â”œâ”€util| | â”œâ”€debug.ts| | â”œâ”€env.ts| | â”œâ”€error.ts| | â”œâ”€index.ts| | â”œâ”€lang.ts| | â”œâ”€next-tick.ts| | â”œâ”€options.ts| | â”œâ”€perf.ts| | â””props.ts| â”œâ”€observer| | â”œâ”€array.ts| | â”œâ”€dep.ts| | â”œâ”€index.ts| | â”œâ”€scheduler.ts| | â”œâ”€traverse.ts| | â””watcher.ts| â”œâ”€instance| | â”œâ”€events.ts| | â”œâ”€index.ts| | â”œâ”€init.ts| | â”œâ”€inject.ts| | â”œâ”€lifecycle.ts| | â”œâ”€proxy.ts| | â”œâ”€render.ts| | â”œâ”€state.ts| | â”œâ”€render-helpers| | | â”œâ”€bind-dynamic-keys.ts| | | â”œâ”€bind-object-listeners.ts| | | â”œâ”€bind-object-props.ts| | | â”œâ”€check-keycodes.ts| | | â”œâ”€index.ts| | | â”œâ”€render-list.ts| | | â”œâ”€render-slot.ts| | | â”œâ”€render-static.ts| | | â”œâ”€resolve-filter.ts| | | â”œâ”€resolve-scoped-slots.ts| | | â””resolve-slots.ts| â”œâ”€global-api| | â”œâ”€assets.ts| | â”œâ”€extend.ts| | â”œâ”€index.ts| | â”œâ”€mixin.ts| | â””use.ts| â”œâ”€components| | â”œâ”€index.ts| | â””keep-alive.ts coreæ–‡ä»¶å¤¹æ˜¯å­˜å‚¨è¿™ vueçš„æ ¸å¿ƒé€»è¾‘ã€‚ 5.1 componentsç›®å½•è¯¥ç›®å½•ä¸‹å­˜æ”¾äº†ä¸€äº›å†…ç½®ç»„ä»¶å¦‚ keep-aliveã€‚ 5.2 global-apiç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vue.jsåœ¨æ ¸å¿ƒå±‚é¢æä¾›çš„å…¨å±€ APIçš„å®ç°ã€‚ å¦‚Vue.mixinã€Vue.useã€Vue.extendç­‰ã€‚ 5.3 instanceç›®å½•è¯¥ç›®å½•åŒ…å«äº† vueå®ä¾‹ç›¸å…³çš„ä¸»è¦å®ç°ã€‚ å…¶ä¸­:render.jsè´Ÿè´£æ¸²æŸ“ç›¸å…³çš„é€»è¾‘ã€lifecycle.jsè´Ÿè´£ç®¡ç† vueå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€events.jsè´Ÿè´£å¤„ç† vueå®ä¾‹ä¸Šçš„äº‹ä»¶ã€state.jsè´Ÿè´£ç®¡ç† vueå®ä¾‹çš„æ•°æ®çŠ¶æ€ç­‰ã€‚ 5.4 observeç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vue.js ä¸­ç”¨äºå®ç°å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ã€‚ è¿™éƒ¨åˆ†ä»£ç è´Ÿè´£å°†æ•°æ®å¯¹è±¡è½¬æ¢ä¸ºå¯è§‚å¯Ÿçš„å¯¹è±¡ï¼Œä½¿å¾—æ•°æ®çš„å˜åŒ–èƒ½å¤Ÿè¢«è¿½è¸ªï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ä¾èµ–äºè¯¥æ•°æ®çš„è§†å›¾ã€‚ 5.5 vdomç›®å½•è¯¥ç›®å½•åŒ…å«äº†Vue.js å¤„ç†è™šæ‹Ÿ DOM (Virtual DOM) çš„ç›¸å…³å®ç°ã€‚ è™šæ‹Ÿ DOM æ˜¯ Vue.js æ¸²æŸ“æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒé€šè¿‡å†…å­˜ä¸­çš„ JavaScript å¯¹è±¡æ¥è¡¨ç¤ºçœŸå®çš„ DOM èŠ‚ç‚¹ã€‚ å…­ã€compileræ–‡ä»¶å¤¹è¯¥ç›®å½•å­˜æ”¾äº†vueæ¨¡æ¿ç¼–è¯‘çš„ç›¸å…³å†…å®¹ã€‚ 1234567891011121314151617181920212223srcâ”œâ”€compiler| â”œâ”€codeframe.ts| â”œâ”€create-compiler.ts| â”œâ”€error-detector.ts| â”œâ”€helpers.ts| â”œâ”€index.ts| â”œâ”€optimizer.ts| â”œâ”€to-function.ts| â”œâ”€parser| | â”œâ”€entity-decoder.ts| | â”œâ”€filter-parser.ts| | â”œâ”€html-parser.ts| | â”œâ”€index.ts| | â””text-parser.ts| â”œâ”€directives| | â”œâ”€bind.ts| | â”œâ”€index.ts| | â”œâ”€model.ts| | â””on.ts| â”œâ”€codegen| | â”œâ”€events.ts| | â””index.ts ä¸ƒã€æ€»ç»“æˆ‘ä»¬è¿™ç« å¤§æ¦‚çš„ä»‹ç»äº† vueçš„å¤§ä½“ç›®å½•ç»“æ„ã€‚"},{"path":"/css/extra.css","content":"/** è®¾ç½®ä¾§è¾¹æ åº•éƒ¨ **/ .social-wrap { display: block; } .social-wrap .social:hover { background-color: #d7beb6 } /** è®¾ç½®å³è¾¹æ  **/ /** å³è¾¹æ ç›®å½•é«˜åº¦è®¾ç½® **/ .l_right .widgets .widget-wrapper.toc .widget-body .toc{ /* max-height: calc(100vh - 500px); */ } .widget-wrapper.toc+.widget-wrapper{ padding-top: 0px; }"}]