[{"title":"ğŸ”¥Vue2æ¸²æŸ“åŸºç¡€-è™šæ‹ŸDOM","path":"//posts/vue2-vnode.html","content":"ä¸“æ ç¬¬å…­ç¯‡-è™šæ‹ŸèŠ‚ç‚¹ä»¥åŠcreateElementå‡½æ•° åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Vueåˆå§‹åŒ–çš„ä¸€ç³»åˆ—æ“ä½œã€‚ å¯ä»¥Vueç»ˆå½’åªæ˜¯ä¸ºäº†ç”»é¡µé¢ã€‚ åé¢çš„ç« èŠ‚å°±å¸¦ç€å¤§å®¶æ¥è§£ææ¸²æŸ“ç›¸å…³çš„é€»è¾‘ï¼Œä¸€æ­¥ä¸€æ­¥è§£æVueæ˜¯å¦‚ä½•å°†æ¨¡æ¿æŒ‚è½½åˆ°é¡µé¢ä¸Šçš„ã€‚ ä½†æ˜¯åœ¨è§£ææ¸²æŸ“ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Vueæ¡†æ¶æ¸²æŸ“çš„åŸºç¡€-è™šæ‹Ÿ DOMã€‚ ä¸€ã€æ¸²æŸ“å™¨çš„æ¸²æŸ“æµç¨‹åœ¨è®¨è®ºè™šæ‹ŸèŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æµè§ˆå™¨æ¸²æŸ“çš„æµç¨‹ã€‚ å½“æµè§ˆå™¨æ¥æ”¶åˆ°ä¸€ä¸ª HTML æ–‡ä»¶åï¼ŒJavaScript å¼•æ“ä¸æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“éšå³å¼€å§‹è¿è¡Œã€‚ ä»æ¸²æŸ“å¼•æ“çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒé¦–å…ˆä¼šæŠŠ HTML æ–‡ä»¶è§£æä¸ºä¸€ä¸ª DOM æ ‘ã€‚ ä¸æ­¤åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šè¯†åˆ«å¹¶åŠ è½½ CSS æ ·å¼ï¼Œç„¶åå°†å…¶ä¸ DOM æ ‘åˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚ åœ¨æœ‰äº†æ¸²æŸ“æ ‘ä¹‹åï¼Œæ¸²æŸ“å¼•æ“ä¼šè®¡ç®—æ‰€æœ‰å…ƒç´ çš„ä½ç½®ä¿¡æ¯ï¼Œæœ€åé€šè¿‡ç»˜åˆ¶æ“ä½œï¼Œåœ¨å±å¹•ä¸Šå‘ˆç°å‡ºæœ€ç»ˆçš„å†…å®¹ã€‚ JavaScript å¼•æ“å’Œæ¸²æŸ“å¼•æ“è™½ç„¶å¤„äºä¸¤ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¹‹ä¸­ï¼Œç„¶è€Œ JavaScript å¼•æ“å´èƒ½å¤Ÿè§¦å‘æ¸²æŸ“å¼•æ“å¼€å§‹å·¥ä½œã€‚ å½“æˆ‘ä»¬å€ŸåŠ©è„šæœ¬å»æ›´æ”¹å…ƒç´ çš„ä½ç½®æˆ–è€…å¤–è§‚æ—¶ï¼ŒJavaScript å¼•æ“ä¼šè¿ç”¨ä¸ DOM ç›¸å…³çš„ API æ–¹æ³•æ¥æ“ä½œ DOM å¯¹è±¡ã€‚ æ­¤æ—¶æ¸²æŸ“å¼•æ“ä¾¿å¼€å§‹è¿ä½œï¼Œæ¸²æŸ“å¼•æ“ä¼šè§¦å‘å›æµæˆ–è€…é‡ç»˜æ“ä½œã€‚ æˆ‘ä»¬æ¥äº†è§£ä¸‹å›æµä»¥åŠé‡ç»˜çš„æ¦‚å¿µï¼š å›æµï¼šå½“æˆ‘ä»¬å¯¹DOMçš„ä¿®æ”¹å¼•å‘äº†å…ƒç´ å°ºå¯¸çš„å˜åŒ–æ—¶ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼Œæœ€åå°†é‡æ–°è®¡ç®—çš„ç»“æœç»˜åˆ¶å‡ºæ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›æµã€‚ é‡ç»˜ï¼šå½“æˆ‘ä»¬å¯¹DOMçš„ä¿®æ”¹åªå•çº¯æ”¹å˜å…ƒç´ çš„é¢œè‰²æ—¶ï¼Œæµè§ˆå™¨æ­¤æ—¶å¹¶ä¸éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å¤§å°å’Œä½ç½®ï¼Œè€Œåªè¦é‡æ–°ç»˜åˆ¶æ–°æ ·å¼ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé‡ç»˜ã€‚ å¾ˆæ˜¾ç„¶ï¼Œå›æµæ¯”èµ·é‡ç»˜æ›´åŠ æ¶ˆè€—æ€§èƒ½ã€‚ é€šè¿‡äº†è§£æµè§ˆå™¨åŸºæœ¬çš„æ¸²æŸ“æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸éš¾è”æƒ³åˆ°ï¼Œå½“ä¸æ–­åœ°é€šè¿‡ JavaScript ä¿®æ”¹ DOM æ—¶ï¼Œå¾ˆå®¹æ˜“åœ¨ä¸ç»æ„é—´è§¦å‘æ¸²æŸ“å¼•æ“çš„å›æµæˆ–è€…é‡ç»˜ï¼Œè€Œè¿™ç§æ“ä½œæ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€æ˜¯éå¸¸å·¨å¤§çš„ã€‚ å› æ­¤ï¼Œä¸ºäº†é™ä½æ€§èƒ½å¼€é”€ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°½å¯èƒ½åœ°å‡å°‘å¯¹ DOM çš„æ“ä½œã€‚ è™šæ‹ŸèŠ‚ç‚¹å°±æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹å­•è‚²è€Œç”Ÿã€‚ äºŒ. ç¼“å†²å±‚-è™šæ‹ŸDOMè™šæ‹Ÿ DOM ï¼ˆVirtual DOM ä»¥ä¸‹ç®€ç§° VDOMï¼‰æ˜¯ä¸ºäº†è§£å†³é¢‘ç¹æ“ä½œ DOM æ‰€å¼•å‘çš„æ€§èƒ½é—®é¢˜è€Œäº§ç”Ÿçš„äº§ç‰©ã€‚ VDOMæ˜¯æŠŠé¡µé¢çš„çŠ¶æ€æŠ½è±¡æˆ JS å¯¹è±¡çš„å½¢å¼å‘ˆç°ã€‚ ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒå¤„äº JS ä¸çœŸå® DOM ä¹‹é—´ï¼Œèµ·ç€ä¸­é—´å±‚çš„ä½œç”¨ã€‚ å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ JS è„šæœ¬è¿›è¡Œå¤§æ‰¹é‡çš„ DOM æ“ä½œæ—¶ï¼Œä¼šä¼˜å…ˆåœ¨è™šæ‹Ÿ VDOM è¿™ä¸ª JS å¯¹è±¡ä¸Šè¿›è¡Œæ“ä½œã€‚ æœ€åï¼Œé€šè¿‡å¯¹æ¯”æ‰¾å‡ºå°†è¦æ”¹åŠ¨çš„éƒ¨åˆ†ï¼Œå¹¶å°†è¿™äº›æ”¹åŠ¨é€šçŸ¥å¹¶æ›´æ–°åˆ°çœŸå®çš„ DOM ä¸Šã€‚ å°½ç®¡æœ€ç»ˆä»ç„¶æ˜¯å¯¹çœŸå®çš„ DOM è¿›è¡Œæ“ä½œï¼Œç„¶è€Œè™šæ‹Ÿ DOM èƒ½å¤Ÿå°†å¤šä¸ªæ”¹åŠ¨åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹é‡æ“ä½œã€‚ è¿™æ ·åšå¯ä»¥å‡å°‘ DOM é‡æ’çš„æ¬¡æ•°ï¼Œè¿›è€Œç¼©çŸ­ç”Ÿæˆæ¸²æŸ“æ ‘ä»¥åŠè¿›è¡Œç»˜åˆ¶æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªçœŸå®çš„ DOM å…·ä½“åŒ…å«äº†å“ªäº›å†…å®¹ã€‚ æµè§ˆå™¨å°†çœŸå®çš„ DOM è®¾è®¡å¾—æä¸ºå¤æ‚ã€‚ å®ƒä¸ä½†åŒ…å«äº†è‡ªèº«çš„å±æ€§æè¿°ï¼Œå¦‚å¤§å°ã€ä½ç½®ç­‰å®šä¹‰ï¼Œè¿˜å›Šæ‹¬äº† DOM æ‰€æ‹¥æœ‰çš„æµè§ˆå™¨äº‹ä»¶ç­‰å†…å®¹ã€‚ æ­£æ˜¯ç”±äºå…¶å¦‚æ­¤å¤æ‚çš„ç»“æ„ï¼Œæˆ‘ä»¬é¢‘ç¹åœ°å»æ“ä½œ DOM æˆ–å¤šæˆ–å°‘ä¼šç»™æµè§ˆå™¨å¸¦æ¥æ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚ è€Œä½œä¸ºæ•°æ®ä¸çœŸå® DOM ä¹‹é—´çš„ä¸€å±‚ç¼“å†²ï¼Œè™šæ‹Ÿ DOM åªæ˜¯ç”¨äºæ˜ å°„åˆ°çœŸå® DOM è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åŒ…å«æ“ä½œ DOM çš„æ–¹æ³•ã€‚ å®ƒåªéœ€åœ¨å¯¹è±¡ä¸­é‡ç‚¹å…³æ³¨å‡ ä¸ªå±æ€§å°±å¯ä»¥äº†ã€‚ ä¸‰ã€ VNode12345678910111213141516171819// çœŸå®DOM&lt;div id=&quot;app&quot;&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;/div&gt;// çœŸå®DOMå¯¹åº”çš„JSå¯¹è±¡(VNode)&#123; tag:&#x27;div&#x27;, data:&#123; id:&#x27;app&#x27; &#125;, children:[&#123; tag:&#x27;span&#x27;, children:[ &#123; tag:undefined, text:&#x27;Hello World&#x27; &#125; ] &#125;]&#125; é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥æ¯ä¸€ä¸ª DOMèŠ‚ç‚¹ éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ª VNode æ¥è¡¨ç¤ºã€‚ åœ¨ Vueå†…éƒ¨ï¼Œä½¿ç”¨ VNode è¿™ä¸ªæ„é€ å‡½æ•°å»æè¿°ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071export default class VNode &#123; tag?: string data: VNodeData | undefined children?: Array&lt;VNode&gt; | null text?: string elm: Node | undefined ns?: string context?: Component // rendered in this component&#x27;s scope key: string | number | undefined componentOptions?: VNodeComponentOptions componentInstance?: Component // component instance parent: VNode | undefined | null // component placeholder node // strictly internal raw: boolean // contains raw HTML? (server only) isStatic: boolean // hoisted static node isRootInsert: boolean // necessary for enter transition check isComment: boolean // empty comment placeholder? isCloned: boolean // is a cloned node? isOnce: boolean // is a v-once node? asyncFactory?: Function // async component factory function asyncMeta: Object | void isAsyncPlaceholder: boolean ssrContext?: Object | void fnContext: Component | void // real context vm for functional nodes fnOptions?: ComponentOptions | null // for SSR caching devtoolsMeta?: Object | null // used to store functional render context for devtools fnScopeId?: string | null // functional scope id support isComponentRootElement?: boolean | null // for SSR directives constructor( tag?: string, data?: VNodeData, children?: Array&lt;VNode&gt; | null, text?: string, elm?: Node, context?: Component, componentOptions?: VNodeComponentOptions, asyncFactory?: Function ) &#123; this.tag = tag this.data = data this.children = children this.text = text this.elm = elm this.ns = undefined this.context = context this.fnContext = undefined this.fnOptions = undefined this.fnScopeId = undefined this.key = data &amp;&amp; data.key this.componentOptions = componentOptions this.componentInstance = undefined this.parent = undefined this.raw = false this.isStatic = false this.isRootInsert = true this.isComment = false this.isCloned = false this.isOnce = false this.asyncFactory = asyncFactory this.asyncMeta = undefined this.isAsyncPlaceholder = false &#125; // DEPRECATED: alias for componentInstance for backwards compat. /* istanbul ignore next */ get child(): Component | void &#123; return this.componentInstance &#125;&#125; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ new å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ª VNodeã€‚ 12345678// åˆ›å»ºä¸€ä¸ªdivçš„ vnodenew VNode(&#x27;div&#x27;,&#123;&#125;,&#x27;Hello World&#x27;)// åˆ›å»ºä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„ vnodenew VNode(&#x27;div&#x27;,&#123;&#125;,[ new VNode(&#x27;span&#x27;,&#123;&#125;,&#x27;1&#x27;), new VNode(&#x27;span&#x27;,&#123;&#125;,&#x27;2&#x27;), new VNode(&#x27;span&#x27;,&#123;&#125;,&#x27;3&#x27;)]) VNodeè¿™ä¸ªæ„é€ å‡½æ•°ä¸Šæœ‰éå¸¸å¤šçš„å±æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆåˆ—ä¸¾å››ä¸ªå¸¸ç”¨çš„å±æ€§ï¼štagã€dataã€childrenã€textã€‚ å…¶ä½™å±æ€§åœ¨æˆ‘ä»¬åé¢çš„è§£æä¸­ä¼šä¸€ä¸€è¿›è¡Œè§£æã€‚ 3.1 tagå±æ€§tagè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ ‡ç­¾åç§°ã€‚ å†³å®šäº†æœ€ç»ˆä¼šæ¸²æŸ“æˆä»€ä¹ˆæ ·çš„ DOMå…ƒç´ ã€‚ tagå¯ä»¥æ˜¯ HTML å…ƒç´ ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²spanã€'div'ã€‚ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶å¼•ç”¨ï¼ŒåŒæ ·å¯ä»¥æ˜¯ä¸€ä¸ªåŠ¨æ€æ ‡ç­¾ã€‚ 123456789101112// ç¼–è¯‘å‰ï¼ˆæ™®é€šèŠ‚ç‚¹ï¼‰&lt;div&gt;&lt;/div&gt; // ç¼–è¯‘åVNode &#123; tag:&quot;div&quot;&#125;// ç¼–è¯‘å‰ï¼ˆç»„ä»¶èŠ‚ç‚¹ï¼‰&lt;CustomComponent&gt;&lt;/CustomComponent&gt; // ç¼–è¯‘åVNode &#123; tag:&quot;CustomComponent&quot;&#125; 3.2 dataå±æ€§data å‚æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ç”¨äºæè¿° VNode çš„å„ç§å±æ€§å’Œé…ç½®ä¿¡æ¯ã€‚ data å‚æ•°å¯ä»¥ç”±ä»¥ä¸‹å‡ ç§æ„æˆï¼š attrs:è¡¨ç¤ºå…ƒç´ çš„ä¸Šé™æ€å±æ€§ï¼Œå¦‚srcã€altç­‰ã€‚ staicClass:è¡¨ç¤ºå…ƒç´ ä¸Šçš„é™æ€cssç±»ã€‚ style:è¡¨ç¤ºå…ƒç´ ä¸Šçš„å†…è”æ ·å¼ã€‚ on:è¡¨ç¤ºå…ƒç´ ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨ã€‚ slot:è¡¨ç¤ºä½œç”¨åŸŸæ’æ§½æˆ–æ™®é€šæ’æ§½çš„ä½ç½®ã€‚ props:è¡¨ç¤ºä¼ é€’ç»„ä»¶çš„ props æ•°æ®ã€‚ directives:è¡¨ç¤ºæ·»åŠ çš„è‡ªå®šä¹‰çš„è¡Œä¸ºï¼Œå¦‚ v-modelã€v-showç­‰ã€‚ key:è¡¨ç¤ºç»„ä»¶å”¯ä¸€æ ‡è¯†ã€‚ 3.3 childrenchildren å‚æ•°æ˜¯æŒ‡å®šä¸€ä¸ª VNodeï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰çš„å­èŠ‚ç‚¹å†…å®¹ã€‚ è¿™ä¸ªå‚æ•°å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼Œç”¨äºæè¿°å­èŠ‚ç‚¹çš„ç»“æ„å’Œå†…å®¹ã€‚ 3.4 textæˆ‘ä»¬çŸ¥é“å¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰tagçš„ï¼Œæ¯”å¦‚æ–‡å­—èŠ‚ç‚¹å°±æ²¡æœ‰tagã€‚ åœ¨Vueä¸­ï¼Œæ–‡å­—ä¹Ÿä»£è¡¨ä¸€ä¸ªvnodeã€‚ 123456// ç¼–è¯‘å‰&quot;æˆ‘æ˜¯&quot; // ç¼–è¯‘åVNode &#123; text:&quot;æˆ‘æ˜¯&quot;&#125; 3.1.5 elmæˆ‘ä»¬çŸ¥é“åœ¨æ¸²æŸ“æ—¶ä¼šæ ¹æ® VNode åˆ›å»ºDOMå…ƒç´ ã€‚ æ¸²æŸ“åæ¯ä¸ªVNodeèŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„çœŸå® DOMå…ƒç´ ã€‚ è€Œè¿™ä¸ª elm å°±æŒ‡å‘è¿™ä¸ªçœŸå® DOMå…ƒç´ ã€‚ å››. createElementå‡½æ•°ç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“è™šæ‹ŸDOMå°±æ˜¯ä¸€ä¸ªJSå¯¹è±¡ï¼Œåªä¸è¿‡ä»–æœ‰å¾ˆå¤šå±æ€§ã€‚ æ‰€ç¤ºè¯´åˆ›å»ºä¸€ä¸ªè™šæ‹ŸDOMä¹Ÿç»ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œä½†æ˜¯ Vue æ¡†æ¶ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå‡½æ•°createElementã€‚ è¿™ä¸ªå‡½æ•°å¯ä»¥æ›´æ–¹ä¾¿çš„å¸®æˆ‘ä»¬ç”Ÿæˆè™šæ‹Ÿ DOMï¼Œåœ¨å…¶ä¸­ç£¨å¹³äº†ä¸€äº›ç»†èŠ‚ã€‚ å®ƒè¢«å®šä¹‰åœ¨ src/core/vdom/create-element.js ä¸­ï¼š 4.1 createElementåœ¨å¼€å‘æ—¶çš„ä½¿ç”¨åœºæ™¯äº†è§£createElementçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›å¯¹çœ‹æºç æ˜¯æœ‰ä¸€å®šçš„å¸®åŠ©çš„ã€‚ æœ‰åœºæ™¯å¸¦å…¥æºç æ‰çŸ¥é“å¯¹åº”çš„é€»è¾‘æ˜¯åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™ä½ å…‰çœ‹æºç ï¼Œå¯¹äºä¸€äº›é€»è¾‘ä½ æ˜¯æ— æ³•çœ‹æ‡‚çš„ã€‚ 4.1.1 webpackç¼–è¯‘æ—¶ä½¿ç”¨Vueæ¡†æ¶åº•å±‚æ¸²æŸ“æ—¶ä¼šè°ƒç”¨å®ä¾‹ä¸Šçš„_renderæ–¹æ³•ï¼Œè¿™ä¸ª renderæ–¹æ³•å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†å®ä¾‹é€‰é¡¹ä¸Šçš„ renderæ–¹æ³•ã€‚ 1vm._render =&gt; vm.$options.render ä½ å¯èƒ½ä¼šæœ‰äº›å›°æƒ‘ï¼Œå› ä¸ºå¹³æ—¶æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨.vueæ–‡ä»¶è¿›è¡Œå•é¡µé¢å¼€å‘ï¼Œæ²¡æœ‰å†™è¿‡ä»€ä¹ˆ renderæ–¹æ³•å•Šï¼Œé‚£è¿™ä¸ª renderæ–¹æ³•æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ å…¶å®æˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„ templateæ¨¡æ¿æ ‡ç­¾åœ¨ webpacké¢„ç¼–è¯‘é˜¶æ®µä¼šå˜æˆä¸€ä¸ªåˆ›å»ºvnodeçš„å‡½æ•°ã€‚ æ¯”å¦‚æˆ‘ä»¬åœ¨æ¨¡ç‰ˆä¸­ç¼–å†™ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼š 123&lt;template&gt; &lt;div&gt;hello world&lt;/div&gt;&lt;/template&gt; .vueæ–‡ä»¶åœ¨webpacké¢„ç¼–è¯‘æ—¶ä¼šè§£ææˆä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ¨¡æ¿éƒ¨åˆ†åˆ™ä¼šç¼–è¯‘æˆ renderå‡½æ•°ã€‚ æ‰€ä»¥å¹³æ—¶æˆ‘ä»¬import Test from &quot;./Test&quot;ï¼Œè¿™é‡Œçš„Testæ‰“å°å‡ºæ¥æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ æˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿™é‡Œç¼–è¯‘çš„ renderæ–¹æ³•ï¼Œå‘ç°æ²¡æœ‰ä½¿ç”¨ createElementå‡½æ•°æ¥åˆ›å»ºèŠ‚ç‚¹ï¼Œè€Œä½¿ç”¨äº†_cã€‚ é‚£ä¹ˆè¿™é‡Œçš„_cä»£è¡¨ä»€ä¹ˆï¼Ÿ _cå®é™…ä¸Šæ˜¯åœ¨ vueåˆå§‹åŒ–æ—¶åœ¨initRenderæ–¹æ³•ä¸­æ³¨å…¥çš„ï¼Œæœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯è°ƒç”¨äº† createElementã€‚ 12// ç¬¬å…­ä¸ªå‚æ•°ä»£è¡¨æ˜¯å¦éœ€è¦è§„èŒƒåŒ–å­èŠ‚ç‚¹ è¿™é‡Œè¡¨ç¤ºä¸éœ€è¦ å› ä¸º webpack é¢„ç¼–è¯‘æ—¶ä¼šç¼–è¯‘å­èŠ‚ç‚¹vm._c = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, false) 4.1.2 ç”¨æˆ·è‡ªå®šä¹‰renderæ–¹æ³•æˆ‘ä»¬çŸ¥é“.vueæ–‡ä»¶ä¼šè¢«è§£ææˆä¸€ä¸ªå¯¹è±¡çš„å½¢å¼ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ª jsæ–‡ä»¶ï¼Œè‡ªå·±å®šä¹‰ renderæ–¹æ³•ã€‚Vueæä¾›äº†è¿™ç§èƒ½åŠ›ã€‚ æˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™ä¹ˆè‡ªå®šä¹‰å‡½æ•°ã€‚ 1234567&#123; render:(h)=&gt;&#123; return &#123; h(&#x27;div&#x27;,&#x27;hello world&#x27;) &#125; &#125;&#125; è€Œæºç ä¸­ä¼šå°† vm.$createElementä¼ å…¥ renderæ–¹æ³•ä¸­ã€‚ 12345try &#123; vnode = render.call(vm._renderProxy, vm.$createElement)&#125; catch (e: any) &#123; ///&#125; æ‰€ä»¥è¿™é‡Œçš„ vm.$createElementå°±æ˜¯hå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åˆ›å»º VNodeçš„å‡½æ•°ã€‚ $createElementå’Œ_cä¸€æ ·ä¹Ÿæ˜¯åœ¨vueåˆå§‹åŒ–æ—¶åœ¨initRenderæ–¹æ³•ä¸­æ³¨å…¥çš„ã€‚ 12// ç¬¬å…­ä¸ªå‚æ•°æ˜¯ true è¡¨ç¤ºéœ€è¦å¤„ç†å­èŠ‚ç‚¹ä¸º VNodeèŠ‚ç‚¹vm.$createElement = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, true) _cå’Œ$createElementçš„ä¸åŒä¹‹å¤„æ˜¯$createElementä¸­å¯¹äº createElementçš„ç¬¬å…­ä¸ªå‚æ•°ä¼ é€’çš„å€¼ä¸åŒã€‚ 4.2 createElementå‡½æ•°è§£æ123456789101112131415161718export function createElement( context: Component, tag: any, data: any, children: any, normalizationType: any, alwaysNormalize: boolean): VNode | Array&lt;VNode&gt; &#123; if (isArray(data) || isPrimitive(data)) &#123; normalizationType = children children = data data = undefined &#125; if (isTrue(alwaysNormalize)) &#123; normalizationType = ALWAYS_NORMALIZE &#125; return _createElement(context, tag, data, children, normalizationType)&#125; createElementçš„å‚æ•°åˆ†åˆ«æ˜¯ï¼š ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcontextï¼šè¡¨ç¤ºä¸Šä¸‹æ–‡ï¼Œä¸€èˆ¬è¿™é‡Œä¼ é€’çš„æ˜¯vueå®ä¾‹vmã€‚ ç¬¬äºŒä¸ªå‚æ•°ä¸º tagï¼šè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ ‡ç­¾ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º dataï¼šè¡¨ç¤ºåˆ›å»ºçš„è™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®ã€‚ ç¬¬å››ä¸ªå‚æ•°ä¸º childrenï¼šè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚ ç¬¬äº”ä¸ªå‚æ•°ä¸º normalizationTypeï¼šè¿™ä¸ªå‚æ•°å†³å®šè§„èŒƒåŒ–çš„ç±»å‹ã€‚ ç¬¬å…­ä¸ªå‚æ•°ä¸º alwaysNormalizeï¼šè¡¨ç¤ºæ˜¯å¦è§„èŒƒåŒ–å­èŠ‚ç‚¹ã€‚ createElement æ–¹æ³•å®é™…ä¸Šæ˜¯å¯¹ _createElement æ–¹æ³•çš„å°è£…ï¼Œå®ƒå…è®¸ä¼ å…¥çš„å‚æ•°æ›´åŠ çµæ´»ï¼Œåœ¨å¤„ç†è¿™äº›å‚æ•°åï¼Œè°ƒç”¨çœŸæ­£åˆ›å»º VNode çš„å‡½æ•° _createElementã€‚ 4.2.1 å¯¹ç¬¬äºŒä¸ªå‚æ•°åšå…¼å®¹1234// å­˜åœ¨ dataçš„æƒ…å†µcreateElement(context,&#x27;div&#x27;,&#123;style:&#123;color:&quot;red&quot;&#125;&#125;,&#x27;hello world&#x27;) // ä¸å­˜åœ¨ dataçš„æƒ…å†µcreateElement(context,&#x27;div&#x27;,null,&#x27;hello world&#x27;) å¦‚ä¸Šï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤º dataï¼Œç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºchildrenã€‚ è€Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¼ é€’ dataå±æ€§ï¼Œä½†æ˜¯ç”±äºå‚æ•°é¡ºåºçš„åŸå› ï¼Œä¾æ—§éœ€è¦ä¼ é€’ä¸€ä¸ªç©ºå¯¹è±¡æ¥è¿›è¡Œå ä½ã€‚ è¿™ä¸ªæ—¶å€™å‡½æ•°å†…éƒ¨å¯¹è¿™ä¸ªå‚æ•°è¿›è¡Œäº†å…¼å®¹å¤„ç†ã€‚ åˆ¤æ–­å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°ç»„æˆ–è€…åŸå§‹ç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•°å­—ç­‰ï¼‰ï¼Œåˆ™å°†å…¶ç¬¬ä¸‰ä¸ªå‚æ•°è§†ä¸ºæ˜¯ä¼ é€’çš„å­èŠ‚ç‚¹ã€‚ åŒæ—¶å°†dataç½®ä¸ºundefinedï¼ŒnormalizationTypeä½¿ç”¨ç¬¬å››ä¸ªå‚æ•°ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè°ƒç”¨ï¼Œä¸ç”¨å†ä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦äº†ã€‚ 12// ä¸å­˜åœ¨ dataçš„æƒ…å†µ ä¸éœ€è¦ä¼ é€’ dataè¿›è¡Œå ä½createElement(context,&#x27;div&#x27;,&#x27;hello world&#x27;) 4.2.2 å¯¹childrençš„è§„èŒƒåŒ–ç”±äºVNodeå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸€ä¸ªVNodeå¯èƒ½ä¼šæœ‰è‹¥å¹²ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™äº›å­èŠ‚ç‚¹åº”è¯¥ä¹Ÿæ˜¯ VNode çš„ç±»å‹ã€‚ _createElement æ¥æ”¶çš„ç¬¬ 4 ä¸ªå‚æ•° children æ˜¯ä»»æ„ç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬è§„èŒƒæˆ VNode ç±»å‹ã€‚ normalizationTypeçš„å€¼æœ‰ 2 ç§ï¼š SIMPLE_NORMALIZEï¼šå€¼ä¸º 1ï¼Œè¡¨ç¤ºç®€å•å¤„ç†å­èŠ‚ç‚¹ ALWAYS_NORMALIZEï¼šå€¼ä¸º 2ï¼Œè¡¨ç¤ºé€’å½’å¤„ç†æ‰€æœ‰å­èŠ‚ç‚¹ éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºrenderæ–¹æ³•ï¼ŒnormalizationTypeä¸€ç›´ä¸ºALWAYS_NORMALIZEã€‚è¡¨ç¤ºéœ€è¦è§„èŒƒå¤„ç†å­èŠ‚ç‚¹ã€‚ å› ä¸ºç”¨æˆ·æœ‰å¯èƒ½ä¸æ˜¯å¾ˆç†Ÿæ‚‰ createElementçš„ä½¿ç”¨æ–¹å¼å’Œ Vueçš„æ¸²æŸ“æœºåˆ¶å¯¼è‡´ä¸€äº›é”™è¯¯æƒ…å†µçš„å‘ç”Ÿï¼Œå¦‚ä¸‹ï¼š 12345678// å¦‚æœä¸è¿›è¡Œå¤„ç†ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ææœ‰å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜render(h)&#123; return h(&#x27;ul&#x27;,[ &quot;è‹¹æœ&quot;, &quot;é¦™è•‰&quot;, &quot;æ¢¨&quot; ])&#125; è¿™é‡Œæ ¹æ® normalizationType çš„ä¸åŒï¼Œåˆ†åˆ«è°ƒç”¨äº†normalizeChildren(children) å’Œ simpleNormalizeChildren(children)æ–¹æ³•ã€‚ å®ƒä»¬çš„å®šä¹‰éƒ½åœ¨ src/core/vdom/helpers/normalzie-children.js ä¸­ï¼š 4.2.2.1 simpleNormalizeChildren1234567891011121314151617181920// The template compiler attempts to minimize the need for normalization by// statically analyzing the template at compile time.//// For plain HTML markup, normalization can be completely skipped because the// generated render function is guaranteed to return Array&lt;VNode&gt;. There are// two cases where extra normalization is needed:// 1. When the children contains components - because a functional component// may return an Array instead of a single root. In this case, just a simple// normalization is needed - if any child is an Array, we flatten the whole// thing with Array.prototype.concat. It is guaranteed to be only 1-level deep// because functional components already normalize their own children.export function simpleNormalizeChildren(children: any) &#123; for (let i = 0; i &lt; children.length; i++) &#123; if (isArray(children[i])) &#123; return Array.prototype.concat.apply([], children) &#125; &#125; return children&#125; å½“ normalizationType ä¸º SIMPLE_NORMALIZE æ—¶ï¼Œæ‰ä¼šè°ƒç”¨simpleNormalizeChildrenæ–¹æ³•ã€‚ é‚£ä¹ˆ normalizationType ä½•æ—¶æ‰ä¼šæ˜¯ SIMPLE_NORMALIZEå‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ç”¨æˆ·è‡ªå®šä¹‰ renderå‡½æ•°çš„æ—¶å€™ï¼ŒnormalizationTypeæ’ä¸ºALWAYS_NORMALIZEï¼Œæ‰€ä»¥åªæœ‰æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™åœ¨_cä¸­æ‰ä¼šå°†å€¼å˜æˆ SIMPLE_NORMALIZEã€‚ ç†è®ºä¸Šç¼–è¯‘ç”Ÿæˆçš„childrenéƒ½å·²ç»æ˜¯ VNodeç±»å‹äº†ï¼Œä¸éœ€è¦å¤„ç†äº†æ‰å¯¹ã€‚ ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µéœ€è¦è€ƒè™‘ï¼Œå°±æ˜¯å‡½æ•°ç»„ä»¶è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„è€Œä¸æ˜¯ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œ 1234567export default &#123; functional: true, props: [&#x27;items&#x27;], render(h, &#123; props &#125;) &#123; return props.items.map(item =&gt; h(&#x27;li&#x27;, item)); &#125;&#125;; æ­¤æ—¶éœ€è¦å°†æ•°ç»„æ‰“å¹³æˆä¸€çº§ã€‚ 4.2.2.2 normalizeChildrené€’å½’å¤„ç†å­èŠ‚ç‚¹1234567export function normalizeChildren(children: any): Array&lt;VNode&gt; | undefined &#123; return isPrimitive(children) ? [createTextVNode(children)] : isArray(children) ? normalizeArrayChildren(children) : undefined&#125; normalizeChildrenç”¨åœ¨ç”¨æˆ·è‡ªå®šä¹‰renderæ—¶å¯¹ childrenè¿›è¡Œè§„èŒƒåŒ–ï¼Œå› ä¸ºç¼–è¯‘æ—¶å·²ç»å°† children éƒ½è§„èŒƒåŒ–ä¸ºäº†createElementåˆ›å»ºå‡½æ•°ã€‚ Vueå…è®¸ç”¨æˆ·æŠŠchildrenå†™æˆåŸºç¡€ç±»å‹ç”¨æ¥åˆ›å»ºå•ä¸ªç®€å•çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¯¹åº”è¿™ç§åœºæ™¯ï¼Œvueä¼šè°ƒç”¨ createTextVNodeåˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹çš„ VNodeï¼Œå¹¶ä¸”ä¼šè½¬åŒ–æˆæ•°ç»„çš„å½¢å¼ã€‚ 1234567891011121314151617// ç”¨æˆ·è‡ªå®šä¹‰ renderå‡½æ•°export default &#123; render:function(h)&#123; return h(&#x27;div&#x27;,&#x27;Hello World&#x27;) &#125;&#125;// ç”Ÿæˆçš„ VNodeVNode &#123; tag:&#x27;div&#x27;, // å°†æ–‡å­—è½¬åŒ–æˆäº†childrenæ•°ç»„ children:[ VNode &#123; tag: undefined, text: &#x27;Hello World&#x27; &#125; ]&#125; å¦‚æœ childrenæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦é€’å½’å¤„ç† childrenï¼Œéå†æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå°†æ¯ä¸€ä¸ªå­èŠ‚ç‚¹è½¬åŒ–ä¸ºæ ‡å‡†çš„ VNodeï¼Œå…¶ä¸­è¿™ä¸ªè½¬åŒ–æ“ä½œæ˜¯ä½¿ç”¨normalizeArrayChildrenå‡½æ•°æ¥å®Œæˆçš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152function normalizeArrayChildren( children: any, nestedIndex?: string): Array&lt;VNode&gt; &#123; const res: VNode[] = [] let i, c, lastIndex, last for (i = 0; i &lt; children.length; i++) &#123; c = children[i] if (isUndef(c) || typeof c === &#x27;boolean&#x27;) continue lastIndex = res.length - 1 last = res[lastIndex] // nested if (isArray(c)) &#123; if (c.length &gt; 0) &#123; c = normalizeArrayChildren(c, `$&#123;nestedIndex || &#x27;&#x27;&#125;_$&#123;i&#125;`) // merge adjacent text nodes if (isTextNode(c[0]) &amp;&amp; isTextNode(last)) &#123; res[lastIndex] = createTextVNode(last.text + c[0].text) c.shift() &#125; res.push.apply(res, c) &#125; &#125; else if (isPrimitive(c)) &#123; if (isTextNode(last)) &#123; // merge adjacent text nodes // this is necessary for SSR hydration because text nodes are // essentially merged when rendered to HTML strings res[lastIndex] = createTextVNode(last.text + c) &#125; else if (c !== &#x27;&#x27;) &#123; // convert primitive to vnode res.push(createTextVNode(c)) &#125; &#125; else &#123; if (isTextNode(c) &amp;&amp; isTextNode(last)) &#123; // merge adjacent text nodes res[lastIndex] = createTextVNode(last.text + c.text) &#125; else &#123; // default key for nested array children (likely generated by v-for) if ( isTrue(children._isVList) &amp;&amp; isDef(c.tag) &amp;&amp; isUndef(c.key) &amp;&amp; isDef(nestedIndex) ) &#123; c.key = `__vlist$&#123;nestedIndex&#125;_$&#123;i&#125;__` &#125; res.push(c) &#125; &#125; &#125; return res&#125; è¯¥å‡½æ•°çš„ä¸»è¦é€»è¾‘å°±æ˜¯éå†childrenæ•°ç»„ï¼Œè·å–æ¯ä¸€é¡¹çš„æ•°æ®ç±»å‹ï¼Œç„¶ååšç›¸åº”å¤„ç†ã€‚ å¦‚æœæ˜¯æœªå®šä¹‰&#x2F;null&#x2F;å¸ƒå°”å€¼ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚ å¦‚æœæ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™é€’å½’è°ƒç”¨normalizeArrayChildrenã€‚ å¦‚æœæ˜¯åŸºç¡€ç±»å‹ï¼Œåˆ™é€šè¿‡ createTextVNodeæ–¹æ³•è½¬æ¢æˆ VNodeç±»å‹ã€‚ å¦‚æœä¸æ˜¯ä¸Šé¢ä¸‰ç§ç±»å‹ï¼Œåˆ™è¡¨ç¤ºå·²ç»æ˜¯ VNodeç±»å‹äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹è¿™ 3 ç§æƒ…å†µéƒ½åšäº†å¦‚ä¸‹å¤„ç†ï¼šå¦‚æœå­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„ text èŠ‚ç‚¹ï¼Œä¼šæŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ª text èŠ‚ç‚¹ã€‚ 4.2.2.3 æ€»ç»“ç»è¿‡å¯¹ childrençš„ç»Ÿä¸€å¤„ç†ï¼Œç°åœ¨ VNodeå·²ç»æ˜¯ä¸€ä¸ªè§„èŒƒåŒ–çš„ VNodeèŠ‚ç‚¹äº†ã€‚ 4.3 VNodeçš„åˆ›å»ºç»è¿‡å…¼å®¹å¤„ç†å’Œ childrenè§„èŒƒåŒ–å¤„ç†åï¼Œå°±å¯ä»¥åˆ›å»ºVNodeäº†ã€‚ 4.3.1 éç»„ä»¶ VNodeå½“ tagä¸ºå­—ç¬¦ä¸²ï¼Œä¸”ä¸æ˜¯æ³¨å†Œç»„ä»¶ï¼Œåˆ™ç›´æ¥è°ƒç”¨ VNodeæ¥åˆ›å»º VNodeã€‚ tagæ˜¯å­—ç¬¦ä¸²ä¸€èˆ¬æœ‰ 2 ç§æƒ…å†µï¼š æ™®é€šçš„HTMLæ ‡ç­¾ 1234567// æ¨¡æ¿ç¼–è¯‘å‰&lt;template&gt; &lt;div&gt;Hello World&lt;/div&gt;&lt;/template&gt;// æ¨¡æ¿ç¼–è¯‘å// _vè¡¨ç¤ºcreateTextVNode ç”¨ä½œåˆ›å»ºå­èŠ‚ç‚¹_c(&#x27;div&#x27;,[_v(&#x27;Hello World&#x27;)]) ç»„ä»¶ç±»å‹ 1234567// æ¨¡æ¿ç¼–è¯‘å‰&lt;template&gt; &lt;Component /&gt;&lt;/template&gt;// æ¨¡æ¿ç¼–è¯‘å// _vè¡¨ç¤ºcreateTextVNode ç”¨ä½œåˆ›å»ºå­èŠ‚ç‚¹_c(&#x27;Component&#x27;) 4.3.2 ç»„ä»¶ VNodeå½“ tagä¸æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ˜¯æ³¨å†Œç»„ä»¶çš„å…³é”®å­—ï¼Œåˆ™è¡¨ç¤ºéœ€è¦åˆ›å»ºä¸€ä¸ªç»„ä»¶VNodeã€‚æ­¤æ—¶è°ƒç”¨ createComponentæ¥åˆ›å»ºç»„ä»¶VNodeã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110export function createComponent( Ctor: typeof Component | Function | ComponentOptions | void, data: VNodeData | undefined, context: Component, children?: Array&lt;VNode&gt;, tag?: string): VNode | Array&lt;VNode&gt; | void &#123; if (isUndef(Ctor)) &#123; return &#125; const baseCtor = context.$options._base // plain options object: turn it into a constructor if (isObject(Ctor)) &#123; Ctor = baseCtor.extend(Ctor as typeof Component) &#125; // if at this stage it&#x27;s not a constructor or an async component factory, // reject. if (typeof Ctor !== &#x27;function&#x27;) &#123; if (__DEV__) &#123; warn(`Invalid Component definition: $&#123;String(Ctor)&#125;`, context) &#125; return &#125; // async component let asyncFactory // @ts-expect-error if (isUndef(Ctor.cid)) &#123; asyncFactory = Ctor Ctor = resolveAsyncComponent(asyncFactory, baseCtor) if (Ctor === undefined) &#123; // return a placeholder node for async component, which is rendered // as a comment node but preserves all the raw information for the node. // the information will be used for async server-rendering and hydration. return createAsyncPlaceholder(asyncFactory, data, context, children, tag) &#125; &#125; data = data || &#123;&#125; // resolve constructor options in case global mixins are applied after // component constructor creation resolveConstructorOptions(Ctor as typeof Component) // transform component v-model data into props &amp; events if (isDef(data.model)) &#123; // @ts-expect-error transformModel(Ctor.options, data) &#125; // extract props // @ts-expect-error const propsData = extractPropsFromVNodeData(data, Ctor, tag) // functional component // @ts-expect-error if (isTrue(Ctor.options.functional)) &#123; return createFunctionalComponent( Ctor as typeof Component, propsData, data, context, children ) &#125; // extract listeners, since these needs to be treated as // child component listeners instead of DOM listeners const listeners = data.on // replace with listeners with .native modifier // so it gets processed during parent component patch. data.on = data.nativeOn // @ts-expect-error if (isTrue(Ctor.options.abstract)) &#123; // abstract components do not keep anything // other than props &amp; listeners &amp; slot // work around flow const slot = data.slot data = &#123;&#125; if (slot) &#123; data.slot = slot &#125; &#125; // install component management hooks onto the placeholder node installComponentHooks(data) // return a placeholder vnode // @ts-expect-error const name = getComponentName(Ctor.options) || tag const vnode = new VNode( // @ts-expect-error `vue-component-$&#123;Ctor.cid&#125;$&#123;name ? `-$&#123;name&#125;` : &#x27;&#x27;&#125;`, data, undefined, undefined, undefined, context, // @ts-expect-error &#123; Ctor, propsData, listeners, tag, children &#125;, asyncFactory ) return vnode&#125; åˆ›å»ºç»„ä»¶ VNodeæ—¶ï¼Œä¼šåœ¨ VNodeæ–°å¢ä¸€äº›ç»„ä»¶ç‰¹æœ‰çš„å±æ€§ï¼š ä½¿ç”¨ Vue.extendç”Ÿæˆä¸€ä¸ªå­ç±»æ„é€ å™¨ï¼Œä¼šæŒ‚è½½åˆ° VNodeçš„componentsOptionså±æ€§çš„ Ctorä¸Šã€‚ å¤„ç†å¼‚æ­¥ç»„ä»¶ å¤„ç† model æ³¨å…¥ä¸€äº› hooks ç­‰ 4.4 createElementå‡½æ•°çš„ä¼˜åŠ¿createElementå‡½æ•°çš„æ„ä¹‰åœ¨äºå®ƒæä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿ã€æ›´ç®€æ´ä¸”æ›´å…·å¯è¯»æ€§çš„æ–¹å¼æ¥åˆ›å»ºvnodeï¼Œç›¸æ¯”ç›´æ¥ç¼–å†™ VNode å…·æœ‰ä»¥ä¸‹å¥½å¤„ï¼š 4.4.1 ç›´è§‚çš„å‚æ•°å½¢å¼ä½¿ç”¨createElementå‡½æ•°å¯ä»¥é€šè¿‡ç›´è§‚çš„å‚æ•°æ¥æè¿°è™šæ‹ŸèŠ‚ç‚¹çš„å±æ€§ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œç›´æ¥ç¼–å†™ VNode å¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ„å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªå±æ€§çš„ JavaScript å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç è¾ƒä¸ºå†—é•¿å’Œå¤æ‚ï¼Œé™ä½äº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 4.4.2 ç»Ÿä¸€çš„åˆ›å»ºæ–¹å¼åœ¨é¡¹ç›®ä¸­ä½¿ç”¨createElementå‡½æ•°å¯ä»¥ç¡®ä¿è™šæ‹ŸèŠ‚ç‚¹çš„åˆ›å»ºæ–¹å¼ä¸€è‡´ã€‚ ç›´æ¥ç¼–å†™ VNode å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„å¼€å‘è€…é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥æ„å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»è€Œé™ä½äº†ä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 4.4.3 åŠ¨æ€å±æ€§å’Œæ¡ä»¶åˆ¤æ–­createElementå‡½æ•°å¯ä»¥æ¥æ”¶åŠ¨æ€çš„å‚æ•°ï¼Œå…è®¸åœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶æ¥å†³å®šè™šæ‹ŸèŠ‚ç‚¹çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®æ•°æ®çš„å˜åŒ–åŠ¨æ€åœ°æ·»åŠ æˆ–ä¿®æ”¹å±æ€§ï¼Œæˆ–è€…æ ¹æ®æ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ªå­èŠ‚ç‚¹ã€‚ ç›´æ¥ç¼–å†™ VNode å¯¹è±¡æ—¶ï¼Œè¦å®ç°ç±»ä¼¼çš„åŠ¨æ€è¡Œä¸ºå¯èƒ½éœ€è¦æ›´å¤šçš„ä»£ç å’Œé€»è¾‘å¤„ç†ï¼Œå¢åŠ äº†ä»£ç çš„å¤æ‚æ€§ã€‚ äº”ã€æ€»ç»“ä¸ºäº†é¿å…é‡å¤æ“ä½œçœŸå® DOM æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œvueæ¡†æ¶å¼•å…¥äº†è™šæ‹Ÿ DOMã€‚ è™šæ‹Ÿ DOMæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå…·æœ‰ç‰¹æœ‰å±æ€§çš„ä¸€ä¸ª JSå¯¹è±¡ã€‚ ä¸ºäº†å®ç°åˆ›å»ºè™šæ‹Ÿ DOM çš„ä¸€è‡´æ€§ï¼Œvueæä¾›äº†ä¸€ä¸ªæ–¹æ³• createElement ç”¨æ¥æ–¹ä¾¿å¿«æ·çš„ç”Ÿæˆè™šæ‹Ÿ DOMã€‚"},{"title":"ğŸ”¥Vue2åˆå§‹åŒ–æ—¶éƒ½å¹²äº†ä»€ä¹ˆäº‹","path":"//posts/vue2-init.html","content":"ä¸“æ ç¬¬å››ç¯‡-åˆå§‹åŒ–å¹²äº†ä»€ä¹ˆäº‹ &emsp;&emsp;ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬çŸ¥é“ Vueå°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåœ¨ä½¿ç”¨ Vueçš„æ—¶å€™éœ€è¦å®ä¾‹åŒ– Vueï¼Œè¿™ä¸€ç« æˆ‘ä»¬å°±æ¥çœ‹çœ‹åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å†…éƒ¨åšäº†ä¸€äº›ä»€ä¹ˆæ“ä½œã€‚ é›¶ã€è°ƒç”¨äº†_initæ–¹æ³•123456function Vue()&#123; if(!this instanceof Vue)&#123; return warn(&quot;å¿…é¡»ä½¿ç”¨ new å…³é”®å­—æ¥å®ä¾‹åŒ–&quot;) &#125; this._init();&#125; é™¤äº†åœ¨æ„é€ å‡½æ•°å†…éƒ¨å¯¹æ˜¯å¦ä½¿ç”¨ new å…³é”®å­—è¿›è¡Œåˆ¤æ–­ã€‚ è¿˜åœ¨æ ¡éªŒè¿‡åè°ƒç”¨äº†_initæ–¹æ³•ã€‚ ä» init è¿™ä¸ªåå­—ä¸éš¾çœ‹å‡ºï¼Œè‚¯å®šåœ¨å†…éƒ¨åšäº†ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œã€‚ è¯¥æ–¹æ³•æ˜¯åœ¨Vueè¢«å¼•å…¥æ—¶è°ƒç”¨ initMixin æ–¹æ³•åœ¨Vueä¸Šæ³¨å…¥çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768let uid = 0;export function initMixin(Vue)&#123; Vue.prototype._init = function (options?: Record&lt;string, any&gt;) &#123; const vm: Component = this // a uid vm._uid = uid++ let startTag, endTag /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; startTag = `vue-perf-start:$&#123;vm._uid&#125;` endTag = `vue-perf-end:$&#123;vm._uid&#125;` mark(startTag) &#125; // a flag to mark this as a Vue instance without having to do instanceof // check vm._isVue = true // avoid instances from being observed vm.__v_skip = true // effect scope vm._scope = new EffectScope(true /* detached */) // #13134 edge case where a child component is manually created during the // render of a parent component vm._scope.parent = undefined vm._scope._vm = true // merge options if (options &amp;&amp; options._isComponent) &#123; // optimize internal component instantiation // since dynamic options merging is pretty slow, and none of the // internal component options needs special treatment. initInternalComponent(vm, options as any) &#125; else &#123; vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm ) &#125; /* istanbul ignore else */ if (__DEV__) &#123; initProxy(vm) &#125; else &#123; vm._renderProxy = vm &#125; // expose real self vm._self = vm initLifecycle(vm) initEvents(vm) initRender(vm) callHook(vm, &#x27;beforeCreate&#x27;, undefined, false /* setContext */) initInjections(vm) // resolve injections before data/props initState(vm) initProvide(vm) // resolve provide after data/props callHook(vm, &#x27;created&#x27;) /* istanbul ignore if */ if (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; vm._name = formatComponentName(vm, false) mark(endTag) measure(`vue $&#123;vm._name&#125; init`, startTag, endTag) &#125; if (vm.$options.el) &#123; vm.$mount(vm.$options.el) &#125; &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè¯¦ç»†è§£é‡Šä¸‹æ¯ä¸€æ­¥ä¸­å…·ä½“éƒ½åšäº†ä»€ä¹ˆã€‚ ä¸€ã€vm._uid12345let uid = 0;Vue.prototype.init=function()&#123; vm._uid = uid++&#125; åœ¨_initæ–¹æ³•çš„ç¬¬ä¸€è¡Œå¯ä»¥çœ‹åˆ°åœ¨å®ä¾‹ä¸ŠæŒ‚è½½äº†ä¸€ä¸ªvm._uidå±æ€§ã€‚ æ¯ä¸ªVueå®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„_uidï¼ˆUnique Identifierï¼Œå”¯ä¸€æ ‡è¯†ç¬¦ã€‚ è¿™ä¸ªæ ‡è¯†ç¬¦æ˜¯åœ¨ Vue å®ä¾‹åˆ›å»ºæ—¶ç”±ä¸€ä¸ªé€’å¢çš„è®¡æ•°å™¨ç”Ÿæˆçš„ï¼Œå…¶ä¸»è¦ç”¨é€”æ˜¯åœ¨å†…éƒ¨å¤„ç†ä¸­æä¾›å”¯ä¸€æ€§ã€‚ å°¤å…¶æ˜¯åœ¨æ¶‰åŠåˆ°å®ä¾‹é—´çš„æ¯”è¾ƒæˆ–è€…è·Ÿè¸ªçš„æ—¶å€™ã€‚ äºŒã€è¿½è¸ªåˆå§‹åŒ–æ¶ˆè€—æ—¶é—´123456789101112// _init å‡½æ•°åˆšæ‰§è¡Œæ—¶let startTag, endTagif (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; startTag = `vue-perf-start:$&#123;vm._uid&#125;` endTag = `vue-perf-end:$&#123;vm._uid&#125;` mark(startTag)&#125;// _init å‡½æ•°åˆå§‹åŒ–é€»è¾‘å®Œæˆif (__DEV__ &amp;&amp; config.performance &amp;&amp; mark) &#123; mark(endTag) measure(`vue $&#123;vm._uid&#125; init`, startTag, endTag)&#125; 2.1 è¦†ç›–é»˜è®¤é…ç½®æˆ‘ä»¬çŸ¥é“åœ¨ Vue å¯ä»¥è¦†ç›–é»˜è®¤é…ç½®ã€‚ 12// å¼€å¯ vueæ€§èƒ½é…ç½®Vue.config.performance = true; é‚£ä¹ˆ vue æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ core/config.jsæ–‡ä»¶æ˜¯vueçš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ 12345// core/config.jsexport default &#123; // é»˜è®¤ä¸å¼€å¯perf performance: false&#125; Vueè¢«å¼•å…¥æ—¶ï¼Œåœ¨ initGlobalAPIæ–¹æ³•ä¸­ç»™ Vueè®¾ç½®äº† configå±æ€§ã€‚ 12345678910111213141516import config from &#x27;../config&#x27;export function initGlobalAPI(Vue)&#123; // çœç•¥éƒ¨åˆ†ä»£ç  const configDef = &#123;&#125;; configDef.get = () =&gt; config; if (__DEV__) &#123; configDef.set = () =&gt; &#123; warn( &#x27;ä¸è¦æ›¿æ¢Vue.é…ç½®å¯¹è±¡ï¼Œè€Œæ˜¯è®¾ç½®å•ç‹¬çš„å­—æ®µ&#x27; ) &#125; &#125; Object.defineProperty(Vue,&#x27;config&#x27;,configDef);&#125; è€Œå¼•å…¥çš„configå°±æ˜¯Vueçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå…¶å¯¼å‡ºå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293export default &#123; /** * Option merge strategies (used in core/util/options) */ // $flow-disable-line optionMergeStrategies: Object.create(null), /** * Whether to suppress warnings. */ silent: false, /** * Show production mode tip message on boot? */ productionTip: __DEV__, /** * Whether to enable devtools */ devtools: __DEV__, /** * Whether to record perf */ performance: false, /** * Error handler for watcher errors */ errorHandler: null, /** * Warn handler for watcher warns */ warnHandler: null, /** * Ignore certain custom elements */ ignoredElements: [], /** * Custom user key aliases for v-on */ // $flow-disable-line keyCodes: Object.create(null), /** * Check if a tag is reserved so that it cannot be registered as a * component. This is platform-dependent and may be overwritten. */ isReservedTag: no, /** * Check if an attribute is reserved so that it cannot be used as a component * prop. This is platform-dependent and may be overwritten. */ isReservedAttr: no, /** * Check if a tag is an unknown element. * Platform-dependent. */ isUnknownElement: no, /** * Get the namespace of an element */ getTagNamespace: noop, /** * Parse the real tag name for the specific platform. */ parsePlatformTagName: identity, /** * Check if an attribute must be bound using property, e.g. value * Platform-dependent. */ mustUseProp: no, /** * Perform updates asynchronously. Intended to be used by Vue Test Utils * This will significantly reduce performance if set to false. */ async: true, /** * Exposed for legacy reasons */ _lifecycleHooks: LIFECYCLE_HOOKS&#125; as unknown as Config æ ¹æ®ä¸Šé¢çš„é…ç½®å¯ä»¥çŸ¥é“ Vue.configè·å–çš„å°±æ˜¯configæ–‡ä»¶ä¸­ä¸­é…ç½®çš„å†…å®¹ã€‚ exportæˆ–export defaultä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¯¹è±¡æœ¬èº«åœ¨å¤–éƒ¨è„šæœ¬ä¸­æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚ä½†æ˜¯å¯¹è±¡çš„å±æ€§åœ¨å¤–éƒ¨è„šæœ¬ä¸­éƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚ æ‰€ä»¥ä½ å¯ä»¥é€šè¿‡Vue.config.xxx = xxx æ¥è®¾ç½®é…ç½®æˆ–è€…è¦†ç›–é»˜è®¤çš„é…ç½®ã€‚ 2.2 markå‡½æ•° &amp; measureå‡½æ•°markå‡½æ•° å’Œ measureå‡½æ•°æ˜¯vueä¸­è¿›è¡Œæ€§èƒ½æ£€æµ‹çš„å‡½æ•°ã€‚ å‡½æ•°ä½äºcore/util/perfæ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718192021222324// åˆ¤æ–­æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­import &#123; inBrowser &#125; from &#x27;./env&#x27;export let markexport let measure// åªæœ‰åœ¨å¼€å‘ç¯å¢ƒä¸­æ‰ä¼šè®¾ç½® mark å’Œ measureif (__DEV__) &#123; const perf = inBrowser &amp;&amp; window.performance if ( perf &amp;&amp; perf.mark &amp;&amp; perf.measure &amp;&amp; perf.clearMarks &amp;&amp; perf.clearMeasures ) &#123; mark = tag =&gt; perf.mark(tag) measure = (name, startTag, endTag) =&gt; &#123; perf.measure(name, startTag, endTag) perf.clearMarks(startTag) perf.clearMarks(endTag) &#125; &#125;&#125; å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†window.performanceç›¸å…³çš„ apiï¼š performance.markï¼šä¸»è¦ç”¨äºåˆ›å»ºæ ‡è®° performance.measureï¼š ä¸»è¦ç”¨äºè®°å½•ä¸¤ä¸ªæ ‡è®°çš„æ—¶é—´é—´éš” performance.clearMarksï¼š ç”¨äºæ¸…é™¤æ ‡è®° 123456789window.performance.mark(&quot;_start&quot;)for(let i=0;i&lt;10000;i++)&#123; console.log();&#125;window.performance.mark(&quot;_end&quot;)window.performance.measure(&quot;timestamp&quot;,&quot;_start&quot;,&quot;_end&quot;)// å¯ä»¥è·å–ç›´æ¥é—´éš”window.performance.getEntriesByName(&quot;timestamp&quot;)[0] å¯ä»¥ä½¿ç”¨getEntriesByNameè·å–ä¸¤ä¸ªæ ‡è®°æœŸé—´ä»£ç æ‰§è¡Œçš„æ—¶é—´ã€‚ ä»è€Œè¿™é‡Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°åˆå§‹åŒ–_initå‡½æ•°æ‰§è¡Œçš„æ—¶æœºã€‚ 2.3 æ€»ç»“åœ¨ _init å‡½æ•°å¼€å§‹æ—¶æ‰“ä¸€ä¸ªåä¸ºâ€œvue-perf-startâ€çš„æ ‡è®°ã€‚ ç„¶ååœ¨é€»è¾‘å¤„ç†ç»“æŸåæ‰“ä¸€ä¸ªåä¸ºâ€œvue-perf-endâ€çš„æ ‡è®°ã€‚ æœ€åé€šè¿‡measureå‡½æ•°è®¾ç½®ä¸€ä¸ª measure å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚ è¿™ä¸ªé—´éš”æ—¶é—´å°±å¯ä»¥çœ‹æˆè¿™ä¸ªå®ä¾‹åˆå§‹åŒ–èŠ±è´¹çš„æ—¶é—´ï¼Œä»¥æ­¤æ¥è¯„æµ‹æ€§èƒ½ã€‚ ä¸‰. vm._isVue123Vue.prototype.init=function()&#123; vm._isVue = true&#125; æ¯ä¸ª vueå®ä¾‹ åœ¨åˆå§‹æ—¶éƒ½ä¼šè®¾ç½®_isVueå˜é‡ã€‚ è¿™ä¸ªå˜é‡å¯ä»¥åœ¨å†…éƒ¨&#x2F;æ‰©å±•æ’ä»¶ä¸­åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ vueå®ä¾‹ã€‚ å››ã€vm.__v_skip123Vue.prototype.init=function()&#123; vm.__v_skip = true&#125; åœ¨åˆå§‹åŒ–æ—¶å°†è¯¥å˜é‡è®¾ç½®ä¸º trueã€‚ è¿™ä¸ªå˜é‡ç”¨äºæŒ‡ç¤ºVueçš„ç›¸åº”æ˜¯ç³»ç»Ÿè·³è¿‡å¯¹è¯¥å¯¹è±¡çš„è§‚æµ‹ã€‚ å½“ä¸€ä¸ªå¯¹è±¡è¢«æ ‡è®°ä¸º __v_skip &#x3D; true æ—¶ï¼ŒVue ä¸ä¼šå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œæ·±åº¦è§‚æµ‹ï¼Œè¿™æ„å‘³ç€å¯¹è±¡å†…éƒ¨çš„å±æ€§å˜åŒ–å°†ä¸ä¼šè§¦å‘è§†å›¾æ›´æ–°ã€‚ äº”ã€åˆå¹¶é€‰é¡¹123456789101112if (options &amp;&amp; options._isComponent) &#123; // optimize internal component instantiation // since dynamic options merging is pretty slow, and none of the // internal component options needs special treatment. initInternalComponent(vm, options as any)&#125; else &#123; vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm )&#125; ç¬¬äº”æ­¥æ˜¯æ‰§è¡Œåˆå¹¶ optionsçš„æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ª optionsæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥è¯´ Vueä¸­çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯åŸºäº optionsæ¥å®Œæˆçš„ï¼Œè¿™ä¸ª optionsä¸­å­˜å‚¨äº†ç”¨æˆ·ä¼ å…¥çš„é€‰é¡¹ä»¥åŠä¸€äº›å†…ç½®çš„ Vueé€‰é¡¹ã€‚ ç”±äºoptionsåœ¨ Vueä¸­æ¯”è¾ƒé‡è¦ï¼Œå…³äºè¿™ä¸€å—æˆ‘ä»¬åé¢ä¼šä¸“é—¨å¼€ä¸€ç¯‡æ–‡ç« æ¥è¯¦ç»†è§£é‡Šã€‚ åœ¨è¿™ç¯‡ä¸“æ ä¸­å…·ä½“è¯´æ˜äº†åˆå¹¶é€‰é¡¹ï¼šç¬¬äº”ç¯‡ä¸“æ  å…­ã€è®¾ç½®æ•°æ®ä»£ç†æ£€æµ‹12345if (__DEV__) &#123; initProxy(vm)&#125;else &#123; vm._renderProxy = vm&#125; è¿™é‡Œçš„ç›®çš„æ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸‹ç»™vmè®¾ç½®ä»£ç†ï¼Œä»è€Œè¾¾åˆ°å¼€å‘æ—¶æç¤ºçš„åŠŸèƒ½ï¼Œè¿™ä¸ªæˆ‘ä»¬åç»­ä¹Ÿä¼šå•å¼€ä¸€ç¯‡æ–‡ç« è¿›è¡Œè¯´æ˜ã€‚ ä¸ƒã€vm._self &#x3D; vm123Vue.prototype.init=function()&#123; vm._self = vm&#125; å°†_selfå±æ€§æŒ‡å‘è‡ªèº«è¿™ä¸ªå®ä¾‹ã€‚ å¯ä»¥ç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£ç¡®å¼•ç”¨å½“å‰å®ä¾‹ã€‚ å…«ã€æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œåé¢æˆ‘ä»¬ä¼šæ‰§è¡Œä¸€äº›ç”¨äºåˆå§‹åŒ–çš„æ“ä½œã€‚ å†…éƒ¨å…·ä½“åšäº†ä»€ä¹ˆæˆ‘ä»¬å’±ä¸è€ƒè™‘ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šä¸€ä¸€è¿›è¡Œè®¨è®ºã€‚ 123456789101112// åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸinitLifeCycle(vm);// åˆå§‹åŒ–äº‹ä»¶ä¸­å¿ƒinitEvents(vm)// åˆå§‹åŒ–æ¸²æŸ“initRender(vm)// åˆå§‹åŒ– injectinitInjections(vm)// åˆå§‹åŒ– propsã€dataã€computed ç­‰initState(vm)// åˆå§‹åŒ– providerinitProvide(vm) è¿™äº›å‡½æ•°åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨å®ä¾‹ä¸ŠæŒ‚è½½äº†ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚æ¸²æŸ“æ‰§è¡Œçš„_updateå°±æ˜¯åœ¨ initLifecycleä¸­å®šä¹‰çš„ã€è·Ÿæ¸²æŸ“ç›¸å…³çš„_renderå‡½æ•°å°±æ˜¯åœ¨ initRenderä¸­å®šä¹‰çš„ã€‚ ä¹ã€æ‰§è¡Œä¸€äº›ç”Ÿå‘½é’©å­åœ¨æ‰§è¡Œ initRender åï¼Œä¼šè°ƒç”¨ beforeCreate é’©å­ã€‚è¿™è¡¨ç¤ºbeforeCreate é’©å­ è°ƒç”¨çš„æ—¶æœºä¸ºVueå®ä¾‹åŒ– dataæ•°æ®å‰ï¼Œæ‰€ä»¥æ­¤æ—¶è·å– dataæ˜¯æ— æ³•è·å–åˆ°çš„ï¼Œå› ä¸ºè¿™æ—¶å€™è¿˜æ²¡æœ‰åˆå§‹åŒ– dataã€‚ åœ¨æ‰§è¡Œå®Œæœ€åä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°initProvideåï¼Œä¼šè°ƒç”¨ createdé’©å­ã€‚è¿™è¡¨ç¤ºcreatedé’©å­ è°ƒç”¨çš„æ—¶æœºä¸ºVueå®ä¾‹åˆå§‹åŒ–åã€‚ 123456// çœç•¥initRender(vm)callHook(vm, &#x27;beforeCreate&#x27;, undefined, false /* setContext */)// çœç•¥initProvide(vm) // resolve provide after data/propscallHook(vm, &#x27;created&#x27;) åã€æ‰§è¡ŒæŒ‚è½½123if (vm.$options.el) &#123; vm.$mount(vm.$options.el)&#125; åˆ¤æ–­æ˜¯å¦æœ‰vmä¸Šæ˜¯å¦æœ‰$optionsé€‰é¡¹ï¼Œå¦‚æœå­˜åœ¨$optionsé€‰é¡¹ï¼Œåˆ™æ‰§è¡ŒæŒ‚è½½æ–¹æ³•ã€‚ åä¸€ã€æ€»ç»“åœ¨ initå‡½æ•°å†…éƒ¨ï¼Œä¸»è¦æ˜¯æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚è®¾ç½®åŸºç¡€çš„ä»£ç†ã€‚åˆå§‹åŒ–dataã€ç»™å®ä¾‹ä¸Šè®¾ç½®_updateã€_renderæ–¹æ³•ç­‰ã€‚"},{"title":"ğŸ”¥Vue2ä¸°å¯Œçš„é€‰é¡¹åˆå¹¶ç­–ç•¥","path":"//posts/vue2-merge-options.html","content":"ä¸“æ ç¬¬äº”ç¯‡-ä¸°å¯Œçš„é€‰é¡¹åˆå¹¶ç­–ç•¥ ä¸€ã€å®ä¾‹åŒ–æ—¶åˆå¹¶é€‰é¡¹åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰§è¡ŒVueåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´åˆ°äº†é€‰é¡¹åˆå¹¶ã€‚ é‚£ä»€ä¹ˆæ˜¯é€‰é¡¹å‘¢ï¼Ÿ åœ¨ new Vue(é€‰é¡¹)ä¸­ï¼ŒVueæ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„æ•°æ®å°±æ˜¯é€‰é¡¹ï¼Œä»£è¡¨ä¼ å…¥çš„é€‰é¡¹ï¼Œä¸€èˆ¬ä»¥å¯¹è±¡å½¢å¼ä¼ å…¥ã€‚ åœ¨Vueæºç ä¸­ä½¿ç”¨å˜é‡optionsè¡¨ç¤ºé€‰é¡¹ï¼Œåœ¨æºç ä¸­ä½ ç»å¸¸èƒ½çœ‹åˆ° optionsçš„èº«å½±ã€‚ åœ¨å®ä¾‹åŒ–æ—¶éœ€è¦å°†å®ä¾‹å¯¹åº”çš„æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹åˆå¹¶åˆ°å®ä¾‹çš„é€‰é¡¹ä¸Šã€‚ 12345vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor), options || &#123;&#125;, vm) ä¸Šé¢ mergeOptions åˆ™æ˜¯ç”¨äºåˆå¹¶ 2 ä¸ª optionsï¼ŒresolveConstructorOptionsç”¨äºè·å–æ„é€ å‡½æ•°ä¸Šçš„optionsã€‚ åœ¨å‰é¢çš„æ–‡ç«  Vueçš„åŸå‹è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ vm.constructor å°±æ˜¯æŒ‡çš„ Vueæ„é€ å‡½æ•° äºŒã€Vueæ„é€ å‡½æ•°çš„é»˜è®¤é€‰é¡¹å‰é¢æˆ‘ä»¬çŸ¥é“ vm.$options ä¸­ä¼šåˆå¹¶Vueæ„é€ å‡½æ•°çš„ optionsã€‚ é‚£ä¹ˆ Vue.options æœ‰å€¼å—ï¼Ÿ å®é™…ä¸ŠVueæ„é€ å‡½æ•°æœ¬èº«ä¼šè‡ªå¸¦ä¸€äº›é»˜è®¤çš„é€‰é¡¹ã€‚ åœ¨Vueè¢«å¼•å…¥æ—¶ï¼Œä¼šæ‰§è¡Œå¤šä¸ªæ–¹æ³•ç»™Vue.optionsæ³¨å…¥å±æ€§ã€‚ 2.1 initGlobalAPIæ–¹æ³•åˆ›å»º Vue.optionsinitGlobalAPIæ–¹æ³•åœ¨Vueè¢«å¼•å…¥æ—¶æ‰§è¡Œã€‚ 1234567891011121314151617// core/global-api/index.tsconst ASSET_TYPES = [&#x27;component&#x27;,&#x27;directive&#x27;,&#x27;filter&#x27;];const builtInComponents = &#123; KeepAlive&#125;export function initGlobalAPI(Vue)&#123; // Object.createç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ è¯¥å¯¹è±¡æ²¡æœ‰åŸå‹ Vue.options = Object.create(null) ASSET_TYPES.forEach(type =&gt; &#123; Vue.options[type + &#x27;s&#x27;] = Object.create(null) &#125;); Vue.options._base = Vue; extend(Vue.options.components, builtInComponents) &#125; å¯ä»¥çœ‹åˆ°ï¼ŒinstallGlobalAPIæ–¹æ³•ä¸­åˆ›å»ºäº† Vue.optionsä¸ºä¸€ä¸ªçº¯å‡€çš„ç©ºå¯¹è±¡ï¼Œç„¶ååœ¨optionsä¸Šé¢æ³¨å…¥äº†ä¸€äº›å±æ€§ã€‚ _baseå°±æ˜¯ Vueæ„é€ å‡½æ•°ã€‚æ¯ä¸ªVueç»„ä»¶éƒ½æ˜¯é€šè¿‡_baseå±æ€§è·å–åˆ°Vueæ„é€ å‡½æ•°ï¼Œç„¶åä½¿ç”¨Vue.extendæ¥ç”Ÿæˆå¯¹åº”çš„ VueComponentæ„é€ å‡½æ•°ã€‚ extendæ–¹æ³•æ˜¯vueä¸­çš„ä¸€ä¸ªé€šç”¨æ–¹æ³•ã€‚ç”¨äºå°†ç¬¬äºŒä¸ªå‚æ•°çš„å€¼åˆå¹¶åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ç›´æ¥è¦†ç›–è¿›ç¬¬ä¸€ä¸ªå‚æ•° extendå‡½æ•°æºç 1234567891011export function extend( to, _from)&#123; // ç”¨äºåˆå¹¶ç¬¬äºŒä¸ªå‚æ•°åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ for (const key in _from) &#123; // è¦†ç›–å‚æ•°å±æ€§ to[key] = _from[key] &#125; return to&#125; 2.2 åˆå¹¶æŒ‡ä»¤ &amp; å†…ç½®ç»„ä»¶1234567891011121314// platforms/web/runtime/indexconst platformDirectives = &#123; model, show&#125;const platformComponents = &#123; Transition, TransitionGroup&#125;extend(Vue.options.directives, platformDirectives)extend(Vue.options.components, platformComponents) è¯¥æ®µé€»è¾‘ä¹Ÿæ˜¯åœ¨ Vueè¢«å¼•å…¥æ—¶æ‰§è¡Œï¼Œæ‰©å±•äº†ä¸€äº›è·Ÿ webå¹³å°ç›¸å…³çš„æŒ‡ä»¤å’Œç»„ä»¶ã€‚ 2.3 æ€»ç»“ç»è¿‡æˆ‘ä»¬çš„ç ”ç©¶å‘ç°ï¼ŒVueæ„é€ å‡½æ•°çš„é»˜è®¤é€‰é¡¹æœ‰ï¼š _baseï¼š ä»£è¡¨Vueæ„é€ å‡½æ•°ï¼Œåç»­ç”¨æ¥åˆ›å»ºç»„ä»¶çš„æ„é€ å‡½æ•°VueComponentã€‚ directiveï¼šä»£è¡¨éœ€è¦æ³¨å†Œçš„æŒ‡ä»¤ï¼Œé»˜è®¤çš„æä¾›äº† v-modelã€v-showçš„å†…ç½®æŒ‡ä»¤ã€‚ componentsï¼šä»£è¡¨éœ€è¦æ³¨å†Œçš„ç»„ä»¶é€‰é¡¹ï¼Œé»˜è®¤æä¾›äº† KeepAliveã€Transitionã€TransitionGroupçš„å†…ç½®ç»„ä»¶ã€‚ filter ï¼šä»£è¡¨éœ€è¦æ³¨å†Œçš„è¿‡æ»¤å™¨ï¼Œé»˜è®¤æ²¡æœ‰æä¾›é»˜è®¤å€¼ã€‚ ä¸‰ã€å­ç±»æ„é€ å‡½æ•°çš„ optionså­¦ä¹ å®Œä¸ŠèŠ‚æˆ‘ä»¬çŸ¥é“åœ¨Vueè¢«å¼•å…¥æ—¶ï¼Œåœ¨Vueæ„é€ å‡½æ•°ä¸Šæ³¨å…¥äº†ä¸€äº›é»˜è®¤é€‰é¡¹ã€‚ åœ¨ä¸“æ ç¬¬ä¸‰ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Vue.extendå‡½æ•°ã€‚ åœ¨renderé˜¶æ®µç”Ÿæˆè™šæ‹ŸèŠ‚ç‚¹æ—¶ï¼Œä¼šè°ƒç”¨ Vue.extend ç”Ÿæˆç»„ä»¶æ„é€ å‡½æ•°VueComponentï¼Œå¹¶å­˜åœ¨ vnodeä¸Šã€‚ ç„¶ååœ¨updateé˜¶æ®µå¼€å§‹æŒ‚è½½èŠ‚ç‚¹æ—¶ï¼Œä¼šè°ƒç”¨ç»„ä»¶æ„é€ å‡½æ•° VueComponentæ¥åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œå†è¿›è¡Œåç»­ç»„ä»¶å®ä¾‹åˆå§‹åŒ–ã€æ¸²æŸ“ç­‰æ“ä½œã€‚ é‚£ä¹ˆVueComponentæ„é€ å‡½æ•°ä½œä¸ºVueæ„é€ å‡½æ•°çš„å­ç±»ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿç»§æ‰¿äº†å®ƒçš„é»˜è®¤é€‰é¡¹å‘¢ï¼Ÿ æˆ‘ä»¬å†æ¬¡æ‰“å¼€ Vue.extend çš„æºç ä¸€æ¢ç©¶ç«Ÿã€‚ 1234567891011Vue.extend = function(extendOptions)&#123; extendOptions = extendOptions || &#123;&#125; // æ–°å¢_Ctorå±æ€§ const cachedCtors = extendOptions._Ctor || (extendOptions._Ctor = &#123;&#125;) const Super = this; const Sub = function VueComponent()&#123; this._init(); &#125; // mergeOptionsç”¨äºåˆå¹¶2ä¸ªé€‰é¡¹è¿”å›ä¸€ä¸ªåˆå¹¶é€‰é¡¹ Sub.options = mergeOptions(Super.options, extendOptions)&#125; è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“ mergeOptionsçš„å…·ä½“é€»è¾‘ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼ŒVueComponentæ„é€ å‡½æ•°ä¸Šçš„ optionså±æ€§åˆå¹¶äº†â€œçˆ¶ç±»â€œæ„é€ å‡½æ•°ä¸Šçš„optionså±æ€§ä»¥åŠextendæ–¹æ³•ä¼ å…¥çš„é€‰é¡¹ã€‚ åœ¨ VueComponentæ„é€ å‡½æ•°ä¸Šæ–°å¢äº†ä¸€ä¸ª_Ctorå±æ€§ï¼Œå¯ä»¥é¿å…æ¯æ¬¡é‡æ–°åˆ›å»ºå­ç±»ï¼Œæé«˜æ€§èƒ½ï¼Œåé¢æˆ‘ä»¬ä¼šä¸“é—¨è¯´è¿™é‡Œï¼Œè¿™é‡Œä¸è¿›è¡Œå±•å¼€ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå­ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ç»§æ‰¿äº†å…¶çˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 123const VueComponent = Vue.extend(&#123; template:`&lt;div&gt;æˆ‘æ˜¯å­ç±»æ„é€ å‡½æ•°&lt;/div&gt;`&#125;); æ­¤æ—¶ VueComponent.options ä¸Šæ—¢åŒ…å«äº†è‡ªèº«ä¼ å…¥çš„ template é€‰é¡¹ï¼Œä¹ŸåŒ…å«äº†ç»§æ‰¿è‡ªVueæ„é€ å‡½æ•°ä¸Šçš„å±æ€§ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆå¹¶çˆ¶ç±»æ„é€ å‡½æ•°çš„ optionsæ—¶ï¼Œä¸åŒ optionçš„åˆå¹¶ç­–ç•¥ä¸åŒï¼Œå¯¹äºcomponentsã€filterã€directivesç­‰å†…ç½®é€‰é¡¹ä¼šåˆå¹¶åˆ°åŸå‹é“¾ä¸­ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒVueComponentæ„é€ å‡½æ•°æœ¬èº«æ˜¯å…·æœ‰å†æ¬¡æ‰©å±•çš„èƒ½åŠ›çš„ã€‚ 1234567const VueComponentChild = VueComponent.extend(&#123; data()&#123; return &#123; name:&quot;VueComponentChildConstructor&quot; &#125; &#125;&#125;) åŒç†ï¼ŒVueComponentChildConstructoræ˜¯VueComponentçš„å­ç±»ï¼Œæ‰€ä»¥VueComponentChildConstructorå°±ç»§æ‰¿äº†VueComponentçš„ optionsã€‚ å››ã€è·å–æ„é€ å‡½æ•°ä¸Šçš„ optionsåœ¨Vueåˆå§‹åŒ–æ“ä½œæ‰§è¡Œæ—¶ï¼Œä½¿ç”¨ resolveConstructorOptions å‡½æ•°æ¥è·å–æ„é€ å‡½æ•°ä¸Šçš„ optionsã€‚ 1234567891011121314151617181920212223export function resolveConstructorOptions(Ctor)&#123; let options = Ctor.options; if (Ctor.super) &#123; const superOptions = resolveConstructorOptions(Ctor.super) const cachedSuperOptions = Ctor.superOptions if (superOptions !== cachedSuperOptions) &#123; // super option changed, // need to resolve new options. Ctor.superOptions = superOptions // check if there are any late-modified/attached options (#4976) const modifiedOptions = resolveModifiedOptions(Ctor) // update base extend options if (modifiedOptions) &#123; extend(Ctor.extendOptions, modifiedOptions) &#125; options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions) if (options.name) &#123; options.components[options.name] = Ctor &#125; &#125; &#125; return options;&#125; çœ‹åˆ°è¿™ä¹ˆå¤šä»£ç ï¼Œæƒ³å¿…å¤§å®¶ä¹Ÿæ˜¯æå…¶æ‡µé€¼çš„ã€‚ å› ä¸ºæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼š Vueæ„é€ å‡½æ•°çš„é€‰é¡¹æ˜¯åœ¨åˆå§‹åŒ–æ—¶æ³¨å…¥çš„ã€‚ VueComponentæ„é€ å‡½æ•°åŠå…¶æ‰©å±•å­ç±»çš„é€‰é¡¹åˆ™æ˜¯åœ¨extendæ–¹æ³•ä¸­è¿›è¡Œæ³¨å…¥çš„ã€‚ é‚£ç›´æ¥ä½¿ç”¨.optionsè·å–æ„é€ å‡½æ•°çš„é€‰é¡¹ä¸å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰è¿™ä¹ˆä¸€å¤§æ®µé€»è¾‘å‘¢ï¼Ÿ 12Vue.options // è·å–Vueæ„é€ å‡½æ•°çš„é€‰é¡¹VueComponent.options // è·å–VueComponentæ„é€ å‡½æ•°çš„é€‰é¡¹ å…¶å®è¿™ä¸€æ®µé€»è¾‘ä¸»è¦æ˜¯åº”å¯¹çˆ¶ç±»æ„é€ å‡½æ•°ä¸Šé€‰é¡¹å˜åŒ–çš„æƒ…å†µã€‚ 4.1 Ctor.superå¯ä»¥çœ‹åˆ°åªæœ‰ Ctor.super å­˜åœ¨æ—¶æ‰ä¼šèµ°è¿™ä¸€å¤§æ®µé€»è¾‘ã€‚ é‚£ä¹ˆ Ctor.super æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åœ¨ä½¿ç”¨ extendç”Ÿæˆå­ç±»æ„é€ å‡½æ•°æ—¶ï¼Œä¼šåœ¨å­ç±»æ„é€ å‡½æ•°ä¸Šæ–°å¢äº†ä¸€ä¸ª superå±æ€§ï¼ŒæŒ‡å‘å®ƒçš„çˆ¶ç±»ã€‚ 123456789Vue.extend = function()&#123; let Sub = function VueComponent()&#123; this._init &#125; let Super = this; // çœç•¥éƒ¨åˆ†ä»£ç  // superå³ä»£è¡¨å®ƒçš„çˆ¶ç±» Sub[&#x27;super&#x27;] = Super;&#125; æ‰€ä»¥å¦‚æœå­˜åœ¨ super å±æ€§ï¼Œåˆ™ä»£è¡¨ç°åœ¨è¿™é‡Œçš„ Ctorä½¿ç”¨çš„æ˜¯extendç”Ÿæˆçš„VueComponentæ„é€ å‡½æ•°ã€‚æ‰€ä»¥è¿™é‡Œåˆ†ä¸º 2 ç§æƒ…å†µï¼š æ²¡æœ‰superå±æ€§ï¼Œä»£è¡¨è¿™æ˜¯ Vueæ„é€ å‡½æ•°ï¼Œç›´æ¥è¿”å› Vue.options å³å¯ã€‚ å¦‚æœå­˜åœ¨superå±æ€§ï¼Œä»£è¡¨è¿™æ˜¯extendç”Ÿæˆçš„ VueComponentæ„é€ å‡½æ•°ï¼Œéœ€è¦è¿›è¡Œè¿›ä¸€æ­¥åˆ¤æ–­ã€‚ å› ä¸º VueComponent.optionsçš„å€¼æ˜¯åœ¨ extendæ—¶åˆå¹¶äº†çˆ¶ç±»é€‰é¡¹å’Œextendä¼ å…¥é€‰é¡¹çš„å…¨æ–°é€‰é¡¹ã€‚ æ‰€ä»¥å¦‚æœåç»­Vue.optionså˜åŒ–äº†æ— æ³•è·å–æœ€æ–°çš„é€‰é¡¹ã€‚ 4.2 åˆ¤æ–­çˆ¶ç±»æ„é€ å‡½æ•°ä¸Šçš„ options æ˜¯å¦å˜åŒ–é‚£ä¹ˆæœ‰å“ªäº›æ“ä½œå¯ä»¥ä¿®æ”¹çˆ¶ç±»æ„é€ å‡½æ•°ä¸Šçš„ optionså‘¢ï¼Ÿ æ¯”å¦‚ä½¿ç”¨ Vue.mixin apiï¼Œè¿™ä¸ª apiå°±ä¿®æ”¹äº†Vue.optionsé€‰é¡¹ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€äº›é€»è¾‘å¯ä»¥æ›´æ–° VueComponentä¸Šçš„ optionsã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹ Vueæ˜¯æ€ä¹ˆæ›´æ–°çš„ã€‚ 12345const superOptions = resolveConstructorOptions(Ctor.super)const cachedSuperOptions = Ctor.superOptionsif (superOptions !== cachedSuperOptions) &#123; // è¿›å…¥è¿™ä¸ªé€»è¾‘è¯´æ˜ Vue.optionså˜åŒ–äº†&#125; ä¸Šé¢ä»£ç ä¸­å¦‚æœ superOptions ä¸ç­‰äº cachedSuperOptionsï¼Œå³è¡¨ç¤ºçˆ¶ç±»æ„é€ å‡½æ•°å‘ç”Ÿäº†å˜åŒ–ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ææ˜ç™½è¿™ 2 ä¸ªå€¼åˆ†åˆ«è¡¨ç¤ºä»€ä¹ˆï¼Ÿ superOptionsæ˜¯åœ¨resolveConstructorOptionsä¸­é€’å½’å‘ä¸ŠæŸ¥æ‰¾çš„ï¼Œå°±æ˜¯è¡¨ç¤ºçˆ¶ç±»æ„é€ å‡½æ•°çš„æœ€æ–°é€‰é¡¹ã€‚ cachedSuperOptions æ˜¯æŒ‡çš„æ„é€ å‡½æ•°ä¸Šçš„ superOptionså±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯åœ¨ extendä¸­å®šä¹‰çš„ï¼š 12345678Vue.extend = function()&#123; let Super = this; let Sub = function VueComponent()&#123; this._init(); &#125; // è¿™é‡Œå­˜å‚¨çš„å°±æ˜¯çˆ¶ç±»æ„é€ å‡½æ•°çš„ options Sub.superOptions = Super.options&#125; æ‰€ä»¥è¿™ 2 ä¸ªå€¼éƒ½æ˜¯æŒ‡çš„çˆ¶ç±»æ„é€ å‡½æ•°ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜åœ°å€ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰ä¸ä¸€æ ·çš„æƒ…å†µå‘¢ï¼Ÿ åœ¨ Vue æ—§ç‰ˆæœ¬ä¸­æ›¾ç»æœ‰ä¸€ä¸ªç›¸å…³çš„ bugã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¿™ä¸ª bugï¼š 4.2.1 Vueæ—§ç‰ˆæœ¬çš„ buggithub issue #4976 è¿™ä¸ªbugçš„å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼šå…ˆç”ŸæˆVueComponentæ„é€ å‡½æ•°ï¼Œç„¶åå†åœ¨æ„é€ å‡½æ•°ä¸Šçš„ options æ·»åŠ å±æ€§ï¼Œåœ¨resolveComponentOptionså‡½æ•°æ‰§è¡Œåï¼Œåæ·»åŠ çš„å±æ€§æ¶ˆå¤±äº†ã€‚ è¿™æ˜¯å¤ç°é“¾æ¥ï¼šoptionsæ¶ˆå¤±ã€‚ æˆ‘ä»¬è¿™é‡Œçœ‹ä¸€ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627const Test = Vue.extend(&#123; foo: &#x27;Foo&#x27;&#125;)// Inject options later// vue-loader and vue-hot-reload-api are doing like thisTest.options.computed = &#123; $style: &#123; test: &#x27;abcde&#x27; &#125; &#125;Test.options.beforeCreate = [ () =&gt; &#123; console.log(&#x27;Should be printed&#x27;) &#125;]Test.options.render = function (h) &#123; return h(&#x27;div&#x27;, &#x27;$style: &#x27; + this.$style)&#125;// Update super constructor&#x27;s optionsVue.mixin(&#123;&#125;)new Vue(&#123;\trender: h =&gt; h(Test)&#125;).$mount(&#x27;#app&#x27;)// This is retainedconsole.log(Test.options.foo)// Should be appear but notconsole.log(Test.options.computed)console.log(Test.options.beforeCreate) å¯ä»¥çœ‹åˆ°é¦–å…ˆä½¿ç”¨ Vue.extend ç”Ÿæˆäº†ä¸€ä¸ª Testæ„é€ å‡½æ•°ã€‚ ç„¶ååœ¨ Testçš„ optionsä¸Šæ–°å¢äº† 2 ä¸ªå±æ€§ã€‚ æ‰§è¡Œå®ŒVue.mixinåï¼Œå…ˆå‰å®šä¹‰çš„computedã€beforeCreate2ä¸ªå±æ€§ä¸è§äº†ã€‚ 4.2.2 Vue.mixiné‚£ä¹ˆè¿™ä¸ª Vue.mixinç©¶ç«Ÿæ˜¯å¹²äº†å•¥å‘¢ï¼Ÿ 1234Vue.mixin = function (mixin: Object) &#123; this.options = mergeOptions(this.options, mixin) return this&#125; å¯ä»¥çœ‹åˆ°mixinå‡½æ•°ä»…ä»…æ˜¯æ”¹å˜äº†æ„é€ å‡½æ•°ä¸Šçš„optionsã€‚ ä½†æ˜¯ mergeOptions ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´æ„é€ å‡½æ•°çš„ options å‘ç”Ÿäº†å˜åŒ–ã€‚ ä¹Ÿå°±å¯¼è‡´äº†å‰é¢è¯´çš„ superOptions !== cachedSuperOptions æƒ…å†µçš„å‘ç”Ÿã€‚ å› ä¸º superOptions è·å–çš„æ˜¯å½“å‰æœ€æ–°çš„é€‰é¡¹ï¼Œä¹Ÿå°±æ˜¯ mixin æ‰§è¡Œè¿‡çš„åˆå¹¶é€‰é¡¹ã€‚ è€Œ cachedSuperOptions åˆ™æ˜¯åœ¨æ‰§è¡Œ Vue.extend æ—¶å½“æ—¶çš„çˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚ 4.2.3 æ—§ç‰ˆæœ¬Vueä¸­ resolveConstructorOptions çš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿä½†æ˜¯ Vue.mixin ä»…ä»…æ˜¯æ›´æ”¹äº† Vue.optionsã€‚ åº”è¯¥ä¸ä¼šå°†VueComponentæ„é€ å‡½æ•°è‡ªèº«æ·»åŠ çš„å±æ€§æ¸…é™¤ã€‚ æ‰€ä»¥åº”è¯¥æ˜¯ Vueå†…éƒ¨å¯¹å…¶åšäº†ä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚ æˆ‘ä»¬æ‰“å¼€ Vue 2.1.10 ç‰ˆæœ¬çš„ç›¸å…³æºç ã€‚ 1234567891011121314151617181920export function resolveConstructorOptions (Ctor) &#123; let options = Ctor.options if (Ctor.super) &#123; const superOptions = Ctor.super.options const cachedSuperOptions = Ctor.superOptions const extendOptions = Ctor.extendOptions if (superOptions !== cachedSuperOptions) &#123; // super option changed Ctor.superOptions = superOptions extendOptions.render = options.render extendOptions.staticRenderFns = options.staticRenderFns extendOptions._scopeId = options._scopeId options = Ctor.options = mergeOptions(superOptions, extendOptions) if (options.name) &#123; options.components[options.name] = Ctor &#125; &#125; &#125; return options&#125; è·å–äº†çˆ¶æ„é€ å‡½æ•°çš„å½“å‰çš„ optionsï¼šconst superOptions = Ctor.super.optionsã€‚ è·å–äº†çˆ¶æ„é€ å‡½æ•°æ‰§è¡Œextendæ—¶çš„optionsï¼šconst cachedSuperOptions = Ctor.superOptionsã€‚ è·å–äº†å­æ„é€ å‡½æ•° extendæ—¶ä¼ å…¥çš„é€‰é¡¹extendOptionsã€‚ å› ä¸ºæ‰§è¡Œäº†mixinï¼Œå¯¼è‡´çˆ¶æ„é€ å‡½æ•°ä¸­çš„ optionså‘ç”Ÿäº†å˜åŒ–ï¼Œå³superOptions !== cachedSuperOptionsï¼Œç„¶åç»§ç»­æ‰§è¡Œå†…éƒ¨çš„é€»è¾‘ã€‚ 1options = Ctor.options = mergeOptions(superOptions, extendOptions) å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å°†è·å–åˆ°çš„çˆ¶æ„é€ å‡½æ•° optionså’Œå½“åˆ extendä¼ å…¥çš„ optionsåˆå¹¶ï¼Œç„¶åé‡æ–°èµ‹å€¼ç»™äº† Ctor.optionsã€‚ æ‰€ä»¥åæ·»åŠ çš„computedã€beforeCreateå°±æ¶ˆå¤±äº†ï¼Œå› ä¸ºæŒ‡å‘äº†ä¸åŒçš„å†…å­˜ç©ºé—´ã€‚ 4.2.4 æ€»ç»“é€šè¿‡ä¸Šé¢å‡ èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä¸ºä»€ä¹ˆéœ€è¦åˆ¤æ–­çˆ¶ç±»æ„é€ å‡½æ•°çš„å˜åŒ–ã€‚ æˆ‘ä»¬ç³»ç»Ÿæä¾›äº†å…¨å±€æ³¨å…¥çš„ APIï¼šVue.mixinã€‚ ä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥å‘å…¨å±€æ³¨å…¥ä¸€äº›é€‰é¡¹ã€‚ è€Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡æ”¹å˜Vueæ„é€ å‡½æ•°ä¸Šçš„optionï¼Œå†é€šè¿‡è¿™é‡Œçš„å˜æ›´é€»è¾‘é‡æ–°èµ‹å€¼åˆ° VueComponent.optionsä¸Šï¼Œè¿™æ ·ç”Ÿæˆçš„å®ä¾‹å°±å¯ä»¥è®¿é—®åˆ° Vue.mixinæ³¨å…¥çš„å±æ€§äº†ã€‚ 4.3 ä½¿ç”¨resolveModifiedOptionsè·å–æ›´æ”¹çš„å±æ€§åº”å¯¹ä¸Šé¢è¯´çš„è¿™ä¸ª bugï¼ŒVueå®˜æ–¹ä¹Ÿå¯¹è¿™resolveConstructorOptionsæ–¹æ³•è¿›è¡Œäº†è°ƒæ•´ã€‚ é’ˆå¯¹VueComponentæ„é€ å‡½æ•°ä¸Šå¯èƒ½å­˜åœ¨çš„optionsæ›´æ”¹è¿›è¡Œäº†å¤„ç†ã€‚ é¦–å…ˆåœ¨ Vue.extendsä¸­ä¿å­˜äº†VueComponentçš„å½“æ—¶çš„optionsã€‚ 12345Vue.extend = function()&#123; // çœç•¥éƒ¨åˆ†ä»£ç  // å­˜å‚¨äº†å½“æ—¶çš„ options Sub.sealedOptions = extend(&#123;&#125;, Sub.options)&#125; ä½¿ç”¨resolveModifiedOptionsæŸ¥æ‰¾ä¿®æ”¹çš„optionéƒ¨åˆ† 123456789101112function resolveModifiedOptions(Ctor)&#123; let modified const latest = Ctor.options const sealed = Ctor.sealedOptions for (const key in latest) &#123; if (latest[key] !== sealed[key]) &#123; if (!modified) modified = &#123;&#125; modified[key] = latest[key] &#125; &#125; return modified&#125; å°†ä¿®æ”¹çš„ optionsåˆè¿› extendOptions 123if (modifiedOptions) &#123; extend(Ctor.extendOptions, modifiedOptions)&#125; åˆå¹¶ extendOptionsä»¥åŠ superOptions extendOptionsæ˜¯æœ€æ–°çš„å­ç±»æ„é€ å‡½æ•° optionsã€‚ superOptionsæ˜¯æœ€æ–°çš„çˆ¶ç±»æ„é€ å‡½æ•° optionsã€‚ å°†ä¸¤è€…åˆå¹¶å°±ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚ 1options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions) 5.4 æ€»ç»“è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–åˆ°æ„é€ å‡½æ•°ä¸Šæœ€æ–°çš„optionsã€‚ åŒæ—¶å¯ä»¥æ›´æ–°å­ç±»æ„é€ å‡½æ•°å’Œçˆ¶ç±»æ„é€ å‡½æ•°ä¸Šçš„superOptionsã€extendOptionsä»¥åŠ optionsã€‚ äº”ã€mergeOptionsçš„åˆå¹¶åœºæ™¯mergeOptionsåœ¨å®ä¾‹åŒ–æ—¶ç”¨äºåˆå¹¶æ„é€ å‡½æ•°çš„ optionså’Œä¼ å…¥çš„ optionsã€‚ mergeOptions æ˜¯å®ç°ç»§æ‰¿å’Œå®ä¾‹åŒ–çš„æ ¸å¿ƒå‡½æ•°ã€‚ 123456function mergeOptions(parent,child,vm)&#123; // parentä»£è¡¨åˆå¹¶çˆ¶ç±» // childä»£è¡¨åˆå¹¶å­ç±» // vmä»£è¡¨å½“å‰çš„ vmå®ä¾‹ // å¦‚æœvmå®ä¾‹å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè¿™æ˜¯åœ¨å®ä¾‹åŒ–æ—¶è°ƒç”¨çš„&#125; mergeOptionså‡½æ•°ä¸ä»…ä»…ç”¨äºç”Ÿæˆå®ä¾‹çš„$optionså±æ€§ã€‚ ä¹Ÿå¯ä»¥ç”¨äºå­ç±»æ„é€ å‡½æ•°å’Œçˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹åˆå¹¶ã€‚ åœ¨å¤šä¸ªåœºæ™¯éƒ½æ˜¯ç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚ 5.1 Vue.extend1234Vue.extend = function(extendOptions)&#123; // çœç•¥éƒ¨åˆ†ä»£ç  Sub.options = mergeOptions(Super.options,extendOptions)&#125; å‰é¢æˆ‘ä»¬å·²ç»å¤šæ¬¡æåŠè¿™ä¸ªæ–¹æ³•äº†ã€‚ è¿™é‡Œçš„ mergeOptions ç”¨äºåˆå¹¶çˆ¶ç±»æ„é€ å‡½æ•°é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹ï¼Œç”Ÿæˆå­ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ã€‚ åœ¨è¿™é‡Œï¼šçˆ¶ç±»æ„é€ å‡½æ•°çš„é€‰é¡¹ç›¸å½“äºçˆ¶ç±»ï¼Œè€Œä¼ å…¥çš„é€‰é¡¹ç›¸å½“äºå­ç±»ã€‚ä¸ä¼ å…¥vmå®ä¾‹ã€‚ 5.2 Vue.mixin1234Vue.mixin = function (mixin: Object) &#123; this.options = mergeOptions(this.options, mixin) return this&#125; å‰é¢æˆ‘ä»¬ä¹Ÿå¤šæ¬¡æåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨äºåˆå¹¶æ„é€ å‡½æ•°çš„optionsï¼Œå’Œä¼ å…¥mixiné€‰é¡¹ï¼Œç”Ÿæˆå…¨æ–°çš„æ„é€ å‡½æ•°çš„ optionsã€‚ åœ¨è¿™é‡Œï¼šæ„é€ å‡½æ•°çš„é€‰é¡¹ç›¸å½“äºçˆ¶ç±»ï¼Œè€Œä¼ å…¥çš„ mixiné€‰é¡¹ç›¸å½“äºå­ç±»ã€‚ä¸ä¼ å…¥vmå®ä¾‹ã€‚ 5.3 vm.$options12345vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm) è¯¥æ–¹æ³•ç”¨äºåœ¨å®ä¾‹åŒ–çš„æ—¶å€™ç”Ÿæˆå®ä¾‹çš„$optionså±æ€§ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºåˆå¹¶å®ä¾‹å¯¹åº”çš„æ„é€ å‡½æ•°çš„é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹ï¼Œç”Ÿæˆä¸€ä¸ªå®Œæ•´åœ°å®ä¾‹é€‰é¡¹ã€‚ åœ¨è¿™é‡Œï¼šæ„é€ å‡½æ•°çš„é€‰é¡¹ç›¸å½“äºçˆ¶ç±»ï¼Œè€Œå®ä¾‹åŒ–æ—¶ä¼ å…¥çš„ mixiné€‰é¡¹ç›¸å½“äºå­ç±»`ã€‚`æ­¤æ—¶ä¼ å…¥vmå®ä¾‹ã€‚ å…­ã€åˆå¹¶ç­–ç•¥åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼šå°†æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹å’Œç”¨æˆ·ä¼ å…¥çš„é€‰é¡¹è¿›è¡Œåˆå¹¶ï¼Œå°†æœ€ç»ˆçš„åˆå¹¶é€‰é¡¹æ³¨å…¥åˆ°å®ä¾‹ä¸­ã€‚ 12345vm.$options = mergeOptions( resolveConstructorOptions(vm.constructor as any), options || &#123;&#125;, vm) mergeOptionså‡½æ•°ç”¨äºåˆå¹¶2ä¸ªé€‰é¡¹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„é€‰é¡¹ã€‚ 123456789101112131415161718function mergeOptions(parent,child)&#123; // çœç•¥éƒ¨åˆ†ä»£ç  let key const options = &#123;&#125;; for(key in parent)&#123; mergeField(key) &#125; for (key in child) &#123; if (!hasOwn(parent, key)) &#123; mergeField(key) &#125; &#125; function mergeField(key)&#123; const strat = strats[key] || defaultStrat; options[key] = strat(parent[key], child[key], vm, key) &#125; return options;&#125; å¤§å®¶å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹åˆå¹¶2ä¸ªå¯¹è±¡éœ€è¦æ³¨æ„äº›ä»€ä¹ˆå‘¢ï¼Ÿ å‡è®¾æ„é€ å‡½æ•°çš„optionså’Œä¼ å…¥çš„optionsä¸­éƒ½å­˜åœ¨dataï¼Œè¿™ä¸ªæ—¶å€™åˆå¹¶çš„æ˜¯ï¼š ç›´æ¥è¦†ç›–ï¼Ÿ å¦‚æœè¦†ç›–çš„è¯æ˜¯ä½¿ç”¨æ„é€ å‡½æ•°çš„dataè¿˜æ˜¯ä¼ å…¥çš„data? è¿˜æ˜¯å°†dataä¸­çš„å†…å®¹å†è¿›è¡Œåˆå¹¶å‘¢ï¼Ÿ å®é™…ä¸Šä¸åŒçš„é€‰é¡¹ä¸­çš„éƒ½å­˜åœ¨è‡ªå·±çš„åˆå¹¶é€»è¾‘ã€‚ æ¯”å¦‚dataé€‰é¡¹å’Œç”Ÿå‘½å‘¨æœŸé’©å­é€‰é¡¹åˆå¹¶ç­–ç•¥è‚¯å®šæ˜¯ä¸åŒçš„ã€‚ 6.1 è‡ªå®šä¹‰ç­–ç•¥åœ¨Vueä¸­ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ä¸åŒçš„åˆå¹¶ç­–ç•¥ã€‚ 1234// å¯ä»¥é…ç½®åˆå¹¶ç­–ç•¥Vue.config.optionMergeStrategies = &#123; customArray:[]&#125;; é…ç½®å®Œä»¥åï¼Œå°±å¯ä»¥åœ¨optionMergeStrategiesè·å–ç”¨æˆ·é…ç½®çš„ç­–ç•¥ã€‚ 12// æºç ä¸­å®šä¹‰ç­–ç•¥å˜é‡é¦–å…ˆè·å–optionMergeStrategies å¦‚æœæ²¡æœ‰é…ç½® optionMergeStrategies é»˜è®¤æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡const strats = config.optionMergeStrategies ç„¶åå†åœ¨ stratsè¿™ä¸ªå¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå®šä¹‰ä¸åŒçš„ç­–ç•¥ã€‚ 123456789101112// dataçš„åˆå¹¶ç­–ç•¥strats.data = (parentVal,ChildVal,vm)=&gt;&#123; // xxx&#125;// propsçš„åˆå¹¶ç­–ç•¥strats.props = (parentVal,ChildVal,vm)=&gt;&#123; // xxx&#125;// computedçš„åˆå¹¶ç­–ç•¥strats.computed = (parentVal,ChildVal,vm)=&gt;&#123; // xxx&#125; ç”±äºstratsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä½ å¦‚æœå®šä¹‰äº†å’Œå†…éƒ¨å®šä¹‰çš„ç­–ç•¥ç›¸åŒçš„é€‰é¡¹ï¼Œä¼šè¢«è¦†ç›–æ‰ã€‚ä¹Ÿå°±æ„å‘³ç€ä½ æ— æ³•é‡æ–°å®šä¹‰ dataã€computedã€propsç­‰å†…éƒ¨ç­–ç•¥ ä½†æ˜¯ä½ å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„é€‰é¡¹ã€‚ 12345678910111213import Vue from &quot;vue/dist/vue.esm.browser&quot; import Test from &quot;./Test.vue&quot; Vue.mixin(&#123; customArray:[1,3,5,8,9]&#125;) const vm = new Vue(&#123; render: h=&gt;h(Test), customArray: [1,4,5,7]&#125;).$mount(&quot;#app&quot;) console.log(vm); æ¯”å¦‚ä½ æƒ³è¦å®ç°ä½ è‡ªå®šä¹‰çš„ customArrayé€‰é¡¹ æ•°ç»„å†…å®¹åˆå¹¶å¹¶ä¸”å»é‡ï¼Œå¯ä»¥ä½¿ç”¨ä½¿ç”¨optionMergeStrategies: 123456// parentValä»£è¡¨æ„é€ å‡½æ•°ä¸Šçš„é€‰é¡¹å€¼ï¼Œ childValä»£è¡¨ä¼ å…¥çš„é€‰é¡¹å€¼Vue.config.optionMergeStrategies.customArray = (parentVal,childVal)=&gt;&#123; // å…¶ä»–Vueç»„ä»¶æ²¡æœ‰å®šä¹‰ä¸è¿›è¡Œå¤„ç† if(!childVal) return []; return Array.from(new Set([...parentVal,...childVal]))&#125; æˆ‘ä»¬æ‰“å°ä¸€ä¸‹è¿™ä¸ªå®ä¾‹ï¼Œå¯ä»¥å‘ç°å·²ç»æˆåŠŸäº†ã€‚ 6.2 é»˜è®¤çš„åˆå¹¶ç­–ç•¥ç”±äºå¯ä»¥é€‰é¡¹é«˜åº¦å¯è‡ªå®šä¹‰ï¼Œæ‰€ä»¥ Vueä¸­å†…ç½®äº†ä¸€å¥—é»˜è®¤çš„åˆå¹¶ç­–ç•¥ã€‚ ä¸»è¦åº”å¯¹æ²¡æœ‰è®¾ç½®å¯¹åº”ç­–ç•¥çš„åˆå¹¶æƒ…å†µã€‚ 123const defaultStrat = function (parentVal, childVal) &#123; return childVal === undefined ? parentVal : childVal&#125; å¯ä»¥çœ‹å‡ºæ¥é»˜è®¤çš„åˆå¹¶ç­–ç•¥æ˜¯ä¼ å…¥çš„optionsç›´æ¥å¯¹æ„é€ å‡½æ•°çš„optionsè¿›è¡Œå¼ºåˆ¶è¦†ç›–ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ã€‚ 6.3 elã€propsDataçš„åˆå¹¶ç­–ç•¥å¯ä»¥çœ‹å‡ºæ¥ elã€propsDataçš„åˆå¹¶ç­–ç•¥å’Œé»˜è®¤ç­–ç•¥ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå¼€å‘ç¯å¢ƒçš„æŠ¥é”™æç¤ºã€‚ 12345678910111213141516if (__DEV__) &#123; strats.el = strats.propsData = function ( parent: any, child: any, vm: any, key: any ) &#123; if (!vm) &#123; warn( `option &quot;$&#123;key&#125;&quot; can only be used during instance ` + &#x27;creation with the `new` keyword.&#x27; ) &#125; return defaultStrat(parent, child) &#125;&#125; é‚£ä¹ˆè¿™ä¸ªæŠ¥é”™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ ç­–ç•¥å‡½æ•°çš„çš„ç¬¬ä¸‰ä¸ªå‚æ•°vmä»£è¡¨vueå®ä¾‹ã€‚ è€Œè¿™ä¸ªvmåŒæ—¶ä¹Ÿæ˜¯mergeOptionsçš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ è€Œ mergeOptionsä½œä¸ºä¸€ä¸ªé€šç”¨å‡½æ•°ï¼Œä¸ä»…åªæ˜¯åœ¨å®ä¾‹åˆå§‹åŒ–çš„æ—¶å€™è¢«è°ƒç”¨ï¼ŒåŒæ—¶ä¹Ÿåœ¨Vue.extendã€Vue.mixinç­‰å¤šä¸ªæ–¹æ³•ä¸­è¢«ä½¿ç”¨ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ç”Ÿæˆ vmå®ä¾‹ï¼Œæ‰€ä»¥ vmä¸ºç©ºã€‚è€Œ elå±æ€§ã€propsDataå±æ€§æ˜¯å±äºè·Ÿå®ä¾‹ç›¸å…³çš„å±æ€§ï¼Œæ‰€ä»¥å¦‚æœåœ¨Vue.mixinç­‰æ–¹æ³•ä¸­æ³¨å…¥ elå±æ€§ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™è¡ŒæŠ¥é”™çš„æ„æ€å°±æ˜¯ç¦æ­¢åœ¨é™¤äº†å®ä¾‹åŒ–ä¹‹å¤–çš„åœ°æ–¹æ³¨å…¥ elé€‰é¡¹ã€‚ æ¯”å¦‚è°ƒç”¨ï¼š 123Vue.mixin(&#123; el:&quot;#select&quot;&#125;) æ§åˆ¶å°å°±ä¼šæŠ¥é”™ï¼š 6.4 dataçš„åˆå¹¶ç­–ç•¥dataé€‰é¡¹åœ¨ Vueä¸­æ— ç–‘æ˜¯ä½¿ç”¨æœ€é¢‘ç¹çš„é€‰é¡¹ä¹‹ä¸€ã€‚ æ‰€ä»¥å®ƒçš„åˆå¹¶ç­–ç•¥ç›¸å½“å¤æ‚ã€‚ 12345678910111213141516171819202122strats.data = function ( parentVal: any, childVal: any, vm?: Component): Function | null &#123; if (!vm) &#123; if (childVal &amp;&amp; typeof childVal !== &#x27;function&#x27;) &#123; __DEV__ &amp;&amp; warn( &#x27;The &quot;data&quot; option should be a function &#x27; + &#x27;that returns a per-instance value in component &#x27; + &#x27;definitions.&#x27;, vm ) return parentVal &#125; return mergeDataOrFn(parentVal, childVal) &#125; return mergeDataOrFn(parentVal, childVal, vm)&#125; 6.4.1 åœ¨å®šä¹‰æ—¶æŠ¥é”™æˆ‘ä»¬çŸ¥é“é€šå¸¸åœ¨ç»„ä»¶ä¸­ï¼Œå»ºè®®å°† dataå®šä¹‰æˆå‡½æ•°ï¼Œå› ä¸ºå¦‚æœå°† dataå®šä¹‰æˆæ™®é€šå¯¹è±¡ï¼Œåœ¨è¯¥ç»„ä»¶è¢«å¼•å…¥åˆ°å¤šå¤„æ—¶ï¼Œç”±äº extendå‡½æ•°å†…éƒ¨ä¼šç¼“å­˜è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ dataä¸­çš„æ•°æ®å¯èƒ½ä¼šè¢«å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¯¼è‡´ bugçš„äº§ç”Ÿã€‚ childValåœ¨è¿™é‡Œä»£è¡¨ä¼ å…¥çš„é€‰é¡¹ï¼Œå³åœ¨ç»„ä»¶ä¸­å®šä¹‰çš„é€‰é¡¹ã€‚ æ‰€ä»¥ä¼šæç¤ºä½ éœ€è¦å°† dataå®šä¹‰æˆå‡½æ•°ï¼Œå¹¶ä¸”ä¾æ—§è°ƒç”¨ mergeDataOrFnã€‚ åœ¨æ‰§è¡Œæ„é€ å‡½æ•°æ—¶åˆ›å»ºå­ç±»æ„é€ å‡½æ•°æ—¶ï¼Œè™½ç„¶å·²ç»æœ‰äº† vmäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¼ å…¥ mergeOptionsã€‚ 123Vue.extend = function()&#123; Sub.options = mergeOptions(Super.options, extendOptions);&#125; æ‰€ä»¥è¿™ä¸ªæŠ¥é”™æ˜¯åœ¨åˆ›å»ºå­ç±»æ„é€ å‡½æ•°æ—¶è¿›è¡Œæç¤ºçš„ã€‚ 6.4.2 mergeDataOrFn1234567891011121314151617181920export function mergeDataOrFn( parentVal, childVal, vm) &#123; return function mergedInstanceDataFn() &#123; // instance merge const instanceData = isFunction(childVal) ? childVal.call(vm, vm) : childVal const defaultData = isFunction(parentVal) ? parentVal.call(vm, vm) : parentVal if (instanceData) &#123; return mergeData(instanceData, defaultData) &#125; else &#123; return defaultData &#125; &#125;&#125; è¯¥å‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ªåˆå¹¶å‡½æ•°ã€‚ å½“è¿™ä¸ªåˆå¹¶å‡½æ•°æ‰§è¡Œçš„æ—¶å€™å°†è·å–æ„é€ å‡½æ•°çš„ä¸Šçš„dataå’Œä¼ å…¥çš„data å½“ä¼ å…¥çš„é€‰é¡¹ä¸­å­˜åœ¨ dataï¼Œåˆ™è°ƒç”¨mergeDataåˆå¹¶ 2 ä¸ªdataå¹¶è¿”å›ã€‚ å½“ä¼ å…¥çš„é€‰é¡¹ä¸­ä¸å­˜åœ¨ dataæ—¶ï¼Œåˆ™ç›´æ¥è¿”å›æ„é€ å‡½æ•°ä¸Šçš„ dataã€‚ 6.4.3 mergeDataå½“æ„é€ å‡½æ•°çš„é€‰é¡¹å’Œä¼ å…¥çš„é€‰é¡¹éƒ½å­˜åœ¨ dataæ—¶ï¼Œéœ€è¦è°ƒç”¨ mergeDataå¯¹ 2 ä¸ªé€‰é¡¹è¿›è¡Œåˆå¹¶ã€‚ 123456789101112131415161718192021222324252627282930function mergeData( to, from, recursive = true)&#123; if (!from) return to let key, toVal, fromVal const keys = hasSymbol ? Reflect.ownKeys(from) : Object.keys(from) for (let i = 0; i &lt; keys.length; i++) &#123; key = keys[i] // in case the object is already observed... if (key === &#x27;__ob__&#x27;) continue toVal = to[key] fromVal = from[key] if (!recursive || !hasOwn(to, key)) &#123; set(to, key, fromVal) &#125; else if ( toVal !== fromVal &amp;&amp; isPlainObject(toVal) &amp;&amp; isPlainObject(fromVal) ) &#123; mergeData(toVal, fromVal) &#125; &#125; return to&#125; è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯åˆå¹¶ä¸¤ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥ç”¨äºåˆå§‹åŒ–ç»„ä»¶çš„æ•°æ®å¯¹è±¡ï¼Œæˆ–è€…åœ¨ç»„ä»¶çš„ created é’©å­ä¸­åˆå¹¶çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶çš„æ•°æ®ã€‚é€šè¿‡ recursive å‚æ•°ï¼Œå®ƒå¯ä»¥çµæ´»åœ°è¿›è¡Œæµ…åˆå¹¶æˆ–æ·±åº¦åˆå¹¶ã€‚ ç”±äºå…¶ä¸­æ¶‰åŠåˆ°å“åº”å¼æ•°æ®çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸åœ¨è¿™é‡Œæ·±å…¥è®¨è®ºã€‚ åé¢ä¼šå•ç‹¬å‡ºå“åº”å¼æ•°æ®çš„å†…å®¹ã€‚ 6.5 ç”Ÿå‘½å‘¨æœŸçš„åˆå¹¶ç­–ç•¥1234567891011121314151617181920212223242526272829303132333435363738394041424344export const LIFECYCLE_HOOKS = [ &#x27;beforeCreate&#x27;, &#x27;created&#x27;, &#x27;beforeMount&#x27;, &#x27;mounted&#x27;, &#x27;beforeUpdate&#x27;, &#x27;updated&#x27;, &#x27;beforeDestroy&#x27;, &#x27;destroyed&#x27;, &#x27;activated&#x27;, &#x27;deactivated&#x27;, &#x27;errorCaptured&#x27;, &#x27;serverPrefetch&#x27;, &#x27;renderTracked&#x27;, &#x27;renderTriggered&#x27;]LIFECYCLE_HOOKS.forEach(hook =&gt; &#123; strats[hook] = mergeLifecycleHook&#125;)// ç”Ÿå‘½å‘¨æœŸçš„åˆå¹¶ç­–ç•¥export function mergeLifecycleHook( parentVal, childVal)&#123; const res = childVal ? parentVal ? parentVal.concat(childVal) : isArray(childVal) ? childVal : [childVal] : parentVal return res ? dedupeHooks(res) : res&#125;function dedupeHooks(hooks) &#123; const res = [] for (let i = 0; i &lt; hooks.length; i++) &#123; if (res.indexOf(hooks[i]) === -1) &#123; res.push(hooks[i]) &#125; &#125; return res&#125; ä¸Šé¢è¿™ä¸ªä¸‰å…ƒè¡¨è¾¾å¼è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚ å¦‚æœå­ç±»å’Œçˆ¶ç±»éƒ½æ‹¥æœ‰ç›¸åŒçš„é’©å­é€‰é¡¹ï¼Œåˆ™å°†å­ç±»é€‰é¡¹å’Œçˆ¶ç±»é€‰é¡¹åˆå¹¶ã€‚ å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨é’©å­é€‰é¡¹ï¼Œå­ç±»å­˜åœ¨æ—¶ï¼Œåˆ™ä»¥æ•°ç»„å½¢å¼è¿”å›å­ç±»é’©å­é€‰é¡¹ã€‚ å½“å­ç±»ä¸å­˜åœ¨é’©å­é€‰é¡¹æ—¶ï¼Œåˆ™ä»¥çˆ¶ç±»é€‰é¡¹è¿”å›ã€‚ å­çˆ¶åˆå¹¶æ—¶ï¼Œæ˜¯å°†å­ç±»é€‰é¡¹æ”¾åœ¨æ•°ç»„çš„æœ«å°¾ï¼Œè¿™æ ·åœ¨æ‰§è¡Œé’©å­æ—¶ï¼Œæ°¸è¿œæ˜¯çˆ¶ç±»é€‰é¡¹ä¼˜å…ˆäºå­ç±»é€‰é¡¹æ‰§è¡Œã€‚ ç®€å•æ€»ç»“ä¸€ä¸‹ï¼šå¯¹äºç”Ÿå‘½å‘¨æœŸé’©å­é€‰é¡¹ï¼Œå­ç±»å’Œçˆ¶ç±»ç›¸åŒçš„é€‰é¡¹å°†åˆå¹¶æˆæ•°ç»„ï¼Œè¿™æ ·åœ¨æ‰§è¡Œå­ç±»é’©å­å‡½æ•°æ—¶ï¼Œçˆ¶ç±»é’©å­é€‰é¡¹ä¹Ÿä¼šæ‰§è¡Œï¼Œå¹¶ä¸”çˆ¶ä¼šä¼˜å…ˆäºå­æ‰§è¡Œã€‚ 6.6 ç»„ä»¶ã€æŒ‡ä»¤ã€è¿‡æ»¤å™¨çš„åˆå¹¶ç­–ç•¥12345678910111213141516171819export const ASSET_TYPES = [&#x27;component&#x27;, &#x27;directive&#x27;, &#x27;filter&#x27;]ASSET_TYPES.forEach(function (type) &#123; strats[type + &#x27;s&#x27;] = mergeAssets&#125;)function mergeAssets( parentVal, childVal, vm, key) &#123; const res = Object.create(parentVal || null) if (childVal) &#123; return extend(res, childVal) &#125; else &#123; return res &#125;&#125; å¾ˆæ˜æ˜¾ ç»„ä»¶ã€æŒ‡ä»¤ã€è¿‡æ»¤å™¨çš„åˆå¹¶ç­–ç•¥å°±æ˜¯ç›´æ¥å¯¹æ„é€ å‡½æ•°çš„é€‰é¡¹è¿›è¡Œè¦†ç›–ã€‚ Object.create()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨åˆ›å»ºçš„å¯¹è±¡æ¥æä¾›æ–°åˆ›å»ºçš„å¯¹è±¡çš„__proto__ã€‚ è¿™æ„å‘³ç€è¿™ä¸ªåˆå¹¶ç­–ç•¥è®©å†…ç½®çš„ä¸€äº›èµ„æºé€‰é¡¹å˜æˆäº†åŸå‹é“¾çš„å½¢å¼ã€‚ è¿™æ ·å­ç±»å¿…é¡»é€šè¿‡åŸå‹é“¾æ‰èƒ½æŸ¥æ‰¾å¹¶ä½¿ç”¨å†…ç½®çš„ç»„ä»¶å’Œå†…ç½®æŒ‡ä»¤ã€‚ 6.7 watchçš„åˆå¹¶ç­–ç•¥åœ¨ä½¿ç”¨ Vue è¿›è¡Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹æ•°æ®å˜åŒ–åšå‡ºå“åº”ï¼Œå°¤å…¶æ˜¯å½“æ¶‰åŠåˆ°éœ€è¦æ‰§è¡Œå¼‚æ­¥æ“ä½œæˆ–è®¡ç®—æˆæœ¬è¾ƒé«˜çš„ä»»åŠ¡æ—¶ï¼Œwatch é€‰é¡¹å°±æ˜¾å¾—å°¤ä¸ºé«˜æ•ˆã€‚ å…³äº watch é€‰é¡¹çš„åˆå¹¶ç­–ç•¥ï¼Œå®ƒä¸ç”Ÿå‘½å‘¨æœŸé’©å­çš„åˆå¹¶æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼šå¦‚æœçˆ¶ç»„ä»¶å’Œå­ç»„ä»¶æœ‰ç›¸åŒçš„è§‚å¯Ÿå­—æ®µï¼Œå®ƒä»¬çš„ watch é€‰é¡¹å°†è¢«åˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ã€‚ å½“ç›‘æµ‹åˆ°å­—æ®µå˜åŒ–æ—¶ï¼Œçˆ¶ç±»å’Œå­ç±»çš„ç›‘å¬ä»£ç å°†è¢«åŒæ—¶è§¦å‘ã€‚ ä¸ç”Ÿå‘½å‘¨æœŸé’©å­çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œwatch é€‰é¡¹åœ¨åˆå¹¶åçš„æ•°ç»„ä¸­å¯ä»¥å‘ˆç°å¤šç§å½¢å¼ï¼šå®ƒä»¬å¯ä»¥æ˜¯åŒ…å«é€‰é¡¹çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å›è°ƒå‡½æ•°ï¼Œæˆ–è€…æ˜¯æ–¹æ³•åçš„å­—ç¬¦ä¸²ã€‚ è¿™ç§çµæ´»æ€§ä½¿å¾— watch é€‰é¡¹èƒ½å¤Ÿé€‚åº”æ›´å¤šçš„ä½¿ç”¨åœºæ™¯ï¼Œæ— è®ºæ˜¯ç®€å•çš„æ•°æ®å˜åŒ–ç›‘å¬è¿˜æ˜¯å¤æ‚çš„å¼‚æ­¥æ“ä½œå¤„ç†ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒVue å…è®¸å¼€å‘è€…åœ¨ç»„ä»¶å’Œæ··å…¥ä¸­çµæ´»åœ°å®šä¹‰å’Œåˆå¹¶ watch é€‰é¡¹ï¼Œä»è€Œå®ç°ç²¾ç»†åŒ–çš„æ•°æ®ç›‘æ§å’Œç®¡ç†ã€‚ 12345678910111213141516171819202122232425262728strats.watch = function (parentVal,childVal,vm,key) &#123; //ç«ç‹æµè§ˆå™¨åœ¨Objectçš„åŸå‹ä¸Šæ‹¥æœ‰watchæ–¹æ³•ï¼Œè¿™é‡Œå¯¹è¿™ä¸€ç°è±¡åšäº†å…¼å®¹ // var nativeWatch = (&#123;&#125;).watch; if (parentVal === nativeWatch) &#123; parentVal = undefined; &#125; if (childVal === nativeWatch) &#123; childVal = undefined; &#125; // æ²¡æœ‰å­ï¼Œåˆ™é»˜è®¤ç”¨çˆ¶é€‰é¡¹ if (!childVal) &#123; return Object.create(parentVal || null) &#125; &#123; // ä¿è¯watché€‰é¡¹æ˜¯ä¸€ä¸ªå¯¹è±¡ assertObjectType(key, childVal, vm); &#125; // æ²¡æœ‰çˆ¶åˆ™ç›´æ¥ç”¨å­é€‰é¡¹ if (!parentVal) &#123; return childVal &#125; var ret = &#123;&#125;; extend(ret, parentVal); for (var key$1 in childVal) &#123; var parent = ret[key$1]; var child = childVal[key$1]; // çˆ¶çš„é€‰é¡¹å…ˆè½¬æ¢æˆæ•°ç»„ if (parent &amp;&amp; !Array.isArray(parent)) &#123; parent = [parent]; &#125; ret[key$1] = parent ? parent.concat(child) : Array.isArray(child) ? child : [child]; &#125; return ret&#125;; ä¸‹é¢ç»“åˆå…·ä½“çš„ä¾‹å­çœ‹åˆå¹¶ç»“æœï¼š 1234567891011121314151617181920212223242526var Parent = Vue.extend(&#123; watch: &#123; &#x27;test&#x27;: function() &#123; console.log(&#x27;parent change&#x27;) &#125; &#125;&#125;)var Child = Parent.extend(&#123; watch: &#123; &#x27;test&#x27;: &#123; handler: function() &#123; console.log(&#x27;child change&#x27;) &#125; &#125; &#125;, data() &#123; return &#123; test: 1 &#125; &#125;&#125;)var vm = new Child().$mount(&#x27;#app&#x27;);vm.test = 2;// è¾“å‡ºç»“æœparent changechild change ç®€è€Œè¨€ä¹‹:Vue åœ¨å¤„ç† watch é€‰é¡¹çš„åˆå¹¶æ—¶ï¼Œä¼šå°†å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶çš„ watch é€‰é¡¹åˆå¹¶æˆä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„æˆå‘˜å¯ä»¥æ˜¯å›è°ƒå‡½æ•°ã€åŒ…å«é…ç½®çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯æŒ‡å‘å‡½æ•°çš„æ–¹æ³•åã€‚è¿™æ ·çš„è®¾è®¡æä¾›äº†çµæ´»çš„é€‰é¡¹ï¼Œä»¥é€‚åº”ä¸åŒçš„æ•°æ®ç›‘æ§éœ€æ±‚ã€‚ 6.8 props methods inject computedåˆå¹¶åœ¨ Vue çš„æºç è®¾è®¡ä¸­ï¼Œpropsã€methodsã€inject å’Œ computed è¿™äº›é€‰é¡¹è¢«å½’ä¸ºä¸€ç±»ï¼Œå¹¶ä¸”å®ƒä»¬éµå¾ªç›¸åŒçš„åˆå¹¶ç­–ç•¥ã€‚ 12345678910111213141516171819strats.props = strats.methods = strats.inject = strats.computed = function ( parentVal, childVal, vm, key) &#123; if (childVal &amp;&amp; __DEV__) &#123; assertObjectType(key, childVal, vm) &#125; if (!parentVal) return childVal const ret = Object.create(null) extend(ret, parentVal) if (childVal) extend(ret, childVal) return ret&#125; ç®€è€Œè¨€ä¹‹ã€‚ çˆ¶ç±»æ²¡æœ‰ç›¸åº”çš„é€‰é¡¹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å­ç±»çš„é€‰é¡¹ å½“çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶éƒ½æä¾›äº†è¿™äº›é€‰é¡¹æ—¶ï¼Œå­ç»„ä»¶çš„é€‰é¡¹ä¼šè¦†ç›–çˆ¶ç»„ä»¶çš„é€‰é¡¹ã€‚è¿™ç§ç­–ç•¥ç¡®ä¿äº†ç»„ä»¶èƒ½å¤Ÿç»§æ‰¿å’Œæ‰©å±•è¡Œä¸ºï¼ŒåŒæ—¶å…è®¸å­ç»„ä»¶é€šè¿‡æä¾›è‡ªå·±çš„é€‰é¡¹æ¥è¦†ç›–ç»§æ‰¿è‡ªçˆ¶ç»„ä»¶æˆ–æ··å…¥çš„é€‰é¡¹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 12345678910111213141516171819202122232425262728var Parent = Vue.extend(&#123; methods:&#123; handleClick:function()&#123; console.log(&quot;çˆ¶ç±»ç‚¹å‡»äº‹ä»¶&quot;) &#125;, getParentName:function()&#123; console.log(&quot;è·å–çˆ¶ç±»åç§°&quot;) &#125; &#125;&#125;)var Child = Parent.extend(&#123; methods:&#123; handleClick:function()&#123; console.log(&quot;å­ç±»ç‚¹å‡»äº‹ä»¶&quot;) &#125;, getChildName:function()&#123; console.log(&quot;è·å–çˆ¶ç±»åç§°&quot;) &#125; &#125;&#125;)var vm = new Child().$mount(&#x27;#app&#x27;);console.log(vm.$options.methods);// åˆå¹¶å­ç±»å’Œçˆ¶ç±»ï¼Œé‡åˆ°ç›¸åŒçš„å±æ€§ï¼Œä½¿ç”¨å­ç±»è¦†ç›–çˆ¶ç±»&#123; getChildName:f(), getParentName:f(), handleClick:f(),&#125; 6.9 provideåˆå¹¶ç¡®ä¿äº†å­ç»„ä»¶çš„ provide é€‰é¡¹å¯ä»¥è¦†ç›–çˆ¶ç»„ä»¶çš„åŒåé€‰é¡¹ï¼ŒåŒæ—¶ä¿ç•™äº†çˆ¶ç»„ä»¶çš„å…¶ä»–é€‰é¡¹ã€‚è¿™ç§è®¾è®¡å…è®¸ç»„ä»¶åœ¨ç»§æ‰¿å’Œæ‰©å±• provide æ•°æ®æ—¶æœ‰æ›´å¤šçš„çµæ´»æ€§ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒVue å…è®¸å¼€å‘è€…åœ¨ç»„ä»¶æ ‘ä¸­æœ‰æ•ˆåœ°ä¼ é€’æ•°æ®ï¼Œè€Œæ— éœ€é€šè¿‡æ¯ä¸ªå±‚çº§çš„ç»„ä»¶æ˜¾å¼åœ°ä¼ é€’ propsã€‚ 123456789101112131415strats.provide = function (parentVal, childVal) &#123; if (!parentVal) return childVal return function () &#123; const ret = Object.create(null) mergeData(ret, isFunction(parentVal) ? parentVal.call(this) : parentVal) if (childVal) &#123; mergeData( ret, isFunction(childVal) ? childVal.call(this) : childVal, false // non-recursive ) &#125; return ret &#125;&#125;"},{"title":"ğŸ”¥Vue2çš„åŸºæœ¬ä½¿ç”¨å’ŒåŸå‹è®¾è®¡","path":"//posts/vue2-constructor.html","content":"ä¸“æ ç¬¬ä¸‰ç¯‡-åŸºæœ¬ä½¿ç”¨å’ŒåŸå‹è®¾è®¡ &emsp;&emsp;åœ¨å‰é¢ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰äº†æºç çš„ç›®å½•ç»“æ„ä»¥åŠæ„å»ºæ–¹å¼ã€‚ &emsp;&emsp;ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ¥è¯´ä¸‹Vueçš„åŸå‹è®¾è®¡ã€‚ ä¸€ã€Vueçš„åŸºç¡€ä½¿ç”¨å®˜æ–¹æ¨è Vue çš„ä½¿ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šé€šè¿‡ CDN å’Œ NPMã€‚ ä½¿ç”¨ CDNï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ HTML ä¸­æ·»åŠ  &lt;script&gt; æ ‡ç­¾ç›´æ¥å¼•å…¥æ‰“åŒ…å¥½çš„ vue.js æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ç§å¿«é€Ÿä¸”ç®€ä¾¿çš„æ–¹æ³•ã€‚ 12// CDNæ–¹å¼&lt;script src=&quot;vue.js&quot;&gt;&lt;/script&gt; è€Œ NPM æ–¹å¼åˆ™æ¶‰åŠåˆ°ä¸æ¨¡å—æ‰“åŒ…å·¥å…·å¦‚ webpack æˆ– Browserify çš„é›†æˆï¼Œé€šè¿‡æ‰§è¡Œ npm install vue å‘½ä»¤æ¥å®‰è£… Vueï¼Œè¿™é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨å¼€å‘å¤§å‹åº”ç”¨æ—¶çš„é¦–é€‰æ–¹å¼ã€‚ 12// NPMæ–¹å¼import Vue from &#x27;vue&#x27;; å½“Vueè¢«å¼•å…¥æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåœ¨å…¥å£æ–‡ä»¶ä¸­å» new ä¸€ä¸ªVueå®ä¾‹ã€‚ ç„¶åå†åˆ©ç”¨å®ä¾‹ä¸Šçš„$mountæ–¹æ³•å°†å¯¹åº”çš„æ¨¡ç‰ˆå†…å®¹æŒ‚è½½åˆ°æµè§ˆå™¨ä¸­#appèŠ‚ç‚¹çš„ä½ç½®ä¸Šã€‚ 12345678// NPMæ–¹å¼// Nodejsç‰ˆæœ¬import Vue from &#x27;vue/dist/vue.common&#x27;;// éœ€è¦å®ä¾‹åŒ– Vuenew Vue(&#123; template:`&lt;div&gt;Hello World&lt;/div&gt;`&#125;).$mount(&quot;#app&quot;); äºŒã€ä¸ºä»€ä¹ˆVueä¸æ˜¯ä¸€ä¸ªç±»ä¸Šä¸€èŠ‚æˆ‘ä»¬è¯´äº†ä½¿ç”¨ Vue éœ€è¦ new ä¸€ä¸‹ã€‚ æ‰€ä»¥ä½ å¯èƒ½ä¼šä¹ æƒ¯æ€§çš„è®¤ä¸º Vue æ˜¯ä¸€ä¸ªç±»ã€‚ ä½†æ˜¯æˆ‘ä»¬æ‰“å¼€Vueè¢«å®šä¹‰çš„core/instance/index.jsæ–‡ä»¶ã€‚ 123456function Vue(options) &#123; if (__DEV__ &amp;&amp; !(this instanceof Vue)) &#123; warn(&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;) &#125; this._init(options)&#125; ä¼šå‘ç°Vueæ˜¯ä½¿ç”¨å‡½æ•°å®šä¹‰çš„ã€‚ é‚£ä¹ˆVueæºç ä¸­ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç±»å‘¢ï¼Ÿ åœ¨Vueä¸­æœ‰å¤§é‡çš„æ‰©å±•å®ä¾‹å±æ€§çš„æ“ä½œå¦‚ï¼šVue.prototype.$mount=xxxã€‚ å…¶å®æœ¬è´¨ä¸Šç±»åªæ˜¯functionçš„è¯­æ³•ç³–ã€‚ è™½ç„¶è¯´ä½¿ç”¨ç±»ä¹Ÿå¯ä»¥è¿›è¡Œæ‰©å±•ï¼š 123456class Animate&#123;&#125;Animate.prototype.eat = function()&#123; console.log(&quot;åŠ¨ç‰©åƒä¸œè¥¿&quot;)&#125;new Animate().eat();// åŠ¨ç‰©åƒä¸œè¥¿ ä½†æ˜¯ç”¨ç±»å’ŒåŸå‹è¿™ä¹ˆæ··åˆä½¿ç”¨ï¼Œéš¾å…ä¼šè®©äººæ„Ÿåˆ°ä¸é€‚ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§å¼€å‘è§„èŒƒå’Œä¹ æƒ¯å§ã€‚ å¤§éƒ¨åˆ†å¼€æºåº“ä¾æ—§ä½¿ç”¨çš„æ˜¯æ„é€ å‡½æ•°functionçš„æ–¹å¼ã€‚ ä¸‰ã€å¿…é¡»ä½¿ç”¨newå…³é”®å­—æ¥è°ƒç”¨å¯ä»¥çœ‹åˆ°åœ¨Vueæ„é€ å‡½æ•°å†…éƒ¨å­˜åœ¨ä¸€ä¸ªåˆ¤æ–­ this instanceof Vueï¼Œé‚£ä¹ˆè¿™è¡Œä»£ç åº”è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“é€šè¿‡ instanceofå¯ä»¥é¡ºç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾å¯¹åº”çš„æ„é€ å‡½æ•°ã€‚ æ‰€ä»¥è¿™ä¸ªåˆ¤æ–­çš„æ„æ€å°±æ˜¯æ£€æŸ¥å½“å‰ä¸Šä¸‹æ–‡ï¼ˆthisï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ª Vueå®ä¾‹ã€‚ å¦‚æœä¸æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå°±ä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Šã€‚ è¿™è¦å‘ŠçŸ¥å¼€å‘è€…Vueåº”è¯¥è¦ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°æ¥ä½¿ç”¨ã€‚ 123456// instance/index.jsfunction Vue(options) &#123; if(__DEV__ &amp;&amp; !this instanceof Vue)&#123; warn(&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;) &#125;&#125; å‡è®¾ä½ è¿™ä¹ˆä½¿ç”¨ Vueï¼š 1const vm = Vue() é‚£ä¹ˆä½ å°†ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ä¸€æ¡æŠ¥é”™ä¿¡æ¯ã€‚ å››ã€Vueçš„åŸå‹è®¾è®¡Vueæ˜¯ä¸€ä¸ªåŸºäºåŸå‹è®¾è®¡çš„å‰ç«¯æ¡†æ¶ã€‚ åœ¨Vueè¢«å¼•å…¥ import Vue from vueæ—¶ï¼Œä¼šé€šè¿‡å¤šä¸ªå‡½æ•°åœ¨VueåŸå‹ä¸Šæ·»åŠ ä¸Šä¸€ç³»åˆ—çš„æ–¹æ³•ã€‚ 123456// è¯¥å‡½æ•°åœ¨ Vueè¢«å¼•å…¥æ—¶æ‰§è¡Œexport function lifecycleMixin(Vue)&#123; Vue.prototype._update = ()=&gt;&#123; // xxxx &#125;&#125; é‚£ä¹ˆåœ¨Vue.prototypeä¸Šå®šä¹‰æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ å‰é¢2èŠ‚ï¼Œæˆ‘ä»¬è¯´åˆ° Vueæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š 123function Vue()&#123; //xxx&#125; æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ newå…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ª vueå®ä¾‹ã€‚ 1const vm = new Vue(); æ„é€ å‡½æ•°ä¸åŸå‹å¯¹è±¡ï¼šæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ª prototypeå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡è¢«å«åšåŸå‹å¯¹è±¡ï¼ŒåŒ…å«äº†ç”±è¯¥æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹å…±äº«å±æ€§å’Œæ–¹æ³•ã€‚ å®ä¾‹å¯¹è±¡çš„ __proto__ å±æ€§ï¼šæ¯ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª __proto__ å±æ€§ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šVueæ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ï¼ˆVue.prototypeï¼‰å’ŒåŸºäºå®ƒåˆ›å»ºçš„å®ä¾‹çš„éšå¼åŸå‹ï¼ˆvm.__proto__ï¼‰æŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜ç©ºé—´ã€‚ å½“ Vueå®ä¾‹è®¿é—®æŸä¸ªå±æ€§æ—¶ï¼Œå¦‚æœåœ¨è‡ªèº«å±æ€§ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šæ²¿ç€__proto__å±æ€§æŒ‡å‘çš„åŸå‹å¯¹è±¡è¿›è¡ŒæŸ¥æ‰¾ã€‚ æ‰€ä»¥é€šè¿‡ vm å¯ä»¥è®¿é—®åˆ°å®šä¹‰åœ¨ Vue.prototype çš„å±æ€§å’Œæ–¹æ³•ã€‚ é€šç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•æ–¹æ³•ï¼Œå¹¶ä¸ç”¨æ˜¾ç¤ºçš„åœ¨ vm ä¸Šè®¾ç½®æ–¹æ³•ï¼Œåšåˆ°äº†ç›¸å¯¹éš”ç¦»ã€‚ äº”ã€Vue.extendåˆ©ç”¨åŸå‹é“¾ç»§æ‰¿ç”Ÿæˆâ€œå­ç±»â€œæ„é€ å‡½æ•°Vue.extendæ˜¯å®šä¹‰åœ¨Vueè¿™ä¸ªæ„é€ å‡½æ•°ä¸Šçš„æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¸»è¦ç”¨äºåˆ›å»ºVueæ„é€ å‡½æ•°çš„â€œå­ç±»â€œï¼Œè¯¥â€œå­ç±»â€œç»§æ‰¿ Vueæ„é€ å‡½æ•°ä¸Šçš„åŸå‹æ–¹æ³•å’ŒåŸå‹å±æ€§ã€‚ è™½ç„¶Vueåœ¨æŠ€æœ¯ä¸Šä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç±»ï¼Œä½†æ˜¯Vue.extendæä¾›äº†ä¸€ç§ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ç»§æ‰¿çš„æ–¹å¼æ¥å®šä¹‰ç»„ä»¶ã€‚ 123456789101112131415// å¯¹åŸå‡½æ•°è¿›è¡Œäº†ä¸€äº›ç®€åŒ– åªä¿ç•™äº†æ ¸å¿ƒVue.extend = function()&#123; // this ä¸º Vueæ„é€ å‡½æ•° const Super = this; // Sub ä¸º VueComponentæ„é€ å‡½æ•°ï¼Œä»£è¡¨ç»„ä»¶æ„é€ å‡½æ•° const Sub = function VueComponent(this)&#123; // å’Œ Vueæ„é€ å‡½æ•°ä¸€æ · ä¼šè°ƒç”¨_initæ–¹æ³• this._init(options); &#125;; // åŸºäº Vue.prototype åˆ›å»ºä¸€å—æ–°çš„å†…å­˜ï¼Œå…±äº«å…¶å±æ€§å’Œæ–¹æ³•ã€‚ Sub.prototype = Object.create(Super.prototype); // ä¿®æ­£ constructoræŒ‡å‘ Sub.prototype.constructor = Sub; return Sub;&#125; æˆ‘ä»¬ç®€å•çš„åˆ†æä¸€ä¸‹è¿™å‡ è¡Œä»£ç ã€‚ å£°æ˜äº†Superå˜é‡å’Œ Subå˜é‡åˆ†åˆ«æŒ‡å‘Vueæ„é€ å‡½æ•°å’Œ VueComponentæ„é€ å‡½æ•°ã€‚ 5.1 ä½¿ç”¨åœºæ™¯åœ¨Vueæºç å†…éƒ¨å’Œä½¿ç”¨Vueç¼–å†™ä¸šåŠ¡ä»£ç æ—¶éƒ½å¯ä»¥ä½¿ç”¨ Vue.extendè¿™ä¸ª apiã€‚ 5.1.1 å†…éƒ¨åˆ›å»ºç»„ä»¶æ¯ä¸€ä¸ªVueç»„ä»¶éƒ½å¯¹åº”ç€ä¸€ä¸ªå®ä¾‹ã€‚ è€Œè¿™äº›å®ä¾‹éƒ½æ˜¯é€šè¿‡ extend æ–¹æ³•åˆ›å»ºçš„ VueComponentæ„é€ å‡½æ•° ç”Ÿæˆçš„ã€‚ åœ¨renderé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯åœ¨ç”Ÿæˆç»„ä»¶çš„vnodeçš„æ—¶å€™ä¼šé€šè¿‡ extend æ–¹æ³•åˆ›å»ºVueComponentæ„é€ å‡½æ•°ã€‚ å¹¶èµ‹å€¼åˆ° vnode ä¸­çš„ componentOptionså±æ€§ä¸­ã€‚ 1234567891011// åˆ›å»ºç»„ä»¶çš„ vnode çš„æ–¹æ³•export function createComponent(Ctor,context)&#123; // _baseåœ¨å¼•å…¥æ—¶è¢«è®¾ç½®ä¸º Vue // è¿™é‡Œçš„optionsåé¢æˆ‘ä»¬ä¼šè¯¦ç»†è¯´æ˜ const base = context.$options._base; // åˆ›å»ºVueå­ç±»æ„é€ å‡½æ•° Ctor = base.extend(); return new Vnode( &#123;componentOptions:&#123;Ctor&#125;&#125; )&#125; è¿™é‡Œçš„_baseå®é™…ä¸Šå°±æ˜¯ Vueã€‚ è¿™é‡Œçš„ contextæ˜¯vmå®ä¾‹ï¼Œvm.$optionsæ˜¯åœ¨å®ä¾‹åŒ–æ„é€ å‡½æ•°æ—¶é€šè¿‡ mergeOptionså‡½æ•°ç”Ÿæˆçš„ã€‚ ç„¶ååœ¨updateé˜¶æ®µï¼ˆæ¸²æŸ“é¡µé¢ï¼‰ï¼Œä¼šåŸºäºCtorç”Ÿæˆå¯¹åº”çš„å®ä¾‹ï¼Œæ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–ã€æ¸²æŸ“æ–¹æ³•ç­‰ã€‚ 12345// æ¯ä¸ªç»„ä»¶éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆ›å»ºå¯¹åº”çš„å®ä¾‹// è¿™é‡Œçš„ componentOptions.Ctor å°±æ˜¯å¯¹åº”çš„VueComponentæ„é€ å‡½æ•°export function createComponentInstanceForVnode(vnode)&#123; return new vnode.componentOptions.Ctor()&#125; 5.1.2 åœ¨ä¸šåŠ¡ä¸­çš„å®é™…åº”ç”¨åœºæ™¯åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½å¯ä»¥åˆ©ç”¨ extend æ¥æ‰©å±•ç»„ä»¶ã€‚ åŒ…æ‹¬åˆ›å»ºå¯å¤ç”¨çš„ç»„ä»¶ã€åŠ¨æ€ç»„ä»¶ã€å…¨å±€å’Œå±€éƒ¨æ³¨å†Œã€ä¸´æ—¶ç»„ä»¶ã€è‡ªå®šä¹‰æŒ‡ä»¤å’Œæ’ä»¶ã€‚ æˆ‘ä»¬å¸¸ç”¨çš„ Elementæ¡†æ¶å†…éƒ¨å°±åˆ©ç”¨äº† Vue.extend æ¥æ‰©å±•æŸäº›ä¸´æ—¶æ€§çš„ç»„ä»¶ï¼Œä¾‹å¦‚æ¨¡æ€å¯¹è¯æ¡†ã€æç¤ºä¿¡æ¯ç­‰ã€‚ é€šè¿‡ Vue.extend åˆ›å»ºçš„ç»„ä»¶æ„é€ å‡½æ•°å¯ä»¥æŒ‰éœ€åˆ›å»ºå’Œé”€æ¯ï¼Œé€‚åˆè¿™ç±»ä¸´æ—¶ç»„ä»¶çš„ç®¡ç†ã€‚ 123456789101112131415161718const Main = &#123; template:&#x27;&lt;div&gt;hello main&lt;/div&gt;&#x27;&#125;const NotificationConstructor = Vue.extend(Main);let instance;const Notification = function() &#123; // é€šè¿‡VueComponentåˆ›å»ºç»„ä»¶å®ä¾‹ instance = new NotificationConstructor(); // ä½¿ç”¨$mountå¯ä»¥åˆ›å»ºä¸€ä¸ªDOMèŠ‚ç‚¹ å¹¶æŒ‚è½½åˆ°instance.$elä¸Š instance.$mount(); document.body.appendChild(instance.$el); return instance;&#125; Notification(); $mountæ–¹æ³•å¦‚æœæ²¡æœ‰ä¼ å‚ä¸ä¼šæŒ‚è½½ï¼Œä½†æ˜¯ä¾æ—§å¯ä»¥ç”Ÿæˆ DOMèŠ‚ç‚¹ï¼Œå¹¶èµ‹å€¼åœ¨ vm.$elä¸Šã€‚ åœ¨ element ä¸­çš„ Notificationç»„ä»¶ å°±ä½¿ç”¨äº† extend è¿›è¡Œæ‰©å±•ã€‚ 5.1.3 ä½¿ç”¨VueComponentç»§ç»­æ‰©å±•å®ƒçš„â€œå­ç±»â€æ„é€ å‡½æ•°éœ€è¦å…³æ³¨çš„æ˜¯åœ¨Vue.extendä¸­ï¼Œå°†Vue.extendæ–¹æ³•åŒæ—¶èµ‹å€¼ç»™äº† VueComponentã€‚ æ„å‘³ç€èµ‹äºˆäº† VueComponentç»§ç»­æ‰©å±•çš„èƒ½åŠ›ï¼š 12345678Vue.extend = function()&#123; const Super = this; const Sub = function VueComponent()&#123; this._init(); &#125; // çœç•¥éƒ¨åˆ†ä»£ç  Sub.extend = Super.extend;&#125; è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ— é™çš„åŸºäº VueComponentå’Œå®ƒçš„â€œå­ç±»â€æ‰©å±•å­ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243import Vue from &quot;@/my-vue2/platforms/web/entry-runtime-with-compiler-esm&quot;// åŸºäºVueæ„é€ å‡½æ•°åˆ›å»ºçš„åŸºç¡€æ„é€ å‡½æ•°const VueComponentConstructor = Vue.extend(&#123; template:`&lt;div&gt;&#123;&#123; name &#125;&#125;æˆ‘æ˜¯æ„é€ å‡½æ•°&lt;/div&gt;`, data()&#123; return &#123; name:&quot;VueComponentConstructor&quot; &#125; &#125;&#125;);// å¯ä»¥å¤ç”¨çˆ¶ç±»æ„é€ å‡½æ•°VueComponentConstructorä¸Šçš„å±æ€§const VueComponentChild1Constructor = VueComponentConstructor.extend(&#123; data()&#123; return &#123; name:&quot;VueComponentChild1Constructor&quot; &#125; &#125;&#125;)// å¯ä»¥å¤ç”¨çˆ¶ç±»æ„é€ å‡½æ•°VueComponentConstructorä¸Šçš„å±æ€§const VueComponentChild2Constructor = VueComponentConstructor.extend(&#123; data()&#123; return &#123; name:&quot;VueComponentChild2Constructor&quot; &#125; &#125;&#125;)function addNode()&#123; const vm1 = new VueComponentConstructor(); const vm2 = new VueComponentChild1Constructor(); const vm3 = new VueComponentChild2Constructor(); vm1.$mount() vm2.$mount() vm3.$mount() document.body.appendChild(vm1.$el) document.body.appendChild(vm2.$el) document.body.appendChild(vm3.$el)&#125;addNode(); ä¸Šè¿°ä»£ç ä¸­ï¼ŒVueComponentConstructor æ˜¯é€šè¿‡ Vue.extend åˆ›å»ºçš„ä¸€ä¸ªåŸºç¡€ç»„ä»¶æ„é€ å‡½æ•°ã€‚ åœ¨è¿™ä¸ªåŸºç¡€æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†æ¨¡æ¿é€‰é¡¹ï¼Œæˆ‘ä»¬ä¹‹ååˆ›å»ºçš„æ„é€ å‡½æ•°å°±å¯ä»¥å¤ç”¨ templateé€‰é¡¹ï¼Œé¿å…ç¼–å†™é‡å¤çš„æ¨¡æ¿ã€‚ æˆ‘ä»¬è¿™é‡Œåªæ˜¯ç®€å•çš„ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬äº†è§£åˆ°äº†extendçš„é‡è¦æ„ä¹‰ã€‚çœŸå®çš„å¤ç”¨ç»“æ„è‚¯å®šæ›´ä¸ºå¤æ‚ã€‚ ä¸è¿‡åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬åº”ç”¨ä¸­åŸºæœ¬åªå­˜åœ¨ Vueæ„é€ å‡½æ•°å’Œå®ƒçš„ç›´æ¥æ„é€ å‡½æ•° VueComponentã€‚ åœ¨ç»„ä»¶åº“ç­‰åŸºç¡€åº“ä¸­å¯èƒ½ä¼šå­˜åœ¨è¿™ç§å­ç±»ç»§ç»­æ‰©å±•å­ç±»çš„æƒ…å†µã€‚ å…­ã€ä¸ºä»€ä¹ˆVueå®ä¾‹è¢«å«åš vmæºç ä¸­ä½ ä¼šçœ‹åˆ°å¤§é‡çš„ vmã€‚ ä½¿ç”¨ new Vue() åˆ›å»ºçš„Vueå®ä¾‹é€šå¸¸è¢«å«åš vmã€‚ Vueè¢«ç§°ä¸ºVMï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŸºäºMVVMï¼ˆModel-View-ViewModelï¼‰æ¶æ„çš„å‰ç«¯æ¡†æ¶ã€‚ åœ¨MVVMæ¶æ„ä¸­ï¼ŒVMä»£è¡¨ViewModelï¼Œè´Ÿè´£ç®¡ç†è§†å›¾ï¼ˆViewï¼‰å’Œæ•°æ®æ¨¡å‹ï¼ˆModelï¼‰ä¹‹é—´çš„é€šä¿¡å’Œäº¤äº’ã€‚ ä¸ƒã€å¼•å…¥æ—¶åŸºäºåŸå‹æŒ‚è½½æ–¹æ³•Vueæ˜¯åŸºäºåŸå‹è®¾è®¡çš„å‰ç«¯æ¡†æ¶ã€‚ åç»­çš„æ“ä½œéƒ½æ˜¯åœ¨è°ƒç”¨åŸå‹ä¸Šå®šä¹‰çš„æ–¹æ³•ã€‚ é‚£ä¹ˆ Vueæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å¯¹è¿™äº›æ–¹æ³•è¿›è¡ŒæŒ‚è½½çš„å‘¢ï¼Ÿ ä¸€éƒ¨åˆ†æ˜¯åœ¨ Vueå¼•å…¥çš„æ—¶å€™æŒ‚è½½çš„ï¼Œä¸€éƒ¨åˆ†æ˜¯åœ¨ Vueå®ä¾‹åŒ–çš„æ—¶å€™è¿›è¡ŒæŒ‚è½½çš„ã€‚ é‚£ä¹ˆ Vueæ˜¯å¦‚ä½•åœ¨å¼•å…¥çš„æ—¶å€™è¿›è¡ŒæŒ‚è½½å‘¢ï¼Ÿ æˆ‘ä»¬æ‰“å¼€å…¥å£æ–‡ä»¶å¯ä»¥çœ‹åˆ° Vue è¢«æœ‰å±‚æ¬¡çš„å¯¼å…¥å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸Šå¯¹åº”çš„åŸå‹æ–¹æ³•ã€‚ æ¯”å¦‚åœ¨: åœ¨platforms/web/runtime-with-compiler.jsæ–‡ä»¶ä¸­ï¼š Vueä¸Šæ‰©å±•äº†å®šä¹‰äº†Vue.compile é‡å†™äº† Vue.prototype.$mount åœ¨platforms/web/runtime/index.jsæ–‡ä»¶ä¸­ï¼š å®šä¹‰äº†Vue.prototype.$mount å®šä¹‰äº†Vue.prototype.patch æ‰©å±•äº†æ‰©å±• Vue.configä¸€äº›å±æ€§ æ‰©å±• Vue.options.directive æ‰©å±• Vue.options.components åœ¨core/index.jsæ–‡ä»¶ä¸­ï¼š ä½¿ç”¨äº†initGlobalAPIå®šä¹‰äº†ä¸€äº›å…¨å±€æ–¹æ³• å¦‚ mixin å®šä¹‰äº†Vue.prototype.$isServer å®šä¹‰äº†Vue.prototype.$ssrContext å®šä¹‰äº†Vue.FunctionalRenderContext å®šä¹‰äº†Vue.version åœ¨core/instance/indexæ–‡ä»¶ä¸­ï¼š ä½¿ç”¨ initMixin æ³¨å…¥äº† åˆå§‹åŒ–æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$init ä½¿ç”¨ stateMixin æ³¨å…¥äº† è·ŸçŠ¶æ€æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$setã€Vue.prototype.$watchã€Vue.prototype.$delete ä½¿ç”¨ eventsMixin æ³¨å…¥äº† è·Ÿäº‹ä»¶æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$onã€Vue.prototype.$offã€Vue.prototype.$once ä½¿ç”¨ lifecycleMixin æ³¨å…¥äº† è·Ÿæ•´ä¸ª vueç”Ÿå‘½å‘¨æœŸæ›´æ–°æœ‰å…³çš„å±æ€§å¦‚ï¼šVue.prototype.$update ä½¿ç”¨ renderMixin æ³¨å…¥äº† è·Ÿæ¸²æŸ“ç›¸å…³çš„å±æ€§å¦‚ï¼šVue.prototype._render å¯ä»¥å‘ç° Vueæºç ä¸­æ˜¯ä¸€å±‚ä¸€å±‚è¿›è¡Œå¯¼å…¥ã€‚ é‚£ä¹ˆVueä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ç›®å½•ç»“æ„å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ¨¡å—éƒ½å¯¹ Vueå¯¹è±¡åšäº†ç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´æ‰©å±•å±æ€§ã€æ‰©å±•å®ä¾‹å±æ€§ç­‰ã€‚ Vue æŒ‰åŠŸèƒ½æŠŠè¿™äº›æ‰©å±•åˆ†æ•£åˆ°å¤šä¸ªæ¨¡å—ä¸­å»å®ç°ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªæ¨¡å—é‡Œå®ç°æ‰€æœ‰ã€‚ è¿™ç§æŠ€å·§ä¾¿äºåæœŸVueçš„ç»´æŠ¤å’Œè¿­ä»£ã€‚"},{"title":"ğŸ”¥Vue2æºç æ„å»º","path":"//posts/vue2-core-build.html","content":"ä¸“æ ç¬¬äºŒç¯‡-æºç æ„å»º &emsp;&emsp;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¤§æ¦‚äº†è§£äº†Vueçš„ç›®å½•ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ã€‚ &emsp;&emsp;åœ¨è¿™ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šçŸ¥æ™“ Vue æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚ ä¸€ã€Vueçš„æ„å»º1.1 æ ¹æ®ä½¿ç”¨åœºæ™¯æ‰“åŒ…åœ¨ä¸Šä¸€ç¯‡ä¸“æ æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰äº† Vueæºç ä¸­çš„ä»£ç ç»“æ„ã€‚ å…¶ä¸­æˆ‘ä»¬ä»‹ç»äº†å‡ ä¸ªå…¥å£æ–‡ä»¶ï¼š entry-runtime.ts entry-runtime-with-compiler.ts entry-runtime-esm.ts entry-runtime-with-compiler-esm.ts åœ¨æˆ‘ä»¬å¼€å‘é¡¹ç›®ç»“æŸåï¼Œéœ€è¦è¿›è¡Œæ‰“åŒ…å¹¶éƒ¨ç½²åˆ°çº¿ä¸Šã€‚ é€šå¸¸æˆ‘ä»¬é¡¹ç›®æ‰“åŒ…æ—¶éœ€è¦ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œ webpacké€šè¿‡è¿™ä¸ªå…¥å£æ–‡ä»¶é€’å½’æ–‡ä»¶è¿›è¡Œä¾èµ–åˆ†æç„¶åæ‰“åŒ…ã€‚ å…¶å®æ¡†æ¶æ‰“åŒ…ä¹Ÿä¸€æ ·ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªå…¥å£æ–‡ä»¶è¿›è¡Œé€’å½’ä¾èµ–åˆ†ææ‰“åŒ…ç”Ÿæˆ jsæ–‡ä»¶æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œä½¿ç”¨ã€‚ å’Œé¡¹ç›®ä¸ä¸€æ ·çš„æ˜¯ï¼Œé¡¹ç›®å¾€å¾€åªæœ‰ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œè€Œæ¡†æ¶ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µé‡‡ç”¨ä¸åŒçš„å…¥å£æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œä¸Šé¢çš„è¿™å››ä¸ªæ–‡ä»¶å°±æ˜¯Vueæ¡†æ¶çš„å…¥å£æ–‡ä»¶ã€‚ Vueæ˜¯ä½¿ç”¨rollupè¿›è¡Œæ‰“åŒ…çš„ã€‚ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·è¿›è¡Œä½¿ç”¨ï¼ŒVueåœ¨ä½¿ç”¨rollupè¿›è¡Œæ‰“åŒ…æ—¶æ ¹æ®å¼€å‘ç¯å¢ƒ&#96;å’Œå¼€å‘æ¨¡å¼æ‰“åŒ…å‡ºäº†ä¸åŒåŠŸèƒ½çš„æ–‡ä»¶ï¼Œä»¥é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚ æ„å»ºçš„rollupæ‰“åŒ…è„šæœ¬çš„ä»£ç åœ¨scripts/config.jsæ–‡ä»¶ä¸­ã€‚ 1234567891011121314151617const builds = &#123; &#x27;runtime-cjs-dev&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.common.dev.js&#x27;), format: &#x27;cjs&#x27;, env: &#x27;development&#x27;, banner &#125;, &#x27;runtime-cjs-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.common.prod.js&#x27;), format: &#x27;cjs&#x27;, env: &#x27;production&#x27;, banner &#125;, // çœç•¥&#125; æ€»å…±æ‰“åŒ…ç”Ÿæˆ 12 ä¸ªæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ æ ¹æ®æ˜¯å¦å¸¦ç¼–è¯‘å™¨çš„è§’åº¦ä¸Šåˆ†ä¸ºFullå’ŒRuntime-Only 2ä¸ªç‰ˆæœ¬ã€‚Fullç‰ˆæœ¬åŒ…å«ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶çš„å…¨éƒ¨åŠŸèƒ½ã€‚Runtime-Only ä»…å«è¿è¡Œæ—¶åŠŸèƒ½ã€‚ æ‰“åŒ…çš„æ–‡ä»¶æ ¹æ®ä½¿ç”¨åœºæ™¯åˆ†ä¸º esmã€cjsã€umdä¸‰ä¸ªç‰ˆæœ¬ã€‚å…¶ä¸­umdå¯ä»¥é€šè¿‡&lt;script&gt;æ ‡ç­¾å¼•å…¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼ŒVueä¼šæš´éœ²ä¸€ä¸ªå…¨å±€å˜é‡ Windows.Vueã€‚è€Œ CommonJSé€‚é…const Vue &#x3D; require(â€˜vueâ€™)è¿™ç§ nodeå¼çš„æ¨¡å—ç³»ç»Ÿã€‚ESåˆ™é€‚é…import Vue from â€˜vueâ€™è¿™ç§es6æ ¼å¼ã€‚ æ‰“åŒ…çš„æ–‡ä»¶æ ¹æ®ç¯å¢ƒåˆ†ä¸º dev&#x2F;prodï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­å¯ä»¥ä½¿ç”¨ devç‰ˆæœ¬çš„ jsæ–‡ä»¶ï¼Œè€Œéƒ¨ç½²åˆ°å®¢æˆ·ç”Ÿäº§ç¯å¢ƒå°±å¯ä»¥ä½¿ç”¨ prodç‰ˆæœ¬çš„ jsæ–‡ä»¶ã€‚ devç‰ˆæœ¬çš„æ–‡ä»¶æœ‰ä¸€äº›æç¤ºï¼Œä¼šåœ¨å¼€å‘è€…å¼€å‘æ—¶ä¾¿äºè°ƒè¯•ã€‚ 1.2 Fullç‰ˆæœ¬çš„Vueåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ å¹³æ—¶æˆ‘ä»¬å¼€å‘ä¸­åªä½¿ç”¨äº† runtime-only ç‰ˆæœ¬ã€‚ è€Œ Fullç‰ˆæœ¬ä¸­ä¸ä»…æœ‰ runtime-onlyéƒ¨åˆ†ï¼Œè¿˜åŒ…æ‹¬ç¼–è¯‘å™¨éƒ¨åˆ†ã€‚ æ‰€è°“ç¼–è¯‘å™¨ï¼Œå°±æ˜¯åœ¨Vueå†…éƒ¨çš„ç¼–è¯‘å™¨å¯ä»¥å°†æ¨¡æ¿è½¬åŒ–ä¸ºå¯¹åº”çš„renderå‡½æ•°ã€‚ åœ¨Vueå†…éƒ¨æ¸²æŸ“å°±æ˜¯è°ƒç”¨çš„ renderæ–¹æ³•ç”Ÿæˆ vnodeã€‚ å› ä¸ºç¼–è¯‘å™¨ä»£ç ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œè€Œä¸”å¦‚æœåœ¨è¿è¡Œçš„æ—¶å€™è¿›è¡Œæ¨¡æ¿ç¼–è¯‘ï¼Œæå¤§å¯èƒ½ä¼šæ¶ˆè€—æ€§èƒ½ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨å¼€å‘é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ runtime-onlyç‰ˆæœ¬ã€‚ åœ¨ webpacké¢„ç¼–è¯‘é˜¶æ®µï¼Œå°±å°†.vueæ–‡ä»¶ç¼–è¯‘æˆrenderå‡½æ•°ï¼Œåœ¨è¿è¡Œæ—¶ç›´æ¥è¿è¡Œ renderå‡½æ•°å°±å¯ä»¥è·å–åˆ°å¯¹åº”çš„ vnodeã€‚ é€šè¿‡ runtime-only å’Œ esmå¾ˆå®¹æ˜“æ¨æµ‹å‡ºæ¥æˆ‘ä»¬é¡¹ç›®åœ¨å¼€å‘é˜¶æ®µä¸­ä½¿ç”¨çš„æ˜¯vue.runtime.esm.js 1.3 ä½¿ç”¨ Full è¿˜æ˜¯ç”¨ Runtime-Onlyç‰ˆæœ¬è¿™éœ€è¦ä¾æ®å…·ä½“æƒ…å†µè¿›è¡Œå…·ä½“åˆ†æã€‚ å€˜è‹¥ä½ éœ€è¦ç”¨åˆ° Vue æ‰€æä¾›çš„ html æ¨¡æ¿åŠŸèƒ½ï¼Œé‚£å°±é€‰ç”¨ Full ç‰ˆæœ¬ã€‚ åä¹‹ï¼Œæœ€å¥½é‡‡ç”¨ Runtime-only ç‰ˆæœ¬ï¼ŒåŸå› åœ¨äºå®ƒæ¯” Full ç‰ˆæœ¬çš„æ–‡ä»¶ä½“ç§¯å¤§çº¦å° 30%ã€‚ *.vue å•æ–‡ä»¶ç»„ä»¶ä¼šè¢« vue-loader ç›´æ¥æ„å»ºæˆä¸º JavaScriptï¼Œå¹¶æœªä½¿ç”¨åˆ° Vue çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Runtime-only ç‰ˆæœ¬ã€‚ äºŒã€ç¥å¥‡çš„â€œ__DEV__â€åœ¨å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œåœ¨æ‰“åŒ…æˆå¼€å‘ç¯å¢ƒçš„åŒ…æ—¶ï¼Œå¾€å¾€ä¼šå­˜åœ¨å¾ˆå¤šæç¤ºä¿¡æ¯ã€‚ è€Œæºç ä¸­åˆ¤æ–­å¼€å‘ç¯å¢ƒé€šå¸¸éƒ½æ˜¯ä½¿ç”¨__DEV__æ¥è¿›è¡Œåˆ¤æ–­ã€‚ 2.1 __DEV__çš„æœ¬è´¨åœ¨Vueæºç ä¸­ï¼Œåˆ°å¤„éƒ½èƒ½çœ‹åˆ°__DEV__å˜é‡çš„èº«å½±ã€‚ ä½†æ˜¯ä½ çœ‹ä¸åˆ°__DEV__è¢« import å¼•å…¥ï¼Œç”šè‡³ä½ éƒ½æ‰¾ä¸åˆ°åœ¨å“ªé‡Œå®šä¹‰äº†è¿™ä¸ªå˜é‡ã€‚ è¿™ä¸ªå˜é‡åœ¨ Vue ä¸­ä»£è¡¨å¼€å‘ç¯å¢ƒã€‚ å½“ä½ åœ¨æºç ä¸­çœ‹è§ if(__DEV__) ä»£è¡¨è¿™ä¸ªifä¸­çš„é€»è¾‘åªæœ‰åœ¨å¼€å‘ç¯å¢ƒæ‰è¿›å…¥æ‰§è¡Œã€‚ vueçš„æ„å»ºå·¥å…·æ˜¯rollupï¼Œåœ¨rollupæ‰“åŒ…çš„æ—¶å€™ä¼šä½¿ç”¨@rollup/plugin-replace æ’ä»¶æ¥æ›¿æ¢æºä»£ç ä¸­çš„__DEV__å˜é‡ï¼Œå¦‚ä¸‹ï¼š 123456789101112......const replace = require(&#x27;@rollup/plugin-replace&#x27;)......// built-in varsconst vars = &#123; ...... __DEV__: `process.env.NODE_ENV !== &#x27;production&#x27;`, ......&#125;......config.plugins.push(replace(vars))...... æ‰€ä»¥__DEV__çš„æœ¬è´¨å°±æ˜¯ proess.env.NODE_ENV!== &#39;production&#39; ã€‚ 2.2 çº¦å®šä¿—æˆçš„â€œprocess.env.NODE_ENV!&#x3D;&#x3D;â€™productionâ€å°† DEV å˜é‡è½¬æ¢ä¸º process.env.NODE_ENV !== &#39;production&#39; è¿™æ ·çš„æ¡ä»¶è¡¨è¾¾å¼åœ¨ç°ä»£å‰ç«¯æ„å»ºå·¥å…·ä¸­æ˜¯ä¸€ç§å¸¸è§çš„çº¦å®šå’Œå®è·µã€‚ åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š ç¯å¢ƒåŒºåˆ†ï¼šé€šè¿‡ process.env.NODE_ENV å¯ä»¥æ–¹ä¾¿åœ°åœ¨ä»£ç ä¸­åŒºåˆ†å¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰ä¸ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨ç‰¹å®šçš„è­¦å‘Šã€æ—¥å¿—è®°å½•æˆ–è€…çƒ­åŠ è½½åŠŸèƒ½ï¼›è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆ™ç¦ç”¨è¿™äº›åŠŸèƒ½ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚ Tree-shaking å’Œ UglifyJSï¼šå½“æ‰“åŒ…å·¥å…·å¦‚ Rollup æˆ– webpack é‡åˆ° process.env.NODE_DEV !== &#39;production&#39; åŒ…è£¹çš„ä»£ç å—æ—¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¼šè‡ªåŠ¨å»é™¤ï¼ˆtree-shakeï¼‰å…¶ä¸­ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­éœ€è¦çš„ä»£ç ï¼Œå› ä¸ºè¯¥æ¡ä»¶è¡¨è¾¾å¼æœ€ç»ˆä¼šè¢«ç¼–è¯‘å™¨æˆ–å‹ç¼©å·¥å…·è¯†åˆ«ä¸ºå§‹ç»ˆä¸º falseï¼Œå› æ­¤åŒ…è£¹çš„ä»£ç ä¸ä¼šè¢«æ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©ã€‚ æ ‡å‡†åŒ–ï¼šè®¸å¤šæ¡†æ¶å’Œåº“éƒ½é‡‡ç”¨äº†è¿™ç§æ¨¡å¼æ¥å¤„ç†ç¯å¢ƒç›¸å…³çš„é€»è¾‘ï¼Œè¿™æ ·å¼€å‘è€…å¯ä»¥ç»Ÿä¸€éµå¾ªè¿™ä¸ªçº¦å®šï¼Œå‡å°‘é…ç½®å’Œç†è§£æˆæœ¬ã€‚ çµæ´»é…ç½®ï¼šç”±äºæ„å»ºå·¥å…·æ”¯æŒ .env æ–‡ä»¶æˆ–å…¶ä»–æ–¹å¼æ¥è®¾ç½® NODE_ENV çš„å€¼ï¼Œè¿™ä½¿å¾—é¡¹ç›®é…ç½®æ›´åŠ çµæ´»ï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å¿«é€Ÿåˆ‡æ¢ä¸åŒç¯å¢ƒä¸‹çš„è¡Œä¸ºã€‚ è·¨å¹³å°å…¼å®¹æ€§ï¼šprocess.env.NODE_ENV ä½œä¸ºä¸€ä¸ªæ ‡å‡† Node.js ç¯å¢ƒå˜é‡æ¥å£ï¼Œå·²ç»è¢«å¹¿æ³›æ¥å—ï¼Œå¹¶ä¸”åœ¨å„ç§æ‰“åŒ…å·¥å…·ä¸­éƒ½æœ‰ç›¸åº”çš„æœºåˆ¶å°†å…¶æ˜ å°„åˆ°æœ€ç»ˆæµè§ˆå™¨æ‰§è¡Œçš„ä»£ç ä¸­ï¼Œç¡®ä¿äº†è·¨å¹³å°çš„ä¸€è‡´æ€§ã€‚ ä¸€èˆ¬é¡¹ç›®åœ¨å¼€å‘ç¯å¢ƒä¸­å°†process.env.NODE_ENVè®¾ç½®ä¸ºdevelopmentï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®ä¸ºproductionã€‚ æ‰€ä»¥é€šè¿‡process.env.NODE_ENV !== &#39;productionå°±å¯ä»¥åˆ¤æ–­ç°åœ¨æ˜¯å¤„äºä»€ä¹ˆç¯å¢ƒä¸‹ã€‚ 2.3 åœ¨æœ¬åœ°ç¯å¢ƒé…ç½®__DEV__å› ä¸ºæˆ‘ä»¬è¿™é—¨è¯¾ç¨‹æ˜¯å†™ä¸€ä¸ªå®Œæ•´ç‰ˆçš„vue2ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨__DEV__è¿™ä¸ªå˜é‡ä»£è¡¨å¼€å‘ç¯å¢ƒã€‚ æˆ‘ä»¬æœ¬åœ°çš„é¡¹ç›®æ˜¯ä½¿ç”¨ vue-cli æ­å»ºçš„ã€‚ å¯ä»¥åœ¨ webpacké…ç½®æ–‡ä»¶ vue.config.js æ–‡ä»¶æ–°å¢ä¸€ä¸ªé…ç½®è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ 1234567891011121314// vue.config.jsconst &#123; defineConfig &#125; = require(&#x27;@vue/cli-service&#x27;);const webpack = require(&#x27;webpack&#x27;);module.exports = defineConfig(&#123; transpileDependencies: true, lintOnSave:false, configureWebpack: &#123; plugins: [ new webpack.DefinePlugin(&#123; __DEV__: process.env.NODE_ENV === &#x27;development&#x27;, &#125;), ], &#125;,&#125;) DefinePlugin æ’ä»¶çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨ç¼–è¯‘æ—¶å°†é¢„å®šä¹‰çš„å€¼æ›¿æ¢åˆ°æºä»£ç ä¸­çš„ç‰¹å®šå˜é‡ã€‚ æˆ‘ä»¬æ‰§è¡Œyarn startå¯åŠ¨è¿™ä¸ªé¡¹ç›®æ‰“å°ä¸€ä¸‹__DEV__ä¸º trueå³ä¸ºæˆåŠŸã€‚ 1console.log(__DEV__); // true"},{"title":"ğŸ”¥Vue2ç›®å½•ç»“æ„çª¥æ¢","path":"//posts/vue2-catalog.html","content":"ä¸“æ ç¬¬ä¸€ç¯‡-ç›®å½•ç»“æ„çª¥æ¢ &emsp;&emsp;å› ä¸º Vue æ¡†æ¶æ˜¯åœ¨åå¤šå¹´å‰äº§ç”Ÿçš„ä¸€ä¸ªå¼€æºå‰ç«¯æ¡†æ¶ï¼Œç»è¿‡ä¸€äº›è¿­ä»£ä¿®å¤ï¼Œç›®å‰å·²ç»è¶‹äºç¨³å®šã€‚ &emsp;&emsp;Vue2æ¡†æ¶åœ¨å¯ç»´æŠ¤æ€§ã€æ€§èƒ½ã€TypeScriptæ”¯æŒç­‰æ–¹é¢æœ‰ä¸€äº›ç—›ç‚¹ï¼Œæ‰€ä»¥å°¤é›¨æºªæ¨å‡ºäº† Vue3ç‰ˆæœ¬ã€‚ &emsp;&emsp;ä¸è¿‡ç›®å‰å¤§éƒ¨åˆ†å…¬å¸å› ä¸ºæˆæœ¬ç­‰æ–¹é¢çš„åŸå› ï¼Œè¿˜æ˜¯ä½¿ç”¨åœ¨ Vue2 ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªä¸“æ å°±æ¥æ¢è®¨ä¸€ä¸‹ Vue2 çš„æºç éƒ¨åˆ†ã€‚ ä¸€ã€éæ ¸å¿ƒVueæºç ç›®å½•å¤§è‡´ç»“æ„ æˆ‘ä»¬çœ‹çš„Vueæºç ç‰ˆæœ¬2.7.16æ˜¯Vue2çš„æœ€æ–°ç‰ˆæœ¬ æˆ‘ä»¬æ‰“å¼€Vue2çš„githubæºç åœ°å€ã€‚ å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰å¾ˆå¤šä¸ªç›®å½•æ–‡ä»¶ï¼Œä½†æ˜¯å…¶å® Vue2 æºç æ ¸å¿ƒçš„éƒ½æ˜¯åœ¨ srcæ–‡ä»¶å¤¹ä¸­çš„ã€‚ æˆ‘ä»¬è¿™ç« å¤§æ¦‚ä»‹ç»ä¸€ä¸‹é™¤äº† src ä¸‹é¢çš„ä¸€äº›ç›®å½•ï¼Œäº†è§£ä¸€ä¸‹å¤§ä½“çš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚ 1.1 .githubè¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ä¸ gitHub ç›¸å…³çš„é…ç½®æ–‡ä»¶æˆ–è€…è„šæœ¬ã€‚ 1.2 benchmarksè¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ€§èƒ½åŸºå‡†æµ‹è¯•çš„ç›¸å…³æ–‡ä»¶å’Œè„šæœ¬ã€‚ æ€§èƒ½åŸºå‡†æµ‹è¯•æ˜¯ä¸€ç§ç”¨æ¥è¯„ä¼°è½¯ä»¶æ€§èƒ½çš„æ–¹æ³•ï¼Œå®ƒé€šè¿‡æ¨¡æ‹ŸçœŸå®ä¸–ç•Œä¸­çš„ä½¿ç”¨åœºæ™¯æ¥æµ‹é‡è½¯ä»¶åœ¨ä¸åŒæ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚ å¯ä»¥ç¡®ä¿æ–°åŠŸèƒ½ä¸ä¼šé™ä½æ¡†æ¶çš„æ•´ä½“æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥ä¼˜åŒ–ç°æœ‰ä»£ç ï¼Œä½¿å…¶æ›´åŠ é«˜æ•ˆã€‚ 1.3. compiler-sfcè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹é€»è¾‘å°±å¯ä»¥ååŠ© webpackè¿›è¡Œè§£æå¤„ç†å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰ã€‚ é€šå¸¸æˆ‘ä»¬å¼€å‘æ—¶ä¼šå€ŸåŠ©webpackå°†vueæ–‡ä»¶è½¬åŒ–ä¸ºä¸€ä¸ªJSå¯¹è±¡ã€‚ å¯ä»¥æŸ¥çœ‹ä»–çš„ index.jsæ–‡ä»¶ å‘ç°å®é™…ä¸Šå°±æ˜¯å¯¼å‡ºäº†@vue/compiler-sfcè¿™ä¸ªåŒ…ã€‚ 1module.exports = require(&#x27;@vue/compiler-sfc&#x27;) 1.4. distè¯¥æ–‡ä»¶å¤¹ä¸ºæ‰“åŒ…æ–‡ä»¶å­˜æ”¾çš„åœ°æ–¹ã€‚ 1.5. examplesè¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ç¤ºä¾‹åº”ç”¨ç¨‹åºæˆ–ä»£ç ç‰‡æ®µï¼Œç›®çš„æ˜¯å±•ç¤º Vue.js çš„åŸºæœ¬ç”¨æ³•å’ŒåŠŸèƒ½ã€‚ 1.6 packagesè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºç»„ç»‡ Vue.js çš„å„ä¸ªå­åŒ…æˆ–æ¨¡å—ã€‚ éšç€ Vue.js é¡¹ç›®çš„å¤æ‚åº¦å¢åŠ ï¼Œå°†ä¸åŒçš„åŠŸèƒ½æ¨¡å—æ‹†åˆ†æˆç‹¬ç«‹çš„å­åŒ…å·²ç»æˆä¸ºäº†ä¸€ç§å¸¸è§çš„åšæ³•ã€‚ è¿™æ ·ä¸ä»…æœ‰åˆ©äºæ¨¡å—åŒ–å¼€å‘ï¼Œè¿˜èƒ½æ–¹ä¾¿ä¾èµ–ç®¡ç†å’Œå‘å¸ƒã€‚ è¯¥ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªç›®å½•ã€‚ 1.6.1 compiler-sfcè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ä¸»è¦ç”¨äºå¤„ç†å•æ–‡ä»¶ç»„ä»¶ã€‚ 1.6.2 server-rendererè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å’ŒæœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³çš„å†…å®¹ã€‚ 1.6.3 template-compilerè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹å­˜æ”¾æ¨¡æ¿ç¼–è¯‘ç›¸å…³çš„é€»è¾‘ã€‚ 1.7 scriptsè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºå­˜æ”¾å„ç§è‡ªåŠ¨åŒ–è„šæœ¬ã€‚ è¿™äº›è„šæœ¬é€šå¸¸ç”¨äºè¾…åŠ©é¡¹ç›®çš„æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒå’Œå…¶ä»–å¼€å‘ä»»åŠ¡ã€‚ 1.8 srcè¯¥æ–‡ä»¶å¤¹æ˜¯å­˜æ”¾ vueæ¡†æ¶æ ¸å¿ƒæºç çš„åœ°æ–¹ã€‚ 1.9 testè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºå­˜æ”¾å„ç§ç±»å‹çš„æµ‹è¯•æ–‡ä»¶ï¼Œè¿™äº›æµ‹è¯•æ–‡ä»¶ç”¨äºéªŒè¯ Vue.js æ¡†æ¶çš„åŠŸèƒ½æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚ 1.10 typesè¯¥æ–‡ä»¶å¤¹ä¸»è¦ç”¨äºå­˜æ”¾ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚ è¿™äº›ç±»å‹å®šä¹‰æ–‡ä»¶ä¸º Vue.js æä¾›äº†ç±»å‹æ”¯æŒï¼Œä½¿å¾—åœ¨ä½¿ç”¨ Vue.js æ—¶å¯ä»¥äº«å—é™æ€ç±»å‹æ£€æŸ¥çš„å¥½å¤„ï¼Œä»è€Œæé«˜ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚ 1.11 .editorconfigè¯¥æ–‡ä»¶ç”¨äºæŒ‡å®šç¼–è¾‘å™¨åº”è¯¥éµå¾ªçš„ä¸€ç³»åˆ—ç¼–ç å’Œæ ¼å¼åŒ–è§„åˆ™ã€‚ 1.12 .git-blame-ignore-revsè¯¥æ–‡ä»¶ç”¨äºå‘Šè¯‰ Git åœ¨æ‰§è¡Œ git blame å‘½ä»¤æ—¶å¿½ç•¥æŸäº›ç‰¹å®šçš„æäº¤è®°å½•ã€‚ 1.13 .gitignoreè¯¥æ–‡ä»¶ç”¨äºæŒ‡å®š Git åº”è¯¥å¿½ç•¥å“ªäº›æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³ä¸å°†è¿™äº›æ–‡ä»¶æˆ–ç›®å½•çº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚ 1.14 .prettierrcè¯¥æ–‡ä»¶ç”¨äºé…ç½® Prettierã€‚ Prettieræ˜¯ä¸€ä¸ªæµè¡Œçš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ä¿æŒä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚ Prettier å¯ä»¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆé¢„è®¾çš„ç¼–ç è§„èŒƒï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œä¸€è‡´æ€§ã€‚ 1.15 BACKERS.mdè¯¥æ–‡ä»¶ä¸»è¦ç”¨äºè®°å½•å’Œæ”¯æŒ Vue.js é¡¹ç›®çš„èµåŠ©è€…æˆ–è´¡çŒ®è€…ã€‚ è¿™ä»½æ–‡ä»¶é€šå¸¸åˆ—å‡ºäº†é‚£äº›é€šè¿‡èµ„é‡‘æˆ–å…¶ä»–å½¢å¼æ”¯æŒ Vue.js å‘å±•çš„ä¸ªäººæˆ–ç»„ç»‡ã€‚ 1.16 CHANGELOG.mdè¯¥æ–‡ä»¶ä¸»è¦ç”¨äºè®°å½•é¡¹ç›®çš„ç‰ˆæœ¬å˜æ›´å†å²ï¼ŒåŒ…æ‹¬æ¯ä¸ªç‰ˆæœ¬çš„æ–°å¢åŠŸèƒ½ã€æ”¹è¿›ã€ä¿®å¤çš„é”™è¯¯ä»¥åŠå…¶ä»–é‡è¦çš„å˜æ›´ä¿¡æ¯ã€‚ 1.17 LICENSEè¯¥æ–‡ä»¶ç”¨æ¥å®šä¹‰å’Œå£°æ˜é¡¹ç›®ä½¿ç”¨çš„è®¸å¯åè®®çš„æ–‡ä»¶ 1.18 README.mdè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„å…¥å£æ–‡æ¡£æ–‡ä»¶ã€‚ æ–‡ä»¶æä¾›äº†å…³äºé¡¹ç›®çš„æ¦‚è¿°ã€å®‰è£…æ­¥éª¤ã€ä½¿ç”¨æ–¹æ³•ã€è´¡çŒ®æŒ‡å—ç­‰å…³é”®ä¿¡æ¯ã€‚ 1.19 api-extractor.jsonè¯¥æ–‡ä»¶ç”¨äºé…ç½® API Extractor å·¥å…·ï¼ˆè¿™æ˜¯ä¸€ç§ç”¨äºç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰æ–‡æ¡£å’Œ API æŠ¥å‘Šçš„å·¥å…·ï¼‰ API Extractor é€šå¸¸ç”¨äºå¤§å‹ TypeScript é¡¹ç›®ä¸­ï¼Œå¸®åŠ©å¼€å‘è€…ç”Ÿæˆè¯¦ç»†çš„ API æ–‡æ¡£ï¼Œå¹¶ç¡®ä¿ç±»å‹å®šä¹‰çš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ã€‚ 1.20 api-extractor.tsconfig.jsonè¯¥æ–‡ä»¶ç”¨äºé…ç½® TypeScript ç¼–è¯‘é€‰é¡¹ï¼Œä»¥é…åˆ API Extractor å·¥å…·ç”Ÿæˆ API æ–‡æ¡£å’Œç±»å‹å®šä¹‰æ–‡ä»¶ã€‚ è¿™ä¸ªæ–‡ä»¶é€šå¸¸åŒ…å«äº†ä¸€äº›ç‰¹å®šçš„ TypeScript é…ç½®ï¼Œç¡®ä¿ API Extractor èƒ½å¤Ÿæ­£ç¡®åœ°è§£æå’Œå¤„ç†æºä»£ç ã€‚ 1.21 package.jsonè¯¥æ–‡ä»¶æ˜¯é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œç”¨äºæè¿°é¡¹ç›®çš„å…ƒæ•°æ®ä»¥åŠé¡¹ç›®ä¾èµ–å…³ç³»å’Œæ„å»ºè„šæœ¬ã€‚ 1.22 pnpm-lock.yamlè¯¥æ–‡ä»¶æ˜¯ç”± pnpm åŒ…ç®¡ç†å™¨ç”Ÿæˆçš„é”å®šæ–‡ä»¶ã€‚ ç”¨äºè®°å½•é¡¹ç›®ä¸­æ‰€æœ‰ä¾èµ–é¡¹çš„å…·ä½“ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•è¢«å®‰è£…çš„ã€‚ pnpm æ˜¯ä¸€ç§æ›¿ä»£ npm å’Œ yarn çš„é«˜æ€§èƒ½åŒ…ç®¡ç†å™¨ï¼Œå®ƒå…·æœ‰æ›´å¿«çš„é€Ÿåº¦å’Œæ›´å°‘çš„ç£ç›˜ç©ºé—´å ç”¨ã€‚ 1.23 pnpm-workspace.yamlè¯¥æ–‡ä»¶ç”¨äºé…ç½® pnpm å·¥ä½œåŒºï¼ˆworkspaceï¼‰ã€‚ pnpm æ”¯æŒå¤šé¡¹ç›®çš„å·¥ä½œåŒºæ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å…è®¸å¤šä¸ªç›¸å…³é¡¹ç›®å…±äº«ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†è¿™äº›é¡¹ç›®çš„ä¾èµ–å…³ç³»å’Œæ„å»ºæµç¨‹ã€‚ 1.24 tsconfig.jsonè¯¥æ–‡ä»¶æ˜¯ TypeScript ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ TypeScript ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æºä»£ç æ—¶åº”éµå¾ªçš„é€‰é¡¹å’Œè§„åˆ™ã€‚ 1.25 vitest.config.tsè¯¥æ–‡ä»¶ç”¨äºé…ç½® Vitest çš„æµ‹è¯•æ¡†æ¶é…ç½®æ–‡ä»¶ã€‚ Vitest æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ JavaScript å’Œ TypeScript æµ‹è¯•æ¡†æ¶ï¼Œå®ƒæä¾›äº†å¿«é€Ÿçš„æµ‹è¯•è¿è¡Œé€Ÿåº¦å’Œä¸°å¯Œçš„åŠŸèƒ½é›†ï¼Œé€‚ç”¨äºå‰ç«¯å’Œåç«¯å¼€å‘ã€‚ äºŒã€srcç›®å½•ä¸‹æœ‰ä»€ä¹ˆï¼Ÿä¸Šä¸€ç« èŠ‚æˆ‘ä»¬ç®€å•ä»‹ç»äº†ä¸€ä¸‹é srcæ–‡ä»¶å¤¹ä¸‹é¢çš„ä¸€äº›æ–‡ä»¶å†…å®¹ã€‚ è¿™äº›éƒ½æ˜¯åœ¨ä¸€ä¸ªå·¥ç¨‹åŒ–çš„æ¡†æ¶é¡¹ç›®ä¸­å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ã€‚ é‚£ä¹ˆæœ¬èŠ‚çš„å†…å®¹å°±æ˜¯çœ‹ä¸‹ src æ–‡ä»¶å¤¹ä¸‹åŒ…å«å“ªäº›å†…å®¹ã€‚ ä¸‹é¢è¿™ä¸ªç›®å½•ç»“æ„å»é™¤äº† tsç›¸å…³çš„å£°æ˜æ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147srcâ”œâ”€shared| â”œâ”€constants.ts| â””util.tsâ”œâ”€platforms| â”œâ”€web| | â”œâ”€entry-compiler.ts| | â”œâ”€entry-runtime-esm.ts| | â”œâ”€entry-runtime-with-compiler-esm.ts| | â”œâ”€entry-runtime-with-compiler.ts| | â”œâ”€entry-runtime.ts| | â”œâ”€runtime-with-compiler.ts| | â”œâ”€util| | | â”œâ”€attrs.ts| | | â”œâ”€class.ts| | | â”œâ”€compat.ts| | | â”œâ”€element.ts| | | â”œâ”€index.ts| | | â””style.ts| | â”œâ”€runtime| | | â”œâ”€class-util.ts| | | â”œâ”€index.ts| | | â”œâ”€node-ops.ts| | | â”œâ”€patch.ts| | | â”œâ”€transition-util.ts| | | â”œâ”€modules| | | | â”œâ”€attrs.ts| | | | â”œâ”€class.ts| | | | â”œâ”€dom-props.ts| | | | â”œâ”€events.ts| | | | â”œâ”€index.ts| | | | â”œâ”€style.ts| | | | â””transition.ts| | | â”œâ”€directives| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””show.ts| | | â”œâ”€components| | | | â”œâ”€index.ts| | | | â”œâ”€transition-group.ts| | | | â””transition.ts| | â”œâ”€compiler| | | â”œâ”€index.ts| | | â”œâ”€options.ts| | | â”œâ”€util.ts| | | â”œâ”€modules| | | | â”œâ”€class.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””style.ts| | | â”œâ”€directives| | | | â”œâ”€html.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””text.tsâ”œâ”€core| â”œâ”€config.ts| â”œâ”€index.ts| â”œâ”€vdom| | â”œâ”€create-component.ts| | â”œâ”€create-element.ts| | â”œâ”€create-functional-component.ts| | â”œâ”€patch.ts| | â”œâ”€vnode.ts| | â”œâ”€modules| | | â”œâ”€directives.ts| | | â”œâ”€index.ts| | | â””template-ref.ts| | â”œâ”€helpers| | | â”œâ”€extract-props.ts| | | â”œâ”€get-first-component-child.ts| | | â”œâ”€index.ts| | | â”œâ”€is-async-placeholder.ts| | | â”œâ”€merge-hook.ts| | | â”œâ”€normalize-children.ts| | | â”œâ”€normalize-scoped-slots.ts| | | â”œâ”€resolve-async-component.ts| | | â””update-listeners.ts| â”œâ”€util| | â”œâ”€debug.ts| | â”œâ”€env.ts| | â”œâ”€error.ts| | â”œâ”€index.ts| | â”œâ”€lang.ts| | â”œâ”€next-tick.ts| | â”œâ”€options.ts| | â”œâ”€perf.ts| | â””props.ts| â”œâ”€observer| | â”œâ”€array.ts| | â”œâ”€dep.ts| | â”œâ”€index.ts| | â”œâ”€scheduler.ts| | â”œâ”€traverse.ts| | â””watcher.ts| â”œâ”€instance| | â”œâ”€events.ts| | â”œâ”€index.ts| | â”œâ”€init.ts| | â”œâ”€inject.ts| | â”œâ”€lifecycle.ts| | â”œâ”€proxy.ts| | â”œâ”€render.ts| | â”œâ”€state.ts| | â”œâ”€render-helpers| | | â”œâ”€bind-dynamic-keys.ts| | | â”œâ”€bind-object-listeners.ts| | | â”œâ”€bind-object-props.ts| | | â”œâ”€check-keycodes.ts| | | â”œâ”€index.ts| | | â”œâ”€render-list.ts| | | â”œâ”€render-slot.ts| | | â”œâ”€render-static.ts| | | â”œâ”€resolve-filter.ts| | | â”œâ”€resolve-scoped-slots.ts| | | â””resolve-slots.ts| â”œâ”€global-api| | â”œâ”€assets.ts| | â”œâ”€extend.ts| | â”œâ”€index.ts| | â”œâ”€mixin.ts| | â””use.ts| â”œâ”€components| | â”œâ”€index.ts| | â””keep-alive.tsâ”œâ”€compiler| â”œâ”€codeframe.ts| â”œâ”€create-compiler.ts| â”œâ”€error-detector.ts| â”œâ”€helpers.ts| â”œâ”€index.ts| â”œâ”€optimizer.ts| â”œâ”€to-function.ts| â”œâ”€parser| | â”œâ”€entity-decoder.ts| | â”œâ”€filter-parser.ts| | â”œâ”€html-parser.ts| | â”œâ”€index.ts| | â””text-parser.ts| â”œâ”€directives| | â”œâ”€bind.ts| | â”œâ”€index.ts| | â”œâ”€model.ts| | â””on.ts| â”œâ”€codegen| | â”œâ”€events.ts| | â””index.ts ä¸‰ã€sharedæ–‡ä»¶å¤¹ 1234srcâ”œâ”€shared| â”œâ”€constants.ts| â””util.ts è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«äº†ä¸€äº›åœ¨ä¸åŒç¯å¢ƒä¸‹éƒ½éœ€è¦å…±äº«çš„å·¥å…·å‡½æ•°æˆ–è€…å¸¸é‡ã€‚ è¿™ä¸ªå·¥å…·å‡½æ•°ä¸å¹³å°æ— å…³ã€‚ æ—¢å¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡ç«¯ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šçš„ç¯å¢ƒç‰¹æ€§ï¼ˆä¾‹å¦‚ DOMï¼‰ã€‚ constants.tsæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›åœ¨æ•´ä¸ªæ¡†æ¶å†…é¢‘ç¹ä½¿ç”¨çš„å¸¸é‡ï¼Œæ¯”å¦‚ç‰¹æ®Šçš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ã€é…ç½®é”®åç­‰ã€‚ util.tsæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›åŸºç¡€çš„å·¥å…·å‡½æ•°ï¼Œæ¯”å¦‚ isStringã€isObjectå’Œå…¶ä»–ä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¦‚æ·±æ‹·è´ã€è­¦å‘Šè¾“å‡ºç­‰ã€‚ è¿™äº›æ–‡ä»¶çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚ é€šè¿‡å°†è¿™äº›åŠŸèƒ½æŠ½è±¡å‡ºæ¥ï¼ŒVue.js èƒ½å¤Ÿä¿æŒæ ¸å¿ƒé€»è¾‘çš„ç®€æ´ï¼Œå¹¶ä¸”ç¡®ä¿ä¸åŒéƒ¨åˆ†ä¹‹é—´çš„å…¼å®¹æ€§ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯å‡å°‘äº†é‡å¤ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ å››ã€platformsæ–‡ä»¶å¤¹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152srcâ”œâ”€platforms| â”œâ”€web| | â”œâ”€entry-compiler.ts| | â”œâ”€entry-runtime-esm.ts| | â”œâ”€entry-runtime-with-compiler-esm.ts| | â”œâ”€entry-runtime-with-compiler.ts| | â”œâ”€entry-runtime.ts| | â”œâ”€runtime-with-compiler.ts| | â”œâ”€util| | | â”œâ”€attrs.ts| | | â”œâ”€class.ts| | | â”œâ”€compat.ts| | | â”œâ”€element.ts| | | â”œâ”€index.ts| | | â””style.ts| | â”œâ”€runtime| | | â”œâ”€class-util.ts| | | â”œâ”€index.ts| | | â”œâ”€node-ops.ts| | | â”œâ”€patch.ts| | | â”œâ”€transition-util.ts| | | â”œâ”€modules| | | | â”œâ”€attrs.ts| | | | â”œâ”€class.ts| | | | â”œâ”€dom-props.ts| | | | â”œâ”€events.ts| | | | â”œâ”€index.ts| | | | â”œâ”€style.ts| | | | â””transition.ts| | | â”œâ”€directives| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””show.ts| | | â”œâ”€components| | | | â”œâ”€index.ts| | | | â”œâ”€transition-group.ts| | | | â””transition.ts| | â”œâ”€compiler| | | â”œâ”€index.ts| | | â”œâ”€options.ts| | | â”œâ”€util.ts| | | â”œâ”€modules| | | | â”œâ”€class.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””style.ts| | | â”œâ”€directives| | | | â”œâ”€html.ts| | | | â”œâ”€index.ts| | | | â”œâ”€model.ts| | | | â””text.ts 4.1 ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªplatformsç›®å½•å‘¢ï¼Ÿplatforms ç¿»è¯‘æˆä¸­æ–‡è¡¨ç¤ºâ€œå¹³å°â€œã€‚ vueä½œä¸ºä¸€ä¸ªè·¨å¹³å°çš„æ¡†æ¶ï¼Œä¸ä»…æ”¯æŒä¼ ç»Ÿçš„webæµè§ˆå™¨ç¯å¢ƒï¼Œè¿˜æ”¯æŒå…¶ä»–å¹³å°ï¼Œå¦‚æœåŠ¡å™¨æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Œç”šè‡³æ˜¯éæµè§ˆå™¨ç¯å¢ƒã€‚ å› æ­¤ï¼Œå°† Web å¹³å°ç›¸å…³çš„ä»£ç å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œæœ‰åŠ©äºä¿æŒä»£ç çš„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ã€‚ Webå¹³å°æœ‰è®¸å¤šç‰¹å®šçš„åŠŸï¼Œæ¯”å¦‚ DOMæ“ä½œã€CSSåŠ¨ç”»ã€äº‹ä»¶å¤„ç†ç­‰ã€‚è¿™äº›åŠŸèƒ½åœ¨ Vueçš„ Webç‰ˆæœ¬ä¸­æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯åœ¨å…¶ä»–å¹³å°ä¸Šåˆ™ä¸ä¸€å®šé€‚ç”¨ã€‚å°†è¿™äº›ä»£ç ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå¯ä»¥ç¡®ä¿å®ƒä»¬åªåœ¨ Webå¹³å°ä¸Šç”Ÿæ•ˆï¼Œè€Œä¸ä¼šå½±å“åˆ°å…¶ä»–å¹³å°çš„æ„å»ºã€‚ å½“ç„¶ç›®å‰ä»…ä»…åªæœ‰ä¸€ä¸ªwebå¹³å°ï¼Œæ‰€ä»¥å¹³å°ä¸‹åªæœ‰ä¸€ä¸ª webç›®å½•ã€‚ 4.2 å‡ ä¸ªå…¥å£æ–‡ä»¶entry-*æ–‡ä»¶ä¸»è¦ç”¨äºå®šä¹‰ä¸åŒæ„å»ºé…ç½®ä¸‹çš„å…¥å£ç‚¹ã€‚ webç›®å½•ä¸‹æœ‰entry-compiler.tsã€entry-runtime-esm.tsã€entry-runtime-with-compiler-esm.tsã€entry-runtime-with-compilerã€entry-runtime.tsäº”ä¸ªå…¥å£æ–‡ä»¶ã€‚ åœ¨vueæºç scripts/config.jsä¸­æœ‰æ‰“åŒ…ç›¸å…³çš„é…ç½®ï¼Œå…¶ä¸­å°±åˆ©ç”¨äº†è¿™å‡ ä¸ªå…¥å£æ–‡ä»¶ã€‚ 4.2.1 entry-compiler.tsè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªæä¾›ç¼–è¯‘ html æ¨¡æ¿ç›¸å…³æ¥å£çš„æ¨¡å—ï¼Œé€šå¸¸ç”¨äºä¸º Vue ç¼–å†™çš„æ„å»ºæ’ä»¶ï¼Œæ¯”å¦‚ vue-loaderã€‚ 1234567891011// scripts/config.jslet builds = &#123; compiler: &#123; entry: resolve(&#x27;web/entry-compiler.ts&#x27;), dest: resolve(&#x27;packages/template-compiler/build.js&#x27;), format: &#x27;cjs&#x27;, external: Object.keys( require(&#x27;../packages/template-compiler/package.json&#x27;).dependencies ) &#125;,&#125; 4.2.2 entry-runtime.ts &amp; entry-runtime-esm.tsè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½ç”¨äºæ„å»ºä»…åŒ…å«è¿è¡Œæ—¶çš„æ–‡ä»¶ï¼Œä¸å…·å¤‡ç¼–è¯‘ html æ¨¡æ¿åŠŸèƒ½ã€‚åŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯ esmæ ¼å¼ï¼Œä¸€ä¸ªä¸æ˜¯ã€‚ 12345678910111213141516// scripts/config.jslet builds = &#123; &#x27;runtime-esm&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-esm.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.esm.js&#x27;), format: &#x27;es&#x27;, banner &#125;, &#x27;runtime-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime.ts&#x27;), dest: resolve(&#x27;dist/vue.runtime.min.js&#x27;), format: &#x27;umd&#x27;, env: &#x27;production&#x27;, banner &#125;,&#125; 4.2.3 entry-runtime-with-compiler.ts &amp; entry-runtime-with-compiler-esm.tsè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½ç”¨äºæ„å»ºåŒæ—¶åŒ…å«ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶çš„å…¨åŠŸèƒ½æ–‡ä»¶ã€‚ åŒºåˆ«æ˜¯ä¸€ä¸ªæ˜¯ esmæ ¼å¼ï¼Œä¸€ä¸ªä¸æ˜¯ã€‚ ä¸‹é¢çš„full-cjs-prodå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªå…¨ç‰ˆæœ¬ï¼Œæœ‰ vueçš„å…¨éƒ¨åŠŸèƒ½ã€‚ 1234567891011121314151617181920// scripts/config.jslet builds = &#123; &#x27;full-cjs-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-with-compiler.ts&#x27;), dest: resolve(&#x27;dist/vue.common.prod.js&#x27;), format: &#x27;cjs&#x27;, env: &#x27;production&#x27;, alias: &#123; he: &#x27;./entity-decoder&#x27; &#125;, banner &#125;, &#x27;full-esm-browser-prod&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-with-compiler-esm.ts&#x27;), dest: resolve(&#x27;dist/vue.esm.browser.min.js&#x27;), format: &#x27;es&#x27;, transpile: false, env: &#x27;production&#x27;, alias: &#123; he: &#x27;./entity-decoder&#x27; &#125;, banner &#125;,&#125; 4.3 runtime-with-compiler.tsä¹‹å‰æˆ‘ä»¬äº†è§£åˆ° Vueåˆ†ä¸º runtime å’Œ compilerä¸¤ä¸ªéƒ¨åˆ†ã€‚ è€Œ runtime-with-compiler.tsæ–‡ä»¶å°±æ˜¯æ—¢æœ‰ runtimeéƒ¨åˆ† ä¹Ÿæœ‰ compileréƒ¨åˆ†ã€‚ ä¸Šé¢çš„entry-runtime-with-compiler.tså’Œentry-runtime-with-compiler-esm.tså°±æ˜¯åŸºäºè¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…çš„ã€‚åªæ˜¯åˆ†åˆ«æ‰©å±•äº†vueçš„ä¸€äº›åŠŸèƒ½ã€‚ 4.4 utilç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vueåœ¨ Webå¹³å°ä¸Šå¸¸ç”¨çš„å·¥å…·å‡½æ•°å’Œä½¿ç”¨å·¥å…·ã€‚ è¿™äº›å·¥å…·ä¸»è¦ç”¨äºå¤„ç†ä¸ Webå¹³å°ç›¸å…³çš„å„ç§ç»†èŠ‚ã€‚ 4.5 runtimeç›®å½•4.5.1 componentsç›®å½•è¯¥ç›®å½•ä¸‹å­˜æ”¾ç€ vue webå¹³å°ä¸­ä½¿ç”¨çš„ç»„ä»¶å¦‚ transitionã€transition-groupç»„ä»¶ç­‰ï¼Œå€ŸåŠ©è¿™äº›ç»„ä»¶å¯ä»¥å®ç°è¿‡æ¸¡åŠ¨ç”»ã€‚ 4.5.2 directivesç›®å½•è¯¥ç›®å½•ä¸‹çš„ä¸»è¦å­˜æ”¾æ˜¯ vueçš„å†…éƒ¨æŒ‡ä»¤æ–‡ä»¶ï¼Œå¦‚v-modelã€v-showæŒ‡ä»¤ã€‚ 4.5.3 modulesç›®å½•è¯¥ç›®å½•ä¸‹çš„ä¸»è¦å­˜æ”¾çš„æ˜¯vueåœ¨ webå¹³å°ä¸Šå¸¸è§çš„ DOMæ“ä½œå’Œç‰¹æ€§å¤„ç†ã€‚ 4.5.3.1 attrs.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†å…ƒç´ å±æ€§çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£æ›´æ–°å’Œç®¡ç†å…ƒç´ çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå½“æ•°æ®æ¨¡å‹ä¸­çš„å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–° DOM ä¸­ç›¸åº”çš„å±æ€§å€¼ã€‚ 4.5.3.2 class.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†å…ƒç´ ç±»çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£æ›´æ–°å’Œç®¡ç†å…ƒç´ çš„ç±»åã€‚ä¾‹å¦‚ï¼Œæ ¹æ®æ•°æ®æ¨¡å‹ä¸­çš„æ¡ä»¶åŠ¨æ€æ·»åŠ æˆ–ç§»é™¤ç±»åã€‚ 4.5.3.3 dom-props.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç† DOM å±æ€§çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£åŒæ­¥å’Œæ›´æ–° DOM å±æ€§ï¼Œå¦‚ value, checked ç­‰ã€‚è¿™åœ¨å¤„ç†è¡¨å•æ§ä»¶æ—¶å°¤ä¸ºé‡è¦ã€‚ 4.5.3.4 events.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†äº‹ä»¶ç»‘å®šçš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£åœ¨ DOM å…ƒç´ ä¸Šæ·»åŠ ã€æ›´æ–°å’Œç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€‚è¿™ä½¿å¾— Vue.js å¯ä»¥å“åº”ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œå¹¶è§¦å‘ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚ 4.5.3.5 style.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†å†…è”æ ·å¼çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£æ›´æ–°å’Œç®¡ç†å…ƒç´ çš„å†…è”æ ·å¼ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®æ•°æ®æ¨¡å‹ä¸­çš„æ¡ä»¶åŠ¨æ€è®¾ç½®æˆ–ç§»é™¤å†…è”æ ·å¼ã€‚ 4.5.3.6 transition.tsè¿™ä¸ªæ–‡ä»¶å®ç°äº†å¤„ç†è¿‡æ¸¡åŠ¨ç”»çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£åº”ç”¨è¿‡æ¸¡ç±»ï¼Œç®¡ç†è¿‡æ¸¡çŠ¶æ€ï¼Œå¹¶ç¡®ä¿è¿‡æ¸¡æ•ˆæœæ­£ç¡®åœ°åº”ç”¨äºå…ƒç´ ã€‚ 4.5.4 transition-util.tsè¯¥æ–‡ä»¶åŒ…å«äº† Vue.js åœ¨ Web å¹³å°ä¸Šä¸è¿‡æ¸¡åŠ¨ç”»ç›¸å…³çš„å®ç”¨å·¥å…·å‡½æ•°ã€‚ è¿™äº›å·¥å…·å‡½æ•°ä¸º &lt;transition&gt; å’Œ &lt;transition-group&gt; ç»„ä»¶æä¾›äº†åº•å±‚çš„æ”¯æŒï¼Œä½¿å¾— Vue.js èƒ½å¤Ÿç®¡ç†å’Œæ§åˆ¶å…ƒç´ çš„è¿‡æ¸¡æ•ˆæœã€‚ 4.5.5 patch.tsè¯¥æ–‡ä»¶æ˜¯ Vue.js åœ¨ Web å¹³å°ä¸Šè´Ÿè´£ DOM æ›´æ–°çš„æ ¸å¿ƒæ¨¡å—ã€‚ è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº† patch å‡½æ•°ï¼Œå®ƒæ˜¯ Vue.js æ¸²æŸ“å¼•æ“çš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€ï¼Œç”¨äºå°†è™šæ‹Ÿ DOMï¼ˆVirtual DOMï¼‰æ›´æ–°åˆ°å®é™…çš„ DOM ä¸Šã€‚ ä»–å®é™…ä¸Šå¼•ç”¨äº†core/vdom/patchç›®å½•ä¸‹çš„ createPatchFunctionå‡½æ•°ã€‚ 4.5.6 node-ops.tsè¯¥æ–‡ä»¶åŒ…å«äº† Vue.js åœ¨ Web å¹³å°ä¸Šè¿›è¡Œ DOM æ“ä½œçš„å…·ä½“å®ç°ã€‚ è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ˜¯ Vue.js æ¸²æŸ“å¼•æ“åœ¨æ›´æ–° DOM æ—¶ä½¿ç”¨çš„å…·ä½“æ“ä½œã€‚å¦‚æ·»åŠ èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ç­‰ã€‚ 4.5.7 class-util.tsè¯¥æ–‡ä»¶åŒ…å«äº† vue åœ¨ webå¹³å°ä¸Šä¸å…ƒç´ ç±»ç›¸å…³çš„ä½¿ç”¨å·¥å…·å‡½æ•°ã€‚ è¿™äº›å·¥å…·å‡½æ•°ç”¨äºå¤„ç†å…ƒç´ çš„ç±»åï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤å’Œåˆ‡æ¢ç±»åç­‰æ“ä½œã€‚ 4.6 compilerç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vue.js åœ¨ Web å¹³å°ä¸Šè¿›è¡Œæ¨¡æ¿ç¼–è¯‘çš„ç›¸å…³å®ç°ã€‚ è¿™ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ¨¡å—è´Ÿè´£å°† Vue æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯ä»¥è¢« Vue æ¸²æŸ“å¼•æ“æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°ã€‚ å…¶ä¸­ directivesç›®å½•ä¸‹çš„æ–‡ä»¶ å®šä¹‰äº†ä¸€äº›å†…ç½®æŒ‡ä»¤å¦‚v-htmlã€v-textã€‚ modulesç›®å½•ä¸­å­˜æ”¾äº†å¯¹åº”å¤„ç†æ¨¡æ¿ç¼–è¯‘æ—¶éœ€è¦çš„ä¸€äº›é€šç”¨å¤„ç†æ–¹æ³•ã€‚ å…¶ä½™æ–‡ä»¶ä¸ºé€šç”¨å·¥å…·ç­‰ã€‚ äº”ã€coreæ–‡ä»¶å¤¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071srcâ”œâ”€core| â”œâ”€config.ts| â”œâ”€index.ts| â”œâ”€vdom| | â”œâ”€create-component.ts| | â”œâ”€create-element.ts| | â”œâ”€create-functional-component.ts| | â”œâ”€patch.ts| | â”œâ”€vnode.ts| | â”œâ”€modules| | | â”œâ”€directives.ts| | | â”œâ”€index.ts| | | â””template-ref.ts| | â”œâ”€helpers| | | â”œâ”€extract-props.ts| | | â”œâ”€get-first-component-child.ts| | | â”œâ”€index.ts| | | â”œâ”€is-async-placeholder.ts| | | â”œâ”€merge-hook.ts| | | â”œâ”€normalize-children.ts| | | â”œâ”€normalize-scoped-slots.ts| | | â”œâ”€resolve-async-component.ts| | | â””update-listeners.ts| â”œâ”€util| | â”œâ”€debug.ts| | â”œâ”€env.ts| | â”œâ”€error.ts| | â”œâ”€index.ts| | â”œâ”€lang.ts| | â”œâ”€next-tick.ts| | â”œâ”€options.ts| | â”œâ”€perf.ts| | â””props.ts| â”œâ”€observer| | â”œâ”€array.ts| | â”œâ”€dep.ts| | â”œâ”€index.ts| | â”œâ”€scheduler.ts| | â”œâ”€traverse.ts| | â””watcher.ts| â”œâ”€instance| | â”œâ”€events.ts| | â”œâ”€index.ts| | â”œâ”€init.ts| | â”œâ”€inject.ts| | â”œâ”€lifecycle.ts| | â”œâ”€proxy.ts| | â”œâ”€render.ts| | â”œâ”€state.ts| | â”œâ”€render-helpers| | | â”œâ”€bind-dynamic-keys.ts| | | â”œâ”€bind-object-listeners.ts| | | â”œâ”€bind-object-props.ts| | | â”œâ”€check-keycodes.ts| | | â”œâ”€index.ts| | | â”œâ”€render-list.ts| | | â”œâ”€render-slot.ts| | | â”œâ”€render-static.ts| | | â”œâ”€resolve-filter.ts| | | â”œâ”€resolve-scoped-slots.ts| | | â””resolve-slots.ts| â”œâ”€global-api| | â”œâ”€assets.ts| | â”œâ”€extend.ts| | â”œâ”€index.ts| | â”œâ”€mixin.ts| | â””use.ts| â”œâ”€components| | â”œâ”€index.ts| | â””keep-alive.ts coreæ–‡ä»¶å¤¹æ˜¯å­˜å‚¨è¿™ vueçš„æ ¸å¿ƒé€»è¾‘ã€‚ 5.1 componentsç›®å½•è¯¥ç›®å½•ä¸‹å­˜æ”¾äº†ä¸€äº›å†…ç½®ç»„ä»¶å¦‚ keep-aliveã€‚ 5.2 global-apiç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vue.jsåœ¨æ ¸å¿ƒå±‚é¢æä¾›çš„å…¨å±€ APIçš„å®ç°ã€‚ å¦‚Vue.mixinã€Vue.useã€Vue.extendç­‰ã€‚ 5.3 instanceç›®å½•è¯¥ç›®å½•åŒ…å«äº† vueå®ä¾‹ç›¸å…³çš„ä¸»è¦å®ç°ã€‚ å…¶ä¸­:render.jsè´Ÿè´£æ¸²æŸ“ç›¸å…³çš„é€»è¾‘ã€lifecycle.jsè´Ÿè´£ç®¡ç† vueå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€events.jsè´Ÿè´£å¤„ç† vueå®ä¾‹ä¸Šçš„äº‹ä»¶ã€state.jsè´Ÿè´£ç®¡ç† vueå®ä¾‹çš„æ•°æ®çŠ¶æ€ç­‰ã€‚ 5.4 observeç›®å½•è¯¥ç›®å½•åŒ…å«äº† Vue.js ä¸­ç”¨äºå®ç°å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ã€‚ è¿™éƒ¨åˆ†ä»£ç è´Ÿè´£å°†æ•°æ®å¯¹è±¡è½¬æ¢ä¸ºå¯è§‚å¯Ÿçš„å¯¹è±¡ï¼Œä½¿å¾—æ•°æ®çš„å˜åŒ–èƒ½å¤Ÿè¢«è¿½è¸ªï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ä¾èµ–äºè¯¥æ•°æ®çš„è§†å›¾ã€‚ 5.5 vdomç›®å½•è¯¥ç›®å½•åŒ…å«äº†Vue.js å¤„ç†è™šæ‹Ÿ DOM (Virtual DOM) çš„ç›¸å…³å®ç°ã€‚ è™šæ‹Ÿ DOM æ˜¯ Vue.js æ¸²æŸ“æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒé€šè¿‡å†…å­˜ä¸­çš„ JavaScript å¯¹è±¡æ¥è¡¨ç¤ºçœŸå®çš„ DOM èŠ‚ç‚¹ã€‚ å…­ã€compileræ–‡ä»¶å¤¹è¯¥ç›®å½•å­˜æ”¾äº†vueæ¨¡æ¿ç¼–è¯‘çš„ç›¸å…³å†…å®¹ã€‚ 1234567891011121314151617181920212223srcâ”œâ”€compiler| â”œâ”€codeframe.ts| â”œâ”€create-compiler.ts| â”œâ”€error-detector.ts| â”œâ”€helpers.ts| â”œâ”€index.ts| â”œâ”€optimizer.ts| â”œâ”€to-function.ts| â”œâ”€parser| | â”œâ”€entity-decoder.ts| | â”œâ”€filter-parser.ts| | â”œâ”€html-parser.ts| | â”œâ”€index.ts| | â””text-parser.ts| â”œâ”€directives| | â”œâ”€bind.ts| | â”œâ”€index.ts| | â”œâ”€model.ts| | â””on.ts| â”œâ”€codegen| | â”œâ”€events.ts| | â””index.ts ä¸ƒã€æ€»ç»“æˆ‘ä»¬è¿™ç« å¤§æ¦‚çš„ä»‹ç»äº† vueçš„å¤§ä½“ç›®å½•ç»“æ„ã€‚"},{"title":"äºŒã€Javaè¯­è¨€å‘å±•å†å²","path":"//posts/Javaè¯­è¨€å‘å±•å†å².html","content":"1ã€Javaè¯­è¨€å‘å±•å†å² å‘è¡Œç‰ˆæœ¬ å‘è¡Œæ—¶é—´ å¤‡æ³¨ Java 1995.05.23 SUNå…¬å¸åœ¨ Sun worldä¼šè®®ä¸Šæ­£å¼å‘å¸ƒ Javaå’Œ HotJavaæµè§ˆå™¨ Java1.0 1996.01.23 SUNå…¬å¸å‘éƒ¨äº† Javaçš„ç¬¬ä¸€ä¸ªå¼€å‘å·¥å…·åŒ… Java1.1 1997.02.19 Java1.2 1998.12.08 æ‹†åˆ†æˆï¼šJ2SE(æ ‡å‡†ç‰ˆ)ã€J2EE(ä¼ä¸šçº§)ã€J2ME(å°å‹ç‰ˆ) Java1.3 2000.05.08 Java1.4 2004.02.06 Java5.0 2004.09.30 1.ç‰ˆæœ¬å·ä» 1.4 ç›´æ¥æ›´æ–°è‡³ 5.0ï¼› 2.å¹³å°æ›´åä¸ºJavaSEã€JavaEEã€JavaME Java6.0 2006.12.11 2009.04.20 Oracleå®£å¸ƒæ”¶è´­ SUNå…¬å¸ Java7.0 2011.07.02 Java8.0 2014.03.18 LTSç‰ˆæœ¬ Java9.0 2017.09.22 1.æ¯åŠå¹´æ›´æ–°ä¸€æ¬¡ 2.Java9.0å¼€å§‹ä¸å†æ”¯æŒ window32ä½ç³»ç»Ÿ Java10.0 2018.03.21 Java11.0 2018.09.25 1.JDKå®‰è£…åŒ…å–æ¶ˆç‹¬ç«‹ JREå®‰è£…åŒ…ï¼›2.LTSç‰ˆæœ¬ Java12.0 2019.03.19 Java13.0 2019.09.17 Java14.0 2020.03.17 Java15.0 2020.09.16 Java16.0 2021.03.16 Java17.0 2021.09.14 LTSç‰ˆæœ¬ LTSï¼ˆLong Term Supportï¼‰:é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œä¸‹ä¸€ä¸ª LTSç‰ˆæœ¬ä¸º Java17.0","tags":["blog"],"categories":["Java","JavaåŸºç¡€"]},{"title":"ä¸€ã€è®¡ç®—æœºè¯­è¨€ä»‹ç»","path":"//posts/è®¡ç®—æœºè¯­è¨€ä»‹ç».html","content":"1ã€è®¡ç®—æœºè¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿæ‰€è°“è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ï¼Œå°±æ˜¯äººä»¬å¯ä»¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€å¯¹è®¡ç®—æœºä¸‹è¾¾å‘½ä»¤ï¼Œè®©è®¡ç®—æœºå®Œæˆäººä»¬éœ€è¦çš„åŠŸèƒ½ã€‚ æ¯”å¦‚æ‰“æ¸¸æˆç­‰å°±æ˜¯è¾“å…¥æŒ‡ä»¤è®©è®¡ç®—æœºæ‰§è¡Œã€‚ 2ã€è®¡ç®—æœºè¯­è¨€å‘å±• ç¬¬ä¸€ä»£ï¼šæœºå™¨è¯­è¨€ ä¾‹å¦‚ï¼š0101 ä¸ç›´è§‚ ç¬¬äºŒä»£ï¼šæ±‡ç¼–è¯­è¨€ ä¾‹å¦‚ï¼šåŠ å…¥äº†å•è¯ ç¬¬ä¸‰ä»£ï¼šé«˜çº§è¯­è¨€ é¢å‘è¿‡ç¨‹è¯­è¨€ é¢å‘å¯¹è±¡è¯­è¨€ 3ã€è®¡ç®—æœºè¯­è¨€æ’è¡Œæ¦œä¸‹é¢æ˜¯ 2024 å¹´ 2 æœˆæœ€å—æ¬¢è¿çš„ 10 ç§ç¼–ç¨‹è¯­è¨€ã€‚ 4ã€è®¡ç®—æœºè¯­è¨€èµ°åŠ¿","tags":["blog"],"categories":["Java","JavaåŸºç¡€"]},{"path":"/css/extra.css","content":"/** è®¾ç½®ä¾§è¾¹æ åº•éƒ¨ **/ .social-wrap { display: block; } .social-wrap .social:hover { background-color: #d7beb6 } /** è®¾ç½®å³è¾¹æ  **/ /** å³è¾¹æ ç›®å½•é«˜åº¦è®¾ç½® **/ .l_right .widgets .widget-wrapper.toc .widget-body .toc{ /* max-height: calc(100vh - 500px); */ } .widget-wrapper.toc+.widget-wrapper{ padding-top: 0px; }"}]